"use strict";"bind"in Function.prototype||(Function.prototype.bind=function(e){var t,a=this;return arguments.length<=1?function(){return a.apply(e,arguments)}:(t=Array.prototype.slice.call(arguments,1),function(){return a.apply(e,0===arguments.length?t:t.concat(Array.prototype.slice.call(arguments)))})}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){(t=void 0===t?0:t)<0&&(t+=this.length),t<0&&(t=0);for(var a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(e,t){for((t=void 0===t?this.length-1:t)<0&&(t+=this.length),t>this.length-1&&(t=this.length-1),t++;0<t--;)if(t in this&&this[t]===e)return t;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(e,t){for(var a=0,s=this.length;a<s;a++)a in this&&e.call(t,this[a],a,this)}),"map"in Array.prototype||(Array.prototype.map=function(e,t){for(var a=new Array(this.length),s=0,n=this.length;s<n;s++)s in this&&(a[s]=e.call(t,this[s],s,this));return a}),"filter"in Array.prototype||(Array.prototype.filter=function(e,t){for(var a,s=[],n=0,o=this.length;n<o;n++)n in this&&e.call(t,a=this[n],n,this)&&s.push(a);return s}),"every"in Array.prototype||(Array.prototype.every=function(e,t){for(var a=0,s=this.length;a<s;a++)if(a in this&&!e.call(t,this[a],a,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(e,t){for(var a=0,s=this.length;a<s;a++)if(a in this&&e.call(t,this[a],a,this))return!0;return!1}),Object.keys||(Object.keys=function(){var n=Object.prototype.hasOwnProperty,o=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=i.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var t,a,s=[];for(t in e)n.call(e,t)&&s.push(t);if(o)for(a=0;a<r;a++)n.call(e,i[a])&&s.push(i[a]);return s}}()),window.console||(window.console={log:function(){}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),jQuery.cachedScript=function(e,t){return"file:"!=window.location.protocol&&"x-wmapp0:"!=window.location.protocol||(e="http:"+e),t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)},!function(e){("object"!=typeof exports||"undefined"==typeof module)&&"function"==typeof define&&define.amd?define(e):e()}(function(){function e(t){var a=this.constructor;return this.then(function(e){return a.resolve(t()).then(function(){return e})},function(e){return a.resolve(t()).then(function(){return a.reject(e)})})}function a(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function n(a,s){for(;3===a._state;)a=a._value;0!==a._state?(a._handled=!0,o._immediateFn(function(){var e,t=1===a._state?s.onFulfilled:s.onRejected;if(null!==t){try{e=t(a._value)}catch(e){return void r(s.promise,e)}i(s.promise,e)}else(1===a._state?i:r)(s.promise,a._value)})):a._deferreds.push(s)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if(e instanceof o)return t._state=3,t._value=e,d(t);if("function"==typeof a)return l((s=a,n=e,function(){s.apply(n,arguments)}),t)}t._state=1,t._value=e,d(t)}catch(e){r(t,e)}var s,n}function r(e,t){e._state=2,e._value=t,d(e)}function d(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,a=e._deferreds.length;t<a;t++)n(e,e._deferreds[t]);e._deferreds=null}function l(e,t){var a=!1;try{e(function(e){a||(a=!0,i(t,e))},function(e){a||(a=!0,r(t,e))})}catch(e){if(a)return;a=!0,r(t,e)}}var t=setTimeout,s=(o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(s,e){var t=new this.constructor(a);return n(this,new function(e,t,a){this.onFulfilled="function"==typeof s?s:null,this.onRejected="function"==typeof t?t:null,this.promise=a}(0,e,t)),t},o.prototype.finally=e,o.all=function(t){return new o(function(n,o){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(t);if(0===i.length)return n([]);for(var r=i.length,e=0;i.length>e;e++)!function t(a,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var s=e.then;if("function"==typeof s)return s.call(e,function(e){t(a,e)},o)}i[a]=e,0==--r&&n(i)}catch(e){o(e)}}(e,i[e])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(a){return new o(function(e,t){t(a)})},o.race=function(n){return new o(function(e,t){for(var a=0,s=n.length;a<s;a++)n[a].then(e,t)})},o._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){t(e,0)},o._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}());"Promise"in s?s.Promise.prototype.finally||(s.Promise.prototype.finally=e):s.Promise=o});var objectFitImages=function(){function r(e,t,a){t="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+(t||1)+"' height='"+(a||0)+"'%3E%3C/svg%3E";g.call(e,"src")!==t&&f.call(e,"src",t)}function d(e,t){e.naturalWidth?t(e):setTimeout(d,100,e,t)}function l(t){var a,s,e,n,o=function(e){for(var t,a=getComputedStyle(e).fontFamily,s={};null!==(t=m.exec(a));)s[t[1]]=t[2];return s}(t),i=t[c];if(o["object-fit"]=o["object-fit"]||"fill",!i.img){if("fill"===o["object-fit"])return;if(!i.skipTest&&u&&!o["object-position"])return}if(!i.img){i.img=new Image(t.width,t.height),i.img.srcset=g.call(t,"data-ofi-srcset")||t.srcset,i.img.src=g.call(t,"data-ofi-src")||t.src,f.call(t,"data-ofi-src",t.src),t.srcset&&f.call(t,"data-ofi-srcset",t.srcset),r(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{a=t,s={get:function(e){return a[c].img[e||"src"]},set:function(e,t){return a[c].img[t||"src"]=e,f.call(a,"data-ofi-"+t,e),l(a),e}},Object.defineProperty(a,"src",s),Object.defineProperty(a,"currentSrc",{get:function(){return s.get("currentSrc")}}),Object.defineProperty(a,"srcset",{get:function(){return s.get("srcset")},set:function(e){return s.set(e,"srcset")}})}catch(t){window.console&&console.warn("https://bit.ly/ofi-old-browser")}}(e=i.img).srcset&&!p&&window.picturefill&&(e[(n=window.picturefill._).ns]&&e[n.ns].evaled||n.fillImg(e,{reselect:!0}),e[n.ns].curSrc||(e[n.ns].supported=!1,n.fillImg(e,{reselect:!0})),e.currentSrc=e[n.ns].curSrc||e.src),t.style.backgroundImage='url("'+(i.img.currentSrc||i.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=o["object-position"]||"center",t.style.backgroundRepeat="no-repeat",t.style.backgroundOrigin="content-box",/scale-down/.test(o["object-fit"])?d(i.img,function(){i.img.naturalWidth>t.width||i.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"}):t.style.backgroundSize=o["object-fit"].replace("none","auto").replace("fill","100% 100%"),d(i.img,function(e){r(t,e.naturalWidth,e.naturalHeight)})}function n(e,t){var a=!h&&!e;if(t=t||{},o&&!t.skipTest||!i)return!1;"img"===(e=e||"img")?e=document.getElementsByTagName("img"):"string"==typeof e?e=document.querySelectorAll(e):"length"in e||(e=[e]);for(var s=0;s<e.length;s++)e[s][c]=e[s][c]||{skipTest:t.skipTest},l(e[s]);a&&(document.body.addEventListener("load",function(e){"IMG"===e.target.tagName&&n(e.target,{skipTest:t.skipTest})},!0),h=!0,e="img"),t.watchMQ&&window.addEventListener("resize",n.bind(null,e,{skipTest:t.skipTest}))}var c="bfred-it:object-fit-images",m=/(object-fit|object-position)\s*:\s*([-.\w\s%]+)/g,e="undefined"==typeof Image?{style:{"object-position":1}}:new Image,u="object-fit"in e.style,o="object-position"in e.style,i="background-size"in e.style,p="string"==typeof e.currentSrc,g=e.getAttribute,f=e.setAttribute,h=!1;return n.supportsObjectFit=u,(n.supportsObjectPosition=o)||(HTMLImageElement.prototype.getAttribute=function(e){return g.call(a(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,t){return f.call(a(this,e),e,String(t))}),n;function a(e,t){return e[c]&&e[c].img&&("src"===t||"srcset"===t)?e[c].img:e}}();!function s(n,o,i){function r(a,e){if(!o[a]){if(!n[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(d)return d(a,!0);e=new Error("Cannot find module '"+a+"'");throw e.code="MODULE_NOT_FOUND",e}t=o[a]={exports:{}};n[a][0].call(t.exports,function(e){var t=n[a][1][e];return r(t||e)},t,t.exports,s,n,o,i)}return o[a].exports}for(var d="function"==typeof require&&require,e=0;e<i.length;e++)r(i[e]);return r}({1:[function(e,t,a){e("./index").polyfill()},{"./index":2}],2:[function(e,t,a){function s(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var a=Object(e),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var o=Object.keys(Object(n)),i=0,r=o.length;i<r;i++){var d=o[i],l=Object.getOwnPropertyDescriptor(n,d);void 0!==l&&l.enumerable&&(a[d]=n[d])}}return a}t.exports={assign:s,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:s})}}},{}]},{},[1]),window.mystore={},window.mystore.loadedCss=[],window.mystore.charmap=JSON.parse('{"$":"dollar","%":"percent","&":"and","<":"less",">":"greater","|":"or","¢":"cent","£":"pound","¤":"currency","¥":"yen","©":"(c)","ª":"a","®":"(r)","º":"o","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","þ":"th","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"DJ","đ":"dj","Ē":"E","ē":"e","Ė":"E","ė":"e","Ę":"e","ę":"e","Ě":"E","ě":"e","Ğ":"G","ğ":"g","Ģ":"G","ģ":"g","Ĩ":"I","ĩ":"i","Ī":"i","ī":"i","Į":"I","į":"i","İ":"I","ı":"i","Ķ":"k","ķ":"k","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ũ":"U","ũ":"u","Ū":"u","ū":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","ǈ":"LJ","ǉ":"lj","ǋ":"NJ","ǌ":"nj","Ș":"S","ș":"s","Ț":"T","ț":"t","˚":"o","Ά":"A","Έ":"E","Ή":"H","Ί":"I","Ό":"O","Ύ":"Y","Ώ":"W","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ϊ":"I","Ϋ":"Y","ά":"a","έ":"e","ή":"h","ί":"i","ΰ":"y","α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","ς":"s","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ϊ":"i","ϋ":"y","ό":"o","ύ":"y","ώ":"w","Ё":"Yo","Ђ":"DJ","Є":"Ye","І":"I","Ї":"Yi","Ј":"J","Љ":"LJ","Њ":"NJ","Ћ":"C","Џ":"DZ","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"U","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"u","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","ё":"yo","ђ":"dj","є":"ye","і":"i","ї":"yi","ј":"j","љ":"lj","њ":"nj","ћ":"c","џ":"dz","Ґ":"G","ґ":"g","฿":"baht","ა":"a","ბ":"b","გ":"g","დ":"d","ე":"e","ვ":"v","ზ":"z","თ":"t","ი":"i","კ":"k","ლ":"l","მ":"m","ნ":"n","ო":"o","პ":"p","ჟ":"zh","რ":"r","ს":"s","ტ":"t","უ":"u","ფ":"f","ქ":"k","ღ":"gh","ყ":"q","შ":"sh","ჩ":"ch","ც":"ts","ძ":"dz","წ":"ts","ჭ":"ch","ხ":"kh","ჯ":"j","ჰ":"h","ẞ":"SS","Ạ":"A","ạ":"a","Ả":"A","ả":"a","Ấ":"A","ấ":"a","Ầ":"A","ầ":"a","Ẩ":"A","ẩ":"a","Ẫ":"A","ẫ":"a","Ậ":"A","ậ":"a","Ắ":"A","ắ":"a","Ằ":"A","ằ":"a","Ẳ":"A","ẳ":"a","Ẵ":"A","ẵ":"a","Ặ":"A","ặ":"a","Ẹ":"E","ẹ":"e","Ẻ":"E","ẻ":"e","Ẽ":"E","ẽ":"e","Ế":"E","ế":"e","Ề":"E","ề":"e","Ể":"E","ể":"e","Ễ":"E","ễ":"e","Ệ":"E","ệ":"e","Ỉ":"I","ỉ":"i","Ị":"I","ị":"i","Ọ":"O","ọ":"o","Ỏ":"O","ỏ":"o","Ố":"O","ố":"o","Ồ":"O","ồ":"o","Ổ":"O","ổ":"o","Ỗ":"O","ỗ":"o","Ộ":"O","ộ":"o","Ớ":"O","ớ":"o","Ờ":"O","ờ":"o","Ở":"O","ở":"o","Ỡ":"O","ỡ":"o","Ợ":"O","ợ":"o","Ụ":"U","ụ":"u","Ủ":"U","ủ":"u","Ứ":"U","ứ":"u","Ừ":"U","ừ":"u","Ử":"U","ử":"u","Ữ":"U","ữ":"u","Ự":"U","ự":"u","Ỳ":"Y","ỳ":"y","Ỵ":"Y","ỵ":"y","Ỷ":"Y","ỷ":"y","Ỹ":"Y","ỹ":"y","‘":"\'","’":"\'","“":"\\"","”":"\\"","†":"+","•":"*","…":"...","₠":"ecu","₢":"cruzeiro","₣":"french franc","₤":"lira","₥":"mill","₦":"naira","₧":"peseta","₨":"rupee","₩":"won","₪":"new shequel","₫":"dong","€":"euro","₭":"kip","₮":"tugrik","₯":"drachma","₰":"penny","₱":"peso","₲":"guarani","₳":"austral","₴":"hryvnia","₵":"cedi","₹":"indian rupee","₽":"russian ruble","₿":"bitcoin","℠":"sm","™":"tm","∂":"d","∆":"delta","∑":"sum","∞":"infinity","♥":"love","元":"yuan","円":"yen","﷼":"rial"}'),window.mystore.utils={compareArrays:function(e,t){for(var a in t)for(var s in t[a])if(t[a][s]!=e[a][s])return 1;return 0},interpolate:function(e,s){if(!s||"object"!=typeof s)return e;var n=Array.isArray(s);return e=e.replace(/\#\#(.*?)\#\#/g,function(e,t){var a=n?s.shift():s[t];return a||"##"+t+"##"})},parseQuery:function(){var e={};if(!location.search)return e;for(var t=location.search.slice(1).split("&"),a=0;a<t.length;a++){var s=t[a].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}return e},parseFunction:function(e){if("function"==typeof e)return e;if("string"!=typeof e)return console.log("MS: ERROR: The function passed should be a valid function or function string"),void console.log(e);if(window[e])return window[e];if(e.match(/^[\w\.]+$/)){for(var t=e.split("."),a=window[t.shift()];a&&t.length&&(a=a[t.shift()]););if(a)return a}var s,n=e.match(/^\s*?function\s*?\(([\s\S]*?)\)\s*?{([\s\S]*?)}\s*?;?\s*$/);return n?(s=[],n[1]&&(s=n[1].split(",")),n=n[2],Function(s,n)):(s=[],"angularjs"==ms.theme.js_framework&&(s=["$scope"]),Function(s,e))},isURL:function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},loadStyles:function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)mystore.utils.loadCss(e[t])},loadCss:function(e){var t;-1==window.mystore.loadedCss.indexOf(e)&&("file:"!=window.location.protocol&&"x-wmapp0:"!=window.location.protocol||(e="http:"+e),(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t),window.mystore.loadedCss.push(e))},loadScripts:function(e,t){Array.isArray(e)||(e=[e]);for(var a=[],s=0;s<e.length;s++)a.push(mystore.utils.loadScript(e[s]));return t&&"function"==typeof t?Promise.all(a).then(t):Promise.all(a)},_loadingScripts:[],loadScript:function(i){return mystore.utils._loadingScripts[i]||(mystore.utils._loadingScripts[i]=new Promise(function(a,s){for(var e=document.getElementsByTagName("script"),t=e.length;t--;)if(e[t].src===i)return a();var n=document.createElement("script"),o=document.getElementsByTagName("script")[0];n.async=!1,n.onload=n.onreadystatechange=function(e,t){t||!n.readyState||/loaded|complete/.test(n.readyState)?(n.onload=n.onreadystatechange=null,delete mystore.utils._loadingScripts[i],n=void 0,t?s():setTimeout(a(),0)):(console.log("ERROR: Failed loading script: "+i),s())},n.src=i,o.parentNode.insertBefore(n,o)}),mystore.utils._loadingScripts[i])},removeDuplicateObjects:function(e,t,a){var s,n={},o=[];for(s in e.forEach(function(e){var t=e[a];n[t]=e}),t.forEach(function(e){var t=e[a];n[t]=e}),n){var i=n[s];o.push(i)}return o},removeExtraObjectFormArray:function(e,t,a){var s={},n=[];return t.forEach(function(e){var t=e[a];s[t]=e}),e.forEach(function(e){var t=e[a];s[t]&&n.push(e)}),n},clone:function(e){return JSON.parse(JSON.stringify(e))},getObjectFormArray:function(e,t,a){for(var s=null,n=0;n<e.length;n++)if(e[n][t]==a){s=e[n];break}return s},getObjectIndexFromArray:function(e,t,a){for(var s=-1,n=0;n<e.length;n++)if(e[n][t]==a){s=n;break}return s},createStructure:function(n,o){mystore.utils.logError("UNUSED: create structure called");var i={},r=0,d={},l={0:[],1:[],2:[],3:[],4:[]},c=[];n.forEach(function(e){r++,e.children=[];var t="root";if((d[e._id]=e).parent&&(t=e.parent),e.parent||l[0].push(e._id),i[t]||(i[t]=[]),i[t].push(e._id),r==n.length){for(var a=0;a<5;a++)l[a].forEach(function(e){i[e]&&(l[a+1]||(l[a+1]=[]),l[a+1]=l[a+1].concat(i[e]))});for(var s,a=4;0<=a;a--)l[a].forEach(function(e){d[e].parent&&(d[e].level=a+1,d[d[e].parent].children.push(d[e]))}),0==a&&(s=0,l[a].forEach(function(e){s++,d[e].level=a+1,c.push(d[e]),s==l[a].length&&o(c)}))}})},timestampFromMongoId:function(e){if(e&&"string"==typeof e&&new RegExp("^[0-9a-fA-F]{24}$").test(e))return e=e.substring(0,8),new Date(1e3*parseInt(e,16)).getTime();return null},sortArrayByField:function(e,a){e&&a&&e.length&&e.sort(function(e,t){return e[a]<t[a]?-1:e[a]>t[a]?1:0})},ms_ucfirst:function(e){return e?(e="object"==typeof e?JSON.stringify(e):e).substring(0,1).toUpperCase()+e.substring(1):""},slugify:function(e){if(!e)return"";for(var t,a=[],s=0;s<e.length;s++)(t=e.charCodeAt(s))<384&&(t=String.fromCharCode(t),a.push(mystore.charmap[t]||t));return(e=(e=a.join("")).replace(/[^a-zA-Z0-9\s-]/g,"-").trim().toLowerCase()).replace(/[-\s]+/g,"-")},logError:function(e){var t={error:e},e=(e instanceof ErrorEvent&&(t.error=e.error.message,t.stack=e.error.stack,t.fileName=e.filename,t.lineNumber=e.lineno),e instanceof Error&&(t.error=e.message,t.fileName=e.fileName,t.lineNumber=e.lineNumber,t.stack=e.stack),window.ms_store&&(t.store={name:ms_store.name,id:ms_store.storeId,level:ms_store.level,env:ms_store.env}),window.ms_store&&(t.store={name:ms_store.name,id:ms_store.storeId,level:ms_store.level,env:ms_store.env}),window.session&&(t.user={geo_location:session.geo_location}),window.appId&&(t.appid=window.appId),window.device&&(t.device=window.device),new XMLHttpRequest);(new Date).toUTCString();e.open("POST","/logerror2"),e.setRequestHeader("Content-type","application/json; charset=UTF-8"),e.setRequestHeader("access-key","ms-logs"),e.setRequestHeader("Accept","application/json"),e.send(JSON.stringify(t))}},window.ms||(window.ms={}),ms.registeredEvents=[],window.msi={},msi.oldLocationSearch=location.search,msi.setSearchParams=function(){var e,t={};if(location.search||msi.oldLocationSearch){if(location.search){var a,s=new URLSearchParams(location.search);s.sort();for(a of s.entries())t[a[0]]=a[1]}msi.oldLocationSearch!=location.search&&JSON.stringify(ms.searchParams)!=JSON.stringify(t)&&(e=ms.searchParams)}msi.oldLocationSearch=location.search,ms.searchParams=t,e&&ms.trigger("ms.search_params_updated",{oldParams:e,newParams:t})};try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(e){Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype.setItem=function(){}}window.mystore.storage=function(){return localStorage},ms.localStorage=localStorage,window.ms.supportWebP=!1;var hasWebP=function(){var e=$.Deferred();return $("<img>").on("load",function(){2===this.width&&1===this.height?e.resolve():e.reject()}).on("error",function(){e.reject()}).attr("src","data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA=="),e.promise()},key,tmp;for(key in hasWebP().then(function(){window.ms.supportWebP=!0},function(){window.ms.supportWebP=!1}),ms.getForm=function(n){return new Promise(function(a,s){if(ms.forms[n])return a(ms.forms[n]);ms.app.list({entity:"ms.forms",version:"1",query:{filters:[{field:"name",value:n}]}},function(e,t){if(e||!t.data||!t.data.data||!t.data.data.length)return console.log("Failed to get the form ["+n+"]"),s("Failed to get the form ["+n+"]");e=t.data.data[0];a(e)})})},ms.handleFile=function(e){return new Promise(function(o,i){var r,d;r=e,(d=new XMLHttpRequest).open("GET","/sign-s3?file-name="+r.name+"&file-type="+r.type),d.onreadystatechange=function(){var e,t,a,s,n;4===d.readyState&&200===d.status&&(e=JSON.parse(d.responseText),r._id=e.imageId,t=r,a=e.signedRequest,s=e.url,(n=new XMLHttpRequest).open("PUT",a),n.setRequestHeader("content-type",t.type),n.setRequestHeader("expires",new Date((new Date).getTime()+3156192e5).toGMTString()),n.setRequestHeader("cache-control","max-age=315619200000,public"),n.onreadystatechange=function(){var e;4===n.readyState?200===n.status?(e={name:t.name,path:s.replace("https://mystore.in.s3.amazonaws.com/",""),size:t.size,type:t.type,uploadType:"tmp",versioning:!0,_id:t._id},o(e)):(console.log("Failed to fetch url: ["+s+"]. Status: "+n.status),i("Failed to fetch url: ["+s+"]. Status: "+n.status)):console.log(n.status)},n.send(t))},d.send()})},ms.formBuilder=function(a){if(a&&a.fields){var e=a.scope;if(e){var l=this;(e.form=l).id=a.id||Math.floor(1e3*Math.random()),l.name=a.name||"",l.options=a,l.fields=a.fields,l.originalFields=Object.assign(l.fields),l.submitBtnLabel=a.submitBtnLabel||"submit",l.data=a.data||{},l.errors={},l.invalid=!1,l.submitting=!1,l.hasShowOnField=!1,ms.trigger("ms.form.loading",{form:{name:l.name,fields:l.fields,data:l.data}});for(var t=0;t<a.fields.length;t++)s(a.fields[t],l.data);e.$watch("form.data",function(){var a=[];l.originalFields.forEach(function(e){var t=!0;e&&e.settings&&e.settings.show_on&&e.settings.show_on.length&&e.settings.show_on.forEach(function(e){if(e&&e.field&&e.value)switch(e.operator){case"equal":e.value!=l.data[e.field]&&(t=!1);break;case"not_equal":e.value==l.data[e.field]&&(t=!1);break;default:e.value!=l.data[e.field]&&(t=!1)}}),!t||e&&e.settings&&"1"==e.settings.hidden||a.push(e)}),l.fields=a},!0),l.validate=function(){ms.trigger("ms.form.validating",{form:{name:l.name,fields:l.fields,data:l.data,errors:l.errors}});var e=validation.formValidation(l.fields,l.data);if(Object.keys(e).length||Object.keys(l.errors).length){var t,a={};for(t in l.fields.map(function(e){a[e.name]=e}),e)if(!l.errors[t])if("collection"==a[t].type)for(var s in l.errors[t]=l.errors[t]||[],e[t]){var n,o=e[t][s];for(n in o){var i=o[n],r=Object.keys(i);l.errors[t][i.index]=l.errors[t][i.index]||{},l.errors[t][i.index][n]=i[r[0]]}}else{var d=Object.keys(e[t]);l.errors[t]=e[t][d[0]]}return ms.trigger("ms.form.invalid",{form:{name:l.name,fields:l.fields,data:l.data,errors:l.errors}}),!(l.invalid=!0)}return ms.trigger("ms.form.valid",{form:{name:l.name,fields:l.fields,data:l.data,errors:l.errors}}),!(l.invalid=!1)},l.clear=function(){l.data={};for(var e=0;e<a.fields.length;e++){var t=a.fields[e];t.settings.default&&s(t,l)}},l.submit=function(){if(l.submitting)console.log("Form submission is already in progress");else{if(l.errors={},l.submitting=!0,l.validate())return a.submit?void a.submit(l).then(function(){l.submitting=!1,l.clear(),ms._applyScope()}).catch(function(e){l.submitting=!1,console.log("Error while submitting the form",e)}):(console.warn("No submit handler specified. No action taken"),l.submitting=!1,void ms._applyScope());console.log("ERROR: Form is not valid"),console.log("Form data:",l.data),console.log("Form errors:",l.errors),void(l.submitting=!1)}},l.reset=function(){l.errors={},l.data={}}}else console.log("ERROR: scope not passed to formBuilder")}else console.log("ERROR: valid options with fields not passed to formBuilder");function s(t,a){t.fields?t.fields.forEach(function(e){a[t.name]||(a[t.name]={}),s(e,a[t.name])}):t.settings.default&&(-1<t.settings.default.indexOf("{{")?ms._compile("<div>"+t.settings.default+"</div>").then(function(e){a[t.name]=e.html()}):a[t.name]=t.settings.default)}},ms.autocompleteBuilder=function(a){var e=a.scope;if(e){var s=this,t=((e.autocomplete=s).count=a.count||20,s.threshold=a.threshold||2,e.widgetElement&&e.widgetElement.find("input").get(0));if(t)return s.currentFocus=-1,s.result=null,s.options=a,s.select=function(e){a.select&&a.select(e),n()},t.addEventListener("focus",function(){s.active=!0}),t.addEventListener("blur",function(){s.active=!1}),t.addEventListener("input",function(e){var t=this.value;s.query=t,n(),!t||t.length<=s.threshold||(s.loading=!0,a.query(t,s).then(function(e){s.loading=!1,s.result={query:t},s.result.items=e,s.currentFocus=-1,ms._applyScope()}).catch(function(e){s.loading=!1,n(),console.log("Error while submitting the query",e)}))}),t.addEventListener("keydown",function(e){if(s.result&&s.result.query){if(40==e.keyCode){if(s.currentFocus>=s.result.items.length-1)return;s.currentFocus++}else if(38==e.keyCode){if(s.currentFocus<0)return;s.currentFocus--}else 13==e.keyCode&&(e.preventDefault(),-1<s.currentFocus?s.select(s.result.items[s.currentFocus]):a.submit(s.query));ms._applyScope()}}),s.clear=function(){t.value=""},document.addEventListener("click",function(e){n()}),s;console.log("ERROR: Could not find input element to bind autocomplete to")}else console.log("ERROR: scope not passed to autoComplete Builder");function n(){s.currentFocus=-1,s.result=null,ms._applyScope()}},ms._resolveDefault=function(t,a){var e,s,n,o;t.settings.default&&(-1<t.settings.default.indexOf("{{")?(s=(e=angular.element("body").injector()).get("$compile"),n=e.get("$rootScope"),o=e.get("$timeout"),s("<div>"+t.settings.default+"</div>")(n,function(e){o(function(){a.data[t.name]=e.html()})})):a.data[t.name]=t.settings.default)},ms.entityToForm=function(e){return new Promise(function(i,r){ms.app.struct({entity:e},function(e,t){if(e)console.log("Error occurred in struct command in  controller"),r(e);else{for(var a=t.data,s=[],n=0;n<a.fields.length;n++){var o=a.fields[n];s.push(function e(t){if(t.name){var a;if(t.settings&&t.settings.edit_type&&(t.type=t.settings.edit_type,t.settings.display_type=t.settings.edit_type),"autocomplete"==t.type&&t.settings.entity&&(t.settings.source={type:"entity",entity:t.settings.entity,label_field:t.settings.label_field,value_field:t.settings.value_field}),t.settings.label?t.label=t.settings.label:t.label=((a=t.name).charAt(0).toUpperCase()+a.slice(1)).replace("_"," "),t.fields)for(var s=0;s<t.fields.length;s++)e(t.fields[s]);return t}}(o))}i(s)}})})},window.cacheEntities={},ms.loadings={},window.require=mystore.utils.loadScripts,ms.loadScripts=mystore.utils.loadScripts,ms.loadStyles=mystore.utils.loadStyles,window.require.config=function(){},ms._httpDefaults={headers:{}},ms.store=ms_store,ms.theme=ms_theme,ms.theme.js_framework||(ms.theme.js_framework="angularjs"),ms.theme.css_framework||(ms.theme.css_framework="bootstrap3"),ms.device=window.session.device,ms.settings=ms_store.store_settings,ms.substore=session.substore,ms.forEach=function(e,t){e&&Array.isArray(e)?t&&"function"==typeof t?e.forEach(t):console.log("Invalid function passed to forEach"):console.log("Argument passed is not an array")},window.session.user_settings)ms.store.store_settings[key]=window.session.user_settings[key];if(window.session.user_messages&&window.session.user_messages.length)for(var name in window.session.user_messages)ms.store.ms_messages&&(ms.store.ms_messages[name]=window.session.user_messages[name]);Array.isArray(ms.store.ms_messages)&&(tmp={},ms.store.ms_messages.forEach(function(e){tmp[e.name]=e.message}),ms.store.ms_messages=tmp),ms.store.messages=ms.store.ms_messages||{};var substoreSettings=ms.substore&&ms.substore.settings?ms.substore.settings:void 0,keys,observer,themeVariables=(substoreSettings&&(keys=Object.keys(substoreSettings),keys.forEach(function(e){"string"==typeof substoreSettings[e]&&!substoreSettings[e].length||("languages"==e&&(substoreSettings[e]=substoreSettings[e].filter(function(e){return-1!=ms.settings.languages.indexOf(e)})),ms.settings[e]=substoreSettings[e])})),window.document.referrer&&-1==window.document.referrer.indexOf(window.location.host)?(ms.referrer=window.document.referrer,ms.localStorage.setItem("msReferrer",ms.referrer)):ms.localStorage.msReferrer&&(ms.referrer=ms.localStorage.msReferrer),ms.adminTheme=!!ms.theme.admintheme,ms.bind=function(e,t){window.addEventListener(e,function(e){e&&e.defaultPrevented||!1===t(e)&&e.preventDefault()})},ms.trigger=function(e,t){var a=document.createEvent("Event");return a.initEvent(e,!0,!0),a.data=t,a.detail=t,window.dispatchEvent(a),a},msi.setSearchParams(),window._designtheme&&(observer=new MutationObserver(function(e){e.forEach(function(e){for(var t,a,s,n=0;n<e.removedNodes.length;n++)e.removedNodes[n].nodeType==Node.ELEMENT_NODE&&((t=$(e.removedNodes[n])).hasClass("ms-widget")&&(a=t.attr("ms-widgetid"),s=t.attr("ms-widgetname"),ms.widgetsById&&ms.widgetsById[a]&&delete ms.widgetsById[a],ms.trigger("ms.widget_removed",{name:s,id:a,element:t.get(0)})))})}),observer.observe(document,{childList:!0,subtree:!0})),ms.store.baseUrl=window.location.protocol+ms.store.baseUrl,ms.store.globalAssetBaseUrl=window.location.protocol+ms.store.globalAssetBaseUrl,window.ms.forms={},ms.store.forms&&(window.ms.forms={},ms.store.forms.forEach(function(e){window.ms.forms[e.name]=e})),"angularjs"!=ms.theme.framework&&ms.theme.variants&&(ms.theme.variant=ms.theme.variants[0]),ms.store.theme={_id:ms.theme.store_theme_id,name:ms.theme.name,global_theme_id:ms.theme.global_theme_id,use_global_theme:ms.theme.use_global_theme,variants:ms.theme.variants,variant:ms.theme.variant},{}),storeVariables={};ms.store.theme&&ms.store.theme.variant&&(storeVariables=ms.store.theme.variant.variables),ms.theme.variables||(ms.theme.variables=[]);for(var i=0,asyncLoad,pendingLocationPromise;i<ms.theme.variables.length;i++){var variable=ms.theme.variables[i],name=variable.name;name&&(name&&-1<name.indexOf("@")&&(name=name.replace(/@/g,"")),storeVariables[name]?themeVariables[name]=storeVariables[name]:themeVariables[name]=variable.default)}ms.variables=themeVariables,ms.updateScreen=function(){window.ms.screen||(window.ms.screen={xs:!1,s:!1,m:!1,l:!1,xl:!1,xxl:!1});var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;ms.device.isMobileApp&&(e=screen.width,screen.height),ms.screen.width=e,ms.screen.xxl=!1,ms.screen.xl=!1,ms.screen.l=!1,ms.screen.m=!1,ms.screen.s=!1,ms.screen.xs=!1,ms.screen.s_bp||(ms.screen.s_bp=576),ms.screen.m_bp||(ms.screen.m_bp=768),ms.screen.l_bp||(ms.screen.l_bp=992),ms.screen.xl_bp||(ms.screen.xl_bp=1200),ms.screen.xxl_bp||(ms.screen.xxl_bp=1400),ms.screen.xl_up=e>=ms.screen.xl_bp,ms.screen.l_up=e>=ms.screen.l_bp,ms.screen.m_up=e>=ms.screen.m_bp,ms.screen.s_up=e>=ms.screen.s,ms.screen.xl_down=e<ms.screen.xxl_bp,ms.screen.l_down=e<ms.screen.xl_bp,ms.screen.m_down=e<ms.screen.l_bp,ms.screen.s_down=e<ms.screen.m_bp,e>=ms.screen.xxl_bp?(ms.screen.xxl=!0,"angularjs"==ms.theme.js_framework&&(ms.screen.xl=!0)):e<ms.screen.xxl_bp&&e>=ms.screen.xl_bp?ms.screen.xl=!0:e<ms.screen.xl_bp&&e>=ms.screen.l_bp?ms.screen.l=!0:e<=ms.screen.l_bp&&e>ms.screen.m_bp?ms.screen.m=!0:e<=ms.screen.m_bp&&e>ms.screen.s_bp?ms.screen.s=!0:e<ms.screen.s_bp&&(ms.screen.xs=!0),ms.trigger("ms.screen_updated")},ms.updateScreen(),ms.store.scriptTags&&(asyncLoad=function(){for(var e=ms.store.scriptTags,t=0;t<e.length;t++){var a=document.createElement("script"),s=(a.type="text/javascript",a.id=e[t].id,a.async=!0,a.src=e[t].src,document.getElementsByTagName("script")[0]);s.parentNode.insertBefore(a,s)}},window.attachEvent?window.attachEvent("onload",asyncLoad):window.addEventListener("load",asyncLoad,!1)),ms._updateSettings=function(e){if(ms.settings=e,ms.adminTheme&&(ms.theme.js_framework="angularjs"),ms.settings.currency_settings&&ms.settings.currency_settings.length)for(var t=0;t<ms.settings.currency_settings.length;t++)delete(s=window.ms.settings.currency_settings[t])._id,window.ms.settings.currency_settings[t].value=JSON.stringify(s);if(ms.settings.base_currency){for(var a=!1,s={name:ms.settings.base_currency,conversion_rate:1,code:ms.settings.base_currency},t=0;t<ms.settings.currency_settings.length;t++){var n=ms.settings.currency_settings[t];n.name==ms.settings.base_currency&&((ms.settings.currency_settings[t]=s).symbol=n.symbol,JSON.stringify(n.decimal_points)&&(s.decimal_points=n.decimal_points),a=!0)}s.value=JSON.stringify(s),a||(ms.settings.currency_settings&&Array.isArray(ms.settings.currency_settings)||(ms.settings.currency_settings=[]),ms.settings.currency_settings.push(s))}for(var o in ms.settings.currency_settings&&ms.settings.currency_settings.length||(ms.settings.currency_settings=[{name:"INR",conversion_rate:1,code:"INR"}]),ms.settings.currency_details&&ms.settings.currencies&&ms.settings.currencies.length||(ms.settings.currencies=[],ms.settings.currency_details={},ms.settings.currency_settings.map(function(e){ms.settings.currencies.push(e.name);var t=Object.assign({},e);delete t.value,delete t.conversion_mode,ms.settings.currency_details[e.name]=t})),ms.settings.admin_languages||(ms.settings.admin_languages=[]),ms.settings.language_details)-1==ms.settings.languages.indexOf(o)&&-1==ms.settings.admin_languages.indexOf(o)&&delete ms.settings.language_details[o];var i;window.ms.settings.old_languages=window.ms.settings.languages,ms.adminTheme&&"1"==ms.settings.admin_translate&&ms.settings.admin_languages&&ms.settings.admin_languages.length&&(ms.settings.languages=ms.settings.admin_languages),ms.settings.payment_methods&&ms.settings.payment_methods.length&&(i=[],ms.settings.payment_methods.forEach(function(e,t){e.enabled&&"1"==e.enabled?i.push(e):mystore.utils.logError("Disabled payment method received on frontend"),t+1==ms.settings.payment_methods.length&&(ms.settings.payment_methods=i)})),ms.settings.ms.login_providers&&!ms.settings.login_providers&&(ms.settings.login_providers=[],ms.settings.ms.login_providers.map(function(e){e={name:e.name,title:e.title,global:"1"==e.global};ms.settings.login_providers.push(e)})),ms.settings.new_provider_flow=1,!ms.settings.default_store_location&&ms.settings.physical_location&&(ms.settings.default_store_location=ms.settings.physical_location._id),ms.trigger("ms.settings_updated")},ms._updateSettings(ms.settings),ms.preferences={currency:window.session.data.currency,language:window.session.data.language,substore_id:window.session.data.substore_id},ms.geo_location=window.session.geo_location,ms.preferences.currencyObj=window.session.data.currency,ms.preferences.currencyObj.name==ms.settings.base_currency&&(ms.preferences.currencyObj.conversion_rate=1),ms.preferences.currency=JSON.stringify(window.session.data.currency),ms.setPreferences=function(s){if(s.currency){if("1"==s.check)if(mystore.utils.logError("UNUSED: data.check in setPreferences"),(s=JSON.parse(s.currency)).name==ms.user.currency.name)return!1;ms.app.call({entity:"ms.settings",command:"setPreferences",data:s},function(e,t){var a;ms.preferences.currency=s.currency,"string"==typeof s.currency&&(3<s.currency.length?s.currency=JSON.parse(s.currency):((a=ms.settings.currency_details[s.currency]).name=s.currency,s.currency=a)),ms.user.currency=s.currency,ms.trigger("ms.user_updated")})}else if(s.language){if("1"==s.check&&s.language==window.ms.preferences.language)return!1;ms.app.call({entity:"ms.settings",command:"setPreferences",data:s},function(e,t){var a;ms.settings.language_based_url?(a=location.pathname.replace(/^\/[a-z][a-z](\-[a-z][a-z])?\//,"/"+s.language.toLowerCase()+"/"),location.pathname=a):ms.reload()})}else{var n;s.substore_id||s.store?(n=ms.substore&&ms.substore.alias||"",ms.app.call({entity:"ms.settings",command:"setPreferences",data:s},function(e,t){var a;ms.settings.substore_based_url&&s.store&&n&&s.store!=n?(a=location.pathname.replace("/store/"+n+"/","/store/"+s.store+"/"),location.pathname=a):ms.settings.substore_based_domain&&s.store&&0===location.host.indexOf(n)&&s.store!=n?location.host=location.host.replace(n+".",s.store+"."):ms.reload()})):(s.campaign||s.geolocation)&&ms.app.call({entity:"ms.settings",command:"setPreferences",data:s},function(e,t){})}},ms.fetch=function(a,s){return window.fetch?fetch(a,s):new Promise(function(e,t){ms.loadScripts("https://cdn.jsdelivr.net/npm/whatwg-fetch@3.4.1/dist/fetch.umd.min.js").then(function(){window.fetch?fetch(a,s).then(e).catch(t):t("Fetch API is not available")})})};var getLocation=function(){return pendingLocationPromise=pendingLocationPromise||new Promise(function(t,a){if(mystore.locations)return t(mystore.locations);var e=ms.filters.globalAsset("locations-1.0.6.json");ms.fetch(e).then(function(e){return e.json()}).then(function(e){mystore.utils.sortArrayByField(e,"country"),mystore.locations=e,t(mystore.locations)}).catch(function(e){a(e)})})};function handleCacheEntities(){if(window&&window.cacheEntities){var t,O=function(e,t){var a=["ms.categories","ms.brands","ms.collections","ms.slides","ms.banners"];if(ms.settings.multistore_entities&&(a=a.concat(ms.settings.multistore_entities)),t&&-1==a.indexOf(t))return e;if(window.cacheEntities["ms.flat_categories"]&&"ms.categories"==t)return e;var s=ms.settings;if("1"!==s.enable_multistore)return e;var n=s.default_substore;if(ms.user.store&&(n=ms.user.store),!(n=ms.settings.substore_filter_by_id?ms.user.substore_id:n))return e;for(var o=[],i=e.length,r=0;r<i;r++){var d=e[r];"ms.categories"==t&&d.children&&d.children.length&&(d.children=O(d.children,"ms.categories")),ms.settings.substore_filter_by_id||"hide"===s.records_with_blank_substores?d.substore&&(-1<d.substore.indexOf(n)||-1<d.substore.indexOf("all"))&&o.push(d):d.substore&&d.substore.length&&!(d.substore.length&&-1<d.substore.indexOf(n))||o.push(d)}return o},a={},s={};if(window.cacheEntities["ms.flat_categories"]){window.cacheEntities["ms.flat_categories"]=O(window.cacheEntities["ms.flat_categories"]);var e,n,o,i=JSON.parse(JSON.stringify(window.cacheEntities["ms.flat_categories"]));for(n in i.map(function(e){a[e._id]=e}),i.map(function(e){s[e.alias]=e}),i)(o=i[n]).children||(o.children=[]),o.parent&&((e=a[o.parent])&&(e.children||(e.children=[]),e.children.push(o)));for(n in window.cacheEntities["ms.categories"]=[],i)(o=i[n]).parent||window.cacheEntities["ms.categories"].push(o)}for(t in ms.resolveCategory=function(e,t=!1){e=a[e]||s[e];return e&&t&&t&&e.parent&&"object"!=typeof e.parent&&(e.ancestorDepth=1,e.parent=a[e.parent],e.parent&&e.parent.parent&&(e.parent.parent=a[e.parent.parent],e.ancestorDepth=2,e.parent.parent&&e.parent.parent.parent&&(e.parent.parent.parent=a[e.parent.parent.parent],e.ancestorDepth=3,e.parent.parent.parent&&e.parent.parent.parent.parent&&(e.parent.parent.parent.parent=a[e.parent.parent.parent.parent],e.ancestorDepth=4,e.parent.parent.parent.parent&&e.parent.parent.parent.parent.parent&&(e.parent.parent.parent.parent.parent=a[e.parent.parent.parent.parent.parent],e.ancestorDepth=5))))),e},window.cacheEntities)["list","get"].forEach(function(e){ms.app.addPrehook({entity:t,command:e},function(t,e,a){if(t.query||(t.query={}),t.query.search)return a();var s=null,n=(t.query.q&&(s=JSON.parse(JSON.stringify(t.query.q))),!0),o=[];if(t.query.filters&&t.query.filters.length){try{"string"==typeof t.query.filters&&(t.query.filters=JSON.parse(t.query.filters))}catch(e){t.query.filters=[]}for(var o=t.query.filters.filter(e=>!("alias"!=e.field||"all"!=e.value||!["ms.categories","ms.collections","ms.brands"].includes(t.entity))),i=["equal","less_than","less_than_or_equal","greater_than","greater_than_or_equal","not_equal","regex","in","nin"],r=0,d=t.query.filters.length;r<d;r++){var l=t.query.filters[r];if(l&&l.field&&l.value&&l.operator&&-1===i.indexOf(l.operator)){n=!1;break}}}if(t.query.q&&t.query.q.alias&&"all"==t.query.q.alias&&(o=[{field:"alias",value:"all"}]),!n)return a();if(o.length)return S={status:200,data:{start:0,limit:1,total:1,data:[{name:ms.filters.translate("All Products"),alias:"all",publish:1,type:"manual"}]}},e.send(200,S.data);if(window.cacheEntities[t.entity]){var c=JSON.parse(JSON.stringify(window.cacheEntities[t.entity])),o=ms.user.language,m=[];if("get"==t.command&&(s._id=t.recordId),s&&!Object.keys(s).length)m=c;else for(var u=t.query.filters,p=("EN"!=o&&"ms.brands"===t.entity&&(u=u.map(function(e){return"name"===e.field&&(e.field="original_name"),e})),function(e,t){var a;return-1<e.indexOf(".")?t[(a=e.split("."))[0]]?t[a[0]][a[1]]:void 0:t[e]}),g=0,d=c.length;g<d;g++){var f,h=!0;if(u)for(var r=0,_=u.length;r<_;r++)if((l=u[r]).operator||(l.operator="equal"),l&&l.field&&l.value)if("in"===l.operator&&Array.isArray(l.value)&&p(l.field,c[g])&&p(l.field,c[g]).length){for(var v=!1,y=0,b=l.value.length;y<b;y++)if(-1<p(l.field,c[g]).indexOf(l.value[y])){v=!0;break}if(v){h=!0;break}h=!1}else if("nin"===l.operator&&Array.isArray(l.value)){var w=!0;p(l.field,c[g])||(c[g][l.field]=[]);for(var $=0,k=l.value.length;$<k;$++)if(-1<p(l.field,c[g]).indexOf(l.value[$])){w=!1;break}if(!w){h=!1;break}}else{if("regex"===l.operator&&p(l.field,c[g])){new RegExp(l.value,"ig").test(p(l.field,c[g]))||(h=!1);break}if("equal"===l.operator&&p(l.field,c[g])){if(l.value!=p(l.field,c[g])){h=!1;break}}else if("less_than"===l.operator&&p(l.field,c[g])){if(l.value>=p(l.field,c[g])){h=!1;break}}else if("less_than_or_equal"===l.operator&&p(l.field,c[g])){if(l.value>p(l.field,c[g])){h=!1;break}}else if("greater_than"===l.operator&&p(l.field,c[g])){if(l.value<=p(l.field,c[g])){h=!1;break}}else if("greater_than_or_equal"===l.operator&&p(l.field,c[g])){if(l.value>p(l.field,c[g])){h=!1;break}}else if("not_equal"===l.operator&&p(l.field,c[g])){if(l.value==p(l.field,c[g])){h=!1;break}}else h=!1}for(f in s)if(s[f]!==p(f,c[g])){h=!1;break}h&&m.push(c[g])}var S={status:200,data:{},headers:{}},m=O(m,t.entity);"get"==t.command?(S.data=m&&m.length?m[0]:null,"1"==t.version&&(S.data={data:m&&m.length?m[0]:null,messages:[]})):(o={records:m,start:0,limit:o=m.length,total:o},t.query.start&&(o.records=o.records.slice(t.query.start),o.start=t.query.start),t.query.limit&&(o.records=o.records.slice(0,t.query.limit),o.limit=t.query.limit),o.count=o.records.length,"1"==t.version?(S.data={data:o.records,paging:o,messages:[]},delete S.data.paging.records):S.data=o),e.send(200,S.data)}else a()})});ms.app.addPrehook({entity:"ms.categories",command:"getCategoryDetail"},function(e,t,a){if(window.cacheEntities&&window.cacheEntities["ms.flat_categories"]){if(!e.query||!e.query.q||!e.query.q.alias)return a();for(var s=null,n=(e.query.q&&(s=JSON.parse(JSON.stringify(e.query.q))),{}),o=null,i=JSON.parse(JSON.stringify(window.cacheEntities["ms.flat_categories"])),r=0;r<i.length;r++){var d,l=i[r],c=(n[l._id]=l,!0);for(d in s)s[d]!=l[d]&&(c=!1);c&&(o=l)}if(!o)return a();if(o.des_truncate)return a();var m=O([o]);if(!(o=m&&m.length?m[0]:null))return a();o.parent&&(o.parent=n[o.parent],o.parent&&o.parent.parent&&(o.parent.parent=n[o.parent.parent],o.parent.parent&&o.parent.parent.parent&&(o.parent.parent.parent=n[o.parent.parent.parent],o.parent.parent.parent&&o.parent.parent.parent.parent&&(o.parent.parent.parent.parent=n[o.parent.parent.parent.parent]))));m={status:200,data:o,headers:{}};"1"==e.version&&(m.data={},m.data.data=o),t.send(200,m.data)}else a()})}}ms._getCountries=function(){return new Promise(function(t,e){getLocation().then(function(e){e=Object.values(e);mystore.utils.sortArrayByField(e,"country"),t(e)}).catch(e)})},ms._getStates=function(s){return new Promise(function(t,a){if(!s)return a("country code not valid:"+s);getLocation().then(function(e){return e&&e[s]?t(e[s]):a("country code not valid:"+s)}).catch(a)})},window.ms.getLocations=function(t){ms._getCountries().then(function(e){t(null,e)},function(e){t(e,null)})},window.ms.getLocation=function(e,t){ms._getStates(e).then(function(e){t(null,e)},function(e){t(e,null)})},ms._updateUser=function(e,t){var a=e.currency&&e.currency.name?e.currency.name:"",s=ms.user.currency&&ms.user.currency.name||ms.user.currency;e.language!=ms.user.language||e.substore_id!=ms.user.substore_id||a!=s||e.theme!=ms.user.theme?(console.log("User property changed. Reloading..",e,ms.user),t&&ms.timeout(ms.reload,200)):(ms.user=new user(e),ms.trigger("ms.user_updated"))},ms._translateKeys=[],ms._translateTimeout=null,ms.filters={translate:function(e,t){function a(e){return t?mystore.utils.interpolate(e,t):e}if(e&&"null"!=e&&"string"==typeof e){if(!ms.translate)return a(e);if(ms.translate[e])return a(ms.translate[e]);var s=e.toLowerCase();if(ms.translate[s])return a(ms.translate[s]);s=ms.user.language;return"EN"==s&&!ms.translate[e]||ms.settings.translation_limit_reached&&0<ms.settings.translation_limit_reached.length&&-1!==ms.settings.translation_limit_reached.indexOf(s)?a(e):!ms.settings.google_translate_api||"1"!=ms.settings.google_translate_api||"AR"==s&&/[\u0600-\u06FF]/.test(e)?a(e):512<e.length?(ms.translate[e]=e,console.error("Key length for translation exceeded limit (512) for key ["+e+"]"),a(e)):(-1==ms._translateKeys.indexOf(e)&&ms._translateKeys.push(e),ms._translateTimeout||(ms._translateTimeout=ms.timeout(function(){var e={entity:ms.adminTheme?"ms.admin_translations":"ms.translations",data:{translate_keys:ms._translateKeys}};ms.app.call("translate",e,function(e,t){var a,s=[];for(a in e?console.error("Error during translation: "+e):s=t.data,ms._translateKeys){var n=ms._translateKeys[a];s[n]?ms.translate[n]=s[n]:ms.translate[n]=n}ms._translateTimeout=null})},100))," ".repeat(e.length))}},currency:function(e,t,a){var s="",n=0,o=ms.user.currency.name||ms.user.currency,i=1,r=ms.settings.currency_details[o],t=(r.conversion_rate&&""!=r.conversion_rate&&(i=r.conversion_rate),t&&(i=1,o=t=t.toUpperCase().trim(),r=ms.settings.currency_details[t]||{name:t}),s=navigator&&navigator.platform&&("Win16"==navigator.platform||"Win32"==navigator.platform)&&"INR"==t?"Rs":r.symbol,a&&!isNaN(a)&&""!=a&&(i=a),parseFloat(e)*parseFloat(i)),a=(r.decimal_points&&""!=r.decimal_points&&!isNaN(r.decimal_points)&&(n=parseInt(r.decimal_points)),ms.user.language?ms.user.language.toLowerCase():"en-US");return r.locale&&(a=r.locale),"object"==typeof Intl&&Intl&&"function"==typeof Intl.NumberFormat?(n<(e=r.min_decimal_points||0)&&(e=n),i=new Intl.NumberFormat(a,{minimumFractionDigits:e,maximumFractionDigits:n,style:"currency",currency:o}),r.formatter&&"function"==typeof r.formatter?r.formatter(t,i):i.format(t)):(s=s||o,ms.settings.add_space_with_currency?s+" "+t.toFixed(n):s+""+t.toFixed(n))},image:function(e,t,a){var s=ms.settings;if(!e||"string"!=typeof e)return"//:0";if(0===e.indexOf("http")&&-1==e.indexOf("storehippo.com")&&-1==e.indexOf(ms_store.base_cdn_url))return e;ms.device.isMobile&&!a&&e&&t&&("2048x2048"==t||"1024x1024"==t||"o"==t)&&(t="640x640");var n,a=e.substring(0,e.lastIndexOf(".")),o=e.substring(e.lastIndexOf(".")),i=(o.toLowerCase().match(/(ico|pdf)/)&&(t=""),o.toLowerCase().match(/(gif|svg)/)&&(t="originals"),ms.store.baseUrl),r=((r=e.match(/^s\/(\w+)\//))&&(n=r[1],a=(e=e.replace("s/"+n+"/","")).substring(0,e.lastIndexOf(".")),i=ms.store.base_cdn_url+"/s/"+n),ms.device.isBot&&(i=i.replace("cdn.storehippo.com","d2pyicwmjx3wii.cloudfront.net")),"originals"==(t="o"==t?"2048x2048":t)&&(i+="/originals"),ms.page&&ms.page.name&&"tryityourself"==ms.page.name&&ms.page.title&&"ms-dummy-product"==ms.page.title&&(n="5a4f4da5fb81476e7a7c564a",i=i.split("s/")[0]+"s/"+n),"");return r=0==(e=t&&"originals"!=t?a+"-"+t+o:e).indexOf("data:")||0==e.indexOf("http")||0==e.indexOf("//")?e:i+"/"+e,r=ms.supportWebP&&s.use_webp_images_across_store&&1==s.use_webp_images_across_store&&"webp"!=o.toLowerCase()&&!o.toLowerCase().match(/(gif|svg|pdf|ico)/)?r.substring(0,r.lastIndexOf("/"))+("/webp"+r.substring(r.lastIndexOf("/"))):r},globalAsset:function(e){return e&&"none"!=e?ms_store.globalAssetBaseUrl+"/"+e:""},ucFirst:function(e){return e?(e="object"==typeof e?JSON.stringify(e):e).substring(0,1).toUpperCase()+e.substring(1):""},file:function(e){return e?ms_store.baseUrl+"/"+e:""},date:function(e,t){var a=ms.user.language?ms.user.language.toLowerCase():"en-US",s=t?{dateStyle:t}:{},e=new Date(e);return"EEE, MMM d, y h:mm a"==t?e.toLocaleTimeString([],{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):new Intl.DateTimeFormat(a,s).format(e)},dateTimeFormat(e,t){var a=t&&t.locale||window.navigator.language;return t=t||{dateStyle:"medium",timeStyle:"medium",hour12:!0},new Intl.DateTimeFormat(a,t).format(new Date(e))},number:function(e,t=0){return(e=e&&parseInt(e))?e.toFixed(t):""},chunk:function(e,t){if(!e||!Array.isArray(e))return console.log("Input to chunk  filter is not an array"),[];for(var a=[],s=0;s<e.length;s+=t){var n=e.slice(s,s+t);a.push(n)}return a},truncate:function(e,t,a){return e?(isNaN(t)&&(t=25),void 0===a&&(a="..."),e.length<=t||e.length-a.length<=t?e:String(e).substring(0,t-a.length)+a):""},relativeTime:function(e){e=Math.ceil(((new Date).getTime()-new Date(e).getTime())/1e3);return e<1?"just now":e<2?e+"sec ago":e<60?"few secs ago":e/60<2?(e/60).toFixed(0)+" min ago":e/60<60?(e/60).toFixed(0)+" mins ago":e/3600<2?(e/3600).toFixed(0)+" hr ago":e/3600<24?(e/3600).toFixed(0)+" hrs ago":e/86400<2?Math.ceil(e/3600*24)+" day ago":Math.ceil(e/86400)+" days ago"},message:function(e){return e&&ms.store.messages[e]?ms.store.messages[e]:e}},window.admin_theme||(window.ms_store||window.ms_theme?window.ms_store?window.ms_theme||mystore.utils.logError("themeinfo not loaded"):mystore.utils.logError("storeinfo not loaded"):mystore.utils.logError("storeinfo and themeinfo not loaded")),window.addEventListener("error",function(e){window.ms_store&&window.ms_store.store_settings&&1==window.ms_store.store_settings.show_browser_errors&&mystore.utils.logError("browser errors",e)});var user=function(e){var o=this;if(Object.assign(o,e),o.currency&&!o.currency.name)for(var t=0;t<ms.settings.currency_settings.length;t++)ms.settings.currency_settings[t].name==o.currency&&(o.currency=ms.settings.currency_settings[t]);o.previous_order_history=[],o.string_saved_address=[],o.resolved_wishlist=[];var s;o.logout=function(a){ms.app.call("logout",{entity:"ms.users"},function(e,t){localStorage.removeItem("app_token"),localStorage.removeItem("user_id"),e?console.log("error occured while logout the user"):(e=t.data,ms_store.user=null,ms.user=e,ms.trigger("ms.user_updated"),localStorage.removeItem("token"),ms.timeout(function(){a&&ms.goTo(a)}))})},o.remove_address=function(n){var e={entity:"ms.user_addresses",recordId:n._id,version:"1"};ms.app.del(e,function(e,t){var a,s;e?console.log("wishlist add error occurred"):(a="",o.addresses.forEach(function(e,t){n._id==e._id&&(a=t)}),o.addresses.splice(a,1),s="",o.string_saved_address.forEach(function(e,t){n._id==e.data._id&&(s=t)}),o.string_saved_address.splice(s,1))})},o.save_address=function(a){delete a.showform;var e={entity:"ms.user_addresses",recordId:a._id,data:a,version:"1"};ms.app.update(e,function(e,t){e?console.log("error occured while updating address"):(o.addresses&&o.addresses.forEach(function(e,t){a._id,e._id}),o.string_saved_address&&o.string_saved_address.forEach(function(e,t){a._id==e.data._id&&o.string_saved_address.splice(t,1)}))})},o.load_wishlist=function(s){var e={entity:"ms.user_wishlists",query:{filters:[{field:"user_id",value:o._id}]},version:"1"};e.query.filters=JSON.stringify(e.query.filters),ms.app.list(e,function(e,t){var a;if(o.wishlist=t&&t.data&&t.data.data&&t.data.data.length?t.data.data:[],o.wishlist.length&&(a={field:"_id",values:[]},o.wishlist.forEach(function(e){a.values.push(e.product_id)})),s)return s()})},o.removeFromWishlist=function(s,n){o.wishlist&&o.wishlist.forEach(function(a,e){var t;a._id!=s&&a.product_id!=s||(t={entity:"ms.user_wishlists",recordId:a._id,version:"1"},ms.app.del(t,function(e,t){e?console.log("wishlist add error occurred",e):(ms.trigger("ms.wishlist_item_removed",{item:a}),o.load_wishlist(n))}))})},o.remove_from_wishlist=function(e,t){o.removeFromWishlist(e,t)},o.addToWishlist=function(a,e){var s;ms.user&&ms.user.isLoggedIn?(s={entity:"ms.user_wishlists",data:{product_id:a._id,user_id:ms.user._id},version:"1"},e&&(s.data.list_id=e),a.selected_variant&&a.selected_variant.variant_id&&(s.data.variant_id=a.selected_variant.variant_id),ms.cart.add_mask(),ms.app.add(s,function(e,t){if(ms.cart.remove_mask(),!e&&t&&t.data){let e=s.data;e._id=t.data.data&&t.data.data._id||t.data._id,ms.trigger("ms.wishlist_item_added",{item:e,product:a}),ms.user.load_wishlist()}else console.log("=======Error in adding wishlist==========")})):ms.broadcast("ms.msg.require_login",{level:"warning"})},o.to_database=function(){var e={};return e.isLoggedIn=o.isLoggedIn,e._id=o._id,e.first_name=o.first_name,e.last_name=o.last_name,e.email=o.email,e.phone=o.phone,e.wishlist=o.wishlist,e.customer_groups=o.customer_groups,e.metafields=o.metafields,e};s=[],o.addresses&&o.addresses.forEach(function(e){var t,a=[];for(t in e)"_id"!=t&&a.push(e[t]);s.push({string:a.join(" "),data:e})}),o.string_saved_address=s},Compare=(ms.add_to_wishlist=function(e,t){ms.user&&ms.user.isLoggedIn?ms.user.addToWishlist(e,t):ms.broadcast("ms.msg.require_login",{level:"warning"})},ms.sendVerification=function(e){e?ms.app.call("sendVerificationMail",{entity:"ms.users",data:{email:e}},function(e,t){e?console.log("Something Went Wrong"):console.log("Mail send Successfully")}):ms.broadcast("ms.msg.something_wrong",{entity:"ms.users",level:"error",data:{}})},function(){var n=this;function o(e,t,a){var s;return 1<e.length&&(t<(s=function(e,t,a){for(var s,n,o,i,r=e[Math.floor((a+t)/2)],d=t,l=a;d<=l;){for(;e[d].price<r.price;)d++;for(;e[l].price>r.price;)l--;d<=l&&(o=l,i=void 0,i=(s=e)[n=d],s[n]=s[o],s[o]=i,d++,l--)}return d}(e,t,a))-1&&o(e,t,s-1),s<a&&o(e,s,a)),e}return n.items=[],n.version="0.0.1",n.sort_items=function(){var a={},s=[];n.items.forEach(function(e,t){a[e._id]=e,s.push(e.price)}),n.items=o(n.items,0,n.items.length-1),n.to_local_storage()},n.to_local_storage=function(){var e={};e.items=n.items,e.version=n.version,localStorage.setItem("compare",JSON.stringify(e))},n.from_local_storage=function(){var e=JSON.parse(localStorage.compare);e.version&&"0.0.1"==e.version?(n.items=e.items,n.version=e.version):n.to_local_storage()},n.add_product=function(t){var a,s;t.categories&&t.categories.length?(a=1,n.items&&n.items.length&&(a=0,t.categories.forEach(function(t){n.items.forEach(function(e){-1<e.categories.indexOf(t)&&(a=1)})})),a?4==n.items.length?ms.broadcast("ms.msg.error_in_adding_product_to_compare_list",{level:"warning"}):(s=!1,t.selected_options||(t.selected_options={}),n.items.forEach(function(e){e._id==t._id&&function(e,t){var a,s=Object.keys(e).length,n=Object.keys(t).length;if(s!=n||0==s)return s==n&&0==s;for(a in e)if(t[a]!==e[a])return;return 1}(t.selected_options,e.selected_options)&&(s=!0)}),s?ms.broadcast("ms.msg.duplicate_product_in_compare_list",{level:"warning"}):(n.items.push(t),n.sort_items(),n.compareHide=!1,ms.broadcast("ms.entity.compare.add_product",{level:"success"}))):ms.broadcast("ms.msg.error_in_adding_product_to_compare_list_diffrent_category",{level:"warning"})):ms.broadcast("ms.msg.error_in_adding_product_to_compare_list",{level:"warning"})},n.remove_product=function(a){var s=!1;n.items.forEach(function(e,t){a._id==e._id&&(n.items.splice(t,1),n.sort_items(),s=!0,ms.broadcast("ms.entity.compare.remove_product",{level:"success"}))}),s||ms.broadcast("ms.msg.error_in_removing_product_from_compare_list",{level:"error"})},n.removeCompare=function(){ms.compare.items=[],n.compareHide=!0;var e={items:[]};e.version=n.version,console.log(e),localStorage.setItem("compare",JSON.stringify(e))},localStorage.compare&&n.from_local_storage(),n}),iframe;function initializeCordova(){ms.device.isMobileApp&&(ms.searchParams.new_mobileapp_flow||ms.localStorage.new_mobileapp_flow)&&(ms.localStorage.new_mobileapp_flow||ms.localStorage.setItem("new_mobileapp_flow",1),ms._newMobileApp=!0,ms.cordova={mobileApp:{},scripts:{startAudioRecording:function(){var e=window.cordova.plugins.permissions;e.requestPermission(e.RECORD_AUDIO,function(e){e.hasPermission||error()},function(){logger.debug("Microphone permission is not turned on")}),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){logger.debug("Initiliazing media recorder"),window.mediaRecorder=new MediaRecorder(e);var n=[];window.mediaRecorder.ondataavailable=function(e){n.push(e.data)},window.mediaRecorder.onstop=function(e){logger.debug("Recording stopped. Creating URL");var t,a,s=new Blob(n,{type:window.mediaRecorder.mimeType});n=[];s=s,t=function(e){app.executeScript({code:"ms.cordova.audioRecordingCallback()",params:{url:e}})},(a=new FileReader).onload=function(e){t(e.target.result)},a.readAsDataURL(s)},window.mediaRecorder.start()}).catch(function(e){app.executeScript({code:"ms.cordova.audioRecordingCallback()",params:{err:{code:e.code,message:e.message}}})}):logger.error("getUserMedia is not available on the device")},inAppReview:function(){window.cordova.plugins.AppReview.requestReview;window.cordova.plugins.AppReview.requestReview().catch(function(){return cordova.plugins.AppReview.openStoreScreen()})},facebookLogin:function(){logger.debug("Calling fb login api"),window.facebookConnectPlugin.login(["public_profile","email"],function(a){logger.debug("inside callback of facebookConnectPlugin.login",a),SpinnerPlugin.activityStart("Logging in.."),window.facebookConnectPlugin.api("me/?fields=id,email,name,first_name,last_name,gender,link",["email"],function(e){var e={first_name:e.first_name||"",last_name:e.last_name||"",email:e.email,gender:e.gender||"",picture:"http://graph.facebook.com/"+e.id+"/picture?type=square&height=1024",id:e.id,link:e.link,name:e.name},t=a&&a.authResponse&&a.authResponse.accessToken;t&&(e.provider_token=t),logger.debug("facebook login response IS :: ",e),app.postMessage({socialLoginResponse:{provider:"facebook",user:e}})},function(e){logger.error("facebook login error :: ",e),app.postMessage({socialLoginResponse:{provider:"facebook",error:e}})})},function(e){logger.error("facebook connection user login error :: ",e),app.postMessage({socialLoginResponse:{provider:"facebook",error:e}})})},facebookLogout:function(){window.facebookConnectPlugin.logout(function(){logger.debug("Facebook Connect Logged Out")},function(e){logger.error("Facebook Connect Logout Error :: ",e)})},appleLogin:function(){window.cordova.plugins.SignInWithApple.signin({requestedScopes:[0,1]},function(e){logger.debug("Inside callback of  window.cordova.plugins.SignInWithApple",e);e={first_name:e.fullName.givenName||"",last_name:e.fullName.familyName||"",email:e.email,id:e.user};SpinnerPlugin.activityStart("Logging in.."),app.postMessage({socialLoginResponse:{provider:"apple",user:e}})},function(e){logger.error("Apple Signin login Error :: ",e),app.postMessage({socialLoginResponse:{provider:"apple",error:e}})})},googleLogout:function(){window.plugins.googleplus.logout(function(e){logger.debug("Google logout success -> "+e)},function(e){logger.debug("Error logging out from Google: "+e),window.plugins.googleplus.trySilentLogin({webClientId:window.mobile_app.web_client_id},function(e){logger.debug("Google trySilentLogin success"),window.plugins.googleplus.logout(function(e){logger.debug("Google logout success")},function(e){logger.debug("Error logging out from Google for the 2nd time: "+e)})},function(e){logger.debug("Google trySilentLogin error: "+e)})})},googleLogin:function(){logger.debug("Calling window.plugins.googleplus.trySilentLogin"),window.plugins.googleplus.trySilentLogin({webClientId:window.mobile_app.web_client_id},function(e){logger.debug("Inside callback of window.plugins.googleplus.trySilentLogin",e);e={first_name:e.givenName||"",last_name:e.familyName||"",email:e.email,picture:e.imageUrl,id:e.userId};SpinnerPlugin.activityStart("Logging in.."),app.postMessage({socialLoginResponse:{provider:"google",user:e}})},function(e){app.siteReference.hide(),window.plugins.googleplus.login({webClientId:window.mobile_app.web_client_id},function(e){app.siteReference.show(),logger.debug("RESPONSE from Google Plus login :: ",e);e={first_name:e.givenName||"",last_name:e.familyName||"",email:e.email,picture:e.imageUrl,id:e.userId,provider_token:e.idToken};SpinnerPlugin.activityStart("Logging in.."),app.postMessage({socialLoginResponse:{provider:"google",user:e}})},function(e){app.siteReference.show(),logger.error("Google Login ERROR IS :: ",e),app.postMessage({socialLoginResponse:{provider:"google",error:e}})})})},getLocation:function(){var e={};params.options&&(e=params.options),navigator.geolocation.getCurrentPosition(function(e){var t={};"coords"in e&&(t.coords={},"latitude"in e.coords&&(t.coords.latitude=e.coords.latitude),"longitude"in e.coords&&(t.coords.longitude=e.coords.longitude),"accuracy"in e.coords&&(t.coords.accuracy=e.coords.accuracy),"altitude"in e.coords&&(t.coords.altitude=e.coords.altitude),"altitudeAccuracy"in e.coords&&(t.coords.altitudeAccuracy=e.coords.altitudeAccuracy),"heading"in e.coords&&(t.coords.heading=e.coords.heading),"speed"in e.coords&&(t.coords.speed=e.coords.speed)),"timestamp"in e&&(t.timestamp=e.timestamp),app.executeScript({code:"ms.cordova.gotLocation()",params:{position:t}})},function(e){app.executeScript({code:"ms.cordova.gotLocation()",params:{err:{code:e.code,message:e.message}}})},e)},initPushNotification:function(){FirebasePlugin?(logger.debug("Initializing push notification 2"),FirebasePlugin.grantPermission(function(e){logger.debug("Notification permission was "+(e?"granted":"denied"));app.executeScript({code:"ms.trigger('ms.mobile_firebase_permission', {hasPermission: params.hasPermission});",params:{hasPermission:e}})}),FirebasePlugin.getToken(function(e){logger.debug("gcm get token : ",e),e&&(app.executeScript({code:"ms.trigger('ms.mobile_firebase_token', {token: params.token});",params:{token:e}}),app.saveUuid(e))},function(e){logger.error("Error in getting FCM token",e)}),FirebasePlugin.onTokenRefresh(function(e){logger.debug("gcm id obtained is : ",e);app.executeScript({code:"ms.trigger('ms.mobile_firebase_token_refreshed', {token: params.token});",params:{token:e}}),app.saveUuid(e)},function(e){logger.error("Error in refreshing FCM token",e)}),FirebasePlugin.onMessageReceived(function(e){logger.debug("Message type: "+e);app.executeScript({code:"ms.trigger('ms.mobile_firebase_message_received', {message: params.message});",params:{message:e}}),"notification"===e.messageType&&(logger.debug("Notification message received",e),e.tap&&logger.debug("Tapped in "+e.tap),e.url&&(logger.debug("Switching to URL:",e.url),app.setLocation(e.url))),logger.debug(e)},function(e){logger.error("Error in receiving push notification",e)})):(logger.debug("Initializing push notification"),app.pushNotificationRef?logger.debug("Push Notification already initialized"):(app.pushNotificationRef=PushNotification.init({android:{forceShow:!0},ios:{alert:"true",badge:"true",sound:"true",forceShow:!0},windows:{}}),logger.debug("Initialized push notification",app.pushNotificationRef),app.pushNotificationRef.on("notification",function(e){logger.info("bindNotification pushNotificationRef on",JSON.stringify(e)),e&&e.additionalData&&e.additionalData.url&&(t=e.additionalData.url,logger.info("Changing url",t),e.additionalData.foreground||app.setLocation(e.additionalData.url));var t=e&&e.additionalData&&e.additionalData["gcm.message_id"];logger.debug("calling Finish for message id: ",t),app.pushNotificationRef.finish(function(){logger.debug("finish successfully called")},function(){logger.error("error while calling finish on push notification")},t)}),app.pushNotificationRef.on("error",function(e){logger.error("bindNotification eorrr===",e,e.message)}),app.pushNotificationRef.on("registration",function(e){logger.info("bindPushRegistration===>>",e,localStorage);var t=setInterval(function(){localStorage.deviceRegistered&&(logger.info("deviceRegistered",localStorage.deviceRegistered),app.saveUuid(e.registrationId),clearInterval(t))},100)}),app.pushNotificationRef.on("error",function(e){logger.error("bindPushRegistration errr===",e)})))}},postMessage:function(e,t=0){var a=window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.cordova_iab;if(a)!e.script&&e.code&&(e.script=e.code),e.executeScript&&e.script&&"function"==typeof e.script&&(a=e.script.toString(),e.script=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))),webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify(e));else if(ms.postmessageTry){if(5<t)return void console.error("Giving up retrying to detect webkit. You are probably running this in a browser");console.error("No webkit detected. RETRY "+(t+1)),window.setTimeout(function(){ms.cordova.postMessage(e,t+1)},500)}else console.error("No webkit. You are probably running this in a browser")},openWindow:function(e,t,a){t=t||"_blank",a=a||"location=yes",ms.cordova.postMessage({executeScript:!0,script:"let name = '"+t+"';\n                let ref = window.cordova.InAppBrowser.open('"+e+"', '"+t+"', '"+a+"');\n                if(name != '_system') return;\n                ref.addEventListener('loaderror', function (params) {\n                    logger.error(\"loaderror: \", params);\n                });\n                ref.addEventListener('loadstart', function (params) {\n                    app.initialized = false;\n                    logger.debug(\"loadstart: \", params);\n                });\n                ref.addEventListener('loadstop', function (params) {\n                    logger.debug(\"loadstop: \", params);\n                    logger.debug(\"Initializing browser app. App previously initialized: \", app.initialized);\n                    app.initializeBrowserApp();\n                });\n                ref.addEventListener('beforeload', function (params) {\n                    logger.debug(\"beforeload: \", params);\n                });\n                ref.addEventListener('exit', function (params) {\n                    logger.debug(\"exit: \", params);\n                    navigator.app.exitApp();\n                });\n                ref.addEventListener('message', app.receivedEvent);"})},logMessage:function(){ms.cordova.postMessage({console:!0,arguments:arguments})},enableLogger:function(e){e&&ms.cordova.postMessage({executeScript:!0,script:"logger.level = "+e+";"})},startAudioRecording:function(e,t){ms.cordova._audioSuccess=e,ms.cordova._audioError=t,ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.startAudioRecording})},stopAudioRecording:function(){ms.cordova.postMessage({executeScript:!0,script:"if(window.mediaRecorder) { window.mediaRecorder.stop(); }"})},executeScript:function(e,t={}){ms.cordova.postMessage({executeScript:!0,script:e,params:t})},register:function(a){function e(){ms.app.call("register",{entity:"ms.push_notifications",data:a},function(e,t){ms._mobileRegistering=!1,e?ms.trigger("ms.mobile_register_failed",{error:e}):(ms.trigger("ms.mobile_register_success",{data:a,response:t}),ms.cordova.postMessage({executeScript:!0,script:"localStorage.deviceRegistered = true;"}))})}window&&window.admin_theme&&window.ms.user&&!window.ms.user.isLoggedIn||(ms._mobileRegistering?window.setTimeout(e,2e3):(ms._mobileRegistering=!0,e()))},hideSplash:function(e,t){ms.cordova.postMessage({executeScript:!0,script:"navigator.splashscreen.hide()"})},getLocation:function(e,t,a){ms.cordova._locationSuccess=e,ms.cordova._locationError=t,a=a||{enableHighAccuracy:!1,timeout:1e4},ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.getLocation,params:{options:a}})},showLoading:function(e,t){ms.cordova.postMessage({executeScript:!0,script:'SpinnerPlugin.activityStart("'+e+'", "'+t+'")'})},hideLoading:function(){ms.cordova.postMessage({executeScript:!0,script:"SpinnerPlugin.activityStop()"})},gotLocation:function(){params.err&&ms.cordova._locationError&&(ms.cordova._locationError(params.err),delete ms.cordova._locationError),params.position&&ms.cordova._locationSuccess&&(ms.cordova._locationSuccess(params.position),delete ms.cordova._locationSuccess)},audioRecordingCallback:function(){params.err&&ms.cordova._audioError&&(ms.cordova._audioError(params.err),delete ms.cordova._audioError),params.url&&ms.cordova._audioSuccess&&(ms.cordova._audioSuccess(params.url),delete ms.cordova._audioSuccess)},setLocation:function(e){ms.goTo(e)},handleEvent:function(t){if(console.log("Received cordova event ",t),t){try{var e=t}catch(e){console.log("Exception while parsing data from mobile app",t)}if(e)for(var a in console.log("Received event from mobile app",e),e)window.ms.cordova.hasOwnProperty(a)&&(console.log("calling function: ",window.ms.cordova[a]),window.ms.cordova[a](e[a]))}},socialLoginResponse:function(e){console.log("Inside Social Login Response",e);var t=e.provider,a=e.user,e=e.error;ms.localStorage.setItem("loginProvider",t),e?window.ms.cordova.hideLoading():ms.settings.new_provider_flow?(console.log("calling ms.users.appSocialLogin"),ms.app.call({entity:"ms.users",version:"1",command:"login",data:{email:a.email,provider:t,provider_token:a.provider_token}},function(e,t){console.log("Inside callback of ms.users.appSocialLogin"),window.ms.cordova.hideLoading(),console.log("calling mystore.afterLogin"),ms._isLogged()})):(console.log("calling ms.users.appSocialLogin"),ms.app.call("appSocialLogin",{entity:"ms.users",data:{user:a,provider:t}},function(e,t){console.log("Inside callback of ms.users.appSocialLogin"),window.ms.cordova.hideLoading(),console.log("calling mystore.afterLogin"),window.mystore.afterLogin()}))},bindSocialLogins:function(){console.log("Binding social logins"),ms.cordova.mobileApp.fb&&(window.mystore.controllers.facebookLogin=["$element",function(e){e.bind("click",function(){ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.facebookLogin})})}]),ms.cordova.mobileApp.google&&(window.mystore.controllers.googleLogin=["$element",function(e){e.bind("click",function(){ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.googleLogin})})}])},loginWithToken:function(a){(a=!a&&params?params.token:a)&&(ms.trigger("ms.mobile_app_token",{token:a}),ms.user.isLoggedIn||(ms.cordova.logMessage("Logging with app token",a),ms.app.call({entity:"ms.users",version:"1",command:"login",data:{app_token:a}},function(e,t){e&&(ms.cordova.logMessage("Error while login with app token",e,a),ms.cordova.executeScript("localStorage.removeItem('app_token')"))})))},initialize:function(e){ms.cordova.logMessage("received initialization data from mobile app",e),ms.cordova.mobileApp=e.mobile_app,ms.cordova.device=e.device,ms.user.isLoggedIn||(e.app_token?ms.cordova.loginWithToken(e.app_token):ms.cordova.executeScript("if(localStorage.app_token) {app.executeScript({code: 'ms.cordova.loginWithToken()', params: {token: localStorage.app_token}})}")),ms.settings.login_providers&&(ms.settings.login_providers=ms.settings.login_providers.filter(function(e){return!("google"==e.name&&!ms.cordova.mobileApp.google)&&!("facebook"==e.name&&!ms.cordova.mobileApp.fb)}),ms.settings.ms.login_providers=ms.settings.ms.login_providers.filter(function(e){return!("google"==e.name&&!ms.cordova.mobileApp.google)&&!("facebook"==e.name&&!ms.cordova.mobileApp.fb)}),ms._applyScope()),ms.settings.enable_apple_signin&&ms.cordova.mobileApp.apple_signin&&(ms.cordova.device.os_version<13?ms.cordova.logMessage("Apple sign in is enabled but IOS Version ("+ms.cordova.device.os_version+") is less than 13. Skipping Apple sign"):ms.settings.login_providers.push({name:"apple",logo:"https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/images/apple-id-sign-up-with.png"})),ms.cordova.logMessage("login providers for mobile app",ms.settings.login_providers),ms._setDefaultHttpHeader&&(ms.cordova.device.appid=ms.cordova.mobileApp.app_id,ms.cordova.mobileApp.package&&(ms.cordova.device.package=ms.cordova.mobileApp.package),ms._setDefaultHttpHeader("device",JSON.stringify(ms.cordova.device))),ms.cordova.bindSocialLogins(),e.mobile_app.enablePushNotification?(ms.cordova.logMessage("Push notification is enabled. Initializing push notifications"),ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.initPushNotification})):ms.cordova.logMessage("Push notification is not enabled"),ms.trigger("ms.mobile_app_initialized")}},ms.settings.is_deeplink_enable&&ms.cordova.executeScript(`if(universalLinks){universalLinks.subscribe(null, function (eventData) {
            logger.debug('eventData url', eventData.url)
             app.setLocation(eventData.url);	
            })}`),ms.bind("ms.page_loaded",function(){ms.cordova.initialized||(ms.cordova.postMessage({initialize:!0}),ms.cordova.initialized=!0)}),navigator.geolocation.getCurrentPosition=ms.cordova.getLocation)}function handleAzureSearch(){ms.adminTheme||ms.settings.azure_search&&ms.store.azure_product_search&&(ms.app.addPrehook({entity:"ms.products",command:"list"},function(d,l,c){if(!d.query||!d.query.search||d.query.skipAzureSearch)return c();var e=ms.store.azure_product_search,t=(d.query.limit||(d.query.limit=10),{search:d.query.search,$orderby:"search.score() desc","api-version":"2019-05-06",$top:d.query.limit,$filter:"store_id eq '"+ms.store.storeId+"' and type eq 'products'",$select:"*"});if(d.query.seller&&(t.$filter+="  and  seller_id eq '"+d.query.seller+"'"),d.query&&d.query.searchType&&d.query.searchType.length){-1==d.query.searchType.indexOf("products")&&d.query.searchType.push("products");for(var a="",s=0;s<d.query.searchType.length;s++)0==s?1<d.query.searchType.length?a+=" and ( type eq '"+d.query.searchType[s]+"'":a+=" and  type eq '"+d.query.searchType[s]+"'":(a+=" or type eq '"+d.query.searchType[s]+"'",s==d.query.searchType.length-1&&(a+=")"));t.$filter="store_id eq '"+ms.store.storeId+"'"+a}var n=e.url,o=("search"==ms.page.name?(d.query.start&&(t.$start=d.query.start),t.$count=!0,t.$skip=d.query.start):(t.fuzzy=!0,t.queryType="simple",t.suggesterName=e.suggester,n+="/suggest"),ms.substore&&(ms.settings.substore_filter_by_id||"hide"==ms.settings.records_with_blank_substores?ms.settings.substore_filter_by_id&&ms.substore._id?(o=["all",ms.substore._id.toString()],o=(o=ms.substore.substore_groups?o.concat(d.ms.substore.substore_groups):o).join(","),t.$filter+=" and (seller_substore_ids/any(t:  search.in(t,'"+o+"', ',')))"):t.$filter+=" and substores/any(t: t eq '"+ms.substore.alias+"')":t.$filter+=" and (substores/any(t: t eq '"+ms.substore.alias+"') or not substores/any())"),{url:n,method:"GET",query:t,uniqueId:"productsearch",headers:{"Content-Type":"application/json; charset=UTF-8","api-key":e.query_key,Accept:"application/json"}});ms._http(o).then(function(e){for(var t=e&&e.data&&e.data.value,a=[],s=0;s<t.length;s++){var n=t[s];if(n._id=n.record_id,a.push(n.record_id),n.images=[{image:n.image}],n.translated_names){for(var o=JSON.parse(n.translated_names),i=0;i<o.length;i++)o[i][ms.user.language]&&(n.name=o[i][ms.user.language]);delete n.translated_names}if(n.translated_brands){for(o=JSON.parse(n.translated_brands),i=0;i<o.length;i++)o[i][ms.user.language]&&(n.brand=o[i][ms.user.language]);delete n.translated_brands}}var r={count:t.length,records:t};"search"==ms.page.name?(d.originalQuery=Object.assign({},d.query),delete d.query.search,delete d.query.start,delete d.query.limit,d.AzureResult=t,"string"==typeof d.query.filters&&(d.query.filters=JSON.parse(d.query.filters)),d.totalAzureResults=e.data["@odata.count"],d.query.filters.push({field:"_id",operator:"in",value:a}),c()):l.send(200,r)}).catch(function(e){console.log("Error while product search",e)})}),ms.app.addPosthook({entity:"ms.products",command:"list"},function(e,t,a){if(!e.originalQuery||!e.originalQuery.search)return a();if(e.query=e.originalQuery,t.data.total=e.totalAzureResults,e.AzureResult&&e.AzureResult.length&&t.data&&t.data.data&&t.data.data.length)for(var s=!0,n=[],o=[],o=t.data&&t.data.data&&t.data.data.length?(s=!1,t.data.data):t.data.records,i=0;i<e.AzureResult.length;i++){for(var r=0;r<o.length;r++)if(e.AzureResult[i].record_id==o[r]._id){n.push(o[r]);break}i==e.AzureResult.length-1&&(s?t.data.records=n:t.data.data=n)}return a()}),ms.app.addPrehook({entity:"ms.categories",command:"list"},function(n,o,i){if(!n.query||!n.query.search)return i();var e=ms.store.azure_product_search,t=(n.query.limit||(n.query.limit=10),{search:n.query.search,fuzzy:!0,searchMode:"simple",queryType:"simple",$orderby:"search.score() desc","api-version":"2019-05-06",$top:n.query.limit,$filter:"store_id eq '"+ms.store.storeId+"' and type eq 'categories'",$select:"*",suggesterName:e.suggester}),a=(ms.substore&&(ms.settings.substore_filter_by_id||"hide"==ms.settings.records_with_blank_substores?ms.settings.substore_filter_by_id&&ms.substore._id?(a=["all",ms.substore._id.toString()],a=(a=ms.substore.substore_groups?a.concat(n.ms.substore.substore_groups):a).join(","),t.$filter+=" and (substores/any(t:  search.in(t,'"+a+"', ',')))"):t.$filter+=" and substores/any(t: t eq '"+ms.substore.alias+"')":t.$filter+=" and (substores/any(t: t eq '"+ms.substore.alias+"') or not substores/any())"),{url:e.url+"/suggest",method:"GET",query:t,uniqueId:"categorysearch",headers:{"Content-Type":"application/json; charset=UTF-8","api-key":e.query_key,Accept:"application/json"}});ms._http(a).then(function(e){for(var t=e&&e.data&&e.data.value,a=[],s=0;s<t.length;s++)a.push(t[s].record_id),t[s].images=[{image:t[s].image}];e={count:t.length,records:t};"search"==ms.page.name?(delete n.query.search,delete n.query.start,delete n.query.limit,n.query.filters||(n.query.filters=[]),"string"==typeof n.query.filters&&(n.query.filters=JSON.parse(n.query.filters)),n.query.filters.push({field:"_id",operator:"in",value:a}),i()):o.send(200,e)}).catch(function(e){console.log("Error while product search",e)})}),ms.app.addPrehook({entity:"ms.sellers",command:"list"},function(n,o,i){if(!n.query||!n.query.search||n.query.skipAzureSearch)return i();var e=ms.store.azure_product_search,t=(n.query.limit||(n.query.limit=10),{search:n.query.search,fuzzy:!0,searchMode:"simple",queryType:"simple",$orderby:"search.score() desc","api-version":"2019-05-06",$top:n.query.limit,$filter:"store_id eq '"+ms.store.storeId+"' and type eq 'sellers'",$select:"*",suggesterName:e.suggester}),a=(ms.substore&&(ms.settings.substore_filter_by_id||"hide"==ms.settings.records_with_blank_substores?ms.settings.substore_filter_by_id?(a=["all",ms.substore._id.toString()],a=(a=ms.substore.substore_groups?a.concat(n.ms.substore.substore_groups):a).join(","),t.$filter+=" and (substores/any(t:  search.in(t,'"+a+"', ',')))"):t.$filter+=" and substores/any(t: t eq '"+ms.substore.alias+"')":t.$filter+=" and (substores/any(t: t eq '"+ms.substore.alias+"') or not substores/any())"),{url:e.url+"/suggest",method:"GET",query:t,uniqueId:"sellersearch",headers:{"Content-Type":"application/json; charset=UTF-8","api-key":e.query_key,Accept:"application/json"}});ms._http(a).then(function(e){for(var t=e&&e.data&&e.data.value,a=[],s=0;s<t.length;s++)a.push(t[s].record_id),t[s].images=[{image:t[s].image}];e={count:t.length,records:t};"search"==ms.page.name?(delete n.query.search,delete n.query.start,delete n.query.limit,n.query.filters||(n.query.filters=[]),"string"==typeof n.query.filters&&(n.query.filters=JSON.parse(n.query.filters)),n.query.filters.push({field:"_id",operator:"in",value:a}),i()):o.send(200,e)}).catch(function(e){console.log("Error while product search",e)})}))}ms.compare=new Compare,ms.bind("ms.user.logout",function(){localStorage.removeItem("compare"),ms.compare.items=[]}),window.session.data&&(window.session.data&&window.session.data.isLoggedIn?ms.user=new user(window.session.data):(ms.user=window.session.data,window.ms_store.store_settings&&"1"==window.ms_store.store_settings.enable_sso&&(iframe=document.createElement("iframe"),iframe.src="/sso/auth0?silent=true",iframe.id="checksso",iframe.style.display="none",document.body.appendChild(iframe)))),!ms_store||!ms_store.store_settings||"dev"===ms_store.env||ms_store.store_settings.dev_version&&"1"==ms_store.store_settings.dev_version||(console.log=function(){}),ms.adminTheme||(ms.base=ms.settings.base&&ms.settings.base.replace(/\/$/,"")||"",ms.base&&0!==ms.base.indexOf("/")&&(ms.base="/"+ms.base),ms.settings.language_based_url&&(ms.base?(ms.base1=ms.base,ms.base="/"+ms.user.language.toLowerCase()+ms.base1):ms.base="/"+ms.user.language.toLowerCase())),window.ms._homepage=null,ms._mergeMetaTags=function(e,t){if(e&&t&&t.length)for(var a=e.map(function(e){return e.name}),s=0;s<t.length;s++)-1===a.indexOf(t[s].name)&&e.push(t[s])},ms._mergeOgTags=function(e,t){if(e&&t&&t.length)for(var a=e.map(function(e){return e.property}),s=0;s<t.length;s++)-1===a.indexOf(t[s].property)&&e.push(t[s])},ms.initializeSEO=function(e){var t,a,s,n,o;if(delete ms.page.meta_tags,ms.page.og_tags,ms.page.data&&(delete ms.page.data.meta_tags,ms.page.data.og_tags),"home"==e.name?(t=ms.settings.title||ms.settings.store_title,a="",s=[],n=[],ms.settings.meta_tags||(ms.settings.meta_tags=[]),ms.settings.meta_tags.forEach(function(e,t){"description"==e.name?a=e.content:e.content&&s.push(e)}),(a=!a&&ms.settings.description?$("<div>"+ms.settings.description+"</div>").text().substring(0,160):a)&&s.push({name:"description",content:a}),o=[],ms.settings.og_tags||(ms.settings.og_tags=[]),ms.settings.og_tags.forEach(function(e){e.content&&(o[e.property]=e.content)}),o["og:title"]||(o["og:title"]=t),o["og:description"]||(o["og:description"]=a),o["og:image"]||(o["og:image"]=ms.filters.image(ms.settings.logo)),o["og:type"]||(o["og:type"]="website"),Object.keys(o).forEach(function(e){n.push({property:e,content:o[e]})}),e.title=t,e.meta_tags=s,e.og_tags=n,e.data||(e.data={}),ms._mergeMetaTags(e.meta_tags,e.data.meta_tags),ms._mergeOgTags(e.og_tags,e.data.og_tags),e.data.meta_tags=s,e.data.og_tags=n,window.ms._homepage=e):(e.meta_tags||(e.meta_tags=[]),ms._mergeMetaTags(e.meta_tags,e.data&&e.data.meta_tags),ms._mergeOgTags(e.og_tags,e.data&&e.data.og_tags)),(ms.settings.default_canonical||ms.settings.language_based_url)&&(ms.settings.language_based_url?e.canonical_url=location.protocol+"//"+location.host+"/"+ms.settings.default_language.toLowerCase()+e.path:e.canonical_url=location.protocol+"//"+location.host+location.pathname),e.links||(e.links=[]),ms.settings.language_based_url)for(var i of ms.settings.languages){var r=location.protocol+"//"+location.host+"/"+i.toLowerCase()+e.path;e.links.push({rel:"alternate",hreflang:i,href:r})}ms.settings.linked_android_app_package&&e.links.push({rel:"alternate",href:"android-app://"+ms.settings.linked_android_app_package+"/"+location.protocol.replace(":","")+"/"+location.host+location.pathname}),ms.updatePage(e),ms._applyScope()},ms.updateSEO=function(e){var t=ms.page,a=[],s=[];if(e.title&&(t.title=e.title,s.push({property:"og:title",content:e.title})),e.description&&(a.push({name:"description",content:e.description}),s.push({property:"og:description",content:e.description})),e.keywords&&a.push({name:"keywords",content:e.keywords}),e.image&&(0!==e.image.indexOf("http")&&0!==e.image.indexOf("//")&&(e.image=ms.filters.image(e.image,"480x480"),e.image=e.image.replace("/webp/","/")),s.push({property:"og:image",content:e.image})),e.url?s.push({property:"og:url",content:e.url}):s.push({property:"og:url",content:window.location.href}),s.push({property:"og:type",content:"website"}),e.canonical_url?t.canonical_url=e.canonical_url:(ms.settings.default_canonical||ms.settings.language_based_url)&&(ms.settings.language_based_url?t.canonical_url=location.protocol+"//"+location.host+"/"+ms.settings.default_language.toLowerCase()+t.path:t.canonical_url=location.protocol+"//"+location.host+location.pathname),t.links=[],e.links&&e.links.length&&(t.links=e.links),ms.settings.language_based_url)for(var n of ms.settings.languages){var o=location.protocol+"//"+location.host+"/"+n.toLowerCase()+t.path;t.links.push({rel:"alternate",hreflang:n,href:o})}t.meta_tags=a,t.og_tags=s,t.data&&(t.data.meta_tags=a),t.data&&(t.data.og_tags=s),ms.updatePage(t),ms._applyScope()},ms.updatePage=function(e){if("angularjs"==ms.theme.js_framework)ms.page=e;else{if(msi.generatedPageTags&&msi.generatedPageTags.length)for(var t of msi.generatedPageTags)t.remove();for(key in document.title="",msi.generatedPageTags=[],e)if(ms.page[key]=e[key],"title"==key)document.title=e.title;else if("meta_tags"==key)for(var a of e.meta_tags)(s=$("meta[name='"+a.name+"']")).length?s.attr("content",a.content):s=$("<meta>").appendTo("head").attr("name",a.name).attr("content",a.content),msi.generatedPageTags.push(s);else if("og_tags"==key)for(var t of e.og_tags)(s=$("meta[property='"+t.property+"']")).length?s.attr("content",t.content):s=$("<meta>").appendTo("head").attr("property",t.property).attr("content",t.content),msi.generatedPageTags.push(s);else if("canonical_url"==key){var s;(s=$("link[rel=canonical]")).length?s.attr("href",e.canonical_url):s=$("<link>").appendTo("head").attr("rel","canonical").attr("href",e.canonical_url),msi.generatedPageTags.push(s)}else if("links"==key)for(var n of e.links)s=$("<link>").appendTo("head").attr("rel",n.rel).attr("href",n.href),n.hreflang&&s.attr("hreflang",n.hreflang),n.sizes&&s.attr("sizes",n.sizes),msi.generatedPageTags.push(s)}ms.trigger("ms.page_updated")},ms.campaign=null,ms._updateCampaign=function(){if(!ms.campaign&&ms.searchParams.utm_campaign&&(ms.campaign={utm:{campaign:ms.searchParams.utm_campaign},created_on:(new Date).getTime()},["utm_medium","utm_source","utm_term","utm_content"].forEach(function(e){var t=e.replace("utm_","");ms.searchParams[e]&&(ms.campaign.utm[t]=ms.searchParams[e])}),ms.campaign.id="utm:"+Object.values(ms.campaign.utm).join(":"),localStorage.msCampaign=JSON.stringify(ms.campaign)),!ms.campaign&&localStorage.msCampaign)try{var e=JSON.parse(localStorage.msCampaign);(new Date).getTime()-e.created_on<15552e6?ms.campaign=e:(ms.setPreferences({campaign:"DELETE"}),delete localStorage.msCampaign)}catch(e){delete localStorage.msCampaign}!ms.campaign||window.session.campaign&&ms.campaign.id==window.session.campaign.id||ms.setPreferences({campaign:ms.campaign})},ms._newMobileApp=!1,window.setTimeout(function(){!ms.device.isMobileApp&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.cordova_iab&&(ms.device.isMobileApp=!0,ms.searchParams.new_mobileapp_flow=1,initializeCordova())},2e3),initializeCordova(),ms.providerLogin=function(e){var t=(e="string"==typeof e?{name:e}:e).name,a=ms.settings.login_providers.filter(function(e){return e.name==t}),a=a&&a[0];a?(ms._providerLoginRole=e.role,ms._providerCallback=e.success,console.log("Login with provider",a),ms.device.isMobileApp?("google"==a.name&&ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.googleLogin}),"facebook"==a.name&&ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.facebookLogin}),"apple"==a.name&&ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.appleLogin})):(e=(a.global&&!location.href.match(/(storehippo|devhippo|betahippo)/)?"http://"+ms.store.name+".storehippo.com":"")+"/auth/"+a.name+"?oldUrl="+window.location.href,window.open(e,a.name,"height=350,width=400"))):console.log("Provider not found: "+t)},ms._loadServiceWorkers=function(){"serviceWorker"in navigator&&(window.ms.settings.enable_sw||"1"==window.ms.settings.enable_pwa?ms.adminTheme||(console.log("Service workers are supported"),window.addEventListener("load",function(){console.log("Registering service worker"),navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope:",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed:",e)})})):(console.log("Unregistering old SWs"),navigator.serviceWorker.getRegistrations().then(function(e){try{e.forEach(function(e){var t=e.active.scriptURL;(-1<t.indexOf("sh.js")||-1<t.indexOf("service-worker.js")||-1<t.indexOf("sw.js"))&&(console.log("Unregistering old SW: ",t),e.unregister().then(function(e){e||console.log("Failed to unregister old SW ",t)}))})}catch(e){console.log("UNEXPECTED error while unregistering service worker")}})))},ms._loadServiceWorkers(),ms._loadPlugins=function(){ms.settings.google_analytics_id&&""!=ms.settings.google_analytics_id&&!ms.user.isBot&&new function(e,t){var n=this;n.trackingId=e,n.initialize=function(e){n.loadGAScript(),window.ga("create",n.trackingId,"auto"),n.bindEvents(),"1"===t.enable_enhanced_ecommerce&&(window.ga("require","ec"),window.ga("set","currencyCode",ms.settings.base_currency),n.bindEcommerceEvents())},n.loadGAScript=function(){window.GoogleAnalyticsObject="ga",window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=(new Date).getTime();var e=document.createElement("script"),t=(e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)},n.bindEvents=function(){ms.bind("ms.page_loaded",function(){var e=location.pathname,t=window.ms.page.title||window.ms.page.name;window.ga("set",{page:e,title:t}),window.ga("send","pageview")}),ms.bind("ms.user_register",function(){var e=ms.user,e=(window.ga("set","userId",e._id),{eventCategory:"Login and Signup",eventAction:"Signup Success",eventLabel:e.provider||"website"});window.ga("send","event",e)}),ms.bind("ms.user_login",function(){var e=ms.user,e=(window.ga("set","userId",e._id),{eventCategory:"Login and Signup",eventAction:"Login Success",eventLabel:e.provider||"website"});window.ga("send","event",e)}),ms.bind("ms.user_logout",function(){window.ga("set","userId",null);window.ga("send","event",{eventCategory:"Login and Signup",eventAction:"Logout Success"})})},n.getProductObject=function(e,t){var a={id:e.sku,name:e.name,category:Array.isArray(e.categories)&&Array.isArray(e.categories)&&e.categories.length?e.categories.join("/"):"",image:e.images&&e.images.length?ms_store.baseUrl+"/"+e.images[0].image:"",price:e.price,brand:e.brand,list:ms.page.name};return e.variant_id&&(a.variant=e.variant_id),t&&(a.position=t),a},n.getOrderItemObject=function(e,t){var a={id:e.product.sku,name:e.product.name,category:e.product.categories&&Array.isArray(e.product.categories)&&e.product.categories.length?e.product.categories.join("/"):"",price:e.price,image:e.product.images&&e.product.images.length?ms_store.baseUrl+"/"+e.product.images[0].image:"",brand:e.product.brand,quantity:e.quantity};return e.product.variant_id&&(a.variant=e.variant_id),t&&(a.position=t),a},n.bindEcommerceEvents=function(){function s(e){var t=ms.cart.items||[];t.length&&(t.forEach(function(e,t){window.ga("ec:addProduct",n.getOrderItemObject(e,t))}),window.ga("ec:setAction","checkout",{step:e}))}ms.app.addPosthook({entity:"ms.products",command:"list"},function(e,t,a){var s=t.data.data;if(!(s=t.data.records?t.data.records:s).length)return a();s.forEach(function(e,t){e.alias==ms.routeParams.product&&window.ga("ec:addProduct",n.getProductObject(e))}),window.ga("ec:setAction","detail"),a()}),ms.app.addPosthook({entity:"ms.carts",command:"addItem"},function(e,t,a){t=t.data.product;if(!t)return a();window.ga("ec:addProduct",n.getOrderItemObject(t)),window.ga("ec:setAction","add"),window.ga("send","event","UX","click","add to cart"),a()}),ms.app.addPosthook({entity:"ms.carts",command:"updateUser"},function(e,t,a){s(1),a()}),ms.app.addPosthook({entity:"ms.carts",command:"updateAddresses"},function(e,t,a){s(2),a()}),ms.app.addPosthook({entity:"ms.carts",command:"updatePaymentMethod"},function(e,t,a){t=t.data.cart,t=t&&t.payment_method&&t.payment_method.name;if(!t)return a();s(3),a()}),ms.bind("ms.order_placed",function(e){e=(e.data.order&&e.data.order.orders?e.data.order:e.data).orders;e&&e.length&&e.forEach(function(e){e.items.forEach(function(e,t){ga("ec:addProduct",n.getOrderItemObject(e,t+1))}),window.ga("ec:setAction","purchase",{id:e.order_id,affiliation:ms.store.name,currency:e.currency.name,shipping:e.shipping_total,quantity:e.item_count,coupon:e.coupon_code,tax:e.taxes_total,transaction_id:e.txn_id,revenue:e.total}),window.ga("send","event","Order Completed","Purchase",e.total+" "+e.currency.symbol)})})}}(ms.settings.google_analytics_id,ms.settings.analytics_settings||{}).initialize(),window.ms.settings.google_tag_manager_id&&""!=window.ms.settings.google_tag_manager_id&&!ms.user.isBot&&new function(e){var o=this,t=e;o.getCurrency=function(e){return e.name||e},o.getProductObject=function(e,t){var a={id:e.sku,name:e.name,category:Array.isArray(e.categories)&&e.categories.length?e.categories.join("/"):"",image:e.images&&e.images.length?ms_store.baseUrl+"/"+e.images[0].image:"",price:e.price,brand:e.brand,list:ms.page.name};return e.variant_id&&(a.variant=e.variant_id),t&&(a.position=t),a},o.getOrderItemObject=function(e,t){try{var a={id:e.product.sku,name:e.product.name,category:e.product.categories&&Array.isArray(e.product.categories)&&e.product.categories.length?e.product.categories.join("/"):"",price:e.price,image:e.product.images&&e.product.images.length?ms_store.baseUrl+"/"+e.product.images[0].image:"",brand:e.product.brand,quantity:e.quantity};return e.product.variant_id&&(a.variant=e.variant_id),t&&(a.position=t),a}catch(e){}},o.checkoutAction=function(e,t){e={event:"checkoutOption",ecommerce:{checkout_option:{actionField:{step:e,option:t}}}};ms.cart.sub_total&&(e.ecommerce.checkout_option.sub_total=ms.cart.sub_total),ms.cart.total&&(e.ecommerce.checkout_option.total=ms.cart.total),window.dataLayer.push(e)},o.initialize=function(){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),mystore.utils.loadScripts(["https://www.googletagmanager.com/gtm.js?id="+t]),o.bindEvents()},o.bindEvents=function(){ms.app.addPosthook({entity:"ms.products",command:"list"},function(e,t,a){var s=t.data.data;if(!(s=t.data.records?t.data.records:s).length)return a();var n={event:"productImpressions",ecommerce:{currencyCode:o.getCurrency(ms.user.currency)}};s.forEach(function(e,t){n.ecommerce.impressions||(n.ecommerce.impressions=[]),12<=t||n.ecommerce.impressions.push(o.getProductObject(e,t+1))}),window.dataLayer.push(n),a()}),ms.bind("ms.page_loaded",function(e){var t;"product"==ms.page.name&&ms.product&&(ms.fromPage&&(t={event:"productClick",ecommerce:{click:{products:[o.getProductObject(ms.product)]}}},window.dataLayer.push(t)),e={event:"productDetail",ecommerce:{currencyCode:ms.user.currency,detail:{products:[o.getProductObject(ms.product)]}}},window.dataLayer.push(e))}),ms.bind("ms.cart_item_added",function(e){var t=e.data&&e.data.new_item;t&&(e={event:"addToCart",ecommerce:{currencyCode:o.getCurrency(ms.user.currency),add:{products:[o.getOrderItemObject(t)]}}},window.dataLayer.push(e))}),ms.bind("ms.cart_item_removed",function(e){var t=e.data&&e.data.old_item&&e.data.old_item.product;t&&(e={event:"removeFromCart",ecommerce:{currencyCode:o.getCurrency(ms.user.currency),remove:{products:[o.getProductObject(t)]}}},window.dataLayer.push(e))}),ms.bind("ms.page_loaded",function(){var e,a={event:"pageView"};window.dataLayer.push(a),"checkout"==ms.page.name&&(ms.settings&&ms.settings.gtm_funnel&&"checkout"==ms.page.name&&o.checkoutAction("OnCheckoutPage","pageView"),a={event:"checkout",ecommerce:{checkout:{currencyCode:o.getCurrency(ms.user.currency),actionField:{step:1,option:ms.user.isLoggedIn?ms.user.email:"Guest Checkout"},products:[]}}},(e=ms.cart.items).length&&(e.forEach(function(e,t){a.ecommerce.checkout.products.push(o.getOrderItemObject(e,t))}),ms.cart.sub_total&&(a.ecommerce.checkout.sub_total=ms.cart.sub_total),ms.cart.total&&(a.ecommerce.checkout.total=ms.cart.total),window.dataLayer.push(a)))}),ms.app.addPosthook({entity:"ms.carts",command:"updateUser"},function(e,t,a){var t=t.data.cart,s=ms.settings&&ms.settings.gtm_funnel?"userUpdated":2;o.checkoutAction(s,ms.user.email||t.email_id),a()}),ms.app.addPosthook({entity:"ms.carts",command:"updateAddresses"},function(e,t,a){var s=ms.settings&&ms.settings.gtm_funnel?"addressEntered":3;o.checkoutAction(s,"address entered"),a()}),ms.app.addPosthook({entity:"ms.carts",command:"updatePaymentMethod"},function(e,t,a){var t=t.data.cart,t=t&&t.payment_method&&t.payment_method.name,s=ms.settings&&ms.settings.gtm_funnel?"paymentMethodSelected":4;if(!t)return a();o.checkoutAction(s,t),a()}),ms.settings&&ms.settings.gtm_funnel&&ms.app.addPrehook({entity:"ms.carts",command:"placeOrder"},function(e,t,a){o.checkoutAction("checkoutStarted","Checkout Initiated"),a()}),ms.bind("ms.order_placed",function(e){e=(e.data.order&&e.data.order.orders?e.data.order:e.data).orders;e&&e.length&&e.forEach(function(e){var t=e.items,a=[],t=(t.forEach(function(e,t){a.push(o.getOrderItemObject(e,t+1))}),{event:ms.settings.update_gtm_purchase_event?"purchase":"Purchase",ecommerce:{purchase:{actionField:{email:e.email,phone:e.shipping_address.phone,id:e.order_id,affiliation:ms.store.name,currency:e.currency.name,shipping:e.shipping_total,quantity:e.item_count,coupon:e.coupon_code,tax:e.taxes_total,transaction_id:e.txn_id,revenue:parseFloat(e.total)},products:a}}});ms.device.isMobileApp&&(t.ecommerce.purchase.actionField.device="app"),window.dataLayer.push(t)})}),ms.bind("ms.user_register",function(){var e=ms.user,e={event:"Signup Success",userId:e._id,provider:e.provider||"website"};window.dataLayer.push(e)}),ms.bind("ms.user_login",function(){var e=ms.user,e={event:"Login Success",userId:e._id,provider:e.provider||"website"};window.dataLayer.push(e)})}}(window.ms.settings.google_tag_manager_id).initialize(),ms.settings.google_analytics_measurement_id&&""!=ms.settings.google_analytics_measurement_id&&!ms.user.isBot&&new function(a){var r=this;r.loadGAScript=function(){var e=document.createElement("script"),t=(e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id="+a,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)},r.gtag=function(){dataLayer.push(arguments)},r.initialize=function(){r.loadGAScript(),window.dataLayer=window.dataLayer||[],r.gtag("js",new Date),r.gtag("config",a),r.bindEcommerceEvents()},r.getCartItemObject=function(e){return{item_id:e.product.sku,item_name:e.product.name,item_category:e.product.categories&&Array.isArray(e.product.categories)&&e.product.categories.length?e.product.categories.join("/"):"",price:e.price,image:e.product.images&&e.product.images.length?ms_store.baseUrl+"/"+e.product.images[0].image:"",item_brand:e.product.brand,quantity:e.quantity}},r.getOrderItemObject=function(e){return{item_id:e.product.sku,item_name:e.product.name,coupon:"SUMMER_FUN",discount:0,item_brand:e.brand,item_category:e.product.categories&&Array.isArray(e.product.categories)&&e.product.categories.length?e.product.categories.join("/"):"",image:e.product.images&&e.product.images.length?ms_store.baseUrl+"/"+e.product.images[0].image:"",price:e.price,quantity:e.quantity}},r.getListItemObject=function(e){return{item_id:e.sku,item_name:e.name,coupon:"",discount:0,index:5,item_list_name:Array.isArray(e.categories)&&e.categories.length?e.categories.join("/"):"",item_list_id:"",item_brand:e.brand,item_category:Array.isArray(e.categories)&&e.categories.length?e.categories.join("/"):"",item_variant:"",price:e.price,image:e.images&&e.images.length?ms_store.baseUrl+"/"+e.images[0].image:"",currency:ms.settings.base_currency,quantity:1}},r.bindEcommerceEvents=function(){ms.bind("ms.page_loaded",function(){var e={screen_name:ms.page.name};r.gtag("event","screen_view",e)}),ms.app.addPosthook({entity:"ms.carts",command:"addItem"},function(e,t,a){t=t.data.product;if(!t)return a();var s=r.getCartItemObject(t);r.gtag("event","add_to_cart",{currency:ms.settings.base_currency,items:[s],value:t.price}),a()}),ms.app.addPosthook({entity:"ms.products",command:"list"},function(e,t,a){var s=t.data.data;if(!(s=t.data.records?t.data.records:s).length)return a();var n=[];if(s.forEach(function(e,t){n.push(r.getListItemObject(e))}),ms.page&&"product"==ms.page.name)ms.product&&ms.product.sku&&ms.product.name&&(r.gtag("event","select_item",{items:[r.getListItemObject(ms.product)],item_list_name:"Related products",item_list_id:ms.product.name}),r.gtag("event","view_item",{items:[r.getListItemObject(ms.product)]}));else{var o,i="";for(o in ms.routeParams)i+=o+":"+ms.routeParams[o];r.gtag("event","view_item_list",{items:n,item_list_name:i=i||"home",item_list_id:i})}a()}),ms.bind("ms.order_placed",function(e){var t=(e.data.order&&e.data.order.orders?e.data.order:e.data).orders;if(t&&t.length)for(var a=[],s=0;s<t.length;s++){for(var n=0;n<t[s].items.length;n++)a.push(r.getOrderItemObject(t[s].items[n]));r.gtag("event","purchase",{id:t[s].order_id,affiliation:ms.store.name,currency:t[s].currency.name,shipping:t[s].shiping_total,quantity:t[s].item_count,coupon:t[s].coupon_code,items:a,tax:t[s].taxes_total,transaction_id:t[s].txn_id,value:t[s].total})}}),ms.bind("ms.user_register",function(){var e=ms.user,e={userId:e._id,method:e.provider||"website"};r.gtag("event","sign_up",e)}),ms.bind("ms.user_login",function(){var e=ms.user,e={userId:e._id,method:e.provider||"website"};r.gtag("event","login",e)})}}(ms.settings.google_analytics_measurement_id).initialize(),window.ms.settings.facebook_pixel_id&&""!=window.ms.settings.facebook_pixel_id&&!ms.user.isBot&&new function(e){var i=this;i.pixelId=e,i.initialize=function(){i.loadFacebookScript(),window.fbq("init",i.pixelId),""!==i.agent&&window.fbq("set","agent",i.agent,i.pixelId),i.bindEcommerceEvents()},i.loadFacebookScript=function(){var e,t;window.fbq||(window.fbq=function(){window.fbq.callMethod?window.fbq.callMethod.apply(window.fbq,arguments):window.fbq.queue.push(arguments)},window._fbq||(window._fbq=window.fbq),window.fbq.push=window.fbq,window.fbq.loaded=!0,window.fbq.version="2.0",window.fbq.queue=[],(e=document.createElement("script")).id="facebookpixel",e.async=!0,e.src="https://connect.facebook.net/en_US/fbevents.js",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t))},i.formatRevenue=function(e){return Number(e||0).toFixed(2)},i.getCurrency=function(e){return e.name||e},i.getProductContentIds=function(e){var t=[];if(Array.isArray(e))for(var a=0,s=e.length;a<s;a++)t.push(e[a].sku||e[a].variant_id);else t.push(e.sku||e.variant_id);return t},i.getProductContentType=function(e){return e._id,"product"},i.getProductNumItems=function(e){return e.quantity||i.getProductContentIds(e).length},i.getProductKey=function(e){return e.sku||e.variant_id},i.getOrderContentIds=function(e){for(var t=[],a=e.items,s=0,n=a.length;s<n;s++){var o=a[s],o=i.getProductKey(o.product);o&&-1===t.indexOf(o)&&t.push(o)}return t},i.getOrderContentType=function(e){return"product"},i.getOrderNumItems=function(e){for(var t=0,a=e.items||[],s=0,n=a.length;s<n;s++){var o=a[s];i.getProductKey(o.product)&&(t+=o.quantity||1)}return t},i.bindEcommerceEvents=function(){try{if(!window.fbq)return;ms.bind("ms.page_loaded",function(){if(window.fbq("track","PageView"),"product"==ms.page.name&&ms.product){let e=ms.product;window.fbq("track","ViewContent",{content_ids:i.getProductContentIds(e),content_type:i.getProductContentType(e),content_name:e.name||"",content_category:e.categories&&Array.isArray(e.categories)&&e.categories.length?e.categories.join(","):"",currency:i.getCurrency(ms.user.currency),value:i.formatRevenue(e.price),userAgent:navigator.userAgent,language:ms.user.language})}if("checkout"==ms.page.name&&ms.cart.items){if(window.fbq("track","InitiateCheckout",{content_ids:i.getOrderContentIds(ms.cart),content_type:i.getOrderContentType(ms.cart),currency:i.getCurrency(ms.user.currency),value:i.formatRevenue(ms.cart.total),num_items:i.getOrderNumItems(ms.cart)}),sessionStorage.getItem("first_submission"))return;sessionStorage.getItem("first_submission")||sessionStorage.setItem("first_submission",!0)}var e;"search"==ms.page.name&&(e=ms.routeParams.query,window.fbq("track","Search",{search_string:e||""}))}),ms.app.addPosthook({entity:"ms.products",command:"list"},function(e,t,a){var s=t.data.data;if(!(s=t.data.records?t.data.records:s).length)return a();ms.group?window.fbq("trackCustom","ViewCategory",{content_ids:i.getProductContentIds(s),content_type:i.getProductContentType(ms.group),content_name:ms.group.name||"",content_category:ms.group.name}):ms.category&&window.fbq("trackCustom","ViewCategory",{content_ids:i.getProductContentIds(s),content_type:i.getProductContentType(ms.category),content_name:ms.category.name||"",content_category:(ms.category.parent||ms.category).name}),a()}),ms.bind("ms.cart_item_added",function(e){e=e.data&&e.data.new_item;e&&e.product&&window.fbq("track","AddToCart",{content_ids:i.getProductContentIds(e.product),content_type:i.getProductContentType(e.product),content_name:e.name||"",content_category:e.product.categories&&Array.isArray(e.product.categories)&&e.product.categories.length?e.product.categories.join(","):"",currency:i.getCurrency(ms.user.currency),value:i.formatRevenue(e.price),num_items:i.getProductNumItems(e)})}),ms.bind("ms.cart.payment_method_updated",function(e){window.fbq("track","AddPaymentInfo",{currency:i.getCurrency(ms.user.currency),value:i.formatRevenue(ms.cart.total),content_ids:i.getOrderContentIds(ms.cart),content_type:i.getOrderContentType(ms.cart),content_category:ms.cart.items[0]&&ms.cart.items[0].product.categories&&Array.isArray(ms.cart.items[0].product.categories)&&ms.cart.items[0].product.categories.length?ms.cart.items[0].product.categories.join(","):""})}),ms.bind("ms.wishlist_item_added",function(e){let t=e.data&&e.data.product;window.fbq("track","AddToWishlist",{content_ids:i.getProductContentIds(t),content_type:i.getProductContentType(t),content_name:t.name||"",content_category:t.categories&&Array.isArray(t.categories)&&t.categories.length?t.categories.join(","):"",currency:i.getCurrency(ms.user.currency),value:i.formatRevenue(t.price)})}),ms.bind("ms.order_placed",function(e){e=(e.data.order&&e.data.order.orders?e.data.order:e.data).orders;e&&e.length&&e.forEach(function(e){window.fbq("track","Purchase",{content_ids:i.getOrderContentIds(e),content_type:i.getOrderContentType(e),currency:i.getCurrency(ms.user.currency),value:i.formatRevenue(e.total),num_items:i.getOrderNumItems(e)})})}),ms.bind("ms.user_register",function(){var e=ms.user;window.fbq("track","CompleteRegistration",{content_name:e.email,status:200,currency:i.getCurrency(ms.user.currency),value:0})}),ms.bind("ms.user_login",function(){var e=ms.user;window.fbq("trackCustom","LoginSuccess",{user_id:e._id,provider:e.provider||"website"})})}catch(e){}}}(window.ms.settings.facebook_pixel_id).initialize()},window.handleNoInternet=function(){window.ms.device.isMobileApp?(console.log("url: "+window.location.href),ms.fetch(window.location.href).then(function(e){window.location.reload()}).catch(function(e){console.log(e)})):window.location.reload()},ms._initialize=function(){ms.device.isBot&&(ms.store.base_cdn_url="//cdn.storehippo.com"),ms.store.base_cdn_url&&(ms.store.globalAssetBaseUrl=ms.store.base_cdn_url+"/global/assets",ms.store.baseUrl=ms.store.base_cdn_url+"/s/"+ms.store.storeId),handleCacheEntities(),ms.user.language&&(a=ms.user.language.toLowerCase(),$("html").attr("lang",a),$("body").addClass("ms-l-"+a),"bootstrap3"!=ms.theme.css_framework&&$("html").attr("dir","ltr"),-1<["ar","he","ha","ku","ps","ur","yi","fa"].indexOf(a)&&("bootstrap3"!=ms.theme.css_framework?$("html").attr("dir","rtl"):$("body").addClass("ms-l-rtl AR"))),ms.app.addPrehook({entity:"ms.forms",command:"list"},function(e,t,a){var s=e.query&&e.query.q&&e.query.q.name;if(!s||!ms.forms[s])return a();e._skipCommand=!0;var n={};return e.version?n.data=[ms.forms[s]]:n.records=[ms.forms[s]],t.set(200,n),a()}),ms.app.addPosthook({entity:"ms.users",command:"register"},function(e,t,a){t=t.data&&t.data.data||t.data;t.token&&(localStorage.setItem("app_token",t.token),ms.device.isMobileApp&&ms.cordova.executeScript("localStorage.setItem('app_token', params.token)",{token:t.token})),ms._updateUser(t),ms.trigger("ms.user_register"),a()}),ms.app.addPosthook({entity:"ms.carts",command:"updatePaymentMethod"},function(e,t,a){if(!e.ms.settings||!e.ms.settings.payment_method_in_coupon_codes)return a();ms.cart.updateUser({email_id:t.data.cart.email_id}),a()}),ms.app.addPosthook({entity:"ms.users",command:"login"},function(e,t,a){t=t.data&&t.data.data||t.data;t.token&&(localStorage.setItem("app_token",t.token),ms.device.isMobileApp&&ms.cordova.executeScript("localStorage.setItem('app_token', params.token)",{token:t.token})),ms._updateUser(t,!0),ms.trigger("ms.user_login"),a()}),ms.app.addPosthook({entity:"ms.users",command:"updateSession"},function(e,t,a){t=t.data&&t.data.data||t.data;ms._updateUser(t),ms.trigger("ms.user_login"),a()}),ms.app.addPosthook({entity:"ms.users",command:"logout"},function(e,t,a){t=t.data.data||t.data;localStorage.removeItem("app_token"),ms.device.isMobileApp&&ms.cordova.executeScript("localStorage.removeItem('app_token')"),ms._updateUser(t),ms.trigger("ms.user_logout"),0===ms.page.path.indexOf("/account/")&&ms.goTo("/user/login"),a()}),ms.app.addPosthook({entity:"ms.users",command:"mobileVerification"},function(e,t,a){t.data.data||t.data;ms._isLogged(),a()}),ms.settings.expertrec_api_key&&ms.app.addPrehook({entity:"ms.products",command:"list"},function(n,e,a){if(!n.query||!n.query.search)return a();if(n.query.search=encodeURIComponent(n.query.search),ms.adminTheme)return a();var o=0,s=function(){var e="&page="+o,t="&size=50",a="https://searchv7.expertrec.com/v6/search/"+ms.settings.expertrec_api_key+"/?q="+n.query.search,s="&suggestions=1&maxSuggestions=12&facets=0",s=(a=a+(s="search"==ms.page.name&&n.httpcache?"":s)+t,e&&(a+=e),n.ms.substore&&n.ms.substore.alias&&(a+="&fq=substore:"+n.ms.substore.alias),{method:"GET",cors:!0,crossDomain:!0,contentType:"application/json",secure:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},success:d});$.ajax(a,s)},i=(s(o),[]),r=[];function d(e){if(!e)return a();if(!e.results&&!e.popular_products)return a();if(e.results.length)for(var t=0;t<e.results.length;t++)e.results[t].images=[{image:e.results[t].image1}],i[t]=e.results[t],r.push(e.results[t].id);if("search"==ms.page.name&&n.httpcache&&"50"==e.results.length)return s(o+=1);n.originalQuery=Object.assign({},n.query),delete n.query.search,"string"==typeof n.query.filters&&(n.query.filters=JSON.parse(n.query.filters)),n.query.filters||(n.query.filters=[]),n.query.filters.push({field:"uniquesku",operator:"in",value:r}),n.query.filters=JSON.stringify(n.query.filters),a()}}),ms.settings.use_algoliasearch&&ms.settings.algoliasearch_app_key&&ms.settings.algoliasearch_search_key&&ms.app.addPrehook({entity:"ms.products",command:"list"},function(l,c,m){var u,e=ms.settings.algoliasearch_index_name||"storehippo_PRODUCTS",t="https://"+ms.settings.algoliasearch_app_key+"-dsn.algolia.net/1/indexes/"+e+"/query";if(!l.query||!l.query.search)return m();if(l.query.search=encodeURIComponent(l.query.search),ms.adminTheme)return m();if(!ms.settings.algoliasearch_search_key||!ms.settings.algoliasearch_app_key)return m();var a=l.query.limit||20,s=(l.query.start&&(a=l.query.limit),"&hitsPerPage="+(a="search"!=ms.page.name?10:a)),n=0,a=("search"==ms.page.name&&l.query.start&&(n=parseInt(l.query.start/a)),{method:"POST",headers:{"Content-Type":"application/json","X-Algolia-API-Key":ms.settings.algoliasearch_search_key,"X-Algolia-Application-Id":ms.settings.algoliasearch_app_key},data:JSON.stringify({params:"query="+l.query.search+s+"&page="+n}),dataType:"json",success:function(e){var t=u&&u.facetHits||[];5<t.length&&(t=t.slice(0,5));for(var a=e&&e.hits,s=(e.nbHits,[]),n=0;n<a.length;n++){var o=a[n];if(s.push(o.record_id),o.images=[{image:o.image}],o.translated_names){for(var i=JSON.parse(o.translated_names),r=0;r<i.length;r++)i[r][ms.user.language]&&(o.name=i[r][ms.user.language]);delete o.translated_names}if(o.translated_brands){for(i=JSON.parse(o.translated_brands),r=0;r<i.length;r++)i[r][ms.user.language]&&(o.brand=i[r][ms.user.language]);delete o.translated_brands}}var d={count:a.length,records:a,facets:t,total:e.nbHits};if("search"==ms.page.name){l.originalQuery=Object.assign({},l.query),l.algoliarecords=a,delete l.query.search,delete l.query.start,delete l.query.limit;for(n=0;n<l.query.filters.length;n++)l.query.filters[n].field;"string"==typeof l.query.filters&&(l.query.filters=JSON.parse(l.query.filters)),l.algoliafacets=t,l.totalAlgoliaResult=e.nbHits,l.query.filters.push({field:"_id",operator:"in",value:s}),ms.instant_algolia_Search=[],e.userData&&e.userData.length&&(ms.instant_algolia_Search=[],e.userData.forEach(e=>{ms.instant_algolia_Search.push(e.banner)})),m()}else c.send(200,d)}});function o(e){u=e;for(var t=(t=[]).concat(ms.categories),a=0;a<ms.categories.length;a++)t=t.concat(ms.categories[a].children);if(ms.categories&&ms.categories.length)for(var s=u.facetHits.length-1;0<=s;s--)for(var n=!1,a=0;a<t.length;a++){if(u.facetHits[s].value==t[a].alias){n=!0;break}a!=t.length-1||n||u.facetHits.splice(s,1)}}ms.preferences.language,s="https://"+ms.settings.algoliasearch_app_key+"-dsn.algolia.net/1/indexes/"+e+"/facets/categories/query",n={method:"POST",headers:{"Content-Type":"application/json","X-Algolia-API-Key":ms.settings.algoliasearch_search_key,"X-Algolia-Application-Id":ms.settings.algoliasearch_app_key},data:JSON.stringify({params:"query="+l.query.search}),dataType:"json",success:o},$.ajax(s,n),$.ajax(t,a)}),ms.settings.use_algoliasearch&&ms.settings.algoliasearch_app_key&&ms.settings.algoliasearch_search_key&&ms.app.addPosthook({entity:"ms.products",command:"list"},function(e,t,a){if(!ms.adminTheme&&1!=ms.settings.use_algoliasearch)return a();if(!e.originalQuery||!e.originalQuery.search)return a();var s=e.query&&e.query.sort;if(t.data.algoliafacets=e.algoliafacets,t.data.total=e.totalAlgoliaResult,t.data&&t.data.paging&&(t.data.paging.total=e.totalAlgoliaResult,t.data.paging.count=e.totalAlgoliaResult),e.algoliarecords&&e.algoliarecords.length&&!s)for(var n=!0,o=[],o=t.data&&t.data&&t.data.data&&t.data.data.length&&t.data.data[0]._id?(n=!1,t.data.data):t.data.records,i=[],r=0;r<e.algoliarecords.length;r++){for(var d=0;d<o.length;d++)if(e.algoliarecords[r].record_id==o[d]._id){i.push(o[d]);break}r==e.algoliarecords.length-1&&(n?t.data.records=i:t.data.data=i)}return a()}),ms.bind("ms.login_auth",function(e){console.log("Received ms.login_auth event",e);var t="login";ms._providerLoginRole&&"member"!=ms._providerLoginRole&&(t="adminLogin"),ms.adminTheme&&(t="adminLogin"),ms.app.call({entity:"ms.users",version:"1",command:t,data:{email:e.data.email,auth_key:e.data.auth_key,provider:e.data.provider}},function(e,t){e||(ms._providerCallback&&"function"==typeof ms._providerCallback&&ms._providerCallback(),ms.theme.js_framework&&"angularjs"!=ms.theme.js_framework||ms._isLogged())})}),ms._newMobileApp&&ms.app.addPosthook({entity:"ms.users",command:"logout"},function(e,t,a){"google"==ms.localStorage.loginProvider&&ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.googleLogout}),"facebook"==ms.localStorage.loginProvider&&ms.cordova.postMessage({executeScript:!0,script:ms.cordova.scripts.facebookLogout}),a()});var e=(new Date).getTime(),t=(window.serverTimestamp=parseInt(window.serverTimestamp),window.serverTimestamp),a=(window.timeInterval=0,setInterval(function(){window.timeInterval=(new Date).getTime()-e,window.serverTimestamp=t+window.timeInterval},1e3),!0);ms.device.isBot&&!ms.settings.execute_startup_widgets_bot&&(a=!1),ms.store.startupControllers&&a&&ms_store.startupControllers.forEach(function(t){if((t.admin_theme||!window.ms.adminTheme)&&(!t.admin_theme||window.ms.adminTheme)){t.name||(t.name="unnamed"),t.template=t.template||"",t.append_to=t.append_to||"head",t.controller=t.controller?t.controller.trim():"";var e=t.name.replace(/\s/g,"_").replace(/\./g,"+++").toLowerCase();0!==t.controller.indexOf("function")&&(t.controller="function() {"+t.controller+"}");try{if("angularjs"!=ms.theme.js_framework||ms.settings.startup_controller_newflow)t.controller&&(console.log("Executing controller for "+t.name),window.mystore.utils.parseFunction(t.controller).call()),t.template&&(console.log("Appending html to head for "+t.name),$("head").append(t.template));else if("angularjs"==ms.theme.js_framework){ms_store.controllers||(ms_store.controllers={}),ms_store.controllers[e]=window.mystore.utils.parseFunction(t.controller);var a='<div ng-controller="ms_store.controllers.'+e+'" style="display:none;">'+t.template+"</div>";ms._compile(a).then(function(e){("body"==t.append_to?$("body"):$("head")).append(e)})}else{let e=window.mystore.utils.parseFunction(t.controller);e()}}catch(e){console.error("Error while executing startup controller ["+t.name+"]"),console.error(e)}}}),window.ms.adminTheme||(ms._updateCampaign(),ms._loadPlugins(),handleAzureSearch()),ms.trigger("ms.initialized")},window.ms.messages=[],window.ms.showMessage=function(t,e){window.ms.messages.push(t),!e||""==e||isNaN(e)?e=5e3:e*=1e3,ms.timeout(function(){var e=ms.messages.indexOf(t);-1<e&&ms.messages.splice(e,1)},e)},window.ms.addMessage=function(t){(t="string"==typeof t?{name:t}:t).message=ms.store.messages[t.name]||t.name;var a=t.params||t.data,e=(a&&"object"==typeof a&&(t.message=t.message.replace(/\{\{message\.data\.(.*?)\}\}/g,function(e,t){return a[t]||"{{"+t+"}}"}),t.message=t.message.replace(/\{\{(.*?)\}\}/g,function(e,t){return a[t]||"{{"+t+"}}"})),ms.trigger("ms.before_add_message",t));if(e&&e.defaultPrevented)return!1;t.duration&&""!=t.duration&&!isNaN(t.duration)||(t.duration=3e3),ms._message_id||(ms._message_id=1),t.id=ms._message_id++,ms.messages.push(t),console.log("Messages",ms.messages),ms.trigger("ms.message_added",t),setTimeout(function(){ms.messages=ms.messages.filter(function(e){return e.id!=t.id}),ms.trigger("ms.message_removed",t)},t.duration)},ms.resolveSEO=function(e,s,n){var t;s.page_new_title?(t=s.page_new_title,ms._compile("<div>"+t+"</div>",e).then(function(e){s.page_new_title=e.html()})):(s.data?ms.forEach(s.data.meta_tags,function(t){ms._compile("<div>"+t.content+"</div>",e).then(function(e){t.content=e.html()})}):s.data={},n&&ms.timeout(function(){var t,a,e;n.canonical_url&&(s.canonical_url=n.canonical_url),s.page_new_title&&(s.title=s.page_new_title),n.title&&(s.title=n.title),n.description&&(t=0,ms.forEach(s.data.meta_tags,function(e){"description"==e.name&&(t=1,e.content=n.description&&""!=n.description?n.description:e.content)}),0==t&&(e={name:"description",content:n.description},s.data.meta_tags.push(e))),n.keywords&&(a=0,ms.forEach(s.data.meta_tags,function(e){"keywords"==e.name&&(a=1,e.content=n.keywords&&""!=n.keywords?n.keywords:e.content)}),0==a&&(e={name:"keywords",content:n.keywords},s.data.meta_tags.push(e))),window.ga&&window.ga("send","pageview",{page:ms.page.path})}),!n&&s.page_new_title&&s.page_new_title.length&&(s.title=s.page_new_title))},ms.resolveOgTags=function(e,a){ms.timeout(function(){var t;e&&e.data.og_tags&&e.data.og_tags.length&&(t=!1,a.image&&(a.image=a.image.replace("/webp/","/")),e.data.og_tags.forEach(function(e){"og:title"==e.property&&a.title&&(e.content=a.title),"og:description"==e.property&&a.description&&(255<a.description.length&&(a.description=a.description.substring(0,255)+"..."),e.content=a.description),"og:image"==e.property&&(t=!0,a.image&&(e.content=a.image))}),!t&&a.image&&e.data.og_tags.push({property:"og:image",content:a.image}))})},ms.redirect=function(e){var t;e&&($("#ms-prerender-status-code").remove(),(t=document.createElement("meta")).id="ms-prerender-status-code",t.name="prerender-status-code",t.content="301",document.getElementsByTagName("head")[0].appendChild(t),(t=document.createElement("meta")).id="ms-prerender-header",t.name="prerender-header",-1<e.indexOf("http")?t.content="Location: "+e:t.content="Location: "+window.location.protocol+"//"+window.location.host+e,document.getElementsByTagName("head")[0].appendChild(t),ms.device.isBot||ms.searchParams._escaped_fragment_||ms.goTo(e))},ms.notFound=function(){var e=window.ms.trigger("ms.page_not_found",{});if(!e||!e.defaultPrevented){var a=function(){ms._goToState("404");var e=document.createElement("meta");e.id="ms-prerender-status-code",e.name="prerender-status-code",e.content="404",document.getElementsByTagName("head")[0].appendChild(e)};if(window.ms.adminTheme)return a();e={entity:"ms.redirects",version:1,query:{filters:[{field:"old_url",value:location.pathname.replace(ms.base,""),operator:"equal"}]}};e.query.filters=JSON.stringify(e.query.filters),ms.app.list(e,function(e,t){t&&t.data&&t.data.data&&t.data.data.length?(t=t.data.data[0].new_url,ms.redirect(t)):a()})}},ms.showErrorPage=function(){var e=ms.trigger("ms.error_page_found",{});e&&e.defaultPrevented||ms._goToState("errorPage")},window.mystore.notFound=ms.notFound,ms.reload=function(){window.location.reload()},ms._isLogged=function(){ms.app.call({entity:"ms.users",command:"isLoggedIn",version:1},function(e,t){t=t.data&&t.data.data||t.data;if(ms.adminTheme)return ms.searchParams.redirect_to?ms.goTo(ms.searchParams.redirect_to):ms.reload();if(window.ms.broadcast("ms.entity.users.login",{entity:"ms.users",level:"success",data:t}),ms._updateUser(t),ms.searchParams.redirect)return ms.goTo(ms.searchParams.redirect);ms.trigger("ms.user_login");t="/account/profile";ms.preurl&&"^"!=ms.preurl&&"/user/login"!=ms.preurl&&"/user/reset_password"!=ms.preurl&&"/user/forgotten"!=ms.preurl&&"/user/verification"!=ms.preurl&&(t=ms.preurl),ms.goTo(t),ms._applyScope()}),ms._applyScope()},window.ms._receiver=function(e){return e.data&&"ms_channel_auth"==e.data.type?(console.log("Channel authenticated",e),void ms.trigger("ms.channel_auth",e.data)):e.data&&"ms_login_auth"==e.data.type?(console.log("Login provider authenticated",e),void ms.trigger("ms.login_auth",e.data)):void("https://api.twitter.com"!=e.origin&&(-1<e.origin.indexOf("storehippo")||-1<e.origin.indexOf("devhippo")||-1<e.origin.indexOf("betahippo"))&&e.data&&"object"==typeof e.data&&"storehippo"==e.data.from&&e.data.user&&(e={entity:"ms.users",command:"updateSession",version:1,data:{user:e.data.user}},ms.adminTheme&&(e.query={q:{adminAccess:1}}),ms.app.call(e,function(){ms._isLogged()}),ms._applyScope()))},window.addEventListener?window.addEventListener("message",ms._receiver,!1):window.attachEvent("message",ms._receiver),window.mystore.afterSSOLogin=function(){ms.app.call("isLoggedIn",{entity:"ms.users"},function(e,t){e||(ms.user=new user(t.data),ms._applyScope())})},ms.bind("ms.page_loaded",function(){"/user/login"==ms.page.path&&ms.searchParams.redirect&&(ms.localStorage.setItem("redirect_uri",ms.searchParams.redirect),ms.localStorage.setItem("redirect_uri_time",(new Date).getTime()))}),ms.bind("ms.user_register",function(){var e=ms.localStorage.getItem("redirect_uri"),t=ms.localStorage.getItem("redirect_uri_time");if(ms.user.isLoggedIn&&e){if(36e5<(new Date).getTime()-t)return ms.localStorage.removeItem("redirect_uri"),void ms.localStorage.removeItem("redirect_uri_time");ms.localStorage.removeItem("redirect_uri"),ms.goTo(e)}}),ms.bind("ms.user_login",function(){var e=ms.localStorage.getItem("redirect_uri"),t=ms.localStorage.getItem("redirect_uri_time");if(e){if(36e5<(new Date).getTime()-t)return ms.localStorage.removeItem("redirect_uri"),void ms.localStorage.removeItem("redirect_uri_time");ms.localStorage.removeItem("redirect_uri"),ms.goTo(e)}}),ms.adminTheme&&ms.user.isLoggedIn&&(ms.settings.new_notification_flow?Permissions["ms.sms_provider"]&&(Permissions["ms.sms_provider"].visible=0):Permissions["ms.sms_providers"]&&(Permissions["ms.sms_providers"].visible=0),ms.settings.new_mail_provider_flow?Permissions["ms.email_providers"]&&(Permissions["ms.email_providers"].visible=0):Permissions["ms.email_providers2"]&&(Permissions["ms.email_providers2"].visible=0),ms.settings.new_payout_method_flow?(Permissions["ms.seller_payout_methods"]&&(Permissions["ms.seller_payout_methods"].visible=0),Permissions["ms.seller_payout_methods2"]&&(Permissions["ms.seller_payout_methods2"].visible=1)):(Permissions["ms.seller_payout_methods"]&&(Permissions["ms.seller_payout_methods"].visible=1),Permissions["ms.seller_payout_methods2"]&&(Permissions["ms.seller_payout_methods2"].visible=0))),ms.adminTheme&&ms.searchParams.without_layout&&(ms.without_layout=1),ms._zips={GB:"GIR[ ]?0AA|((AB|AL|B|BA|BB|BD|BH|BL|BN|BR|BS|BT|CA|CB|CF|CH|CM|CO|CR|CT|CV|CW|DA|DD|DE|DG|DH|DL|DN|DT|DY|E|EC|EH|EN|EX|FK|FY|G|GL|GY|GU|HA|HD|HG|HP|HR|HS|HU|HX|IG|IM|IP|IV|JE|KA|KT|KW|KY|L|LA|LD|LE|LL|LN|LS|LU|M|ME|MK|ML|N|NE|NG|NN|NP|NR|NW|OL|OX|PA|PE|PH|PL|PO|PR|RG|RH|RM|S|SA|SE|SG|SK|SL|SM|SN|SO|SP|SR|SS|ST|SW|SY|TA|TD|TF|TN|TQ|TR|TS|TW|UB|W|WA|WC|WD|WF|WN|WR|WS|WV|YO|ZE)(\\d[\\dA-Z]?[ ]?\\d[ABD-HJLN-UW-Z]{2}))|BFPO[ ]?\\d{1:4}$",JE:"JE\\d[\\dA-Z]?[ ]?\\d[ABD-HJLN-UW-Z]{2}$",GG:"GY\\d[\\dA-Z]?[ ]?\\d[ABD-HJLN-UW-Z]{2}$",IM:"IM\\d[\\dA-Z]?[ ]?\\d[ABD-HJLN-UW-Z]{2}$",US:"^\\d{5}$",CA:"[ABCEGHJKLMNPRSTVXY]\\d[ABCEGHJ-NPRSTV-Z][ ]?\\d[ABCEGHJ-NPRSTV-Z]\\d$",DE:"^\\d{5}$",JP:"^\\d{3}-\\d{4}$",FR:"^\\d{2}[ ]?\\d{3}$",AU:"^\\d{4}$",IT:"^\\d{5}$",CH:"^\\d{4}$",AT:"^\\d{4}$",ES:"^\\d{5}$",NL:"^\\d{4}[ ]?[A-Z]{2}$",BE:"^\\d{4}$",DK:"^\\d{4}$",SE:"^\\d{3}[ ]?\\d{2}$",NO:"^\\d{4}$",BR:"^\\d{5}[\\-]?\\d{3}$",PT:"^\\d{4}([\\-]\\d{3})?$",FI:"^\\d{5}$",AX:"22^\\d{3}$",KR:"^\\d{3}[\\-]\\d{3}$",CN:"^\\d{6}$",TW:"^\\d{3}(\\d{2})?$",SG:"^\\d{6}$",DZ:"^\\d{5}$",AD:"AD^\\d{3}$",AR:"([A-HJ-NP-Z])?\\d{4}([A-Z]{3})?$",AM:"(37)?^\\d{4}$",AZ:"^\\d{4}$",BH:"((1[0-2]|[2-9])\\d{2})?$",BD:"^\\d{4}$",BB:"(BB^\\d{5})?$",BY:"^\\d{6}$",BM:"[A-Z]{2}[ ]?[A-Z0-9]{2}$",BA:"^\\d{5}$",IO:"BBND 1ZZ$",BN:"[A-Z]{2}[ ]?^\\d{4}$",BG:"^\\d{4}$",KH:"^\\d{5}$",CV:"^\\d{4}$",CL:"^\\d{7}$",CR:"^\\d{4:5}|\\d{3}-\\d{4}$",HR:"^\\d{5}$",CY:"^\\d{4}$",CZ:"^\\d{3}[ ]?\\d{2}$",DO:"^\\d{5}$",EC:"([A-Z]^\\d{4}[A-Z]|(?:[A-Z]{2})?\\d{6})?$",EG:"^\\d{5}$",EE:"^\\d{5}$",FO:"^\\d{3}$",GE:"^\\d{4}$",GR:"^\\d{3}[ ]?\\d{2}$",GL:"39^\\d{2}$",GT:"^\\d{5}$",HT:"^\\d{4}$",HN:"(?:^\\d{5})?$",HU:"^\\d{4}$",IS:"^\\d{3}$",IN:"^\\d{6}$",ID:"^\\d{5}$",IL:"^\\d{7}$",JO:"^\\d{5}$",KZ:"^\\d{6}$",KE:"^\\d{5}$",KW:"^\\d{5}$",LA:"^\\d{5}$",LV:"^\\d{4}$",LB:"(^\\d{4}([ ]?\\d{4})?)?$",LI:"(948[5-9])|(949[0-7])$",LT:"^\\d{5}$",LU:"^\\d{4}$",MK:"^\\d{4}$",MY:"^\\d{5}$",MV:"^\\d{5}$",MT:"[A-Z]{3}[ ]?^\\d{2:4}$",MU:"(^\\d{3}[A-Z]{2}\\d{3})?$",MX:"^\\d{5}$",MD:"^\\d{4}$",MC:"980^\\d{2}$",MA:"^\\d{5}$",NP:"^\\d{5}$",NZ:"^\\d{4}$",NI:"((^\\d{4}-)?\\d{3}-\\d{3}(-\\d{1})?)?$",NG:"(^\\d{6})?$",OM:"(PC )?^\\d{3}$",PK:"^\\d{5}$",PY:"^\\d{4}$",PH:"^\\d{4}$",PL:"^\\d{2}-\\d{3}$",PR:"00[679]^\\d{2}([ \\-]\\d{4})?$",RO:"^\\d{6}$",RU:"^\\d{6}$",SM:"4789\\d$",SA:"^\\d{5}$",SN:"^\\d{5}$",SK:"^\\d{3}[ ]?\\d{2}$",SI:"^\\d{4}$",ZA:"^\\d{4}$",LK:"^\\d{5}$",TJ:"^\\d{6}$",TH:"^\\d{5}$",TN:"^\\d{4}$",TR:"^\\d{5}$",TM:"^\\d{6}$",UA:"^\\d{5}$",UZ:"^\\d{6}$",VA:"00120$",VE:"^\\d{4}$",ZM:"^\\d{5}$",AS:"96799$",CC:"6799$",CK:"^\\d{4}$",RS:"^\\d{6}$",ME:"8^\\d{4}$",CS:"^\\d{5}$",YU:"^\\d{5}$",CX:"6798$",ET:"^\\d{4}$",FK:"FIQQ 1ZZ$",NF:"2899$",FM:"(9694[1-4])([ \\-]^\\d{4})?$",GF:"9[78]3^\\d{2}$",GN:"^\\d{3}$",GP:"9[78][01]^\\d{2}$",GS:"SIQQ 1ZZ$",GU:"969[123]\\d([ \\-]^\\d{4})?$",GW:"^\\d{4}$",HM:"^\\d{4}$",IQ:"^\\d{5}$",KG:"^\\d{6}$",LR:"^\\d{4}$",LS:"^\\d{3}$",MG:"^\\d{3}$",MH:"969[67]\\d([ \\-]^\\d{4})?$",MN:"^\\d{6}$",MP:"9695[012]([ \\-]^\\d{4})?$",MQ:"9[78]2^\\d{2}$",NC:"^\\d{5}$",NE:"^\\d{4}$",VI:"008(([0-4]\\d)|(5[01]))([ \\-]^\\d{4})?$",PF:"987^\\d{2}$",PG:"^\\d{3}$",PM:"9[78]5^\\d{2}$",PN:"PCRN 1ZZ$",PW:"96940$",RE:"9[78]4^\\d{2}$",SH:"(ASCN|STHL) 1ZZ$",SJ:"^\\d{4}$",SO:"^\\d{5}$",SZ:"[HLMS]^\\d{3}$",TC:"TKCA 1ZZ$",WF:"986^\\d{2}$",XK:"^\\d{5}$",YT:"976^\\d{2}$"};var validation={removeError:function(e){angular.forEach(e,function(e){e.error&&delete e.error,e.errors&&delete e.errors,!e.settings||"object"!=e.data_type&&"array"!=e.data_type&&"object"!=e.settings.edit_type&&"collection"!=e.settings.edit_type||validation.removeError(e.fields)})},checkUniqueColumns:function(e,t){var a={},s={},n={};if(e.settings.unique_columns&&e.settings.unique_columns.length){for(var o,i=0,r=t.length;i<r;i++)for(var d=t[i],l=0;l<e.settings.unique_columns.length;l++){var c=e.settings.unique_columns[l];n[c]?n[c]==d[c]&&(s[c]=i):n[c]=d[c]}for(o in s){var m=String(o);m=(m=m.replace(/_/g," ")).replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),a[o]={duplicate:m+" is duplicate",index:s[o]}}}return a},checkConditionalValidation:function(t,e){var a=!0;if(e.settings&&e.settings.show_on&&e.settings.show_on.length){for(var s=!1,n=0,o=e.settings.show_on.length;n<o;n++){var i=e.settings.show_on[n];if(t[i.field]==i.value){s=!0;break}}a=s}else e.settings&&e.settings.hide_on&&e.settings.hide_on.length&&(s=!1,e.settings.hide_on.forEach(function(e){if(e)switch(e.operator||"equal"){case"equal":t[e.field]!=e.value&&(s=!0);break;case"not_equal":t[e.field]==e.value&&(s=!0)}}),a=s);return a},formValidation:function(e,o,t,a,i){var r={};if(!e||!e.length)return r;var s=[];if(t)for(var n in o)for(var d=0;d<e.length;d++){var l=e[d];if(l.name==n){s.push(l);break}}else s=e;return s.forEach(function(n){var e;!o||!n.settings||"1"==n.settings.hidden||n.settings.hidden||"object"!=n.settings.edit_type&&"object"!=n.data_type||(e=validation.formValidation(n.fields,o[n.name],!1),0!==Object.keys(e).length&&(r[n.name]=e)),o&&(n.settings&&"collection"==n.settings.edit_type&&"1"!=n.settings.hidden&&!n.settings.hidden||"array"==n.data_type&&"1"!=n.settings.hidden&&!n.settings.hidden&&n.fields&&n.fields.length)&&o[n.name]&&o[n.name].length&&(e=validation.checkUniqueColumns(n,o[n.name]),o[n.name].forEach(function(e,t){e=validation.formValidation(n.fields,e,!1,n,t);0!==Object.keys(e).length&&(r[n.name]||(r[n.name]=[]),r[n.name].push(e))}),0!=Object.keys(e).length&&(r[n.name]||(r[n.name]=[]),r[n.name].push(e))),o&&"array"==n.data_type&&"1"!=n.settings.hidden&&!n.settings.hidden&&!n.fields&&o[n.name]&&Array.isArray(o[n.name])?o[n.name].forEach(function(e){var t=Object.assign({},n),a=(t.data_type="string",{}),e=(a[t.name]=e,validation.formValidation([t],a,!1));0!==Object.keys(e).length&&(r[n.name]||(r[n.name]={}),r[n.name]=e)}):(n.settings||(n.settings={}),n.settings.required&&"1"==n.settings.required&&"1"!=n.settings.hidden&&validation.checkConditionalValidation(o,n)&&(void 0===o[n.name]||null==o[n.name]||"false"==String(o[n.name])||"0"!=String(o[n.name])&&!String(o[n.name]))&&("email"!=n.settings.edit_type&&"email"!=n.settings.display_type&&"email"!=n.type||o[n.name]?!n.settings||"phone"!=n.settings.edit_type&&"phone"!=n.settings.display_type&&"phone"!=n.type||o[n.name]?(r[n.name]={required:"Required field"},void 0!==i&&(r[n.name].index=i),n.error="Required Field"):(r[n.name]={required:"Enter a valid phone number"},void 0!==i&&(r[n.name].index=i),n.error="Enter a valid phone number"):(r[n.name]={required:"Enter a valid email"},void 0!==i&&(r[n.name].index=i),n.error="Enter a valid email")),"email"!=n.settings.edit_type&&"email"!=n.settings.display_type&&"email"!=n.type||(n.settings.validation||(n.settings.validation=[]),n.settings.validation.filter(function(e){return"email"==e.rule}).length||n.settings.validation.push({rule:"email",message:"Email is not valid"})),o&&n.data_type&&validation.checkConditionalValidation(o,n)&&void 0!==o[n.name]&&("number"==n.data_type||"integer"==n.data_type)&&!/^-?\d*(\.\d+)?$/.test(o[n.name])&&(r[n.name]||(r[n.name]={}),r[n.name].numeric="Only numbers",n.error="Only numbers"),n.settings&&n.settings.validation&&"1"!=n.settings.hidden&&!n.settings.hidden&&validation.checkConditionalValidation(o,n)&&n.settings.validation.forEach(function(e){var t=e.rule,a={rule:t},s=e.param,e=e.message;void 0!==o[n.name]&&"NaN"==String(o[n.name])&&(o[n.name]=String(o[n.name])),"function"==t&&o[n.name]&&!validation.validFunction(o[n.name])&&(a.message=e||"Invalid function"),"callback"==t&&validation.callback(o,s)&&(a.message=e||"Required Field"),"no_dot"==t&&o[n.name]&&validation.matchDot(o[n.name],s)&&(a.message=e||"Dot not allowed"),"email"==t&&o[n.name]&&!validation.validEmail(o[n.name])&&(a.message=e||"Email is not valid"),"regex"==t&&o[n.name]&&!validation.validRegex(o[n.name],s)&&(a.message=e||"Only Alphanumeric and underscore"),"max_length"==t&&o[n.name]&&String(o[n.name]).length>parseInt(s)&&(a.message=e||"Maximum "+s+" chars are allowed"),"min_length"==t&&o[n.name]&&String(o[n.name].length)<parseInt(s)&&(a.message=e||"Minimum "+s+" chars are required"),"url"==t&&o[n.name]&&!validation.validUrl(o[n.name])&&(a.message=e||"Enter a valid URL"),"match_other_field"==t&&o[n.name]!=o[s]&&(a.message=e||n.name+" does not match"),"greater_than"==t&&o[n.name]&&parseFloat(o[n.name])<=parseFloat(s)&&(a.message=e||"Value needs to be greater than "+s),"less_than"==t&&o[n.name]&&parseFloat(o[n.name])>=parseFloat(s)&&(a.message=e||"Value needs to be less than "+s),"greater_than_field"==t&&o[n.name]&&o[s]&&parseFloat(o[n.name])<parseFloat(o[s])&&(a.message=e||(n.settings.label||n.name)+" can not be less than "+s),"numeric"==t&&o[n.name]&&!validation.validNumeric(o[n.name])&&(a.message=e||"Only numbers"),"boolean"==t&&o[n.name]&&!validation.validBoolean(o[n.name])&&(a.message=e||"Only 0 or 1"),"valid_chars"==t&&o[n.name]&&!validation.validCharOnly(o[n.name])&&(a.message=e||"Only Alphanumeric and underscore"),"zip_code"==t&&o[n.name]&&(s=o.country,new RegExp(ms._zips[s]).test(o[n.name])||(a.message=e||"Enter valid zip code")),a.message&&(r[n.name]||(r[n.name]={}),r[n.name][t]=a.message,void 0!==i&&(r[n.name].index=i),n.error=a.message)}))}),r},validEmail:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},callback:function(e,t){t=window.mystore.utils.parseFunction(t);try{return t.call(this,e)}catch(e){return console.log(e),!1}},matchDot:function(e){return/[\.]/.test(e)},validUrl:function(e){return/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/.test(e)},validRegex:function(e,t){return new RegExp(t).test(e)},validNumeric:function(e){return/^-?\d*(\.\d+)?$/.test(e)},validBoolean:function(e){return"0"!=e&&"1"!=e?!1:!0},validCharOnly:function(e){return/^[a-z_A-Z0-9]*$/.test(e)},validFunction:function(e){e=window.mystore.utils.parseFunction(e);return e&&"[object Function]"==={}.toString.call(e)}},seller_alias;function initializeApplication(){console.log("Creating  app");const app=Vue.createApp({});app.config.globalProperties.ms=ms,ms.renderComponent=function(e,t,a){e=Object.assign({},ms.components[e]);e.props=Object.keys(t);let s=Vue.createVNode(e,t);s.appContext=app._context,Vue.render(s,a)};var widgetsByName={};ms.components={};let parseFunction=function(str,widget){if("function"==typeof str)return str;if(str=str.trim(),str.match(/^[\w\.]+$/)){for(var parts=str.split("."),obj=eval(parts.shift());obj&&parts.length&&(obj=obj[parts.shift()],obj););obj&&(str=obj.toString())}let match=str.match(/^\s*?function\s*?\(([\s\S]*?)\)\s*?{([\s\S]*?)}\s*?;?\s*$/),body=(match&&(str=match[2]),`var $scope = {widgetName: '${widget.name}'};
            var $props = props;
            var $attrs = context.attrs;
            var $watch = Vue.watch;
            var $emit = context.emit;
            var $logger = new ms._logger('${widget.name}');
            var $ref = function(value){
                return (typeof value == 'object')?Vue.reactive(value):Vue.ref(value);
            }
            
            try {
                ${str}
            }
            catch(e){
                console.error("Error while executing controller for component ${widget.name}", e);
            }
            return $scope;
           `),args=["props","context"];try{return Function(args,body)}catch(e){console.log("error while parsing controller for function "+e.message,widget.name)}};function getRandomInt(e){Math.floor(Math.random()*Math.floor(e))}function check404(e,t,a){if("/topic"==e.path)return ms.redirect("/topics");e=e.path.replace(/\/$/,"");ms.app.listOne("ms.redirects",{filters:[{field:"old_url",value:e,operator:"equal"}]}).then(function(e){if(e&&e.new_url)return ms.redirect(e.new_url);$("#ms-prerender-status-code").remove(),$("<meta>").appendTo("head").attr("id","ms-prerender-status-code").attr("name","prerender-status-code").attr("content","404"),a()})}ms._processWidget=function(s){if(s.controller&&(s.controller=parseFunction(s.controller,s)),s.template&&(s.template=s.template.replace(/\bms\.user\b/g,"msUser")),s.template&&(s.template=s.template.replace(/\bms\.page\b/g,"msPage")),s.template&&(s.template=s.template.replace(/\bms\.cart\b/g,"msCart")),s.template&&(s.template=s.template.replace(/\bms\.settings\b/g,"msSettings")),s.template&&(s.template=s.template.replace(/\bms\.messages\b/g,"msMessages")),s.template&&(s.template=s.template.replace(/\bms\.screen\b/g,"msScreen")),s.template&&(s.template=s.template.replace(/\bms\.temp\b/g,"msTemp")),s.template&&(s.template=s.template.replace(/\bms\.design\b/g,"msDesign")),s.template&&(s.template=s.template.replace(/\bms\.product\b/g,"msProduct")),s.template&&(s.template=s.template.replace(/\bms\.seller\b/g,"msSeller")),s.template&&(s.template=s.template.replace(/\bms\.group\b/g,"msGroup")),s.template&&(s.template=s.template.replace(/\bms\.topic\b/g,"msTopic")),s.css&&(s.template+='<component is="style" scoped>'+s.css+"</component>"),!s.props&&s.settings&&Array.isArray(s.settings)){var e,t=[];for(e of s.settings)t.push(e.name);s.props=t}var a;ms.widgetsById||(ms.widgetsById={}),ms.searchParams.design&&s.template&&(a="ms-widgetId-"+s.widget_Id,ms.widgetsById[a]={name:s.name,id:a,element:$("<div>"+s.template+"</div>")},s.template="<div class='ms-widget'  id='"+s.widget_Id+"' ms-widgetId='"+s.widget_Id+"' data-widgetname='"+s.name+"'>"+s.template+"</div>");let n={props:s.props,template:s.template,setup:s.controller,errorCaptured:function(e,t,a){return console.log(`%c${s.name}%c unexpected error(${a})%c `+e,"background: #eee; color: #333;padding: 3px;font-weight:bold","color:red;font-weight:bold","color: auto"),!1}};s.events&&(n.emits=s.events.map(function(e){return e.name})),ms.components[s.name]=n,app.component(s.name,n)},ms._processWidgets=function(e){var t,a,s;for(a of e)a.originalName=a.name,t?t+=1:t=1,a.widget_Id=t,a.name=a.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-"),a.name.startsWith("ms-")||(a.name="w-"+a.name),a.parent||widgetsByName[a.name]||(widgetsByName[a.name]=a,ms._processWidget(a));for(a of e)a.name.includes("shipping"),!a.parent||widgetsByName[a.name]||((s=widgetsByName[a.parent])&&(s.props&&(a.props=s.props),s.events&&(a.events=s.events),s.controller&&(a.controller=s.controller)),ms._processWidget(a))},ms._processWidgets(ms.theme.widgets),window.addEventListener("resize",function(){ms.updateScreen()}),app.config.globalProperties.msUser=Vue.reactive({}),app.config.globalProperties.msPage=Vue.reactive({}),app.config.globalProperties.msCart=Vue.reactive({}),app.config.globalProperties.msSettings=Vue.reactive({}),app.config.globalProperties.msMessages=Vue.reactive([]),app.config.globalProperties.msScreen=Vue.reactive({}),app.config.globalProperties.msTemp=Vue.reactive({}),ms.addComponent=function(e,t){app.component(e,t),ms.components[e]=t},ms._checkAndLoadWidgets=function(i){return new Promise(function(e){if(!i)return e();let t=/\<(ms\-[a-zA-Z0-9\-]+)[\s\>]+/gm,a,s=[];for(;a=t.exec(i);)if(a[1].includes("related")&&0,a&&-1<a[1].indexOf("ms-")){let t=a[1].replace("ms-form-","ms.form.");t=(t=(t=t.replace("ms-addon-","ms.addon.")).replace("ms-","ms.")).replace("-","_"),ms.theme.widgets.filter(e=>e.originalName==t).length?console.log(`widget ${t} already exists`):s.push(t)}if(!s.length)return console.log("No Widgets to load"),e();let n=[];for(let t of s){console.log("Loading widget: ",t);var o=fetch("/ms/theme/widget/"+t+"/"+ms.store.version+".js").then(e=>e.json()).then(function(e){console.log("loaded widget",t),ms._processWidgets(e.widgets),ms.theme.widgets=ms.theme.widgets.concat(e.widgets)});n.push(o)}Promise.all(n).then(e)})},app.directive("temp",{beforeMount:function(e,t){var a={};a[t.arg]=t.value,Object.assign(app.config.globalProperties.msTemp,a)}}),ms.bind("ms.message_added",function(e){app.config.globalProperties.msMessages.push(e.data)}),ms.bind("ms.message_removed",function(a){app.config.globalProperties.msMessages.map(function(e,t){e.id==a.data.id&&app.config.globalProperties.msMessages.splice(t,1)})}),Object.assign(app.config.globalProperties.msScreen,ms.screen),ms.bind("ms.screen_updated",function(e){console.log("Screen updated"),Object.assign(app.config.globalProperties.msScreen,ms.screen)}),Object.assign(app.config.globalProperties.msSettings,ms.settings),Object.assign(app.config.globalProperties.msCart,ms.cart),ms.bind("ms.page_updated",function(){Object.assign(app.config.globalProperties.msPage,ms.page)}),Object.assign(app.config.globalProperties.msUser,ms.user),ms.bind("ms.user_updated",function(){console.log("User updated"),Object.assign(app.config.globalProperties.msUser,ms.user)}),ms.bind("ms.product_updated",function(){console.log("product updated"),Object.assign(app.config.globalProperties.msProduct,ms.product)}),ms.bind("ms.topic_updated",function(){console.log("topic updated"),Object.assign(app.config.globalProperties.msTopic,ms.topic)}),ms.bind("ms.seller_updated",function(){console.log("User updated"),Object.assign(app.config.globalProperties.msSeller,ms.seller)}),ms.bind("ms.group_updated",function(){console.log("Group updated"),Object.assign(app.config.globalProperties.msGroup,ms.group)}),ms.bind("ms.cart_loaded",function(){Object.assign(app.config.globalProperties.msCart,ms.cart)}),ms.bind("ms.cart_updated",function(){console.log("Cart updated",ms.cart),Object.assign(app.config.globalProperties.msCart,ms.cart)}),ms.bind("ms.settings_updated",function(){Object.assign(app.config.globalProperties.msSettings,ms.settings)}),ms._applyScope=function(){},ms.reactive=function(e){return"object"==typeof e?Vue.reactive(e):Vue.ref(e)},ms.watch=function(){},ms._setDefaultHttpHeader=function(e,t){ms._httpDefaults.headers[e]=t},ms.timeout=Vue.nextTick,ms.broadcast=function(e,t={}){t.name=e,ms.addMessage(t)},ms.app=new App2;var routes=[],routesByName={},page,name;ms.theme.pages.map(function(e){var t;"nointernet"!=e.name&&(routesByName[e.name]={name:e.name,path:e.url||"",component:{setup:function(){}}},e.widget&&(t="w-"+e.widget.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-"),routesByName[e.name].component=ms.components[t],"404"==e.name&&(routesByName[e.name].component.beforeRouteEnter=check404)),e.aliases&&(routesByName[e.name].alias=e.aliases.map(function(e){return e.url})))}),routesByName.orderprocessing={path:"/order/:status/:id/processing",component:{setup:mystore.controllers.processOrder}};for(page of ms.theme.pages)page.layout&&routesByName[page.layout]&&(routesByName[page.layout].children||(routesByName[page.layout].children=[]),routesByName[page.layout].children.push(routesByName[page.name]),delete routesByName[page.name]);for(name in routesByName)routes.push(routesByName[name]);ms.design=Vue.reactive({enabled:0}),app.config.globalProperties.msDesign=ms.design,ms._loadDesignFiles=function(){ms.fetch("/ms/design/vue-design-themeinfo.js",{}).then(function(e){return e.json()}).then(function(e){ms._processWidgets(e.widgets),Object.assign(app.config.globalProperties.msDesign,{enabled:1})}),ms.loadScripts(["https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"]).then(function(){ms.loadStyles(["https://unpkg.com/dropzone@5/dist/min/dropzone.min.css"])}),ms.theme.originalWidgets||fetch("/ms/theme/"+ms.theme.store_theme_id+"/theme_widgets.js?v="+new Date(ms.theme.updated_on).getTime()).then(e=>e.json()).then(function(e){ms.theme.originalWidgets=e,ms.theme.originalWidgets.widgets.forEach(function(t){var s=1e3;if("home"==t.name){let e=$("<div>"+t.template+"</div>");e.find("section").each(function(e,t){var a=$(this);t.id;a.attr("drag_id")||$(a).attr("drag_id",s+1),s++}),t.template=e.html()}})})};var designWrapper={setup:function(){ms.searchParams.design&&ms._loadDesignFiles()},template:" <component v-if='msDesign.enabled' :is=\"'ms-design'\"></component>"},applicationLayout=(app.component("ms-designWrapper",designWrapper),{name:"applicationLayout",path:"/",component:{template:`<div> 
                    <div id='ms-content' :class='{"design": msDesign.active}'><router-view></router-view></div>
                    <component :is="'ms-designWrapper'"></component>
                </div>`},children:routes}),routes=[applicationLayout];console.log("routes",routes,ms.base);const router=VueRouter.createRouter({history:VueRouter.createWebHistory(ms.base+"/"),routes:routes,scrollBehavior(e,t,a){return a||{top:0}}});function routeToPage(e){var t={};return t.path=e.path.replace(ms.base,""),t.base=ms.base,t.url=e.href,t.href=e.href,t.params=e.params,t.query=e.query,t.hash=e.hash,t.name=e.name,t}if(router.beforeResolve((e,t)=>{console.log("BEFORERESOLVE",e,t);e={toPage:routeToPage(e),fromPage:routeToPage(t),to:e.href,from:t.href},t=ms.trigger("ms.page_change_start",e);if(t&&t.defaultPrevented)return!1}),ms._applyScope=function(){},router.afterEach((e,t)=>{console.log("Route change",e,t),$("#ms-prerender-status-code").remove(),msi.setSearchParams(),ms.product={},ms.category={},ms.collection={},ms.brand={},ms.blog={},ms.blog_post={},ms.seller={},ms.topic={},app.config.globalProperties.msProduct=Vue.reactive({}),app.config.globalProperties.msSeller=Vue.reactive({}),app.config.globalProperties.msGroup=Vue.reactive({}),app.config.globalProperties.msTopic=Vue.reactive({}),ms.starttime=(new Date).getTime(),ms.page&&ms.page.name&&(ms.fromPage=ms.page);var a=routeToPage(e);(!a.title||-1<a.title.indexOf("{{"))&&(a.title=ms.settings.title||ms.settings.store_title),ms.routeParams=e.params,a._elapsedTime=0,ms._pageloadInterval&&clearInterval(ms._pageloadInterval),ms._pageloadInterval=setInterval(function(){console.log("Pending requests:",a._elapsedTime,ms.app.pendingRequestCount),ms.app.pendingRequestCount<=0?(clearInterval(ms._pageloadInterval),console.log("Page loaded"),ms.trigger("ms.page_loaded")):5e3<a._elapsedTime&&(clearInterval(ms._pageloadInterval),ms.trigger("ms.page_loaded",{timeout:!0,numPendingRequests:ms.app.pendingRequestCount})),a._elapsedTime+=200},200),window.ms.pageLoaded=function(){window.ms._pageloadInterval&&(clearInterval(ms._pageloadInterval),window.ms.trigger("ms.page_loaded"))},window.ms.page={domain:window.location.hostname},ms.initializeSEO(a),ms.trigger("ms.page_change_success")}),ms.forward=function(){router.forward()},ms.back=function(){ms.fromPage?router.back():ms.goTo("/")},ms.goTo=function(e,t=!1){return-1<e.indexOf("http")?window.location.href=e:t?void(window.location.href=location.protocol+"//"+location.host+e):router.push(e)},ms.notFound=function(){var e=ms.page&&ms.page.path&&ms.page.path.replace(/^\//,"");router.push({name:"404",params:{catchAll:e},path:e})},console.log("Attaching  router"),app.use(router),window.Vuetify){let vuetify1=Vuetify.createVuetify({components:Vuetify.components});app.use(vuetify1)}function handleMobileAppAnchor(e){if(!e.match(/^[a-z]+\:/))return!1;if(-1!=e.indexOf(location.host))return!1;if(ms.settings.mobile_whitelist_domains&&ms.settings.mobile_whitelist_domains.length)for(var t of ms.settings.mobile_whitelist_domains)if(-1!=e.indexOf(t))return!1;return ms.cordova&&ms.cordova.openWindow?ms.cordova.openWindow(encodeURI(e),"_system"):window.open(encodeURI(e),"_system"),!0}console.log("Mounting app",app),$("#body").append("<router-view></router-view>"),app.mount("#body"),$(document).on("click","a",function(e){var t=this.getAttribute("href"),a=this.getAttribute("target");if(t){if(ms.device.isMobileApp)if(handleMobileAppAnchor(t))return void e.preventDefault();if(!(a&&"_blank"==a||t.match(/^[a-z]+\:/))){if(!t.match(/^\/?admin\//))return router.push(t),e.preventDefault(),!1;location.href=location.origin+"/"+t.replace(/^\//,"")}}}),ms._initialize()}ms.validation=validation,msi._dialogs={},ms.dialog=function(n={}){return new function(){let s=this;s.defaults={id:"dialog_"+Math.random()},n=Object.assign({},n,s.defaults),s.setContent=function(e){return n.content=e,s},s.close=function(e){s.dialog&&s.dialog.close()},s.showModal=function(){return new Promise(function(e){if(s.dialog)return e(s.dialog);if(n.element){if("DIALOG"==n.tagName)return s.dialog=n.element,e(s.dialog);console.error("The element passed to ms.dialog should be a dialog tag")}if(n.id&&document.getElementById(n.id))return s.dialog=document.getElementById(n.id),e(s.dialog);const t=document.createElement("dialog");if((msi._dialogs[n.id]=t).addEventListener("close",e=>{delete msi._dialogs[n.id]}),t.showModal)return n.id&&(t.id=n.id),n.className&&(t.className=n.className),s.dialog=t,e(t);ms.loadStyles("https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.5.6/dialog-polyfill.min.css"),ms.loadScripts("https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.5.6/dialog-polyfill.min.js").then(function(){window.dialogPolyfill&&dialogPolyfill.registerDialog(t),n.id&&(t.id=n.id),n.className&&(t.className=n.className),s.dialog=t,e(t)})}).then(function(t){if(document.body.append(t),n.widget)if("vuejs"==ms.theme.js_framework){var a=n.widget;a.startsWith("ms-")||a.startsWith("w-")||(a="w-"+a);let e=n.props||n.widgetScope||{};e.dialog=s,console.log("Rendering widget ",a,e),ms.renderComponent(a,e,t),t.showModal()}else{a=n.widgetScope&&ms._newScope(n.widgetScope)||ms._newScope();a.dialog=s,ms._compile("<div ms-widget='"+n.widget+"' ms-data-src='cdn'></div>",a).then(function(e){$(e).appendTo(t),t.showModal()})}else"object"==typeof content?t.append(content):t.innerHTML=n.content||"dummy content",t.showModal()}),s}}},ms.closeAllDialogs=function(){for(var e in msi._dialogs)msi._dialogs[e].close()},ms.io=function(){function e(){return new Promise(function(a){if(msi.socketIo)return a(msi.socketIo);ms.loadScripts("https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.min.js").then(function(){var t=io({transports:["websocket"]});t.on("connect",function(e){msi.socketIo=t,a(t)})})})}return{on:function(t,a){e().then(function(e){e.on(t,a)})},emit:function(t,a){e().then(function(e){e.emit(t,a)})}}},ms._logger=function(e){var t=this;t.name=e,t.error=function(){var e=(e=Array.prototype.slice.call(arguments)).join(",");console.log(`%c${t.name}%c error%c `+e,"background: #eee; color: #333;padding: 3px;font-weight:bold","color:red;font-weight:bold","color: auto")},t.info=function(){var e=(e=Array.prototype.slice.call(arguments)).join(",");console.log(`%c${t.name}%c info%c `+e,"background: #eee; color: #333;padding: 3px;font-weight:bold","font-weight:bold","color: auto")},t.debug=t.info},ms._defaultLogger=new ms._logger("default"),ms.logger=function(e){return new ms._logger(e)},ms.logger.error=ms._defaultLogger.error,ms.logger.info=ms._defaultLogger.error,ms.convertImgTags=function(){$("img").each(function(e,t){let a=(t=$(t)).attr("src");a&&(a=a.trim()).startsWith("http")&&t.attr("src",a.replace(/^http\:/,"https:"))})},ms.convertAnchorTags=function(){$("a").each(function(e,t){let a=(t=$(t)).attr("href");!a||(a=a.trim()).startsWith("#")||a.startsWith("http")||a.startsWith("//")||(a.startsWith("/")?ms.base&&!a.match(/\/[a-z][a-z](\-[a-z][a-z])?\//)&&t.attr("href",ms.base+a):t.attr("href",ms.base+"/"+a))})},ms.locateMe=function(){return new Promise(function(a,e){navigator.geolocation?(ms.trigger("ms.geolocation.loading"),navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude,e=e.coords.longitude;ms.geo_location.latitude=t,ms.geo_location.longitude=e,ms.setPreferences({geolocation:{source:"browser",lat:t,longitude:e,time:Date.now()}}),ms.trigger("ms.geolocation.loaded"),a({lat:t,long:e})},function(e){e&&(ms.logger.error("Error while geting current position: ",e.message),ms.trigger("ms.geolocation.errored",{error:e}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})):(ms.logger.error("Geolocation is not supported by this browser."),ms.trigger("ms.geolocation.errored",{error:ms.filters.translate("Geolocation is not supported by this browser.")}))})},ms.geolocation=ms.geo_location,ms.updateGeolocation=function(e){ms.geo_location=e,ms.geolocation=ms.geo_location,ms.setPreferences({geolocation:{source:"browser",lat:e.latitude,long:e.longitude,time:Date.now()}})},ms.adminTheme||(ms.settings.enable_geolocation_prompt&&"ip"==ms.geolocation.source&&("browser"==ms.settings.geolocation_prompt_mode?ms.locateMe():ms.dialog({widget:"geolocation"}).showModal()),ms.bind("ms.geolocation_loaded",function(){ms.settings.reload_on_geolocation_change&&ms.reload()}),ms.settings.enable_location_availability&&!ms.store.name.includes("mystore")&&("ip"==ms.geolocation.source&&ms.dialog({widget:"geolocation"}),ms.bind("ms.geolocation_loaded",function(){ms.reload()}),ms.app.addPrehook({entity:"ms.products",command:"list"},function(e,t,a){let s=["all"];return ms.geolocation.zip_code&&s.push(ms.geolocation.zip_code),ms.geolocation.std_code&&s.push("std:"+ms.geolocation.std_code),e.query.filters.push({field:"location_availability",operator:"in",value:s}),a()}))),"vuejs"==ms.theme.js_framework&&document.addEventListener("DOMContentLoaded",initializeApplication),"1"!=ms.searchParams.ms_pwa||location.pathname.includes("/seller/")||(seller_alias=ms.localStorage.getItem("ms_lseller_alias"),seller_alias&&(location.href="/seller/"+seller_alias)),"1"==ms.settings.enable_pwa&&ms.settings.enable_seller_pwa&&ms.bind("ms.page_loaded",function(){"seller"==ms.page.name&&(ms.localStorage.setItem("ms_lseller_id",ms.seller._id),ms.localStorage.setItem("ms_lseller_alias",ms.seller.alias),$("link[rel='manifest']").attr("href","/seller_manifest_"+ms.seller._id+".webmanifest"))});var App2=function(){function s(e){return e&&"[object Function]"==={}.toString.call(e)}function o(e){var t;return e&&((t={}).status=e.status,t.data=e.data,t)}function i(s){var n=this;n.sent=!1,n.status=200,n.data=null,n.set=function(e,t){var a=parseInt(e);a&&200<=a&&a<500&&(n.status=e,e=t),e&&(n.data=e.data)},n.error=function(e,t){n.sent||(n.status=e,t&&(n.data=t.data),n.sent=!0,s(o(n),null))},n.status=function(e){n.status=e},n.send=function(e,t){var a;e&&(a=parseInt(e))&&200<=a&&a<500&&(n.status=e,e=t),n.sent?console.log("Response has been already sent"):(e&&(n.data=e.data),n.sent=!0,s(null,o(n)))}}var c=this,m=(c.interceptors={},c.pendingRequestCount=0,c.intercept=function(e,t,a){"request"!=e&&"response"!=e||t&&"object"==typeof t&&t.entity&&t.command&&s(a)&&(e=e+"_"+t.entity+"_"+t.command,t.sort_order||(t.sort_order=0),a={fun:a,sort_order:t.sort_order},c.interceptors[e]||(c.interceptors[e]=[]),c.interceptors[e].push(a))},c.addPrehook=function(e,t){var a;e&&"object"==typeof e&&e.entity&&e.command&&s(t)&&(a="ms.entity."+e.entity+"."+e.command+".pre",e.sort_order||(e.sort_order=0),t={fun:t,sort_order:e.sort_order},c.interceptors[a]||(c.interceptors[a]=[]),c.interceptors[a].push(t))},c.addPosthook=function(e,t){var a;e&&"object"==typeof e&&e.entity&&e.command&&s(t)&&(a="ms.entity."+e.entity+"."+e.command+".post",e.sort_order||(e.sort_order=0),t={fun:t,sort_order:e.sort_order},c.interceptors[a]||(c.interceptors[a]=[]),c.interceptors[a].push(t))},c.addLoading=function(e,t){ms.loadings[e]||(ms.loadings[e]={}),ms.loadings[e][t]?++ms.loadings[e][t]:ms.loadings[e][t]=1},c.removeLoading=function(e,t){if(ms.loadings[e]){ms.loadings[e][t]&&--ms.loadings[e][t];var a,s=!0;for(a in ms.loadings[e])0!=ms.loadings[e][a]&&(s=!1);s&&delete ms.loadings[e]}},c.broadcastMessages=function(e){if(e&&e.length)for(var t of e)t.name&&ms.store.messages[t.name]&&ms.addMessage(t)},function(){return new Promise(function(t){if(window.Dexie){if(c.db)return console.log("DB Already initialised"),t(c.db);c.db=new Dexie("MsApp"),c.db.version(3).stores({"ms.products":"_id, &alias, uniquesku, price, name ","ms.carts":"_id","ms.sellers":"_id, &alias"}),c.db.open().then(function(){t(c.db)}).catch(function(e){console.log("ERROR in opening db",e),t(null)})}else ms.loadScripts("https://cdnjs.cloudflare.com/ajax/libs/dexie/3.0.4/dexie.min.js").then(function(){m().then(t)})})});const u=(t=Math,e=Date,a=16,s=e=>t.floor(e).toString(a))=>s(e.now()/1e3)+" ".repeat(a).replace(/./g,()=>s(t.random()*a));function r(a,s,n){if(msi._offlineEntities&&msi._offlineEntities.includes(a.entity)&&!a._skipOffline)return console.log("Offline command",a.entity,a.command),t=s,i=n,"list"==(o=a).command?m().then(function(e){return e[o.entity]}).then(function(e){var t,a=e,n=(o.query.sort&&(t=o.query.sort.replace(/^\-/,""),a=o.query.sort.startsWith("-")?e.orderBy(t).reverse():e.orderBy(t)),o.query||(o.query={}),o.query.filters||[]);if(o.query.q)for(var s in o.query.q)n.push({field:s,value:o.query.q[s]});return(a=n.length?a.filter(function(e){for(var t=!0,a=0;a<n.length;a++){var s=n[a];if(s.field&&s.value)switch(s.operator){case"equal":e[s.field]!=s.value&&(t=!1);break;case"less_than":parseFloat(e[s.field])>=parseFloat(s.value)&&(t=!1);break;case"less_than_or_equal":parseFloat(e[s.field])>parseFloat(s.value)&&(t=!1);break;case"greater_than":parseFloat(e[s.field])<=parseFloat(s.value)&&(t=!1);break;case"greater_than_or_equal":parseFloat(e[s.field])<parseFloat(s.value)&&(t=!1);break;case"not_equal":e[s.field]==s.value&&(t=!1);case"in":!s.value||e[s.field]&&Array.isArray(e[s.field])&&e[s.field].includes(s.value)||(t=!1);break;case"regex":new RegExp(".*"+s.value+".*","i").test(e[s.field])||(t=!1);break;default:e[s.field]!=s.value&&(t=!1)}}return t}):a).toArray()}).then(function(e){console.log("offline records",e);e={data:{data:e,paging:{count:e.length,offline:!0}}};t.set(200,e),i()}).catch(function(e){console.log("ERROR in offline db list",e),i()}):"add"==o.command?(console.log("inside add command"),o.data._id||(o.data._id=u()),m().then(function(e){return e[o.entity].put(o.data)}).then(function(e){t.set(200,{_id:e}),i()}).catch(function(e){console.log("ERROR in offline db add",e),i()})):"get"==o.command?(console.log("inside get command"),m().then(function(e){return e[o.entity].where("_id").equals(o.recordId).toArray()}).then(function(e){e={data:e[0]};t.set(200,e),i()}).catch(function(e){console.log("ERROR in offline db get",e),i()})):(console.log("command "+o.command+" not supported in offline mode"),t.set(406,null),i());var o,t,i;if(!s.sent){if(a._skipCommand)return console.log("Skipping command",a.entity,a.command),n();c.addLoading(a.entity,a.command),a.query||(a.query={}),a.query.q&&(a.query.q=JSON.stringify(a.query.q));var e=ms_store.backend_url||"",r=(a.version?e+="/api/"+a.version:ms.store&&ms.store.api_version&&(e+="/api/"+ms.store.api_version),{});if(ms.adminTheme?r.backend=1:r.frontend=1,a.url=e+"/entity/"+a.entity,function(e){if(!e.command)return console.error("fieldId is required in get request with field"),!1;if("get"==e.command){if(!e.recordId)return console.error("recordId is required in get request"),!1;if(e.method||(e.method="GET"),e.url+="/"+e.recordId,e.field){if(!e.fieldId)return console.error("fieldId is required in get request with field"),!1;e.url+="/"+e.field+"/"+e.fieldId}}else if("list"==e.command){if(e.method||(e.method="GET"),e.field){if(!e.recordId)return console.error("recordId is required for a get request with field"),!1;e.url+="/"+e.recordId+"/"+e.field}}else if("delete"==e.command){if(!e.recordId)return console.error("recordId is required in request for delete command"),!1;if(e.method||(e.method="DELETE"),e.url+="/"+e.recordId,e.field){if(!e.fieldId)return console.error("fieldId is required in delete request with field"),!1;e.url+="/"+e.field+"/"+e.fieldId}}else if("edit"==e.command){if(!e.recordId)return console.error("recordId is required in request for edit command"),!1;if(e.method||(e.method="PATCH"),e.url+="/"+e.recordId,e.field){if(!e.fieldId)return console.error("fieldId is required in edit request with field"),!1;e.url+="/"+e.field+"/"+e.fieldId}}else if("add"==e.command){if(e.method="POST",e.field){if(!e.recordId)return console.error("recordId is required for a request with field"),!1;e.url+="/"+e.recordId+"/"+e.field}}else e.method="PUT",e.recordId&&(e.url+="/"+e.recordId),e.field&&(e.url+="/"+e.field),e.fieldId&&(e.url+="/"+e.fieldId),e.url+="/_/"+e.command;return!0}(a)||s.error({status:422,data:"Invalid request. Please check command, recordId, field, fieldId"}),ms._httpDefaults.headers)for(var d in ms._httpDefaults.headers)ms._httpDefaults.headers.hasOwnProperty(d)&&(r[d]=ms._httpDefaults.headers[d]);var l={method:a.method,params:a.query,cache:a.cache,headers:r};return a.data&&(!a.version||a.version<=1)?l.data={data:a.data}:l.data=a.data,console.log("making http call:"+a.entity+"."+a.command,l),c.pendingRequestCount++,l.params&&l.params.controller&&(l.signal=l.params.controller.signal,delete l.params.controller),axios(a.url,l).then(function(e){var t;c.pendingRequestCount--,console.log("http call successful:"+a.entity+"."+a.command,e),c.removeLoading(a.entity,a.command),console.log("RESPONSE",l,e),ms.trigger("ms.entity."+a.entity+"."+a.command+".success",{response:e,request:a}),e.headers&&e.headers["ms-messages"]&&((t=JSON.parse(e.headers["ms-messages"]))[0].data=e.data,c.broadcastMessages(t)),s.set(e.status,e),n()}).catch(function(e){c.pendingRequestCount--;var t=e.response;console.log("http call failed:"+a.entity+"."+a.command,e),window.internetFlag||navigator.onLine||(window.internetFlag=!0,ms.showErrorPage(),window.internetFlag=!1),ms.trigger("ms.entity."+a.entity+"."+a.command+".error",{request:a,response:t}),c.removeLoading(a.entity,a.command),t.headers&&t.headers["ms-messages"]&&((e=JSON.parse(t.headers["ms-messages"]))[0].data=t.data,c.broadcastMessages(e)),s.error(t.status,t),n()})}console.log("Response has been already sent. Returning")}var d=function(e,t,a,s){if(!a.sent){if(e&&0==e.length)return s();var n=e.shift();n.fun?n.fun(t,a,function(){d(e,t,a,s)}):d(e,t,a,s)}};c.call=function(e,t,a){if("string"==typeof e&&(s=e,(e=t).command=s,t=a),e.entityName&&!e.entity&&(e.entity=e.entityName,delete e.entityName),e.resourceId&&!e.recordId&&(e.recordId=e.resourceId,delete e.resourceId),!e.entity||!e.command)return console.log("please specify the entity and command name in app service call method"),void t({status:400,data:"please specify the entity and command name in app service call method"});var n,s,o=e;e.field&&!e.recordId?t({status:400,data:"Please specify recordId in app field command"}):(n=new i(t),o.ms=ms,o.storename=ms.store.name,o.store=ms.store,o.app=ms.app,o.msApp=ms.app,s=o,a=function(){r(o,n,function(){var e,t,a,s;ms.enableDebug&&n.data&&"object"==typeof n.data&&n.data.debug&&(a=n.data.debug,(e=new Dexie("ms.debug")).version(1).stores({requests:"requestId"}),e.requests.add(a).then(function(){}).catch(function(e){}),delete n.data.debug),e=o,a=function(){n.send()},(t=n).sent||(s="ms.entity."+e.entity+"."+e.command+".post",c.interceptors[s]&&c.interceptors[s].length?d(c.interceptors[s].slice(0),e,t,a):a())})},(e=n).sent||(t="ms.entity."+s.entity+"."+s.command+".pre",c.interceptors[t]&&c.interceptors[t].length?d(c.interceptors[t].slice(0),s,e,a):a()))},c.struct=function(e,t){c.call("struct",e,t)},c.list=function(e,t){c.call("list",e,t)},c.get=function(e,t){c.call("get",e,t)},c.add=function(e,t){c.call("add",e,t)},c.update=function(e,t){c.call("edit",e,t)},c.del=function(e,t){c.call("delete",e,t)},c.callAsync=function(e){return new Promise((a,s)=>{e.version||(e.version=1),c.call(e,function(e,t){if(e)return s(e);a(t)})})},c.listOne=function(a,s){return new Promise((t,e)=>{(s=s||{}).limit=1,c.listRecords(a,s).then(function(e){t(e&&e[0])}).catch(e)})},c.listRecords=function(t,n){return new Promise((a,s)=>{let e={entity:t,command:"list",version:1};n&&(e.query=n),c.call(e,function(e,t){if(e)return s(e);a(t.data&&t.data.data||t.data)})})},c.deleteRecord=function(e,t){return new Promise((a,s)=>{c.call({entity:e,recordId:t,command:"delete",version:1},function(e,t){if(e)return s(e);a(t)})})},c.addRecord=function(e,t){return new Promise((a,s)=>{c.call({entity:e,command:"add",data:t,version:1},function(e,t){if(e)return s(e);a(t.data&&t.data._id)})})},c.updateRecord=function(e,t,n){return new Promise((a,s)=>{c.call({entity:e,recordId:t,command:"edit",data:n,version:1},function(e,t){if(e)return s(e);a(t)})})},c.getRecord=function(e,t){return new Promise((a,s)=>{c.call({entity:e,command:"get",recordId:t,version:1},function(e,t){if(e&&404!=e.status)return s(e);a(t.data&&t.data.data||t.data)})})},c.duplicate=function(e,t){c.call("duplicate",e,t)},c.filter=function(e,t){c.call("filter",e,t)},c.search=function(e,t){c.call("search",e,t)},c.textSearch=function(e,t){c.call("textSearch",e,t)},c.reorder=function(e,t){c.call("reorder",e,t)},c.publish=function(e,t){c.call("publish",e,t)},c.unpublish=function(e,t){c.call("unpublish",e,t)}},d,modules,m,defineMystoreModule;function PopupCenter(e,t,a,s){var n=null!=window.screenLeft?window.screenLeft:screen.left,o=null!=window.screenTop?window.screenTop:screen.top,i=window.innerWidth||document.documentElement.clientWidth||screen.width,r=window.innerHeight||document.documentElement.clientHeight||screen.height,e=window.open(e,t,"scrollbars=yes, width="+a+", height="+s+", top="+(r/2-s/2+o)+", left="+(i/2-a/2+n));return window.focus&&e.focus(),e}ms.theme.js_framework&&"angularjs"!=ms.theme.js_framework||(angular.module("mystore-services",[]).factory("msCache",["$cacheFactory",function(e){var o=e("ms"),i=["ms.option_set","ms.banners","ms.slides"];return{add_to_cache:function(e,t,a,s){var n;-1!=i.indexOf(e)&&(n=o.get(e)||{},"array"==s&&angular.forEach(a,function(e){n[e[t]]=e}),"object"==s&&(n[[a[t]]]=a),o.put([e],n))},get_from_cache:function(e,t){e=o.get(e);return e&&(t?(e=t=e[t])&&(e=angular.copy(t)):e=angular.copy(e)),e},clear_cache:function(e){o.remove(e)}}}]).factory("entitySvc",["$http","$rootScope","$q","msCache",function(r,a,d,n){function t(e){var o=this,i=ms_store.backend_url||"";o.entity=e,o.entityname=e,o.broadcastMessages=function(e,t){e&&e.length&&angular.forEach(e,function(e){a.ms.broadcast(e.name,{entity:o.entityname,level:e.level,duration:e.duration,message:e.message,data:t})})},o.list=function(e){e=e||{};var s=d.defer();return e.q&&(e.q=JSON.stringify(e.q)),r.get(i+"/entity/"+o.entity,{params:e}).success(function(e,t,a){n.add_to_cache(o.entity,"_id",e.records,"array"),s.resolve(e)}).error(function(e,t,a){s.reject(e)}),s.promise},o.get=function(e){var s=d.defer();return r.get(i+"/entity/"+o.entity+"/"+e).success(function(e,t,a){n.add_to_cache(o.entity,"_id",e,"object"),s.resolve(e)}).error(function(e,t,a){s.reject(e)}),s.promise},o.create=function(e){var s=d.defer();return r.post(i+"/entity/"+o.entity,e).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.update=function(e,t){var s=d.defer();return r.put(i+"/entity/"+o.entity+"/"+e,t).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.del=function(e){var s=d.defer();return r.delete(i+"/entity/"+o.entity+"/"+e).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.struct=function(e){var s=d.defer();return r.get(i+"/entity/"+o.entity+"/_/struct",{params:e=e||{}}).success(function(e,t,a){s.resolve(e)}).error(function(e,t,a){s.reject(e)}),s.promise},o.duplicate=function(e,t){var s=d.defer();return r.put(i+"/entity/"+o.entity+"/"+e+"_duplicate",{params:t=t||{}}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.filter=function(e){var s=d.defer();return r.get(i+"/entity/"+o.entity+"/filterData",{params:e=e||{}}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.search=function(e){var s=d.defer();return r.get(i+"/entity/"+o.entity+"/_search",{params:e=e||{}}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.textSearch=function(e){var s=d.defer();return r.get(i+"/entity/"+o.entity+"/_textSearch",{params:e=e||{}}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.reorder=function(e){var s=d.defer();return r.post(i+"/entity/"+o.entity+"/_reorder",{params:e=e||{}}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.addSubRecord=function(e,t,a){var s=d.defer();return r.post(i+"/entity/"+o.entity+"/"+e+"/"+t,a).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.getSubRecord=function(e,t,a){var s=d.defer();return r.get(i+"/entity/"+o.entity+"/"+e+"/"+t+"/"+a).success(function(e,t,a){s.resolve(e)}).error(function(e,t,a){s.reject(e)}),s.promise},o.deleteSubRecord=function(e,t,a){var s=d.defer();return r.delete(i+"/entity/"+o.entity+"/"+e+"/"+t+"/"+a).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.duplicateSubRecord=function(e,t,a,s){var n=d.defer();return r.put(i+"/entity/"+o.entity+"/"+e+"/"+t+"/"+a+"_duplicate",{params:s=s||{}}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),n.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),n.reject(e)}),n.promise},o.updateSubRecord=function(e,t,a,s){var n=d.defer();return r.put(i+"/entity/"+o.entity+"/"+e+"/"+t+"/"+a,s).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),n.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),n.reject(e)}),n.promise},o.listSubRecords=function(e,t,a){a=a||{};var s=d.defer();return r.get(i+"/entity/"+o.entity+"/"+e+"/"+t,{params:a}).success(function(e,t,a){s.resolve(e)}).error(function(e,t,a){s.reject(e)}),s.promise},o.getCustomCommand=function(e,t){t=t||{};var s=d.defer();return r.get(i+"/entity/"+o.entity+"/_/"+e,{params:t}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){s.reject(e,t,a)}),s.promise},o.postCustomCommand=function(e,t){var s=d.defer();return r.post(i+"/entity/"+o.entity+"/_/"+e,t).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise},o.putCustomCommand=function(e,t,a){a=a||{};var s=d.defer();return r.put(i+"/entity/"+o.entity+"/_/"+e,t,{params:a}).success(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.resolve(e)}).error(function(e,t,a){o.broadcastMessages(JSON.parse(a("ms-messages")),e),s.reject(e)}),s.promise}}return{getEntity:function(e){return!!e&&new t(e)}}}]).factory("entitySvcNew",["$http","$rootScope","$q","msCache",function(u,a,p,r){localStorage.token;function o(e,t,n,o,l){var c=this,m=ms_store.backend_url||"",i=(c.entity=e,c.entityname=e,c.token=localStorage.token,a.ms.store&&a.ms.store.api_version&&!t&&(m+="/api/"+a.ms.store.api_version,c.version=a.ms.store.api_version),t&&(m+="/api/"+t,c.version=t),{app_request:1,token:c.token});l&&(i.backend=1),c.list=function(e,t){var a=!1,s=((e=e||{})&&e.q?e.q.alias&&-1<e.q.alias.indexOf("ms-dummy")&&(a=!0):e&&e.filters&&(-1<e.filters.indexOf("ms-dummy-")||-1<e.filters.indexOf("MS Dummy"))&&(a=!0),a&&(m="https://tryityourself.storehippo.com",c.version&&(m+="/api/"+c.version)),""),s=p.defer();return n&&o&&(d[n]&&d[n].resolve(),d[n]=s),e.q&&(e.q=JSON.stringify(e.q)),u.get(m+"/entity/"+c.entity,{params:e,cache:t=t||!1,headers:i,timeout:s.promise}).success(function(e,t,a){r.add_to_cache(c.entity,"_id",e.data||e.records,"array"),s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.get=function(e,t,a){var s=!1,n=((t=t||{})&&t.q?t.q.alias&&-1<t.q.alias.indexOf("ms-dummy")&&(s=!0):t&&t.filters&&-1<t.filters.indexOf("ms-dummy-")&&(s=!0),s&&(m="https://tryityourself.storehippo.com",c.version&&(m+="/api/"+c.version)),a=a||!1,p.defer());return u.get(m+"/entity/"+c.entity+"/"+e,{params:t,cache:a,headers:i}).success(function(e,t,a){r.add_to_cache(c.entity,"_id",e.data||e,"object"),n.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){n.reject({status:t,data:e,headers:a})}),n.promise},c.create=function(e){var s=p.defer();return u.post(m+"/entity/"+c.entity,e,{params:e.query,headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.update=function(e,t,a){var s=p.defer();return u.put(m+"/entity/"+c.entity+"/"+e,t,{headers:i,params:a=a||{}}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.del=function(e,t,a){var s=p.defer(),n=(t&&t.q&&(t.q=JSON.stringify(t.q)),i),e=(n["Content-Type"]="application/json;charset=utf-8",{method:"DELETE",url:m+"/entity/"+c.entity+"/"+e,params:t,data:a,headers:n});return e.data&&e.data.data||delete e.data,u(e).success(function(e,t,a){delete n["Content-Type"],s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){delete n["Content-Type"],s.reject({status:t,data:e,headers:a})}),s.promise},c.struct=function(e){var s=p.defer();return u.get("/entity/"+c.entity+"/_/struct",{params:e=e||{},headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.duplicate=function(e,t){var s=p.defer();return u.put(m+"/entity/"+c.entity+"/"+e+"/_duplicate",t=t||{},{headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.filter=function(e){var s=p.defer();return u.get(m+"/entity/"+c.entity+"/filterData",{params:e=e||{},headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.search=function(e){var s=p.defer();return u.get(m+"/entity/"+c.entity+"/_search",{params:e=e||{},headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.textSearch=function(e){var s=p.defer();return u.get(m+"/entity/"+c.entity+"/_textSearch",{params:e=e||{},headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.reorder=function(e){var s=p.defer();return u.post(m+"/entity/"+c.entity+"/_reorder",{params:e=e||{}},{headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.publish=function(e,t){var s=p.defer();return u.put(m+"/entity/"+c.entity+"/"+e+"/publish",t=t||{},{headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.unpublish=function(e,t){var s=p.defer();return u.put(m+"/entity/"+c.entity+"/"+e+"/unpublish",t=t||{},{headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.addSubRecord=function(e,t,a){var s=p.defer();return u.post(m+"/entity/"+c.entity+"/"+e+"/"+t,a,{headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.getSubRecord=function(e,t,a,s){var n=p.defer();return u.get(m+"/entity/"+c.entity+"/"+e+"/"+t+"/"+a,{headers:{app_request:1,cache:s=s||!1,token:c.token}}).success(function(e,t,a){n.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){n.reject({status:t,data:e,headers:a})}),n.promise},c.deleteSubRecord=function(e,t,a){var s=p.defer();return u.delete(m+"/entity/"+c.entity+"/"+e+"/"+t+"/"+a,{headers:i}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},c.duplicateSubRecord=function(e,t,a,s){var n=p.defer();return u.put(m+"/entity/"+c.entity+"/"+e+"/"+t+"/"+a+"/_duplicate",s,{headers:i}).success(function(e,t,a){n.resolve(e)}).error(function(e,t,a){n.reject(e)}),n.promise},c.updateSubRecord=function(e,t,a,s){var n=p.defer();return u.put(m+"/entity/"+c.entity+"/"+e+"/"+t+"/"+a,s,{headers:i}).success(function(e,t,a){n.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){n.reject({status:t,data:e,headers:a})}),n.promise},c.listSubRecords=function(e,t,a,s){a=a||{};var n=p.defer();return u.get(m+"/entity/"+c.entity+"/"+e+"/"+t,{params:a,cache:s=s||!1,headers:i}).success(function(e,t,a){n.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){n.reject({status:t,data:e,headers:a})}),n.promise},c.getCustomCommand=function(e,t,a,s){var n=!1,o=((a=a||{})&&a.q?a.q.alias&&-1<a.q.alias.indexOf("ms-dummy")&&(n=!0):a&&a.filters&&-1<a.filters.indexOf("ms-dummy-")&&(n=!0),n&&(m="https://tryityourself.storehippo.com",c.version&&(m+="/api/"+c.version)),p.defer()),i={app_request:1,token:c.token};if(s)for(var r in s)i[r]=s[r];l&&(i.backend=1);n=m+"/entity/"+c.entity+"/_/"+e;return t&&(n=m+"/entity/"+c.entity+"/"+t+"/_/"+e),u.get(n,{params:a,headers:i}).success(function(e,t,a){o.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){o.reject({status:t,data:e,headers:a})}),o.promise},c.postCustomCommand=function(e,t,a,s){var n=p.defer(),o={app_request:1,token:c.token};if(s)for(var i in s)o[i]=s[i];l&&(o.backend=1);var r=m+"/entity/"+c.entity+"/_/"+e;return t&&(r=m+"/entity/"+c.entity+"/"+t+"/_/"+e),u.post(r,a,{headers:o}).success(function(e,t,a){n.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){n.reject({status:t,data:e,headers:a})}),n.promise},c.putCustomCommand=function(e,t,a,s,n){s=s||{};var o=p.defer(),i={app_request:1,token:c.token};if(n)for(var r in n)i[r]=n[r];l&&(i.backend=1);var d=m+"/entity/"+c.entity+"/_/"+e;return t&&(d=m+"/entity/"+c.entity+"/"+t+"/_/"+e),u.put(d,a,{params:s,headers:i}).success(function(e,t,a){o.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){o.reject({status:t,data:e,headers:a})}),o.promise}}var d={};return{getEntity:function(e,t,a,s,n){return!!e&&new o(e,t,a,s,n)}}}]).factory("app",["$http","$rootScope","$q","entitySvcNew","$filter",function(e,f,t,a,h){if(ms.settings.new_app_flow)return ms.app||(ms.app=new App2),ms.app;return new function(){function s(e){return e&&"[object Function]"==={}.toString.call(e)}var g=this;g.interceptors={};g.intercept=function(e,t,a){if("request"!=e&&"response"!=e)return console.log("Wrong type defined in interceptor",e,t);if(!t||"object"!=typeof t||!t.entity||!t.command)return console.log("Wrong value defined in interceptor",e,t);if(!s(a))return console.log("Wrong Callback defined in interceptor",e,t);e=e+"_"+t.entity+"_"+t.command,t.sort_order||(t.sort_order=0),a={fun:a,sort_order:t.sort_order};g.interceptors[e]||(g.interceptors[e]=[]),g.interceptors[e].push(a)},g.addPrehook=function(e,t){if(!e||"object"!=typeof e||!e.entity||!e.command)return console.log("Wrong value defined in prehook : ",e);if(!s(t))return console.log("Wrong Callback defined in prehook : ",e.entity,e.command);var a="ms.entity."+e.entity+"."+e.command+".pre",t=(e.sort_order||(e.sort_order=0),{fun:t,sort_order:e.sort_order});g.interceptors[a]||(g.interceptors[a]=[]),g.interceptors[a].push(t)},g.addPosthook=function(e,t){if(!e||"object"!=typeof e||!e.entity||!e.command)return console.log("Wrong value defined in posthook",e);if(!s(t))return console.log("Wrong Callback defined in posthook ",e.entity,e.command);var a="ms.entity."+e.entity+"."+e.command+".post",t=(e.sort_order||(e.sort_order=0),{fun:t,sort_order:e.sort_order});g.interceptors[a]||(g.interceptors[a]=[]),g.interceptors[a].push(t)},g.call=function(o,i,r){if("object"==typeof o?(r=i,i=o):(i=i||{}).command=o,!i.entity||!i.command)return console.log("please specify the entity and command name in app service call method"),void r({status:400,data:"please specify the entity and command name in app service call method"});f.ms.deferredCache||(f.ms.deferredCache={}),f.ms.loadings||(f.ms.loadings={}),g.addLoading=function(e,t){f.ms.loadings[e]||(f.ms.loadings[e]={}),f.ms.loadings[e][t]?++f.ms.loadings[e][t]:f.ms.loadings[e][t]=1},g.removeLoading=function(e,t){if(f.ms.loadings[e]){f.ms.loadings[e][t]&&--f.ms.loadings[e][t];var a,s=!0;for(a in f.ms.loadings[e])0!=f.ms.loadings[e][a]&&(s=!1);s&&delete f.ms.loadings[e]}};var d,l,n,c,m,s,e,u,t,p=a.getEntity(i.entity,i.version,i.id,i.cancel,i.backend);i.field&&!i.recordId?r({status:400,data:"Please specify recordId in app field command"}):(d=function(t,a){var e;a&&a.headers&&a.headers("ms-messages")&&(e=JSON.parse(a.headers("ms-messages")),angular.forEach(e,function(e){f.ms.broadcast(e.name,{entity:t,level:e.level,duration:e.duration,message:e.message,data:a.data})}))},l=function(e,t,a,s){if(e&&0==e.length)return s();var n=e.shift();n.fun?n.fun(t,a,function(){l(e,t,a,s)}):l(e,t,a,s)},n=function(e){if(e){var t,a={};if(a.status=e.status,a.data=e.data,a.headers=e.headers,e.headers&&"function"==typeof e.headers&&e.headers("ms-messages")){try{a.messages=h("msT")(JSON.parse(e.headers("ms-messages")))}catch(e){}a.messages&&Array.isArray(a.messages)&&(a.messages=a.messages.filter(function(e){return e.key=e.name,e.name=ms.store.messages[e.key]||e.key,"error"!=e.level||(t=e,!1)}),(e.status<200||299<e.status)&&(a.error=t||a.messages[0]),a.messages.length||delete a.messages)}return a}return e},c=new function(){var s=this;s.sent=!1,s.status=200,s.data=null,s.headers={},s.set=function(e,t,a){e&&(s.status=e),t&&(s.data=t),a&&(s.headers=a)},s.error=function(e,t,a){s.sent?console.log("Response has been already sent",c):(s.set(e,t,a),s.sent=!0,r(n(s),null))},s.send=function(e,t,a){s.sent?console.log("Response has been already sent",c):(s.set(e,t,a),s.sent=!0,200<=s.status&&s.status<300?r(null,n(s)):r(n(s),null))}},(m=i).storename=ms.store.name,m.ms=f.ms,m.store=f.ms.store,m.app=f.ms.app,m.msApp=f.ms.app,e=function(){var e,t,a,s;e=m,t=c,a=function(){var s=c,n=function(){var e,t,a,s;ms.enableDebug&&c.data&&"object"==typeof c.data&&c.data.debug&&(t=c.data.debug,(e=new Dexie("ms.debug")).version(1).stores({requests:"requestId"}),e.requests.add(t).then(function(){console.log("request added to db")}).catch(function(e){console.log("Error: "+(e.stack||e))}),delete c.data.debug),e=m,t=c,a=function(){c.send()},s="ms.entity."+i.entity+"."+i.command+".post",g.interceptors[s]&&g.interceptors[s].length?l(g.interceptors[s].slice(0),e,t,a):a()};if(m._skipCommand)n();else switch(o){case"struct":i.query||(i.query={}),g.addLoading(i.entity,o),p.struct(i.query).then(function(e){var t,a;g.removeLoading(i.entity,o),i.field&&(a=t=null,a=(p.version?e.data:e).data.fields,angular.forEach(a,function(e){e.name==i.field&&(t=e)}),p.version?e.data.data=t:e.data=t),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),s.error(e.status,e.data,e.headers)});break;case"list":i.query||(i.query={});var e=function(){return i.field?p.listSubRecords(i.recordId,i.field,i.query):p.list(i.query)},t="";g.addLoading(i.entity,o),i.cache?(t=f.ms.deferredCache[i.entity+"_"+JSON.stringify(i.query)])||(t=e(),f.ms.deferredCache[i.entity+"_"+JSON.stringify(i.query)]=t):t=e(),t.then(function(e){g.removeLoading(i.entity,o),s.set(e?e.status:0,e?e.data:null,e?e.headers:{}),n()},function(e){window.internetFlag||navigator.onLine||(window.internetFlag=!0,f.ms.showErrorPage(),window.internetFlag=!1),g.removeLoading(i.entity,o),s.error(e.status,e.data,e.headers)});break;case"get":if(!i.recordId)return void r({status:400,data:"Please specify recordId in app field command"});if(i.field&&!i.fieldId)return void r({status:400,data:"Please specify the fieldId in app field get command"});i.query||(i.query={});var e=function(){return i.field?p.getSubRecord(i.recordId,i.field,i.fieldId):p.get(i.recordId,i.query)},t="";g.addLoading(i.entity,o),i.cache?(t=f.ms.deferredCache[i.entity+"/"+i.recordId])||(t=e(),f.ms.deferredCache[i.entity+"/"+i.recordId]=t):t=e(),t.then(function(e){window.internetFlag||navigator.onLine||(window.internetFlag=!0,f.ms.showErrorPage(),window.internetFlag=!1),g.removeLoading(i.entity,o),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),s.error(e.status,e.data,e.headers)});break;case"add":g.addLoading(i.entity,o),i.query||(i.query={}),(t=i.field?p.addSubRecord(i.recordId,i.field,{data:i.data}):p.create({data:i.data,query:i.query})).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"edit":if(!i.recordId)return void r({status:400,data:"Please specify the recordId in app edit command"});if(i.field&&!i.fieldId)return void(console.log("Please specify the fieldId in app field update command"),r({status:400,data:"Please specify the fieldId in app field update command"}));g.addLoading(i.entity,o),(t=i.field?p.updateSubRecord(i.recordId,i.field,i.fieldId,{data:i.data}):p.update(i.recordId,{data:i.data},i.query)).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"delete":if(!i.recordId)return void(console.log("Please specify the recordId in app delete command"),r({status:400,data:"Please specify the recordId in app delete command"}));if(i.field&&!i.fieldId)return void(console.log("Please specify the fieldId in app field delete command"),r({status:400,data:"Please specify the fieldId in app field delete command"}));g.addLoading(i.entity,o),(t=i.field?p.deleteSubRecord(i.recordId,i.field,i.fieldId,i.query):p.del(i.recordId,i.query,{data:i.data})).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"duplicate":if(!i.recordId)return void(console.log("Please specify the recordId in app duplicate command"),r({status:400,data:"Please specify the recordId in app duplicate command"}));if(i.field&&!i.fieldId)return void(console.log("Please specify the recordId in app field duplicate command"),r({status:400,data:"Please specify the recordId in app field duplicate command"}));g.addLoading(i.entity,o),(t=i.field?p.duplicateSubRecord(i.recordId,i.field,i.fieldId,{data:i.data}):p.duplicate(i.recordId,{data:i.data})).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"filter":g.addLoading(i.entity,o),p.filter(i.query).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"search":g.addLoading(i.entity,o),p.search(i.query).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"textSearch":g.addLoading(i.entity,o),p.textSearch(i.query).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"reorder":g.addLoading(i.entity,o),p.reorder(i.query).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"publish":if(!i.recordId)return void(console.log("Please specify the recordId in app publish command"),r({status:400,data:"Please specify the recordId in app publish command"}));g.addLoading(i.entity,o),p.publish(i.recordId,{data:i.data}).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"unpublish":if(!i.recordId)return void(console.log("Please specify the recordId in app publish command"),r({status:400,data:"Please specify the recordId in app publish command"}));g.addLoading(i.entity,o),p.unpublish(i.recordId,{data:i.data}).then(function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,o),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"customCommand":if(console.log("customCommand called"),i.customCommandName)if(i.type)switch(i.type){case"get":i.query||(i.query={}),g.addLoading(i.entity,i.customCommandName),p.getCustomCommand(i.customCommandName,i.recordId,i.query).then(function(e){window.internetFlag||navigator.onLine||(window.internetFlag=!0,f.ms.showErrorPage(),window.internetFlag=!1),g.removeLoading(i.entity,i.customCommandName),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,i.customCommandName),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"post":g.addLoading(i.entity,i.customCommandName),p.postCustomCommand(i.customCommandName,i.recordId,{data:i.data}).then(function(e){console.log("app add command called"),g.removeLoading(i.entity,i.customCommandName),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,i.customCommandName),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"put":g.addLoading(i.entity,i.customCommandName),p.putCustomCommand(i.customCommandName,i.recordId,{data:i.data},i.query).then(function(e){g.removeLoading(i.entity,i.customCommandName),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){g.removeLoading(i.entity,i.customCommandName),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;default:console.log("Wrong custom type"),r({status:400,data:"Wrong custom type"},null)}else console.log("Command Type not specified"),r("Command Type not specified",null);else console.log("customCommandName not specified"),r({status:400,data:"customCommandName not specified"},null);break;default:switch(i.type||(i.type="put"),i.type){case"get":i.query||(i.query={});var a={};i.headers&&(a=i.headers),g.addLoading(i.entity,i.command),p.getCustomCommand(i.command,i.recordId,i.query,a).then(function(e){g.removeLoading(i.entity,i.command),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){window.internetFlag||navigator.onLine||(window.internetFlag=!0,ms.showErrorPage(),window.internetFlag=!1),g.removeLoading(i.entity,i.command),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"post":g.addLoading(i.entity,i.command);a={};i.headers&&(a=i.headers),p.postCustomCommand(i.command,i.recordId,{data:i.data},a).then(function(e){console.log("app add command called"),g.removeLoading(i.entity,i.command),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){window.internetFlag||navigator.onLine||(window.internetFlag=!0,ms.showErrorPage(),window.internetFlag=!1),g.removeLoading(i.entity,i.command),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;case"put":g.addLoading(i.entity,i.command);a={};i.headers&&(a=i.headers),p.putCustomCommand(i.command,i.recordId,{data:i.data},i.query,a).then(function(e){g.removeLoading(i.entity,i.command),d(i.entity,e),s.set(e.status,e.data,e.headers),n()},function(e){window.internetFlag||navigator.onLine||(window.internetFlag=!0,ms.showErrorPage(),window.internetFlag=!1),g.removeLoading(i.entity,i.command),d(i.entity,e),s.error(e.status,e.data,e.headers)});break;default:console.log("Wrong custom type"),r({statue:401,data:"Wrong custom type"},null)}}},s="ms.entity."+i.entity+"."+i.command+".pre",g.interceptors[s]&&g.interceptors[s].length?l(g.interceptors[s].slice(0),e,t,a):a()},t="request_"+(s=m).entity+"_"+s.command,g.interceptors[t]&&g.interceptors[t].length?(s.callback=r,(u=function(e,t){if(0==e.length)return t();var a=e.shift();a.fun?a.fun(s,function(){u(e,t)}):u(e,t)})(g.interceptors[t].slice(0),function(){s.callback="",e()})):e())},g.struct=function(e,t){g.call("struct",e,t)},g.list=function(e,t){g.call("list",e,t)},g.listOne=function(a,s){return new Promise((t,e)=>{(s=s||{}).limit=1,g.listRecords(a,s).then(function(e){t(e&&e[0])}).catch(e)})},g.listRecords=function(t,n){return new Promise((a,s)=>{let e={entity:t,command:"list",version:1};n&&(e.query=n),g.call(e,function(e,t){if(e)return s(e);a(t.data&&t.data.data||t.data)})})},g.get=function(e,t){g.call("get",e,t)},g.add=function(e,t){g.call("add",e,t)},g.update=function(e,t){g.call("edit",e,t)},g.del=function(e,t){g.call("delete",e,t)},g.duplicate=function(e,t){g.call("duplicate",e,t)},g.filter=function(e,t){g.call("filter",e,t)},g.search=function(e,t){g.call("search",e,t)},g.textSearch=function(e,t){g.call("textSearch",e,t)},g.reorder=function(e,t){g.call("reorder",e,t)},g.publish=function(e,t){g.call("publish",e,t)},g.unpublish=function(e,t){g.call("unpublish",e,t)}}}]).factory("adminTasks",["$rootScope",function(e){return[]}]).factory("$translate",["$rootScope",function(e){return""}]).factory("phoneHttpInterceptor",["$q","$location",function(e,a){return{request:function(e){var t;return e.headers=e.headers||{},"file"!=a.$$protocol&&"x-wmapp0"!=a.$$protocol||(t="http://"+ms_store.global_domain,window.admin_theme&&window.admin_theme.name&&(t="http://"+ms_store.name+".storehippo.com"),e.url.match("http")||e.url.match("datatable")||e.url.match("_template")||e.url.match("/templates")||e.url.match("/child")||e.url.match("/checkout")||(e.url=t+e.url)),e}}}]),d=angular.module("mystore-directives",[]).directive("ngIntlTelInput",[function(){return{restrict:"A",require:"ngModel",link:function(i,r,d,l){ms.loadStyles("https://cdn.storehippo.com/global/assets/intl-tel-input/17.0.18/css/intlTelInput.css"),ms.loadScripts(["https://cdn.storehippo.com/global/assets/intl-tel-input/17.0.18/js/intlTelInput.min.js","https://cdn.storehippo.com/global/assets/intl-tel-input/17.0.18/js/utils.min.js"]).then(function(){var a,e,t,s,n;function o(e,t){a()?(l.$setValidity("ngIntlTelInput",!0),l.$viewValue&&l.$setViewValue(""),l.$setViewValue(r[0].value)):(l.$setValidity("ngIntlTelInput",!1),l.$setViewValue(""))}ms._intltelinput||($("<style>.iti {width: 100%;}</style>").appendTo("head"),ms._intltelinput=1),d.type&&"text"!==d.type&&"tel"!==d.type||"INPUT"!==r[0].tagName?console.warn("ng-intl-tel-input can only be applied to a *text* or *tel* input"):(a=function(e){return!(e||0<r[0].value.length)||s.isValidNumber()},e=ms.settings.served_countries||["in","us"],t=d.initialCountry||ms.geo_location.country,"other"==t&&(t="US",ms.settings.physical_location&&ms.settings.physical_location.country&&(t=ms.settings.physical_location.country)),window.intlTelInput||console.warn("intlTelInput not defined"),s=intlTelInput(r[0],{preferredCountries:e,initialCountry:ms.initialCountry||t,onlyCountries:ms.onlyCountries||[],separateDialCode:ms.separateDialCode||!1}),n=!0,window.addEventListener("countrychange",o),window.addEventListener("close:countrydropdown",function(e){setTimeout(function(){})}),i.$on("$destroy",function(){window.removeEventListener("countrychange",o)}),i.field&&i.field.name&&i.field.settings&&i.field.settings.required&&"1"==i.field.settings.required&&(i.showErrorMessage=!1),l.$validators.ngIntlTelInput=function(e){var t;return n&&(t=s.getSelectedCountryData())&&t.iso2.toUpperCase()==d.initialCountry&&(n=!1),a(e)},l.$parsers.push(function(e){return s.getNumber()}),l.$formatters.push(function(e){return e&&s.setNumber(e),e}),o())})}}}]).directive("checkLogin",["$rootScope","app","$compile","$timeout",function(o,a,i,r){return{priority:-1,link:function(t,s,e){s.on("$destroy",function(){$("#loginWidgetModal").remove(),$("#loginWidget").remove(),$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()});function n(e){o.ms.user.isLoggedIn||(window._lastElement=s,a.addPosthook({entity:"ms.users",command:"login"},function(e,t,a){o.ms.user=new user(t.data),o.ms.user.isLoggedIn&&window._lastElement&&($(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),s.off("click",n),r(function(){angular.element(window._lastElement).click(),delete window._lastElement}))}),i("<div id='loginWidget' ms-data-modalid='loginWidgetModal' ms-widget='ms.modal' ms-data-widget='login'></div>")(t,function(e,t){r(function(){$(e).appendTo("body")}),r(function(){$("#loginWidget").trigger("click")},100)}),e.stopImmediatePropagation())}s.on("click",n)}}}]).directive("input",[function(){return{restrict:"E",require:"?ngModel",link:function(e,t,a,s){var n;void 0!==a.type&&"number"===a.type&&s&&s.$formatters.push(function(e){return e&&Number(e)}),void 0!==a.type&&"date"===a.type&&s&&((s=document.createElement("input")).setAttribute("type","date"),n="not-a-date",s.setAttribute("value",n),(!!(s.value===n)||a.msLoadPloyfill&&"1"==a.msLoadPloyfill)&&$.cachedScript(ms_store.globalAssetBaseUrl+"/date-input-polyfill.dist.js").done(function(e,t){console.log("Input Date type loaded::",e,t)}).fail(function(e,t,a){console.log("Failed:: Input Date type not loaded")}))}}}]).directive("msWidget",["$templateCache","$compile","$http","$rootScope","$timeout","$interpolate","$location","$state","app",function(c,m,u,p,e,g,f,t,h){return{scope:!0,restrict:"A",priority:500,terminal:!0,compile:function(e,t){var a;return!ms.settings.image_lazyload||"ms.responsiveImage"!=t.msWidget&&"ms.image"!=t.msWidget||t.ngSrc&&(t.$set("msDataSrc",t.ngSrc),e.removeAttr("data-ng-src")),e[0]&&e[0].outerHTML&&(window._designtheme&&(t=t.msWidget)&&"ms.design"!=t&&-1==t.indexOf("design.")&&(a=c.get("/templates/widgets/"+t+".html"))&&(p.uniqueWidgetId||(p.uniqueWidgetId=1),a=a.replace(/(ms-widget[\s]*=[\s]*["']([\w+\.+\-]*?)['"])/gm,function(e,t,a,s){return e+' ms-uniqueid="'+p.uniqueWidgetId+++'" '}),c.put("/templates/widgets/"+t+".html",a)),e.data("originalHtml",e[0].outerHTML)),{post:function(r,d,l){function e(){function n(){if(!ms_theme.controllers[s])if(o.controller&&""!=o.controller){try{var e=o.controller.trim();ms_theme.controllers[s]=mystore.utils.parseFunction(e)}catch(e){console.log("ERROR parsing controller for widget: "+i)}ms_theme.controllers[s]||console.log("ERROR: The controller for widget ["+i+"] is not a valid function")}else ms_theme.controllers[s]=function(){};ms_theme.widgetsCss||(ms_theme.widgetsCss={}),ms_theme.widgetsCss[s]||(o.css&&""!=o.css?ms_theme.widgetsCss[s]=o.css:ms_theme.widgetsCss[s]=""),d.addClass("ms-widget");var t=d.html(),e=(t&&""!=t.trim()||((t=c.get("/templates/widgets/"+i+".html"))&&o.css&&(e="<style id='widgetCss_"+JSON.parse(JSON.stringify(i)).replace(/[.]/g,"")+"'>".concat(o.css).concat("</style>"),t=t.concat(e)),d.append(t)),d.attr("data-ng-name",s),d.attr("ms-widgetname",l.msWidget),d.attr("data-ng-controller","ms_theme.controllers."+s),d.removeAttr("ms-widget"),d.removeAttr("data-ms-widget"),d.removeAttr("x-ms-widget"),r.settings={},ms_theme.widgets[i]&&ms_theme.widgets[i].settings,angular.forEach(l,function(e,t){if("string"==typeof e&&0==t.indexOf("msData")){t=t.replace(/^msData/,"").toLowerCase();if(r.settings[t]=g(e)(r),"string"==typeof r.settings[t]&&0==r.settings[t].indexOf("{"))try{r.settings[t]=JSON.parse(r.settings[t])}catch(e){}}}),angular.forEach(l,function(e,t){if("string"==typeof e&&0==t.indexOf("msd")){t=t.replace(/^msd/,"").toLowerCase();if(r.settings[t]=g(e)(r),"string"==typeof r.settings[t]&&0==r.settings[t].indexOf("{"))try{r.settings[t]=JSON.parse(r.settings[t])}catch(e){}}}),r.widgetName=i,p.widgetId||(p.widgetId=1),r.widgetId="ms-widget-"+p.widgetId++,d.data("ms-widgetid",r.widgetId),d.attr("ms-widgetid",r.widgetId),d.attr("id")||d.attr("id",r.widgetId),r.widgetObject=o,r.widgetElement=d,r.error=function(e){console.log("WIDGET ["+i+"]:ERROR: "+e)},r.info=function(e){console.log("WIDGET ["+i+"]:INFO: "+e)},l.msName&&""!=l.msName.trim()&&(i=l.msName),m(d)(r)),a=(p.ms.widgets||(p.ms.widgets={}),e.scope());a.refresh=function(){a.widgetElement.data("originalHtml")&&(t=a.widgetElement.data("originalHtml"),a.widgetElement.replaceWith(m(t)(r)))},p.ms.widgets[i]=a,window._designtheme&&(ms.widgetsById||(ms.widgetsById={}),ms.widgetsById[r.widgetId]={name:i,id:r.widgetId,element:e.get(0)}),ms.trigger("ms.widget_added",{name:i,id:r.widgetId,element:e.get(0)})}var s,o,e,i=l.msWidget;(i=-1<i.indexOf("{{")?g(i)(r):i)&&""!=i.trim()?(s=i.replace(/\./g,"+++"),(o=ms_theme.widgets[i])?n():-1<f.path().indexOf("/page")||"true"==l.dynamicLoad||"cdn"==l.msDataSrc||-1<f.path().indexOf("tryityourself")?(e={q:{name:i},exactMatch:!0},u.get("/entity/ms.global_widgets",{params:e}).success(function(e,t,a){var s;e&&e.records&&e.records.length&&(e=e.records[0]).name==i?(ms_theme.widgets[e.name]||(s="/templates/widgets/"+e.name+".html",c.put(s,e.template),ms_theme.widgets[e.name]=e),o=ms_theme.widgets[e.name],n()):console.log("WIDGET ["+i+"] not found")}).error(function(e,t,a){console.log("status, data, headers error",t,e,a),console.log("ERROR : WIDGET ["+i+"] not found")})):"store"===l.msDataSrc?h.list({version:1,entity:"ms.store_widgets",query:{q:{name:i},exactMatch:!0}},function(e,t){e?console.log("ERROR : WIDGET ["+i+"] not found"):(e=(t=t.data)&&t.data&&t.data.length?t.data[0]:null,console.log("WIDGET ",e),e?(ms_theme.widgets[e.name]||(t="/templates/widgets/"+e.name+".html",c.put(t,e.template),ms_theme.widgets[e.name]=e),o=ms_theme.widgets[e.name],n()):console.log("WIDGET ["+i+"] not found"))}):console.log("WIDGET ["+i+"] not found")):console.log("ERROR: Empty name passed for the widget")}r.refresh=function(){e()},e()}}}}}]).directive("bindUnsafeHtml",["$compile",function(n){return function(t,a,s){t.$watch(function(e){return e.$eval(s.bindUnsafeHtml)},function(e){a.html(e),n(a.contents())(t)})}}]).directive("msModal",["$compile","$timeout","$location",function(i,r,d){return{link:function(e,t,a){var s=a.msModal,a=a.modalHeader,n="",o='<div class="modal modaldirective fade" ><div class="modal-dialog"> <div class="modal-content"> '+(n=a&&""!=a?'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"> '+a+"</h4></div>":n)+'<div class="modal-body"> <div ms-widget="'+s+'"></div></div></div></div></div>';t.bind("click",function(){$(".modaldirective").remove(),$(".modal-backdrop").remove(),i(o)(e,function(e,s){r(function(){$(e).appendTo("body"),$("div.modal").on("show.bs.modal",function(){var e=this,t=e.id,a=(d.hash(t),s.$on("$locationChangeStart",function(){d.hash()||($(e).modal("hide"),a())}))}),$("div.modal").on("hidden.bs.modal",function(){this.id;window.location.search?history.pushState("",document.title,window.location.pathname+window.location.search):history.pushState("",document.title,window.location.pathname)}),setTimeout(function(){$(e).modal("show"),$(e).find("form .col-sm-10").removeClass("col-sm-10").addClass("col-sm-9"),$(e).find("form .col-sm-2").removeClass("col-sm-2").addClass("col-sm-3")},100)})}),e.$apply()})}}}]).directive("msDialog",["$injector","$mdDialog","$interpolate",function(r,d,l){return{link:function(n,e,t){var s,a,o,i=t.msDialog;i&&(n.settings||(n.settings={}),angular.forEach(t,function(e,t){if("string"==typeof e&&0==t.indexOf("msData")){var a=t.replace(/^msData/,"").toLowerCase();if(n.settings[a]=l(e)(n),"string"==typeof n.settings[a]&&0==n.settings[a].indexOf("{"))try{for(var s in n.settings[a]=JSON.parse(n.settings[a]),n.settings[a])if(0==n.settings[a][s].indexOf("function"))try{n.settings[a][s]=mystore.utils.parseFunction(n.settings[a][s])}catch(e){}}catch(e){}}}),s="/templates/widgets/"+i+".html",a=t=!0,ms_theme.templates[s]||(t=!1),o=["$scope","$mdDialog",function(e,t){e.cancel=function(){t.cancel()}}],ms_theme.widgets[i]&&ms_theme.widgets[i].controller?o=mystore.utils.parseFunction(ms_theme.widgets[i].controller):a=!1,(t||a)&&(!t&&a?e.bind("click",function(e){var t;(t=o)&&t.call(null,n,d,r)}):e.bind("click",function(e){var t,a={clickOutsideToClose:!0,controller:o,parent:angular.element("body"),templateUrl:s,targetEvent:e};for(t in n.settings.dialogsettings)a[t]=n.settings.dialogsettings[t];n.settings.newscope||(a.scope=n,a.preserveScope=!0),d.show(a)})))}}}]).directive("msAssign",function(){return{scope:!0,compile:function(e,t){return{pre:function(e,t,a){a=a.msAssign.split("=");e[a[0]]=e.$eval(a[1])}}}}}).directive("msActive",["$compile",function(e){return{link:function(e,a,t){e.$watch("element",function(e,t){a.hasClass("active")&&(a.parent().parent().parent().parent()&&(a.parent().parent().parent().parent().addClass("open"),a.parent().parent().parent().parent().addClass("active")),a.parent().parent().addClass("active"),a.parent().parent().addClass("open"))},!0),a.on("click",function(){a.siblings().hasClass("active")&&a.siblings().removeClass("active"),a.siblings().hasClass("open")&&(a.siblings().removeClass("open"),a.siblings().children("ul").css("display","none")),a.parent().parent().siblings().removeClass("open"),a.parent().parent().siblings().children("ul").css("display","none"),a.parent().parent().siblings().removeClass("active"),a.parent().parent().addClass("active"),a.parent().parent().addClass("open")})}}}]).directive("msThemeactive",["$compile",function(e){return{link:function(e,a,t){e.$watch("element",function(e,t){a.hasClass("active")&&(a.parent().parent().parent().parent()&&(a.parent().parent().parent().parent().addClass("open"),a.parent().parent().parent().parent().addClass("active")),a.parent().parent().addClass("active"),a.parent().parent().addClass("open"))},!0),a.on("click",function(){a.hasClass("child")&&($(".child").removeClass("active"),a.addClass("active")),a.siblings()&&a.siblings().hasClass("active")&&0==a.children.length&&a.siblings().removeClass("active"),a.siblings().hasClass("open")&&(a.siblings().removeClass("open"),a.siblings().children("ul").css("display","none")),a.parent().parent().siblings().removeClass("open"),a.parent().parent().siblings().children("ul").css("display","none"),a.parent().parent().siblings().removeClass("active"),a.parent().parent().addClass("active"),a.parent().parent().addClass("open")})}}}]).directive("msImgCentered",function(){return{scope:!0,compile:function(e,t){return{pre:function(e,t,a){var a=a.msImgCentered.split("x"),s="100%",a=(a[0]&&(s=a[0]+"px"),a[1]+"px"),n=$("<div class='ms-centered-inner'></div>"),o=$("<div class='ms-centered-outer'></div>");$(n).css("height",a),$(o).css("width",s),$(t).css("maxHeight",a),$(t).css("maxWidth",s),$(t).wrap(n).parent().wrap(o)}}}}}).directive("msScroll",function(){return{link:function(e,t,a){t.bind("click",function(){var e=$("#"+a.msScroll).offset().top;a.msHeight&&(e-=parseInt(a.msHeight)),a.msSpeed?$("body, html").animate({scrollTop:e},parseInt(a.msSpeed)):$("body, html").animate({scrollTop:e})})}}}).directive("msSubmit",[function(){return{restrict:"A",scope:{formName:"@msSubmit"},link:function(t,e,a){e.bind("click",function(){var e=document.forms[t.formName];return e?angular.element(e).trigger("submit"):console.log("MS-SUBMIT: ERROR: form with name ["+t.formName+"] not found"),!1})}}}]).directive("ngBindHtmlUnsafe",[function(){return function(e,t,a){t.addClass("ng-binding").data("$binding",a.ngBindHtmlUnsafe),e.$watch(a.ngBindHtmlUnsafe,function(e){t.html(e||"")})}}]).directive("ngBindHtmlCompile",["$compile",function(n){return function(t,a,s){t.$watch(function(e){return e.$eval(s.ngBindHtmlCompile)},function(e){a.html(e),n(a.contents())(t)})}}]).constant("uiDateConfig",{}).directive("uiDate",["uiDateConfig","$filter",function(a,e){return angular.extend({},a),{require:"?ngModel",link:function(n,o,e,i){ms.loadStyles(ms.filters.globalAsset("ui-date-new.css")),ms.loadScripts(ms.filters.globalAsset("ui-date-jquery-ui.custom.js")).then(function(){function t(){return angular.extend({},a,n.$eval(e.uiDate))}n.$watch(t,function(){var a,s=!1,e=t();i&&(a=e.onSelect||angular.noop,e.onSelect=function(e,t){n.$apply(function(){s=!0,i.$setViewValue(o.datepicker("getDate")),a(e,t),o.blur()})},e.beforeShow=function(){s=!0},e.onClose=function(e,t){s=!1},o.on("blur",function(){s||n.$apply(function(){o.datepicker("setDate",o.datepicker("getDate")),i.$setViewValue(o.datepicker("getDate"))})}),i.$render=function(){var e=i.$viewValue;if(angular.isDefined(e)&&null!==e&&!angular.isDate(e))throw new Error("ng-Model value must be a Date object - currently it is a "+typeof e+" - use ui-date-format to convert it from a string");o.datepicker("setDate",e)}),o.datepicker("destroy"),o.datepicker(e),i&&i.$render()},!0)}).catch(function(){console.log("Triggered ajaxError handler.")})}}}]).constant("uiDateFormatConfig","").directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(n){n.initCarousel=function(e){var t,a={},s=n.$eval($(e).attr("data-options"));for(t in s)a[t]=s[t];$(e).owlCarousel(a)}}}}).directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(e,t){e.$last&&e.initCarousel(t.parent())}}}]).directive("compile",["$compile",function(n){return function(t,a,s){t.$watch(function(e){return e.$eval(s.compile)},function(e){a.html(e),n(a.contents())(t)})}}]).directive("uiDateFormat",["uiDateFormatConfig",function(o){return{require:"ngModel",link:function(e,t,a,s){var n=a.uiDateFormat||o;n?(s.$formatters.push(function(e){return angular.isString(e)?jQuery.datepicker.parseDate(n,e):null}),s.$parsers.push(function(e){return e?jQuery.datepicker.formatDate(n,e):null})):(s.$formatters.push(function(e){return angular.isString(e)||e?new Date(e):null}),s.$parsers.push(function(e){return e?new Date(e).getTime():null}))}}}]).directive("prism",[function(){return{restrict:"EAC",template:"<pre><code ng-transclude></code></pre>",replace:!0,transclude:!0}}]).directive("ngEnter",function(){return function(t,e,a){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(a.ngEnter)}),e.preventDefault())})}}),ms.device.isMobileApp&&d.directive("a",function(){return{restrict:"E",link:function(s,n,o){n.on("click",function(e){var t=n[0].href;if(t&&-1==t.indexOf(location.host)){if(ms.settings.mobile_whitelist_domains&&ms.settings.mobile_whitelist_domains.length)for(var a of ms.settings.mobile_whitelist_domains)if(-1!=t.indexOf(a))return;e.preventDefault(),o.ngClick&&s.$eval(o.ngClick),ms.cordova&&ms.cordova.openWindow?ms.cordova.openWindow(encodeURI(t),"_system"):window.open(encodeURI(t),"_system")}})}}}),ms.filters.translate.$stateful=!0,ms.filters.currency.$stateful=!0,angular.module("mystore-filters",[]).filter("resolveLink",["$interpolate",function(a){return function(e,t){if(e&&t)return a(e)(t)}}]).filter("trustUrl",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]).filter("globalAsset",function(){return ms.filters.globalAsset}).filter("styleTag",function(){return function(e){return'<link rel="stylesheet" href="'+e+'" />'}}).filter("asset",["$rootScope",function(e){return function(e){if(!e||"none"==e)return"";return ms_theme.assetUrl&&ms_store.theme.global_theme_id&&"1"==ms_store.theme.use_global_theme?ms_theme.assetUrl+"/ms.local_themes/"+ms_store.theme.global_theme_id+"/"+e:ms_store.baseUrl+"/ms.local_themes/"+ms_store.theme._id+"/"+e}}]).provider("filterWatcher",function(){var s="_$$";this.setPrefix=function(e){return s=e,this},this.$get=["$window",function(e){var a=e.setTimeout;return{$watch:function(e,t){return e=s+e,angular.isDefined(t[e])||Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:{}}),t[e]},$destroy:function(e,t){return a(function(){delete t[s+e]})}}}]}).filter("groupBy_new",["$parse","filterWatcher",function(o,i){return function(e,t){var a,s,n=o(t);return!angular.isObject(e)||angular.isUndefined(t)?e:(a=i.$watch("groupBy_new",e),angular.forEach(e,function(e){s=n(e),a[s]||(a[s]=[]),-1===a[s].indexOf(e)&&a[s].push(e)}),i.$destroy("groupBy_new",e),a)}}]).filter("variant_image",["$rootScope",function(a){return function(e){if(!e||"none"==e)return"";var t="ms.local_themes";return a.ms&&a.ms.settings&&a.ms.settings.themes_new_flow&&"1"==a.ms.settings.themes_new_flow&&!a.ms.theme.added_from_old_themes&&"1"!=a.ms.theme.added_from_old_themes&&(t="ms.themes"),ms_store.baseUrl+"/"+t+"/"+ms_store.theme._id+"/"+e}}]).filter("file",function(){return ms.filters.file}).filter("image",[function(){return ms.filters.image}]).filter("image_ext",function(){return function(e,t){return e?t?e.substring(0,e.lastIndexOf("."))+"-"+t+e.substring(e.lastIndexOf(".")):e:ms_store.baseUrl+"/unknown"}}).filter("global_asset",function(){return ms.filters.globalAsset}).filter("globalAsset",function(){return ms.filters.globalAsset}).filter("datetime",function(){return function(e){return parseInt(e)?(e=new Date(e)).toLocaleDateString()+" - "+e.toLocaleTimeString():""}}).filter("ms_break_capitalize",function(){return function(e){return e.replace(/[^a-zA-Z0-9]/g," ")}}).filter("ms_ucfirst",function(){return ms.filters.ucFirst}).filter("ucFirst",function(){return ms.filters.ucFirst}).filter("isEmpty",function(){return function(e){return e?"object"==typeof e?!(!Object.keys(e)||!Object.keys(e).length):void 0:""}}).filter("isEmptyObjectKeys",function(){return function(e){if(!e)return!0;if("object"==typeof e){if(!Object.keys(e).length)return!0;if(Object.keys(e)&&Object.keys(e).length)for(var t=Object.keys(e),a=Object.keys(e).length,s=0;s<a;s++){if(e[t[s]])return!1;if(s+1==a)return!0}}}}).filter("sortPredefined",function(){return function(e,a){return e&&a?(e.sort(function(e,t){return a.indexOf(e.value)-a.indexOf(t.value)}),e):[]}}).filter("removeDash",function(){return function(e){var t,a="";for(e=e.split(""),t=0;t<e.length;t++)"-"==e[t]&&(e[t]=" "),a+=e[t];return a}}).filter("roundup",function(){return function(e){return Math.ceil(e)}}).filter("startsWith",function(){return function(e,t){if(e.startsWith(t)||e.startsWith(t.toLowerCase()))return e}}).filter("msRemoveUnderscore",function(){return function(e){if(e)return e=e.split("_"),""==e[0]?e[1]:e.join(" ")}}).filter("removeNum",function(){return function(e){var t,a="";for(e=e.split(""),t=0;t<e.length;t++)(0<=e[t]||e[t]<=9)&&(e[t]=" "),a+=e[t];return a}}).filter("removeSpacetoUnderscore",function(){return function(e){if(e)return e=e.split(" ")," "==e[0]?e[1]:e.join("_")}}).filter("removeAttribute",function(){return function(e){var t,a="";for(e=e.split("."),t=0;t<e.length;t++)"attributes"==e[t]&&(e[t]=" "),a+=e[t];return a}}).filter("toWords",function(){return e;function e(e){var t=["","thousand","million","billion","trillion"],a=["zero","one","two","three","four","five","six","seven","eight","nine"],s=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],n=["twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];if((e=(e=e.toString()).replace(/[\, ]/g,""))!=parseFloat(e))return"not a number";var o=e.indexOf(".");if(15<(o=-1==o?e.length:o))return"too big";for(var i=e.split(""),r="",d=0,l=0;l<o;l++)(o-l)%3==2?"1"==i[l]?(r+=s[Number(i[l+1])]+" ",l++,d=1):0!=i[l]&&(r+=n[i[l]-2]+" ",d=1):0!=i[l]&&(r+=a[i[l]]+" ",(o-l)%3==0&&(r+="hundred "),d=1),(o-l)%3==1&&(d&&(r+=t[(o-l-1)/3]+" "),d=0);if(o!=e.length){var c=e.length;r+="point ";for(l=o+1;l<c;l++)r+=a[i[l]]+" "}return r.replace(/\s+/g," ")}}).filter("remove_underscore",function(){return function(e){return e.replace(/_/g," ")}}).filter("removeUnderscore",function(){return function(e){return e.replace(/_/g," ")}}).filter("msRemoveDot",function(){return function(e){return e&&-1<e.indexOf(".")?e.split(".")[1]:e}}).filter("msRemoveHash",function(){return function(e){return e.replace(/[#]/,"")}}).filter("remove_quotes",function(){return function(e){return e?e.replace(/'/g,""):""}}).filter("truncate",function(){return function(e,t,a){return e?(isNaN(t)&&(t=25),void 0===a&&(a="..."),e.length<=t||e.length-a.length<=t?e:String(e).substring(0,t-a.length)+a):""}}).filter("range",function(){return function(e,t){t=parseInt(t);for(var a=0;a<t;a++)e.push(a);return e}}).filter("sortNum",function(){return function(e){return e.sort(function(e,t){return parseInt(e.value)>parseInt(t.value)?1:-1}),e}}).filter("chunk",function(){return function(e,t){if(!(e instanceof Array))return e;if(!t)return e;var a=angular.module("mystore-filters");void 0===a.chunkCache&&(a.chunkCache=[]);for(var s=0;s<a.chunkCache.length;s++)if((o=a.chunkCache[s]).array==e&&o.chunkSize==t)return o.result;var n=function(e,t){for(var a=[],s=[],n=0;n<e.length;n++)s.push(e[n]),s.length==t&&(a.push(s),s=[]);return 0<s.length&&a.push(s),a}(e,t),o={array:e,chunkSize:t,result:n};return a.chunkCache.push(o),n}}).filter("msCurrency",["$filter","$rootScope",function(e,t){return ms.filters.currency}]).filter("currency",["$filter","$rootScope",function(e,t){return ms.filters.currency}]).filter("msTranslate",[function(){return ms.filters.translate}]).filter("translate",[function(){return ms.filters.translate}]).filter("msT",[function(){return ms.filters.translate}]).filter("t",[function(){return ms.filters.translate}]).filter("parse_json",function(){return function(e){return JSON.stringify(e,null,"\t")}}).filter("relativeTime",function(){return ms.filters.relativeTime}).filter("msDate",["$filter",function(s){return function(e){var t=new Date(e),t=Math.floor((new Date-t)/1e3),a=Math.floor(t/31536e3*2592e3*86400);return 1==a?a+" days ago":1<(a=Math.floor(t/3600))&&a<=24?a+" hours ago":(a=Math.floor(t/60))<60?(a=a<0?0:a)+" minutes ago":s("date")(e,"dd/MM/yyyy @ h:mma")}}]).filter("msDateNew",["$filter",function(s){return function(e){var t=new Date(e),t=Math.floor((new Date-t)/1e3),a=Math.floor(t/31536e3);return 1<=a||1<=(a=Math.floor(t/2592e3))||1<=(a=Math.floor(t/86400))?s("date")(e,"dd/MM/yyyy @ h:mma"):1<=(a=Math.floor(t/3600))?a+" hours ago":1<=(a=Math.floor(t/60))&&a<60?a+" minutes ago":t<=0?"Few seconds ago":Math.floor(t)+" seconds ago"}}]).filter("msContains",function(){return function(e,t){return!(!e||!t)&&0<=e.indexOf(t)}}).filter("msObjectSize",function(){return function(e){return e&&"object"==typeof e?Object.keys(e).length:0}}).filter("msCompareObject",function(){return function(e,t,a){if(!e&&!t)return!0;if(!e&&t)return!1;if(e&&!t)return!1;var s=Object.keys(e).length;if(s!=Object.keys(t).length)return!1;if(0==s)return!0;var n,o=!0;for(n in e)if(!a||n!=a){var i=t[n],r=e[n];if(!i&&r){o=!1;break}if(i&&!r){o=!1;break}if(i!=r){o=!1;break}}return!!o}}).filter("msArrayOfObjectContains",function(){return function(e,t,a){if(e&&e.length&&t&&(a||"0"==a)){for(var s=!1,n=0;n<e.length;n++){if("object"!=typeof e[n]){s=!1;break}for(var o in e[n])if(o==t&&e[n][o]==a){s=!0;break}if(s)break}return!!s}return!1}}).filter("htmlDecode",function(){return function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0].nodeValue}}),modules=["ngRoute","ngSanitize","mystore-services","mystore-directives","mystore-filters","ui.state","ngAnimate"],window.MYSTORE_MODULES&&angular.forEach(MYSTORE_MODULES,function(e){modules.push(e)}),window.admintheme&&"storehippo"==window.admin_theme.name&&modules.push("ngTouch"),m=angular.module("mystore",modules),defineMystoreModule=function(){function e(){var s,n,o,i;ms.adminTheme&&(s=ms.searchParams.primary_pallete||ms.settings.primary_pallete||"light-green",n=ms.settings.accent_pallete||"orange",o=ms.settings.primary_hue||"700",i=ms.settings.accent_hue||"500","1"==ms_store.shipkaro&&(s="teal",n="pink",o="A700",i="A200"),t.config(["$mdThemingProvider","$mdColorPalette",function(e,t){e.theme("default").primaryPalette(s,{default:o}).accentPalette(n,{default:i});var e=function(e){e=angular.element('<meta name="theme-color" content="'+e+'"/>');angular.element(document.head).append(e)},a={hue:o};a=(a=angular.isObject(a)?a:{}).hue||"500",window.metaColor=t[s][a],window.accentColor=t[n][a],e(window.metaColor)}])),t.config(["$controllerProvider",function(e,t){e.allowGlobals()}])}var t=angular.module("mystore");window.msReadyPromise?window.msReadyPromise.then(function(){e(),angular.bootstrap(document,["mystore"])}):(e(),angular.element(document).ready(function(){angular.bootstrap(document,["mystore"])})),t.config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","$compileProvider",function(t,e,a,s,n){s.html5Mode({enabled:!0}).hashPrefix("!"),a.interceptors.push("phoneHttpInterceptor"),a.interceptors.push(function(){return{request:function(e){return e.headers.location=window.location.pathname,e.headers.ajax=1,ms.adminTheme?e.headers.backend=1:e.headers.frontend=1,e}}}),n.aHrefSanitizationWhitelist(/^\s*(https?|itms-services|file|blob|mailto|tel|data|whatsapp):/),e.when("","/"),-1==document.URL.indexOf("http")?e.otherwise("/"):e.otherwise(function(e,t){window.mystore.notFound()}),ms_theme.states.push({name:"layout-design",abstract:!0,templateUrl:"/templates/design.html"}),ms_theme.states.push({name:"orderProcessing",url:"/order/:status/:id/processing",controller:mystore.controllers.processOrder}),ms_theme.states.push({name:"cartProcessing",url:"/cart/:id/processing",controller:mystore.controllers.cartOrder}),ms_theme.states.push({name:"postVerification",url:"/verification/:status",controller:mystore.controllers.postVerification});var o=!1,i=!1;angular.forEach(ms_theme.states,function(e){var r,d;ms.base&&e.url&&(e.url=(ms.base+e.url).replace("//","/")),"orderProcessing"!=e.name&&"cartProcessing"!=e.name&&"postVerification"!=e.name&&(r="",e.controller&&(r=e.controller,delete e.controller),d="",e.templateUrl&&(d=e.templateUrl,delete e.templateUrl),e.templateProvider=["$rootScope","$http","$q","$stateParams","$timeout","app",function(e,t,a,s,n,o){var i=a.defer();return(r?window.mystore.utils.parseFunction(r):function(){var e=angular.element("body").injector(),e=(e.get("$timeout"),e.get("$q").defer());return e.resolve({}),e.promise}).call(this,e,t,a,s,n,o).then(function(){window.ms.page&&window.ms.page.widget&&(d="/templates/widgets/"+window.ms.page.widget+".html"),i.resolve(ms_theme.templates[d])}),i.promise}],"404"==e.name&&(o=!0,delete e.url),"errorPage"==e.name&&(i=!0,delete e.url)),t.state(e)}),o||(t.state(s={_id:"547875c6221307e575f9a0ea",layout:"default",meta_tags:[],og_tags:[],entities:[],name:"404",templateUrl:"/templates/pages/404.html",template:'<div class="container"> \n  <div class="wrapper"><h1>Error (404)</h1>\n    <h3>Page you are requesting does not exist.</h3></div>\n  <a data-ng-href="/">Go to Home</a>\n</div>\n'}),ms_theme.templates["/templates/pages/404.html"]=s.template),i||(t.state(a={_id:"547875c6221307e575f9a0qw",layout:"default",meta_tags:[],og_tags:[],entities:[],name:"errorPage",templateUrl:"/templates/pages/errorPage.html",template:"<div class='container'> \n  <div class='wrapper' style='text-align: center'><h1>Error</h1>\n    <h3>Some services did not respond. Please check your connection and try again.</h3><button class='btn btn-primary btn-lg'  onclick='window.handleNoInternet()'>Retry</button>\n</div>\n </div>\n"}),ms_theme.templates["/templates/pages/errorPage.html"]=a.template)}]),t.run(["$state","$rootScope","$templateCache","$location","$http","$stateParams","$compile","$timeout","$window","app","$filter","$q","$interval",function(t,l,a,o,c,e,m,u,s,n,i,r,p){if(ms._applyScope=function(){l.$$phase||l.$apply()},ms._compile=function(a,s){return s=s||l,new Promise(function(e){var t=m(a)(s);u(function(){e(t)})})},ms._newScope=function(e,t=!1){return(e=e||l).$new(t)},ms.goTo=function(e){return-1<e.indexOf("http")?window.location.href=e:o.url(e)},ms._goToState=function(e){t.transitionTo(e)},ms._setDefaultHttpHeader=function(e,t){c.defaults.headers.common[e]=t},l.$on("$stateChangeStart",function(e,t,a,s,n){$("#ms-prerender-status-code").remove()}),l.ms||(l.ms=window.ms),ms.timeout=u,ms.settings.new_app_flow?ms.app||(ms.app=new App2):ms.app=n,ms._initialize(),ms.broadcast=function(e,t){if(e){if(t.message||(t.message=ms.store.messages[e]),t.message)t.message=ms.filters.translate(t.message);else{if(!window.admin_theme||"mobitual"!=window.admin_theme.name)return;if("success"!=t.level)return;if(e.endsWith(".edit"))t.message=ms.filters.translate("Data Updated Successfully");else if(e.endsWith(".add"))t.message=ms.filters.translate("Data Added Successfully");else if(e.endsWith(".duplicate"))t.message=ms.filters.translate("Duplicate successful");else{if(!e.endsWith(".delete"))return;t.message=ms.filters.translate("Deleted Successfully")}}var a=[],s=(angular.element(document).find(".ms_message_widget_internal").each(function(e){var t=angular.element(this).data("eventname");t&&a.push(t)}),e),e=(t.level&&(s=e+"_"+t.level),l.$broadcast(s,t),!1);(e=-1<a.indexOf(s)?!0:e)||l.$broadcast("*",t)}},l._ms||(l._ms={}),ms.timeout=u,window.ms.api=n,ms.getPendingRequests=function(){return c.pendingRequests},ms._cancellers={},ms._http=function(t){return new Promise(function(s,n){t.uniqueId&&ms._cancellers[t.uniqueId]&&(console.log("uniqueId: "+t.uniqueId),ms._cancellers[t.uniqueId].resolve(),delete ms._cancellers[t.uniqueId]);var e=r.defer();c({method:t.method,url:t.url,data:t.data,params:t.query,cache:t.cache,headers:t.headers,timeout:e.promise}).success(function(e,t,a){s({status:t,data:e,headers:a})}).error(function(e,t,a){n({status:t,data:e,headers:a})}),t.uniqueId&&(ms._cancellers[t.uniqueId]=e)})},c.defaults.headers.common={ajax:1},ms_theme.admintheme?c.defaults.headers.common={backend:1}:ms.searchParams._theme||ms.searchParams.design?c.defaults.headers.common={ajax:1,frontend:void 0,backend:1}:c.defaults.headers.common={frontend:1},l.isMobileApp=ms.device.isMobileApp,ms._newMobileApp&&ms.cordova.device&&(ms.cordova.device.appid=ms.cordova.mobileApp.app_id,ms.cordova.mobileApp.package&&(ms.cordova.device.package=ms.cordova.mobileApp.package),ms._setDefaultHttpHeader("device",JSON.stringify(ms.cordova.device))),window.ms.searchText="",window.ms.page={},window.ms.widgets={},window.ms.routeParams=e,window.ms.location=o,window.design_theme){for(var d in window.design_theme.templates)window.design_theme.templates.hasOwnProperty(d)&&(window.ms_theme.templates[d]=window.design_theme.templates[d]);for(var d in window.design_theme.widgets)window.design_theme.widgets.hasOwnProperty(d)&&(window.ms_theme.widgets[d]=window.design_theme.widgets[d])}angular.forEach(ms_theme.templates,function(e,t){a.put(t,e)}),ms.settings.enable_debug&&("0"==ms.searchParams.msdebug&&ms.localStorage.setItem("msdebug",0),"1"==ms.searchParams.msdebug&&ms.localStorage.setItem("msdebug",1),ms.localStorage.getItem("msdebug")&&(c.defaults.headers.common.msdebug=1,ms.enableDebug=!0)),window.addEventListener("resize",function(){l.$apply(ms.updateScreen)});try{window.parent.shareScope&&0==window.ms.adminTheme&&l.$watch("ms.theme",function(e,t){e&&window.parent.shareScope(ms_store,ms_theme,l)},!0)}catch(e){}l.$on("$locationChangeStart",function(e,t,a){var s,n=o.$$path;if("http:"==location.protocol&&0===n.indexOf(ms.base+"/user/")&&-1==location.hostname.indexOf(".storehippo.manu"))location.protocol="https:";else{if(window.ms.settings.password_page&&window.ms.settings.password_page.enable&&"1"==window.ms.settings.password_page.enable&&o.$$path!=ms.base+"/password"&&!window.ms.adminTheme&&!window.session.approve_password&&!ms.searchParams.designtheme&&(!window._designtheme||1!=window._designtheme))return s=ms.base+"/password",o.path(s);if(ms.base&&n==ms.base)return e.preventDefault(),o.path(ms.base+"/");if(!ms.base||n!=ms.base+"/"){if(ms.base1&&(n==ms.base1||n==ms.base1+"/"))return e.preventDefault(),o.path(ms.base+"/");if(ms.base&&0!=n.indexOf(ms.base))return n.match(/^\/[a-z][a-z](\-[a-z][a-z])?\//)&&(n=n.replace(/^\/[a-z][a-z](\-[a-z][a-z])?\//,"/")),e.preventDefault(),s=(ms.base+n).replace("//","/"),o.path(s);if("/"==n[n.length-1])return s=n.substring(0,n.length-1),o.path(s)}n=window.ms.trigger("ms.page_change_start",{to:t,from:a});n&&n.defaultPrevented&&e.preventDefault()}}),l.$on("$locationChangeSuccess",function(e,t,a){msi.setSearchParams()}),l.$on("$stateChangeStart",function(e,t,a,s,n){if(t.login_required&&!ms.user.isLoggedIn)return ms.goTo("/user/login?redirect="+location.href);window.ms.product=null,window.ms.category=null,window.ms.collection=null,window.ms.brand=null,window.ms.blog=null,window.ms.blog_post=null,window.ms.seller=null,window.ms.starttime=(new Date).getTime(),ms.page&&ms.page.name&&(window.ms.fromPage=ms.page,ms.preurl=ms.fromPage.path);var o=function(){function t(){var e=setTimeout(function(){0<c.pendingRequests.length?i():10==++a?clearTimeout(e):t()},10)}var a=0;t()},i=function(){var e=setTimeout(function(){0==c.pendingRequests.length?(window.ms.endtime=(new Date).getTime(),clearTimeout(e),o()):i()},100)},r=(i(),t.data||(t.data={}),Object.assign({},t)),a=(r.url&&(r.route=r.url.replace(ms.base,"")),r.path=location.pathname.replace(ms.base,""),r.base=ms.base,r.url=location.href,Object.assign({},a));if(r.params=a,(!r.title||-1<r.title.indexOf("{{"))&&(r.title=ms.settings.title||ms.settings.store_title),delete r._id,delete r.templateProvider,ms.trigger("ms.page_render_start"),ms.trigger("ms.page_change_success"),r._elapsedTime=0,ms._pageloadInterval&&p.cancel(window.ms._pageloadInterval),ms._pageloadInterval=p(function(){console.log(c.pendingRequests[0]),0==c.pendingRequests.length?(p.cancel(window.ms._pageloadInterval),ms.trigger("ms.page_loaded")):5e3<r._elapsedTime&&(p.cancel(window.ms._pageloadInterval),ms.trigger("ms.page_loaded",{timeout:!0,numPendingRequests:c.pendingRequests.length})),r._elapsedTime+=200},200),window.ms.pageLoaded=function(){window.ms._pageloadInterval&&(p.cancel(ms._pageloadInterval),window.ms.trigger("ms.page_loaded"))},ms.initializeSEO(r),!window.ms.adminTheme){var d,a=window.ms.user&&window.ms.user.isLoggedIn;if(a&&ms.user&&1==ms.user.use_temporary_password&&"/account/change_password"!=window.location.path)return ms.goTo("/account/change_password");if(a&&-1<ms.page.path.indexOf("/user/")){if(ms.searchParams.redirect)return ms.goTo(ms.searchParams.redirect);var l="/account/profile";return window.ms.preurl&&"^"!=window.ms.preurl&&"-1"==window.ms.preurl.indexOf("/user/")&&(l=window.ms.preurl),ms.goTo(l)}if(!a&&"account"==ms.page.name)return ms.showMessage("Please Login first"),ms.goTo("/user/login");"1"==ms_store.login_required&&window.location.path!=ms.base+"/user/login"&&window.location.path!=ms.base+"/user/forgot_password"&&window.location.path!=ms.base+"/user/reset_password"?a||(window.ms.broadcast("ms.msg.require_login",{level:"warning"}),ms.goTo("/user/login"),(d=document.createElement("meta")).name="prerender-status-code",d.content="302",document.getElementsByTagName("head")[0].appendChild(d)):a||"1"!=t.data.required||(window.ms.broadcast("ms.msg.require_login",{level:"warning"}),ms.goTo("/user/login"),(d=document.createElement("meta")).name="prerender-status-code",d.content="302",document.getElementsByTagName("head")[0].appendChild(d))}}),l.$on("$stateChangeSuccess",function(e,t,a,s,n){"checkout"===t.name&&(ms.preurl="/checkout")}),window.mystore.afterLogin=function(e){if("mystorein"==ms.store.name&&e&&e.socialLoggedinFromMystorein)return 0==(e="/store/startYourTrial").indexOf("http")&&(window.location.href=e),void ms._applyScope();ms._isLogged()},window.mystore.afterPayment=function(e){if(!e||"undefined"==e||"null"==e)return window.ms.broadcast("ms.msg.payment_failed",{level:"warning"});c({url:"/entity/ms.orders/"+e+"?getOriginalOrder=true",method:"GET"}).success(function(e){e?window.ms.broadcast("ms.entity.orders.handleiFramePaymentResponse",{level:"success",data:e.orders}):window.ms.broadcast("ms.msg.payment_failed",{level:"warning"})}).error(function(e){return window.ms.broadcast("ms.msg.payment_failed",{level:"warning",data:e})})},!ms._newMobileApp&&(ms.searchParams&&ms.searchParams.referer&&"mobileApp"==ms.searchParams.referer||window.session&&window.session.mobileApp)&&(navigator.geolocation.getCurrentPosition=function(e,t,a){e&&(window.ms.cordova.locationSuccess=e),t&&(window.ms.cordova.locationError=t),parent.postMessage({getLocation:!0,options:a||null},"*")},console.log=function(){parent.postMessage({console:!0,arguments:JSON.stringify(arguments)},"*")},window.ms.cordova={InAppBrowser:{open:function(e,t,a,s){parent.postMessage({url:e,target:t,options:a,metadata:s,openInappBrowser:!0},"*")}},gotLocation:function(e){e.err&&window.ms.cordova.locationError&&(window.ms.cordova.locationError(e.err),delete window.ms.cordova.locationError),e.position&&window.ms.cordova.locationSuccess&&(window.ms.cordova.locationSuccess(e.position),delete window.ms.cordova.locationSuccess)},enableLogger:function(e){parent.postMessage({enableLogger:!0,level:e},"*")},socialLogin:function(e){console.log("provider====",e),parent.postMessage({socialLogin:!0,provider:e},"*")},socialLogout:function(e){parent.postMessage({socialLogout:!0,provider:e},"*")},socialLoginResponse:function(e){console.log("Inside Social Login Response",e);var t=e.provider,a=e.user;e.error?window.ms.cordova.hideLoading():(console.log("calling ms.users.appSocialLogin"),n.call("appSocialLogin",{entity:"ms.users",data:{user:a,provider:t}},function(e,t){console.log("Inside callback of ms.users.appSocialLogin"),window.ms.cordova.hideLoading(),console.log("calling mystore.afterLogin"),window.mystore.afterLogin()}))},register:function(a){window&&window.admin_theme&&window.ms.user&&!window.ms.user.isLoggedIn||n.call("register",{entity:"ms.push_notifications",data:a},function(e,t){a.device&&!window.device&&(window.device=a.device,window.device.uuid=a.uuid,c.defaults.headers.common.device=JSON.stringify(window.device));parent.postMessage({register:!0},"*")})},removeMask:function(){window.ms.cart.removeMask(),window.ms.cart.locked=!1},afterPayment:function(e){window.mystore.afterPayment(e)},updateSession:function(e){c.post("/entity/ms.users/_/updateSession",{data:{user:e}}).success(function(e){ms._isLogged()}),l.$$phase||l.$apply()},afterLogin:function(){window.mystore.afterLogin()},setLocation:function(e){0===e.indexOf("http")?window.location.href=e:(o.path(e),l.$$phase||l.$apply())},showLoading:function(e,t){parent.postMessage({startloading:!0,title:e,message:t},"*")},hideLoading:function(e,t){parent.postMessage({hideloading:!0},"*")},showSplash:function(){parent.postMessage({startsplas:!0},"*")},hideSplash:function(e,t){parent.postMessage({hidesplash:!0},"*")},executeScript:function(e){parent.postMessage({executeScript:!0,script:e},"*")},parentExecuteScript:function(e){return new Function(e)()}},navigator&&navigator.splashscreen&&navigator.splashscreen.hide?0<c.pendingRequests.length?u(navigator.splashscreen.hide,500):navigator.splashscreen.hide():0<c.pendingRequests.length?u(window.ms.cordova.hideSplash,500):window.ms.cordova.hideSplash(),window.ms._mobileEventListener=function(e){if(e.data&&"object"==typeof e.data&&ms.device.isMobileApp&&e.data.headerDevice)window.device=e.data.headerDevice,window.appId=e.data.appId,e.data.socialLoginEnabled&&(e.data.socialLoginEnabled.facebook&&(window.mystore.controllers.facebookLogin=["$rootScope","$element",function(e,t){t.bind("click",function(){window.ms.cordova.socialLogin("facebook")}),n.addPosthook({entity:"ms.users",command:"logout"},function(e,t,a){window.ms.cordova.socialLogout("facebook"),a()})}],window.ms.settings.ms.login_providers.push({title:"Sign in with Facebook",name:"facebook",active:!0})),e.data.socialLoginEnabled.google&&(window.mystore.controllers.googleLogin=["$rootScope","$element",function(e,t){t.bind("click",function(){window.ms.cordova.socialLogin("google")}),n.addPosthook({entity:"ms.users",command:"logout"},function(e,t,a){window.ms.cordova.socialLogout("google"),a()})}],window.ms.settings.ms.login_providers.push({title:"Sign in with Google",name:"google",active:!0})),e.data.socialLoginEnabled.linkedin&&(window.mystore.controllers.linkedinLogin=["$rootScope","$element",function(e,t){t.bind("click",function(){window.ms.cordova.socialLogin("linkedin")}),n.addPosthook({entity:"ms.users",command:"logout"},function(e,t,a){window.ms.cordova.socialLogout("linkedin"),a()})}],window.ms.settings.ms.login_providers.push({title:"Sign in with LinkedIn",name:"linkedin",active:!0})),window.ms.settings.ms.login_providers=mystore.utils.removeDuplicateObjects(window.ms.settings.ms.login_providers,[],"name")),window&&window.admin_theme?c.defaults.headers.common={device:JSON.stringify(window.device)}:c.defaults.headers.common={frontend:1,device:JSON.stringify(window.device)};else if(e.data&&"object"==typeof e.data&&ms.device.isMobileApp){console.log("Received event from mobile app");var t,a=e.data;for(t in a)window.ms.cordova.hasOwnProperty(t)&&(console.log("calling function: ",window.ms.cordova[t]),window.ms.cordova[t](a[t]))}},window.addEventListener?window.addEventListener("message",ms._mobileEventListener,!1):window.attachEvent("message",ms._mobileEventListener),window.ms.settings.ms.login_providers&&window.ms.settings.ms.login_providers.length&&!window.ms.settings.google_web_client_id&&-1<(e=mystore.utils.getObjectIndexFromArray(window.ms.settings.ms.login_providers,"name","google"))&&window.ms.settings.ms.login_providers.splice(e,1)),window.ms.modal=function(e,t,a,s,n,o){var i,r={};function d(){1!=r.enablestack&&"true"!=r.enablestack&&$("#"+n).remove(),m(i)(l,function(t,e){u(function(){$(t).appendTo("body");var e={show:!0};r.backdrop&&(e.backdrop=r.backdrop),(0==r.usedefault||"false"==r.usedefault?$("#"+n).find(".modal"):$("#"+n)).modal(e),setTimeout(function(){$(t).find("form .col-sm-10").removeClass("col-sm-10").addClass("col-sm-9"),$(t).find("form .col-sm-2").removeClass("col-sm-2").addClass("col-sm-3")},100)})})}e&&(r.widget=e),t&&(r.header=t),n&&(r.modalid=n),s&&(r.backdrop=s),o&&(r.enablestack=o),a&&(r.usedefault=a),r.widget?(e=r.widget,t=r.header,n=i="",s=function(e,t){for(var a="",s=e;0<s;--s)a+=t[Math.round(Math.random()*(t.length-1))];return a},i=0==r.usedefault||"false"==r.usedefault?'<div id="'+(n=s(4,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"))+'" ms-widget="'+e+'"></div>':'<div id="'+(n=r.modalid||s(4,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"))+'" class="modal fade" ><div class="modal-dialog"> <div class="modal-content"> '+(t&&""!=t?'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"> '+t+"</h4></div>":"")+'<div class="modal-body"> <div ms-widget="'+e+'"></div></div></div></div></div>',l.remove=function(){$(".modal").remove(),$(".modal-backdrop").remove()},l.show=function(){d()},d()):alert("widget name not specified in ms.modal widget")}}])},window.mystoredefined||(defineMystoreModule(),window.mystoredefined=!0)),window.mystore.entityController=function(d,l){l=l||"records",d.settings.alias&&(l=d.settings.alias),d.fields={};var a,s,o,c,m,u,e,p,n,i,g,f,h,_,r,t=angular.element("body").injector(),v=t.get("app"),y=t.get("$stateParams"),b=t.get("$location"),w=d.settings.entity;(w="ms.blogs"==d.settings.entity&&b.path().indexOf("blog")<1?"ms.blog_posts":w)?(a=[],s=[],o=[],c=[],u=12,e=1,p=m=0,g=i=n="",d.settings.searchtext&&(n=d.settings.searchtext),d.settings.facetgroup&&(i=d.settings.facetgroup),"true"==d.settings.facets&&(g=d.settings.facets),d.settings.showpage&&b.search().page&&(e=parseInt(b.search().page)),d.settings.page_size&&(u=parseInt(d.settings.page_size)),d.settings.pagesize&&(u=parseInt(d.settings.pagesize)),d.settings.customstart&&(m=parseInt(d.settings.customstart)),1<e&&(m+=u*(e-1)),250<u&&(u=250),f="",h=null,d.showPrevious=!1,d.showNext=!1,d.loading=!1,d.loadingMore=!1,d.TIMESTAMP=(new Date).getTime(),d.paginationSize=1,d.showPagination=[],b.search().filters&&"null"!=b.search().filters&&"string"==typeof(c=b.search().filters)&&(c=JSON.parse(c)),d.settings.filters&&("string"==typeof d.settings.filters&&(d.settings.filters=JSON.parse(d.settings.filters)),angular.forEach(d.settings.filters,function(e){"route_param"==e.type?y.hasOwnProperty(e.value)&&(e.value=y[e.value]):"scope_param"==e.type&&d.$eval(e.value)&&(e.value=d.$eval(e.value))}),s=angular.copy(d.settings.filters)),"price"==(f=d.settings.sortfields?d.settings.sortfields:f)&&(f="price,_id"),d.settings.fields&&(h=d.settings.fields),d.settings.resolve&&(a=d.settings.resolve),_=Math.floor(1e5*Math.random()),!f&&b.search().sortfield&&(f=b.search().sortfield),r=function(r){(d.loading||d.loadingMore)&&d.error("loading under progress..."),r?d.loadingMore=!0:d.loading=!0;var e=s,t=(c&&c.length&&(e=e.concat(c)),o&&o.length&&(e=e.concat(o)),{entity:w,id:_,cancel:!0,version:"1",query:{limit:u,start:m},httpcache:!0});f&&(t.query.sort=f),d.settings.ignoresubstore&&(t.query.ignore_substore=!0),a&&(t.query.resolve=a),e&&(t.query.filters=JSON.stringify(e)),i&&(t.query.facets=g,t.query.facetgroup=i),d.settings.filteroperator&&(t.query.filter_operator=d.settings.filteroperator),h&&(t.query.fields=h),d.settings.total&&"1"==d.settings.total&&(t.query.total="1"),n&&(t.query.search=n),v.list(t,function(e,t){if(d.loading=!1,d.loadingMore=!1,!e&&t&&t.data){r&&d[l]&&d[l].length?d[l]=d[l].concat(t.data.data):d[l]=t.data.data,d.showPrevious=0!=m,u+m<=t.data.paging.total?d.showNext=!0:(d.showNext=!1,d.settings&&d.settings.loop&&(d.showNext=!1,m=0)),d.totalRecords=t.data.paging.total,t.data.paging&&t.data.paging.facets&&(d.facets=t.data.paging.facets,angular.forEach(d.facets,function(e,t){d.fields[t]||(d.fields[t]=[])}),b.search().filters&&b.search().filters.length&&("string"==typeof(e=b.search().filters)&&(e=JSON.parse(e)),a=0,s="",d.fields={},e.forEach(function(e){"price"===e.field?("greater_than_or_equal"===e.operator&&(s=e.value),"less_than_or_equal"===e.operator&&(s=s+"-"+e.value,a=1),s&&a&&(-1==d.fields[e.field].indexOf(s)&&d.fields[e.field].push(s),s="",a=0)):d.fields[e.field]=e.value}))),d.paginationSize=Math.ceil(t.data.paging.total/u);var a,s,n=4;if((n=d.settings.paginationlimit?parseInt(d.settings.paginationlimit):n)>=d.paginationSize&&(n=d.paginationSize),0==m||p<n||p==n&&p==d.paginationSize){for(var o=0;o<n;o++)d.showPagination[o+1]=!0;for(o=n+1;o<=d.paginationSize;o++)d.showPagination[o]=!1}else if(p==n)d.showPagination[1]=!1,d.showPagination[p+1]=!0;else if(n<p&&p<d.paginationSize){for(o=0;o<p;o++)if(1==d.showPagination[o+1]){d.showPagination[o+1]=!1;break}if(d.showPagination[p+1]&&0!=d.showPagination[p+1])for(o=p;1<o;o--){if(0==d.showPagination[o]){d.showPagination[o]=!0,d.showPagination[p+n]=!1;break}if(0==d.showPagination[o-1]){d.showPagination[o-1]=!0;break}}else d.showPagination[p+1]=!0}else if(p==d.paginationSize){for(var i=d.paginationSize-n,o=d.paginationSize;i<o;o--)d.showPagination[o]=!0;for(o=0;o<i;o++)d.showPagination[o+1]=!1}ms.showPagination=angular.copy(d.showPagination)}})},d.next=function(){m+=u,e+=1,d.settings.showpage&&b.search("page",e),r()},d.setmypage=function(e){for(var t=0;t<d.showPagination.length;t++)d.showPagination[t]=!1;e=parseInt(e),d.showPagination&&(d.showPagination[e]=!0,d.showPagination[e-1]=!0,d.showPagination[e-2]=!0,d.showPagination[e+1]=!0)},d.$watch(function(){return b.search()},function(){b.search().page&&"1"<b.search().page&&d.pagination(b.search().page)}),d.previous=function(){m-=u,e-=1,d.settings.showpage&&b.search("page",e),r()},d.pagination=function(e){m=0,m+=u*((p=e)-1),r()},d.paginationPrevious=function(){m-=u,p==d.paginationSize&&(p=d.paginationSize-1),(p-=1)<0&&(p=0),d.selected=p,r()},d.paginationNext=function(){m+=u,p==d.paginationSize&&(p=d.paginationSize-1),p+=1,d.selected=p,r()},d.selected=0,d.select=function(e){d.selected=e},d.loadMore=function(){d.loading||d.loadingMore?d.error("loading under progress..."):d.showNext&&(m+=u,r(!0))},d.removeAllFilters=function(){d.fields={},c=[],"true"!=d.settings.disablefilter&&1!=d.settings.disablefilter&&b.search("filters",null),r()},d.removeFilter=function(e,t){d.fields[e]||(d.fields[e]=[]);var a=mystore.utils.getObjectIndexFromArray(c,"field",e),s=(-1<a&&(-1<(s=c[a].value).indexOf(t)&&s.splice(s.indexOf(t),1),s.length||c.splice(a,1)),d.fields[e].indexOf(t));-1<s&&d.fields[e].splice(s,1),"true"!=d.settings.disablefilter&&1!=d.settings.disablefilter&&(c.length?b.search("filters",JSON.stringify(c)):b.search("filters",null)),r()},d.togglefilter=function(t,e,a){m=0,0;var s,n=[];for(s in d.fields[t]||(d.fields[t]=[]),d.loading=!0,"checkbox"==a.type||"swatch"==a.type?-1==d.fields[t].indexOf(e)?d.fields[t].push(e):d.fields[t].splice(d.fields[t].indexOf(e),1):"radio"==a.type&&(d.fields[t]=[e]),"range"==a.type&&("radio"==a.settings.display_type||"range"==a.settings.display_type?d.fields[t]=[e.min+"-"+e.max]:(d.fields[t]||(d.fields[t]=[]),"price"===t&&(-1==d.fields[t].indexOf(e.min+"-"+e.max)?d.fields[t].push(e.min+"-"+e.max):d.fields[t].splice(d.fields[t].indexOf(e.min+"-"+e.max),1)))),d.fields)"price"===s?d.fields[s].forEach(function(e){e=e.split("-");n.push({field:t,value:parseFloat(e[0]),operator:"greater_than_or_equal",filter_operator:"and"}),n.push({field:t,value:parseFloat(e[1]),operator:"less_than_or_equal",filter_operator:"and"})}):d.fields[s]&&d.fields[s].length&&n.push({field:s,value:d.fields[s],operator:"in",filter_operator:a.settings&&a.settings.display_type&&"radio"!==a.settings.display_type?"or":void 0});if(ms.settings.new_facet_flow){for(var o=[],i=0;i<n.length;i++)n[i].field==t&&(o.push(n[i]),n.splice(n.indexOf(n[i]),1));n=n.concat(o)}(c=n).length?b.search("filters",JSON.stringify(c)):b.search("filters",null),r()},d.priceFilter=function(e,t,a){"string"==typeof e&&(e=JSON.parse(e)),d.value1=parseInt(e.min),d.value2=parseInt(e.max);var s="price",e=(t&&(s=t),"radio");if("radio"==(e=a?a:e)){for(var n=o.length-1;0<=n;--n)o[n].field==s&&o.splice(n,1);o.push({field:s,value:d.value1,operator:"greater_than_or_equal"}),o.push({field:s,value:d.value2,operator:"less_than_or_equal"})}m=0,r()},d.filter=function(e){m=0;var n=angular.copy(e);if(n)if(Array.isArray(n))c=n;else for(var t in angular.forEach(n,function(e,t){if(e&&""!=e){if("object"==typeof e){var a,s={};for(a in e)e[a]&&""!=e[a]&&(s[a]=e[a]);e=JSON.stringify(s)}n[t]=e}else delete n[t]}),n)c.push({field:t,value:n[t],operator:"equal"});else c=[];"true"!=d.settings.disablefilter&&1!=d.settings.disablefilter&&b.search("filters",JSON.stringify(c)),r()},r(),d.advanceFilter=function(e){for(var t in m=0,e)c.push({field:t,value:e[t],operator:"equal"});r()},d.sort=function(e){b.search("sortfield",e),f=e,m=0,r()},d.search=function(e){e={entity:w,query:{q:e},httpcache:!0,cache:!0};v.search(e,function(e,t){if(t&&t.data){d.$$phase||d.$apply();for(var a=[],s=0;s<t.data.length;s++)a.push(t.data[s].obj);d.records=a}d.$$phase||d.$apply()})},d.remove=function(e){e&&(e={entity:w,version:"1",recordId:e},v.del(e,function(e,t){e||r()}))},d.reload=function(){r()},"onScroll"==d.settings.loadmore&&($(document).unbind("scroll"),$(document).scroll(function(){d.settings.hash||(d.settings.hash=CryptoJS.MD5(b.path()).toString());var e,t,a,s=CryptoJS.MD5(b.path()).toString();d.settings.hash===s&&(s=0,parseInt(d.settings.bottomheight)&&(s=parseInt(d.settings.bottomheight)),d.settings.bottomelementid&&(s=$("#"+d.settings.bottomelementid).height()),e=$(window).scrollTop(),t=$(window).height(),(a=$(document).height())-t-s<=e&&0<t&&s<a-t&&"onScroll"==d.settings.loadmore&&(d.loadMore(),$(window).scrollTop(e)))}))):d.error("Entity not defined")},window.mystore.formController=function(s,t){s.fields={},s.widgetValid=!0,"FORM"!=t[0].tagName&&(alert("The "+s.widgetName+" widget can only be applied to form Element"),s.widgetValid=!1),t.attr("name")&&""!=t.attr("name")||(alert("please give the name attribute to "+s.widgetName+" widget element"),s.widgetValid=!1);s.validate=function(){s.errors={},angular.forEach(s.requiredfields,function(e,t){var a;s.fields[e]&&""!=s.fields[e]?"email"==e&&(a=s.fields[e],/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/.test(a)||(s.errors[e]="Please enter a valid email address")):s.errors[e]="Required Field"})},s.reset=function(){s.errors={},s.fields={},s.submitted=!1},s.submitValid=function(){if(!s.widgetValid)return alert("Requirement of "+s.widgetName+" widget not fulfilled"),!1;if(s.submitting)return!1;var e=!(s.submitted=!0);return s[t.attr("name")].$valid||(e=!0),s.validate(),0===Object.keys(s.errors).length&&!e}},ms._resolveDefault=function(t,a){var e,s,n,o;t.settings.default&&(-1<t.settings.default.indexOf("{{")?(s=(e=angular.element("body").injector()).get("$compile"),n=e.get("$rootScope"),o=e.get("$timeout"),s("<div>"+t.settings.default+"</div>")(n,function(e){o(function(){a.data[t.name]=e.html()})})):a.data[t.name]=t.settings.default)};var defaultBgImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAABkCAQAAAC/MNJRAAABWklEQVR42u3VQREAAAzCsOHf9HTAJRL6aQ4AqBcJAMDQAQBDBwAMHQAwdAAwdADA0AEAQwcADB0ADB0AMHQAwNABAEMHAEMHAAwdADB0AMDQAcDQAQBDBwAMHQAwdAAwdADA0AEAQwcADB0ADB0AMHQAwNABAEMHAEMHAAwdADB0AMDQAcDQAQBDBwAMHQAwdAAwdADA0AEAQwcADB0ADB0AMHQAwNABAEMHAAwdAAwdADB0AMDQAQBDBwBDBwAMHQAwdADA0AHA0AEAQwcADB0AMHQAMHQAwNABAEMHAAwdAAwdADB0AMDQAQBDBwBDBwAMHQAwdADA0AHA0AEAQwcADB0AMHQAMHQAwNABAEMHAAwdAAwdADB0AMDQAQBDBwBDBwAMHQAwdADA0AHA0CUAAEMHAAwdADB0AMDQAcDQAQBDBwAMHQAwdAAwdADA0AEAQwcADB0AFj1HsQBlME/e2wAAAABJRU5ErkJggg==",controllers=(window.mystore.formValidator=function(o){if(!o.settings.formname||""==o.settings.formname)return console.log("ERROR: formname must be specified"),!1;o.errors={},o.fields={},o.formFields=[],o.invalid=!1,o.submitted=!1,o.button=o.settings.buttonname||"Submit",o.reset=function(){o.errors={},o.fields={},o.submitted=!1},o.submitValid=function(){o.errors={},ms.trigger("ms.form.validating",{form:{name:o.settings.formname,fields:o.formFields,data:o.fields,errors:o.errors}});var e=validation.formValidation(o.formFields,o.fields);if(console.log("field error",e),Object.keys(e).length||Object.keys(o.errors).length){for(var t in e){var a=Object.keys(e[t]);o.errors[t]||(o.errors[t]=e[t][a[0]])}return o.invalid=!0,ms.trigger("ms.form.invalid",{form:{name:o.settings.formname,fields:o.formFields,data:o.fields,errors:o.errors}}),!1}return ms.trigger("ms.form.valid",{form:{name:o.settings.formname,fields:o.formFields,data:o.fields,errors:{}}}),!(o.invalid=!1)};var a={};function i(){o.fieldGroups=[],o.formFields.forEach(function(e){e=e.settings.field_groups;e&&(Array.isArray(e)?e.forEach(function(e){-1==o.fieldGroups.indexOf(e)&&o.fieldGroups.push(e)}):-1==o.fieldGroups.indexOf(e)&&o.fieldGroups.push(e))})}o.fieldGroups=[],ms.app.list({entity:"ms.forms",version:"1",query:{filters:[{field:"name",value:o.settings.formname}]}},function(e,t){t=t&&t.data&&t.data.data&&t.data.data[0];if(ms.trigger("ms.form.loading",{form:{name:o.settings.formname,fields:t.fields,data:o.fields}}),e||!t)return console.log("ERROR: form name is not valid: "+o.settings.formname),!1;(a=t).fields.forEach(function(e){e.data_type="file"==e.type?"file":"string",e.settings.display_type=e.type,e&&e.settings&&"1"==e.settings.hidden||o.formFields.push(e),ms._resolveDefault(e,{data:o.fields})}),ms._applyScope(),i()}),o.$watch("fields",function(s){var n=[];angular.forEach(a.fields,function(e,t){var a=!0;e&&e.settings&&e.settings.show_on&&e.settings.show_on.length&&e.settings.show_on.forEach(function(e){if(e&&e.field&&e.value)switch(e.operator){case"equal":e.value!=s[e.field]&&(a=!1);break;case"not_equal":e.value==s[e.field]&&(a=!1);break;default:e.value!=s[e.field]&&(a=!1)}}),!a||e&&e.settings&&"1"==e.settings.hidden||n.push(e)}),o.formFields=n,i()},!0)},window.mystore.orderOptions=function(o,i,r){o.optionData={},o.show_input=!1,o.options=[];var d=i.ms.cart,l=o.settings.level||"order";function a(){function e(e){e.forEach(function(e){d.options[e.name]&&"file"==e.type?o.optionData[e.name]={type:e.type,value:"",data:d.options[e.name]}:o.optionData[e.name]={type:e.type,value:d.options[e.name]&&"file"!=e.type?d.options[e.name]:"",data:e.default||null}}),o.options=e,o.options.length&&(o.show_input=!0)}i.ms.cart&&i.ms.cart.available_options&&i.ms.cart.available_options.length?e(i.ms.cart.available_options):e([])}a(),o.removeOption=function(a){var e={entity:"ms.carts",customCommandName:"",version:"1",query:{q:{_id:d._id,option:a.name,type:a.type}}};r.call("removeOption",e,function(e,t){o.submitting=!1,e||(d.updateCart(t.data.data.cart),delete o.optionData[a.name])})};var s=!0;i.$watch("ms.cart.options",function(e,t){s?s=!1:a()}),o.saveOption=function(a){var e,t={};for(e in o.optionData)t[e]=o.optionData[e].value;var s=validation.formValidation(i.ms.cart.available_options,t,!1);if(s&&Object.keys(s)&&Object.keys(s).length){for(var n in o.optionErrors||(o.optionErrors={}),s)o.optionErrors[n]=!0;return a({error:"Some required options are not present"})}s={entity:"ms.carts",customCommandName:"",version:"1",query:{q:{_id:d._id}},data:{fields:t,level:l,product:o.settings.product}};r.call("saveOptions",s,function(e,t){e?a(e):(d.updateCart(t.data.data.cart),a())})}},window.mystore.shippingOptions=function(n,o,i){n.shippingData={},n.show_shipping_input=!1,n.shippingOptions={};var r=o.ms.cart;function a(){function e(t){Object.keys(t).forEach(function(e){n.shippingData[e]={value:r.shipping_options&&r.shipping_options[e]?r.shipping_options[e]:"",data:t[e]&&t[e].length?t[e]:[]}}),Object.keys(n.shippingData).length&&(n.show_shipping_input=!0)}o.ms.cart&&o.ms.cart.available_shipping_charges&&Object.keys(o.ms.cart.available_shipping_charges).length?e(o.ms.cart.available_shipping_charges):e({})}a();var s=!0;o.$watch("ms.cart.shipping_options",function(e,t){s?s=!1:a()}),n.saveShippingOption=function(a){r=r||o.ms.cart;var e,t={};for(e in n.shippingData)t[e]=n.shippingData[e].value;r.add_mask();var s={entity:"ms.carts",customCommandName:"",version:"1",query:{q:{_id:r._id}},data:{options:t}};i.call("saveShippingOptions",s,function(e,t){e?(r.remove_mask(),a&&a(e)):(r.updateCart(t.data.data.cart),r.remove_mask(),a&&a())})}},window.mystore.checkProductAvailability=function(t){"automatic"!=t.inventory_management&&(t.available=!0),"automatic"==t.inventory_management&&"product"==t.inventory_management_level&&(0<t.inventory_quantity||"1"==t.inventory_allow_out_of_stock?t.available=!0:t.available=!1),"automatic"==t.inventory_management&&"variant"==t.inventory_management_level&&(t.available=!1,t.variants.forEach(function(e){("automatic"!=e.inventory_management||0<e.inventory_quantity||"1"==e.inventory_allow_out_of_stock)&&(t.available=!0)}))},window.mystore.controllers={product:["$scope","app","$stateParams","$rootScope","$filter","$location","$compile","$timeout","$http",function(_,p,v,y,e,t,a,s,n){var b,w,k,S,O,q,x,C,E,I,o,P=null;_.settings.product&&(P=_.settings.product),v.product&&(P=v.product),ms.productlodedImages=!0,(P=_.settings&&_.settings.product?_.settings.product:P)?(_.settings.showalloptions||(_.settings.showalloptions=!1),_.settings.showallvalues||(_.settings.showallvalues=!1),_.product={},_.product_images=[],_.product_media=[],_.options={},_.option_values={},_.featured_image={},_.related_products=[],_.loading=!0,_.priceOverrideTotal,b={},w=[],k=[],S=_.settings.showalloptions,O=_.settings.showallvalues,q={},x=[],C=[],E={},I=[],y.$on("ReviewAdded",function(){var e={entity:"ms.products",query:{q:{alias:v.product}},httpcache:!0,cache:!0};p.list(e,function(e,t){e||s(function(){_.product.avg_rating=t.data.records[0].avg_rating,_.product.num_reviews=t.data.records[0].num_reviews})})}),o={entity:"ms.products",query:{q:{alias:P}},httpcache:!0,cache:!0},p.list(o,function(e,t){var a,n,s,o,i,g,f,r,d,l,c,h,m,u;_.loading=!1,e?_.product={_id:"dummy"}:!t.data.records.length||"1"!=t.data.records[0].publish?"product"==ms.page.name&&ms.routeParams.product==P&&ms.notFound():(_.product=t.data.records[0],ms.settings.new_product_variant_flow&&(_.product.variants=_.product.variants2||[],_.product.variants=_.product.variants.filter(function(e){return e.variant_id}),_.product.variants.length?_.product.product_has_multiple_variants="1":_.product.product_has_multiple_variants="0",_.product.default_variant&&(delete _.product.default_variant.price,delete _.product.default_variant.compare_price,delete _.product.default_variant.list_price,delete _.product.default_variant.our_price)),"product"==ms.page.name&&v.product&&v.product==_.product.alias&&(ms.product=_.product,ms.pageLoaded()),ms.settings.configurable_fields?k=ms.settings.configurable_fields:t.data.configurable_fields&&t.data.configurable_fields.length&&(k=t.data.configurable_fields),angular.forEach(k,function(e){b[e]=_.product[e]}),b.original_price=_.product.original_price,_.product.metafields&&_.product.metafields.size_chart&&y.$broadcast("ProductSizeChart",{file:_.product.metafields.size_chart}),_.product_images=_.product.images,_.product.media&&_.product.media.length&&(_.product_images=_.product_images.concat(_.product.media)),_.featured_image=_.product.images&&_.product.images.length?_.product.images[0]:{},_.product.featured_image=_.featured_image,_.product.selected_options={},_.product.selected_variant={},t=(e=_.product.SEO||{}).title&&e.title.trim()||_.product.name,a=(a=e.description)||$("<div>"+_.product.description+"</div>").text().substring(0,160),ms.updateSEO({title:t,description:a,image:_.featured_image&&_.featured_image.image,keywords:e.keywords,canonical_url:e.canonical_url}),"0"==_.product.available||0==_.product.available?_.product.available=!1:_.product.available=!0,_.$watch("related_products",function(e,t){e&&e.length&&angular.forEach(_.related_products,function(e,t){e.alias==_.product.alias&&_.related_products.splice(t,1)})}),y.$watch("ms.categories",function(e,t){var i;e&&(i=!0,_.product.categories||(_.product.categories=[]),angular.forEach(e,function(e){var t,a,s,n,o;i&&(-1!=_.product.categories.indexOf(e.alias)?(delete(t=angular.copy(e)).children,e.children&&e.children.length?(a=0,s={},n={},o={},angular.forEach(e.children,function(e){a++,-1!=_.product.categories.indexOf(e.alias)&&(delete(s=angular.copy(e)).children,e.children&&e.children.length&&angular.forEach(e.children,function(e){-1!=_.product.categories.indexOf(e.alias)&&(delete(n=angular.copy(e)).children,e.children&&e.children.length&&angular.forEach(e.children,function(e){-1!=_.product.categories.indexOf(e.alias)&&delete(o=angular.copy(e)).children}))}))}),e.children&&a==e.children.length&&(o&&Object.keys(o).length?(_.product.category=o,_.product.category.parent=n,_.product.category.parent.parent=s,_.product.category.parent.parent.parent=t):n&&Object.keys(n).length?(_.product.category=n,_.product.category.parent=s,_.product.category.parent.parent=t):s&&Object.keys(s).length?(_.product.category=s,_.product.category.parent=t):_.product.category=t,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.paginationLimit=4,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products")))):(_.product.category=t,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products"))),i=!1):e.children&&e.children.length&&angular.forEach(e.children,function(e){var t,a,s;i&&(-1!=_.product.categories.indexOf(e.alias)?(delete(t=angular.copy(e)).children,e.children&&e.children.length?(a=0,s={},angular.forEach(e.children,function(e){a++,-1!=_.product.categories.indexOf(e.alias)&&delete(s=angular.copy(e)).children,a==e.children.length&&(Object.keys(s).length?(_.product.category=s,_.product.category.parent=t):_.product.category=t,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products")))})):(_.product.category=t,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products"))),i=!1):e.children&&e.children.length&&(s={},angular.forEach(e.children,function(e){-1!=_.product.categories.indexOf(e.alias)?(s=angular.copy(e),_.product.category=s,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products")),i=!1):e.children&&e.children.length&&angular.forEach(e.children,function(e){-1!=_.product.categories.indexOf(e.alias)?(s=angular.copy(e),_.product.category=s,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products")),i=!1):e.children&&e.children.length&&angular.forEach(e.children,function(e){-1!=_.product.categories.indexOf(e.alias)&&(s=angular.copy(e),_.product.category=s,ms.settings.new_product_variant_flow||(_.settings.page_size=12,_.settings.filters=[{field:"categories",type:"manual",value:_.product.category.alias},{field:"publish",type:"manual",value:"1"}],_.settings.entity="ms.products",mystore.entityController(_,"related_products")),i=!1)})})})))}))}))}),_.filterImages=function(a){var s;ms.productlodedImages=!1,(_.product.images&&_.product.images.length||_.product.media&&_.product.media.length)&&(_.product.images=_.product.images||[],_.product.media=_.product.media||[],s=_.product.images.concat(_.product.media),_.product_images&&_.product_images.length&&(_.product_images=[]),a?angular.forEach(s,function(e,t){e.tags==a&&_.product_images.push(e),t+1==s.length&&(_.product_images.length?_.featured_image=_.product_images[0]:(_.product_images=s,_.featured_image=s[0]))}):(_.product_images=s,_.featured_image=s[0]),ms.timeout(function(){ms.productlodedImages=!0}))},_.load_featured_image=function(e){ms.settings.image_lazyload&&(_.featured_image=""),ms.timeout(function(){_.featured_image=e})},n=function(a){var o,i=[];return O?angular.forEach(a,function(a,e){var s=[];angular.forEach(a.values,function(e,t){e.available=!0,s.push(e),++t==a.values.length&&(a.values=s,i.push(a))})}):(o={},angular.forEach(w,function(e,t){angular.forEach(e.options,function(e){var t=e.name,e=e.value;o[t]||(o[t]=[]),-1==o[t].indexOf(e)&&o[t].push(e)}),++t==w.length&&angular.forEach(a,function(a,e){var s,n=a.name;o[n]&&(s=[],angular.forEach(a.values,function(e,t){-1!=o[n].indexOf(e.value)&&(e.available=!0,s.push(e)),++t==a.values.length&&(a.values=s,i.push(a))}))})})),i},s=function(e){var a=[];return S?a=e:angular.forEach(e,function(e,t){-1!=x.indexOf(e.name)&&a.push(e)}),a},o=function(e){for(var t in _.options={},angular.forEach(e,function(e){var t={display_name:e.display_name,name:e.name,type:e.type,default_value:e.default_value,available:!0,required:"0"};e.required&&"1"==e.required&&(t.required="1",t.required_message=e.required_message||"Please select "+e.display_name,t.show=!1),_.option_values[e.name]=e.values,_.options[e.name]=t,q[e.name]=t}),I=[],_.options)I.push(t)},i=function(){var s=[];if(w.forEach(function(e){var a;e.available&&(a={},e.options&&e.options.length&&e.options.forEach(function(e){var t=String(e.name);a[t]=e.value}),s.push(a))}),_.option_values)for(var n in _.option_values)_.option_values[n]&&_.option_values[n].forEach(function(t){var a=t.available=!1;s.length?s.forEach(function(e){e[n]==t.value&&(a=!0)}):a=!0,a&&(t.available=!0)})},g=function(){_.quantity={managing:!1,available:0},"automatic"!=_.product.inventory_management&&(_.product.available=!0),"automatic"==_.product.inventory_management&&"product"==_.product.inventory_management_level&&(0<_.product.inventory_quantity||"1"==_.product.inventory_allow_out_of_stock?_.product.available=!0:_.product.available=!1,0<=_.product.inventory_quantity&&(_.quantity={managing:!0,available:_.product.inventory_quantity})),"automatic"==_.product.inventory_management&&"variant"==_.product.inventory_management_level&&("automatic"!=_.product.selected_variant.inventory_management||0<_.product.selected_variant.inventory_quantity||"1"==_.product.selected_variant.inventory_allow_out_of_stock?_.product.available=!0:_.product.available=!1,0<=_.product.selected_variant.inventory_quantity&&(_.quantity={managing:!0,available:_.product.selected_variant.inventory_quantity}))},!_.product.option_set||_.product.options&&_.product.options.length&&_.product.variants&&_.product.variants.length||(_.show_always_options={},_.show_always_options_values={},d={},l=function(){var t;angular.forEach(_.product.options,function(e){e.name=e.name;var s={_id:e._id,name:e.name,display_name:e.name,type:"dropdown",values:[]},n="";d[e.name]&&((n=d[e.name]).display_name&&(s.display_name=n.display_name),n.type&&(s.type=n.type),n.required&&(s.required=n.required),n.default_value&&(s.default_value=n.default_value)),angular.forEach(e.values,function(t){var a={label:t,value:t};n&&n.values&&n.values.length&&n.values.forEach(function(e){e.value==t&&(a=e)}),s.values.push(a)}),q&&q.length&&q.push(s)}),_.product.variants&&_.product.variants.length&&angular.forEach(_.product.variants,function(e,t){e&&w.push(e)}),angular.forEach(w,function(e,t){C.push(e.variant_id),angular.forEach(e.options,function(e){-1==x.indexOf(e.name)&&"#"!=e.value&&x.push(e.name)})}),_.product.default_variant&&Object.keys(_.product.default_variant).length&&(t=_.product.default_variant,_.product.selected_variant=_.product.default_variant,angular.forEach(k,function(e){ms.settings.new_product_variant_flow||("inventory_quantity"!=e&&"inventory_low_stock_quantity"!=e&&"inventory_management"!=e&&"inventory_management_level"!=e&&"inventory_allow_out_of_stock"!=e&&"price"!=e&&t[e]&&(_.product[e]=t[e]),"price"==e&&(_.product.original_price,_.product.original_price=_.product.price,t.price||(t.price=_.product.price),_.product.price=parseFloat(t.price)*(parseFloat(b.price)/parseFloat(b.original_price)),_.product.original_price=parseFloat(t.price)))}),angular.forEach(t.options,function(e){_.product.selected_options[e.name]=e.value})),"variant"==_.product.inventory_management_level&&(O=!1,angular.forEach(w,function(t){E[t.variant_id]||(E[t.variant_id]=[],angular.forEach(t.options,function(e){E[t.variant_id].push(e.value)}))})),o(n(s())),g(),i()},c={entity:"ms.option_set",query:{q:{_id:_.product.option_set}},httpcache:!0,cache:!0},p.list(c,function(e,t){e||(_.show_always_options={},_.show_always_options_values={},e=t.data.records[0],_.optionSet=e,angular.forEach(e.options,function(e){"1"==e.show_always&&(_.show_always_options[e.name]={display_name:e.display_name,name:e.name,type:e.type,required:e.required},_.show_always_options_values[e.name]=e.values),"1"!=e.show_always&&(e.name=e.name,d[e.name]=e)}),l())})),_.product.options&&_.product.options.length&&_.product.variants&&_.product.variants.length?(_.product.inventory_management_level="variant",_.product.product_has_multiple_variants="1",f=async function(t){return new Promise(async function(a){var e={entity:"ms.products",command:"list",query:{filters:[{field:"_id",value:_.product._id}],selected_variant:t}};ms.app.call(e,function(e,t){t&&t.data&&t.data.records&&t.data.records.length&&t.data.records[0].override_total?_.priceOverrideTotal=t.data.records[0].override_total:_.priceOverrideTotal="",a()})})},r=[],d={},l=async function(){var t;angular.forEach(_.product.options,function(e){var s={_id:e._id,name:e.name,display_name:e.name,type:"dropdown",values:[]},n="";d[e.name]&&((n=d[e.name]).display_name&&(s.display_name=n.display_name),n.type&&(s.type=n.type),n.required&&(s.required=n.required),n.default_value&&(s.default_value=n.default_value)),angular.forEach(e.values,function(t){var a={label:t,value:t};n&&n.values&&n.values.length&&n.values.forEach(function(e){e.value==t&&(a=e)}),s.values.push(a)}),r.push(s)}),_.product.variants&&_.product.variants.length&&angular.forEach(_.product.variants,function(e,t){e&&w.push(e)}),angular.forEach(w,function(e,t){C.push(e.variant_id),angular.forEach(e.options,function(e){-1==x.indexOf(e.name)&&"#"!=e.value&&x.push(e.name)})}),_.product.default_variant&&Object.keys(_.product.default_variant).length&&((t=_.product.default_variant)&&t.variant_id&&ms.settings&&ms.settings.show_priceoverride_on_product_page&&await f(t.variant_id),_.product.selected_variant=_.product.default_variant,angular.forEach(k,function(e){"inventory_quantity"!=e&&"inventory_low_stock_quantity"!=e&&"inventory_management"!=e&&"inventory_management_level"!=e&&"inventory_allow_out_of_stock"!=e&&"price"!=e&&t[e]&&(_.product[e]=t[e]),"price"==e&&(_.priceOverrideTotal&&ms.settings&&ms.settings.show_priceoverride_on_product_page&&(t.price=parseFloat(_.priceOverrideTotal)),_.product.original_price,_.product.original_price=_.product.price,t.price||(t.price=_.product.price),_.product.price=parseFloat(t.price)*(parseFloat(b.price)/parseFloat(b.original_price)),_.product.original_price=parseFloat(t.price))}),angular.forEach(t.options,function(e){_.product.selected_options[e.name]=e.value})),"variant"==_.product.inventory_management_level&&(O=!1,angular.forEach(w,function(t){E[t.variant_id]||(E[t.variant_id]=[],angular.forEach(t.options,function(e){E[t.variant_id].push(e.value)}))})),o(n(s(r))),g(),i()},_.product.option_set?(c={entity:"ms.option_set",query:{q:{_id:_.product.option_set}},httpcache:!0,cache:!0},p.list(c,function(e,t){e||(_.show_always_options={},_.show_always_options_values={},e=t.data.records[0],(_.optionSet=e)&&angular.forEach(e.options,function(e){"1"==e.show_always&&(_.show_always_options[e.name]={display_name:e.display_name,name:e.name,type:e.type,required:e.required},_.show_always_options_values[e.name]=e.values),"1"!=e.show_always&&(e.name=e.name,d[e.name]=e)}),l())})):l()):g(),h=function(e,t,a,s){if(!a&&0==e.length||!t)return s(null);if(!a&&1<=e.length)return s(e[0]);for(var n=e,o=a,e=function(e){h(e,t,a-1,s)},i=t.split("|"),r=[],d=0;d<n.length;d++){var l=n[d].variant_id?n[d].variant_id.split("|"):"",c=!0;if(i.length==l.length){for(var m=0;m<i.length;m++)i[m]==l[m]||m+o==Object.keys(_.options).length&&"#"==l[m]||(c=!1);c&&r.push(n[d])}}e(r)},_.findRules=function(e,t){if(!e||!t)return!1;if(_.product.selected_options[e]=t,ms.settings&&ms.settings.enable_option_price){if("object"==typeof t){var a,s=[];for(a in t)t[a]&&s.push(a);_.product.selected_options[e]=s}_.option_set_total=0,_.optionSet&&_.optionSet.options&&Object.keys(_.product.selected_options).forEach(function(a){_.optionSet.options.forEach(function(e){e.name==a&&e.values&&e.values.forEach(function(t){Array.isArray(_.product.selected_options[a])&&_.product.selected_options[a].forEach(function(e){t.price&&t.value==e&&(_.option_set_total+=parseFloat(t.price))})})})}),_.option_set_total?_.product.price_with_option_set=parseFloat(_.product.price)+parseFloat(_.option_set_total):_.product.price_with_option_set=0}if("1"!=_.product.product_has_multiple_variants)return!1;for(var n=[],o=(o=I).sort(),i=0;i<o.length;i++)_.product.selected_options[o[i]]?n[i]=_.product.selected_options[o[i]]:n[i]="#";function r(a){angular.forEach(k,function(e){if(_.product[e]=a[e],ms.settings.resolve_variant_discounts||"price"!=e)_.priceOverrideTotal&&ms.settings&&ms.settings.show_priceoverride_on_product_page&&"price"==e&&(a.price=_.priceOverrideTotal,_.product.price=parseFloat(a.price),_.product.original_price=parseFloat(a.price));else{if(_.priceOverrideTotal&&ms.settings&&ms.settings.show_priceoverride_on_product_page&&(a.price=_.priceOverrideTotal),_.product.original_price||(_.product.original_price=_.product.price),a.price||(a.price=_.product.price),_.product.discounts&&_.product&&_.product.discounts.length&&(1!=_.product.discounts.length||a.discount_applied||("percentage"==_.product.discounts[0].type?(a.discount_applied=!0,a.original_price=parseFloat(a.price),a.price=parseFloat(a.price)-parseFloat(a.price)*parseFloat(_.product.discounts[0].amount)/100):(a.original_price=parseFloat(a.price),_.product.discounts[0].saved_amount&&(a.price=parseFloat(a.price)-parseFloat(_.product.discounts[0].saved_amount)),a.discount_applied=!0))),_.product.price=parseFloat(a.price),_.product.original_price=parseFloat(a.price),a.original_price&&(_.product.original_price=parseFloat(a.original_price)),a.metafields)for(var t in a.metafields)_.product.metafields[t]=a.metafields[t];ms._applyScope()}})}var d=n.join("|"),l={},c=(ms.settings.new_product_variant_flow&&_.product.variants&&_.product.variants.length&&(w=JSON.parse(JSON.stringify(_.product.variants))),h(w.slice(0),d,Object.keys(_.options).length,async function(e){if(!e)return angular.forEach(k,function(e){_.product[e]=b[e]}),_.filterImages(null),g(),_.product.selected_variant={},!0;var t;l=e,ms.settings.new_product_variant_flow?(t=l,new Promise(function(a){console.log("selectedVariant: ",t);var e={entity:"ms.product_variants",command:"list",query:{filters:[{field:"_id",value:t._id}]},version:"1"};ms.app.call(e,function(e,t){t=t.data&&t.data.data&&t.data.data.records&&t.data.data.records[0];a(t)})}).then(function(e){r(l=e);e=_.product.selected_variant&&_.product.selected_variant.variant_id;(_.product.selected_variant=l).tag&&_.filterImages(l.tag),g(),ms._applyScope(),e!=l.variant_id&&ms.trigger("ms.product_variant_selected")})):(e=_.product.selected_variant&&_.product.selected_variant.variant_id,l&&l.variant_id&&ms.settings&&ms.settings.show_priceoverride_on_product_page&&await f(l.variant_id),r(l),(_.product.selected_variant=l).tag&&_.filterImages(l.tag),_.product.tax_rate&&0<_.product.tax_rate&&(_.product.price_with_tax=parseFloat(parseFloat(parseFloat(_.product.price)+_.product.tax_rate/100*parseFloat(_.product.price)).toFixed(2))),g(),e!=l.variant_id&&ms.trigger("ms.product_variant_selected"))}),e),m=t,u=[];if(w.forEach(function(e){var a;e.available&&(a={},e.options&&e.options.length&&e.options.forEach(function(e){var t=String(e.name);a[t]=e.value}),u.push(a))}),_.option_values)for(var p in _.option_values)c!=p&&_.option_values[p]&&_.option_values[p].forEach(function(t){var a=t.available=!1;u.length&&u.forEach(function(e){e[c]==m&&e[p]==t.value&&(a=!0)}),a&&(t.available=!0)});ms.trigger("ms.product_option_selected",{option_name:e,option_value:t})},_.selectOption=_.findRules,m=function(){var a=!1;return angular.forEach(_.options,function(e,t){_.options[t].required&&"1"==_.options[t].required&&(_.options[t].show=!1),_.product.selected_options[t]&&""!=_.product.selected_options[t]||(_.options[t].show=!0,a=!0)}),angular.forEach(_.show_always_options,function(e,t){!_.show_always_options[t].required||"1"!=_.show_always_options[t].required||_.product.selected_options[t]&&""!=_.product.selected_options[t]?_.show_always_options[t].show=!1:(_.show_always_options[t].show=!0,_.show_always_options[t].required_message="Please select "+_.show_always_options[t].display_name,a=!0)}),a},u=function(e,a){var t,s,n=null;return e.options&&e.options.length&&(t=[],e.options.forEach(function(e){e.name&&t.push(e.name)}),t.sort(),s=[],t.forEach(function(e){var t="#";a&&e&&a[e]&&(t=a[e]),s.push(t)}),n=s.join("|")),n},_.check_required_options=function(e,t){var a=!1;if(_.show_always_options&&(Object.keys(_.show_always_options).forEach(function(e){"1"!=_.show_always_options[e].required||_.product.selected_options[e]||(a=!0)}),a))return _.variant_error="Variant not exist",window.ms.broadcast("ms.msg.variant_not_selected",{level:"warning"});for(var s=[],n=(n=I).sort(),o=0;o<n.length;o++)_.product.selected_options[n[o]]?s[o]=_.product.selected_options[n[o]]:s[o]="#";var i,r=s.join("|");if(e.variants&&e.variants.length&&-1==mystore.utils.getObjectIndexFromArray(e.variants,"variant_id",r))return _.variant_error="Variant not exist",window.ms.broadcast("ms.msg.variant_not_selected",{level:"warning"});if("automatic"!=e.inventory_management)return m()||y.ms.cart.add_product(e,t),!0;if("product"==e.inventory_management_level)return m()||y.ms.cart.add_product(e,t),!0;if("variant"==e.inventory_management_level){if(!_.product.selected_variant||!Object.keys(_.product.selected_variant).length||(i=!1,angular.forEach(_.options,function(e,t){-1==x.indexOf(_.options[t].name)&&_.options[t].required&&"1"==_.options[t].required&&(_.options[t].show=!1,_.product.selected_options[t]&&""!=_.product.selected_options[t]||(_.options[t].show=!0,i=!0))}),i))return window.ms.broadcast("ms.msg.variant_not_selected",{level:"warning"});y.ms.cart.add_product(_.product,t)}},_.addToCart=_.check_required_options,_.linkedProducts=[],u(_.product,_.product.selected_options),_.product.seller_products&&_.product.seller_products.length&&(function(e){var t=JSON.parse(JSON.stringify(_.product)),s=[];if(t.seller_products.forEach(function(e){"1"==e.publish&&s.push(e)}),_.linkedProductsLoading=!1,!t.options||!t.options.length)return e(null,{data:{records:s,total:s.length}});var n={};t.options.forEach(function(t){var a;t&&t.name&&(a=t.name,n[a]||(n[a]=[]),s.forEach(function(e){e.selected_options&&e.selected_options[t.name]&&(e=e.selected_options[t.name],-1==n[a].indexOf(e)&&n[a].push(e))}))}),e(null,{data:{records:s,total:s.length,options:n}})}(function(e,t){var a,s;e||t.data&&t.data.records&&(t.data.total,t.data&&t.data.options&&(_.linkedProductsOptions=t.data.options,_.product.options&&_.product.options.length?(_.product.inventory_management_level="variant",_.product.product_has_multiple_variants="1",q=[],a={},s=function(){angular.forEach(_.product.options,function(e){e.name=e.name;var s,n={_id:e._id,name:e.name,display_name:e.name,type:"dropdown",values:[]};a[e.name]&&((s=a[e.name]).display_name&&(n.display_name=s.display_name),s.type&&(n.type=s.type),s.required&&(n.required=s.required),s.default_value&&(n.default_value=s.default_value)),angular.forEach(e.values,function(t){var a={label:t,value:t};s&&s.values&&s.values.length&&s.values.forEach(function(e){e.value==t&&(a=e)}),n.values.push(a)}),q.push(n)}),o(n(q)),g()},_.product.option_set?(e={entity:"ms.option_set",query:{filters:[{field:"_id",value:_.product.option_set}]},httpcache:!0,cache:!0},p.list(e,function(e,t){e||(e=t.data.records[0],(_.optionSet=e)&&angular.forEach(e.options,function(e){e.name=e.name,a[e.name]=e})),s()})):s()):g()),t.data.records.forEach(function(e){var t;_.linkedProducts.push((e=e,(t=JSON.parse(JSON.stringify(_.product))).price=e.price,t.compare_price=e.compare_price,t.variant_id=e.variant_id,t.available=e.available,t.tax_rule=e.tax_rule,t.sku=e.sku,t.inventory_quantity=e.inventory_quantity,t.barcode=e.barcode,t.estimated_delivery_time=e.estimated_delivery_time,t.estimated_dispatch_time=e.estimated_dispatch_time,t._resolvedData=e._resolvedData,t.linked_product_id=e._id,t.metafields||(t.metafields={}),t.selected_variant={},t.selected_options=e.selected_options,t.metafields.vendor=e.vendor,t.seller_name=e.seller_name,t.seller=e.seller,t.original_price=e.price,e.variant_id&&(t.selected_variant={},t.selected_variant.variant_id=e.variant_id),t))}))}),_.settings.loadlinkedproducts&&(u=function(e,a){var t,s,n=null;return e.options&&e.options.length&&(t=[],e.options.forEach(function(e){e.name&&t.push(e.name)}),t.sort(),s=[],t.forEach(function(e){var t="#";a&&e&&a[e]&&(t=a[e]),s.push(t)}),n=s.join("|")),n},_.loadLinkedProducts=function(e){var t={entity:"ms.linked_products",query:{resolve:[{field:"vendor",child_fields:["first_name","last_name","email"]}],q:{product_id:_.product._id,publish:"1"}},version:"1",httpcache:!0,cache:!0};e&&(t.query.q.variant_id=e),_.settings.linkedproductssortfield&&(t.query.sort=_.settings.linkedproductssortfield),_.linkedProductsLoading=!0,p.list(t,function(e,t){var a;_.linkedProductsLoading=!1,_.linkedProducts=[],e||t.data&&t.data.data&&(e=t.data.data,a=[],e.forEach(function(e){var t=JSON.parse(JSON.stringify(_.product));t.price=e.price,t.compare_price=e.compare_price,t.variant_id=e.variant_id,t.tax_rule=e.tax_rule,t.sku=e.sku,t.inventory_quantity=e.inventory_quantity,t.barcode=e.barcode,t.estimated_delivery_time=e.estimated_delivery_time,t.estimated_dispatch_time=e.estimated_dispatch_time,t._resolvedData=e._resolvedData,t.metafields||(t.metafields={}),t.selected_variant={},t.selected_options={},t.metafields.vendor=e.vendor,t.original_price=e.price,e.variant_id&&(t.selected_variant={},t.selected_variant.variant_id=e.variant_id),a.push(t)}),_.linkedProducts=a)})},t="",_.product.default_variant&&_.product.default_variant.variant_id&&(t=_.product.default_variant.variant_id),_.loadLinkedProducts(t),_.loadLinkedProductWithVariant=function(e){var t=u(_.product,_.product.selected_options);t&&_.loadLinkedProducts(t)})))})):_.error("Could not find :product in the URL params")}],allProducts:["$scope",function(e){e.settings.entity="ms.products",e.settings.filters=[{field:"publish",type:"manual",value:"1"}],e.products=[],mystore.entityController(e,"products")}],staticPage:["$scope","app","$stateParams","$rootScope","$compile",function(o,e,t,a,i){var s,n,r=(r=o.settings.alias)||t.page;r?(n=function(a){o.page=a,o.page.include_template&&"1"==o.page.include_template&&o.page.template&&(o.page.content=i(o.page.template)(o)),o.page.content="<div>"+o.page.content+"</div>",o.page.content=i(o.page.content)(o);var e=o.page.SEO||{},t=e.title&&e.title.trim()||o.page.title,s=(s=e.description)||o.page.content.text().substring(0,160),n=(e.cannonical_url||(e.cannonical_url=ms.base+"/page/"+r),[]);(ms.settings.language_based_url||a.aliases_by_lang)&&ms.settings.languages.forEach(function(e){var t=a.aliases_by_lang&&a.aliases_by_lang[e]||r;e==ms.user.language&&t!=r&&ms.goTo(ms.base+"/page/"+t),!ms.settings.language_based_url&&t==r||(t=ms.base+"/page/"+t,n.push({rel:"alternate",hreflang:e,href:t}))}),ms.updateSEO({title:t,description:s,keywords:e.keywords,canonical_url:e.canonical_url,links:n})},t={entity:"ms.pages",query:{q:{alias:s=r,publish:"1"}},version:"1",httpcache:!0,cache:!0},o.loading=!0,e.list(t,function(e,t){if(o.loading=!1,!e){if(!t.data.data||0==t.data.data.length)return o.error("Alias ["+s+"] not found"),void("staticpage"==ms.page.name&&ms.routeParams.page==s&&ms.notFound());n(t.data.data[0])}})):o.error("MS: ERROR: page alias not specified in settings or in url. Not proceeding")}],collection:["$scope","app","$stateParams","$rootScope",function(s,e,n,o){var a,i,t,r=(r=s.settings.collection)||n.collection;r?(s.products=[],i=function(e){var t,a;s.collection=e,s.collection.image=(e.images&&e.images.length&&e.images[0]&&e.images[0].image?e.images[0]:e).image,n.collection&&(t=(e=s.collection.SEO||{}).title&&e.title.trim()||s.collection.name,a=(a=e.description)||$("<div>"+s.collection.description+"</div>").text().substring(0,160),ms.updateSEO({title:t,description:a,image:s.collection.image,keywords:e.keywords,canonical_url:e.canonical_url})),s.settings.filters||(s.settings.filters=[]),"string"==typeof s.settings.filters&&(s.settings.filters=JSON.parse(s.settings.filters)),s.settings.filters.push({field:"publish",type:"manual",value:"1"}),"manual"==s.collection.type?s.settings.filters.push({field:"collections",type:"manual",value:[r],operator:"in"}):"dynamic"==s.collection.type&&s.collection.filters&&s.collection.filters.length&&s.collection.filters.forEach(function(e){var t,a;return"brand"==e.field&&"in"!==e.operator&&delete e.operator,"options"==e.field?(t={field:"variants.options.name",value:e.name,operator:"eq"},a={field:"variants.options.value",value:e.value,operator:"in"},s.settings.filters.push(t),void s.settings.filters.push(a)):"attributes"==e.field?(t={field:"attributes.name",value:e.name,operator:e.operator},a={field:"attributes.value",value:e.value,operator:e.operator},s.settings.filters.push(t),void s.settings.filters.push(a)):void s.settings.filters.push(e)}),s.collection.default_sort_order&&"manually"!=s.collection.default_sort_order&&(s.settings.sortfields=s.collection.default_sort_order),o.ms.settings&&o.ms.settings.faceted_search&&"1"==o.ms.settings.faceted_search&&"collection"==ms.page.name&&ms.routeParams.collection==r&&(s.settings.facets="true",s.settings.facetgroup=s.collection.facet_group||"default_category_facet"),s.settings.entity="ms.products",mystore.entityController(s,"products"),"collection"==ms.page.name&&n.collection&&n.collection==s.collection.alias&&(ms.collection=s.collection,ms.pageLoaded())},(t={entity:"ms.collections",query:{filters:[{field:"alias",value:a=r,operator:"equal"}]},version:"1",httpcache:!0,cache:!0}).query.filters=JSON.stringify(t.query.filters),e.list(t,function(e,t){if(!e){if(!t.data.data||0==t.data.data.length)return s.error("alias ["+a+"] not found"),void("collection"==ms.page.name&&ms.routeParams.collection==a&&ms.notFound());i(t.data.data[0])}})):s.error("MS: ERROR: collection not specified in settings or in url. Not proceeding")}],category:["$scope","app","$stateParams","$rootScope","$http","$filter",function(s,e,n,o,t,a){var i,r,d=(d=s.settings.category)||n.category;d?(s.products=[],i=d,r=function(e,t){var a;e&&404!=e.status||(e&&404===e.status||!t?"category"==ms.page.name&&ms.routeParams.category==d&&ms.notFound():(s.category=t,s.category.image=t.images&&t.images.length&&t.images[1]&&t.images[1].image?t.images[1].image:t.images&&t.images.length&&t.images[0]&&t.images[0].image?t.images[0].image:null,t.images&&t.images.length&&t.images[1]&&t.images[1].caption&&(s.category.caption=t.images[1].caption),n.category&&(t=(e=s.category.SEO||{}).title&&e.title.trim()||s.category.name,a=(a=e.description)||$("<div>"+s.category.description+"</div>").text().substring(0,160),ms.updateSEO({title:t,description:a,image:s.category.image,keywords:e.keywords,canonical_url:e.canonical_url})),s.settings.filters=[{field:"categories",type:"manual",value:[d],operator:"in"},{field:"publish",type:"manual",value:"1"}],s.category.default_sort_order&&"manually"!=s.category.default_sort_order&&(s.settings.sortfields=s.category.default_sort_order),o.ms.settings&&o.ms.settings.faceted_search&&"1"==o.ms.settings.faceted_search&&"category"==ms.page.name&&ms.routeParams.category==d&&(s.settings.facets="true",s.settings.facetgroup=s.category.facet_group||"default_category_facet"),s.settings.entity="ms.products",mystore.entityController(s,"products"),"category"==ms.page.name&&n.category&&n.category==s.category.alias&&(ms.category=s.category,ms.pageLoaded())))},i={q:{alias:d,publish:"1"}},s.loading=!0,e.call("getCategoryDetail",{version:1,type:"get",entity:"ms.categories",query:i},function(e,t){if(e)return s.loading=!1,r(e);t.data&&t.data.data?(s.loading=!1,r(null,t.data.data)):(s.loading=!1,r())})):s.error("Category not specified in settings or in url. Not proceeding")}],categoryLayout:["$scope","app","$stateParams","$rootScope","$http","$filter",function(n,e,a,o,t,s){var i,r,d=(d=n.settings.category)||a.category;d?(n.products=[],i=d,r=function(e,t){e&&404!=e.status||(e&&404===e.status||!t?("category"==ms.page.name&&ms.routeParams.category==d&&ms.notFound(),n.error("Category ["+d+"] not found")):(n.category=t,n.category.image=t.images&&t.images.length&&t.images[1]&&t.images[1].image?t.images[1].image:t.images&&t.images.length&&t.images[0]&&t.images[0].image?t.images[0].image:null,t.images&&t.images.length&&t.images[1]&&t.images[1].caption&&(n.category.caption=t.images[1].caption),a.category&&(o.ms.page.title=n.category.name,o.ms.resolveSEO(n,o.ms.page,n.category.SEO),(e=(e=n.category.SEO)||{}).title||(e.title=n.category.name),e.description||(e.description=$("<div>"+n.category.description+"</div>").text()),n.category&&n.category.image&&(e.image=s("image")(n.category.image)),o.ms.resolveOgTags(o.ms.page,e)),n.settings.filters=[{field:"categories",type:"manual",value:d},{field:"publish",type:"manual",value:"1"}],n.category.default_sort_order&&"manually"!=n.category.default_sort_order&&(n.settings.sortfields=n.category.default_sort_order),o.ms.settings&&o.ms.settings.faceted_search&&"1"==o.ms.settings.faceted_search&&(n.settings.facets="true",n.settings.facetgroup="default_category_facet"),n.settings.entity="ms.products",mystore.entityController(n,"products")))},i={q:{alias:d,publish:"1"}},n.loading=!0,e.call("getCategoryDetail",{version:1,entity:"ms.categories",query:i},function(e,t){if(e)return n.loading=!1,r(e);t.data&&t.data.data?(n.loading=!1,r(null,t.data.data)):(n.loading=!1,r())}),setTimeout(function(){var s=n.$on("$stateChangeSuccess",function(e,t,a){"category"==o.ms.page.name&&"category"==o.ms.fromPage.name&&(n.refresh(),s(),e.defaultPrevented=!0)})},2e3)):n.error("Category not specified in settings or in url. Not proceeding")}],products:["$scope",function(s){s.settings.entity="ms.products";var e,t=s.settings.grouptype,n=s.settings.groupalias;t||("category"==ms.page.name&&ms.page.params.category?n=ms.page.params.category:"collection"==ms.page.name&&ms.page.params.collection?n=ms.page.params.collection:"brand_detail"==ms.page.name&&ms.page.params.brand?n=ms.page.params.brand:"seller_detail"==ms.page.name&&ms.page.params.alias?n=ms.page.params.alias:"search"==ms.page.name&&ms.page.params.query,ms.settings&&ms.settings.faceted_search&&"1"==ms.settings.faceted_search&&(s.settings.facets="true",s.settings.facetgroup="default_category_facet")),"category"==t?(e={entity:"ms.categories",command:"list",query:{filters:[{field:"alias",value:n}]},version:"1",cache:!0},ms.app.call(e,function(e,t){e?s.error("Could not get records for "+entity):(e=t.data&&t.data.data&&t.data.data[0])?(s.record=e,s.group={name:e.name,alias:e.alias,images:e.images,url:"/browse/"+e.alias},s.settings.filters=[{field:"categories",type:"manual",value:[s.settings.groupalias],operator:"in"}],mystore.entityController(s,"products")):"category"==ms.page.name&&ms.routeParams.category==n&&ms.notFound()})):"collection"==t?(e={entity:"ms.collections",command:"list",query:{filters:[{field:"alias",value:n}]},version:"1",cache:!0},ms.app.call(e,function(e,t){var a;e?s.error("Could not get records for "+entity):(e=t.data&&t.data.data&&t.data.data[0])?(s.record=e,s.group={name:e.name,alias:e.alias,images:e.images,url:"/collection/"+e.alias},s.settings.filters=[{field:"collections",type:"manual",value:[s.settings.groupalias],operator:"in"}],"dynamic"==e.type&&e.filters&&e.filters.length&&(a=[],e.filters.forEach(function(e){"brand"==e.field&&"in"!==e.operator&&delete e.operator,"categories"==e.field&&"in"!==e.operator&&delete e.operator,a.push(e)}),a.length&&(s.settings.filters=a)),mystore.entityController(s,"products")):"collection"==ms.page.name&&ms.routeParams.collection==n&&ms.notFound()})):"brand"==t?(e={entity:"ms.brands",command:"list",query:{filters:[{field:"alias",value:n}]},version:"1",cache:!0},ms.app.call(e,function(e,t){e?s.error("Could not get records for "+entity):(e=t.data&&t.data.data&&t.data.data[0])?(s.record=e,s.group={name:e.name,alias:e.alias,images:e.images,url:"/brand/"+e.alias},s.settings.filters=[{field:"brand",type:"manual",value:e.name}],mystore.entityController(s,"products")):"brand_detail"==ms.page.name&&ms.routeParams.brand==n&&ms.notFound()})):"seller"==t?(e={entity:"ms.sellers",command:"list",query:{filters:[{field:"alias",value:n}]},version:"1",cache:!0},n.match(/^[0-9a-fA-F]{24}$/)&&(e.query.filters[0]={field:"_id",value:n}),ms.app.call(e,function(e,t){e?s.error("Could not get records for "+entity):(e=t.data&&t.data.data&&t.data.data[0])?(s.record=e,s.group={name:e.title,alias:e.alias,images:e.images,url:"/sellers/"+e.alias},s.settings.filters=[{field:"seller",type:"manual",value:e._id}],mystore.entityController(s,"products")):"seller_detail"==ms.page.name&&ms.routeParams.alias==n&&ms.notFound()})):"search"==t?(s.settings.searchText=ms.page.params.query,mystore.entityController(s,"products")):s.error("Not a valid groupType: ",t)}],reviews:["$scope",function(n){var e,t=n.settings.sortfields||"-created_on",a=n.settings.pagesize||10;"product"==ms.page.name&&((e=function(){ms.app.call({entity:"ms.reviews",command:"list",query:{q:{unique_id:n.settings.uniqueid,publish:"1"},limit:a,sort:t,resolve:{field:"user_id",child_fields:["first_name","last_name","email"]}}},function(e,t){var t=t.data&&t.data.data||t.data,a=(n.count=t.records.length,n.count1=t.total,angular.forEach(t.records,function(e){e.user=e._resolvedData.user_id}),n.reviews=t.records,n.firstReview=n.lastReview=n.reviews[0],1<n.reviews.length&&(n.lastReview=n.reviews[n.reviews.length-1]),0),s=[],t=(angular.forEach(t.records,function(e){e.rating=parseInt(e.rating),0<e.rating&&(s.push(e),a+=parseInt(e.rating))}),s.length),t=Math.round(a/t);isNaN(t)?n.average_rating="0":n.average_rating=t})})(),n.loadOld=function(){a+=10,e()})}],mmProduct:["$scope",function(e){mystore.controllers.products(e)}],brand:["$scope","app","$stateParams","$rootScope","$filter",function(s,e,n,o,t){var i,r,a=(a=s.settings.brand)||n.brand;a?(s.products=[],i=a,r=function(e){var t,a;e?(s.brand=e,s.brand.description&&(s.brand.about=s.brand.description),s.brand.image=(e.images&&e.images.length&&e.images[0]&&e.images[0].image?e.images[0]:e).image,n.brand&&(a=(e=s.brand.SEO||{}).title&&e.title.trim()||s.brand.title,t=(t=e.description)||$("<div>"+s.brand.description+"</div>").text().substring(0,160),ms.updateSEO({title:a,description:t,image:s.brand.image,keywords:e.keywords,canonical_url:e.canonical_url})),a=s.brand.name,(a=s.brand.original_name?s.brand.original_name:a)&&(s.settings.filters=[{field:"brand",type:"manual",value:a},{field:"publish",type:"manual",value:"1"}],s.brand.default_sort_order&&"manually"!=s.brand.default_sort_order&&(s.settings.sortfields=s.brand.default_sort_order),o.ms.settings&&o.ms.settings.faceted_search&&"1"==o.ms.settings.faceted_search&&"brand_detail"==ms.page.name&&ms.routeParams.brand&&(s.settings.facets="true",s.settings.facetgroup="default_category_facet",s.brand.facet_group&&(s.settings.facetgroup=s.brand.facet_group)),s.settings.entity="ms.products",mystore.entityController(s,"products"),"brand_detail"==ms.page.name&&n.brand&&n.brand==s.brand.alias&&(ms.brand=s.brand,ms.pageLoaded()))):"brand"==ms.page.name&&ms.routeParams.brand==i&&ms.notFound()},(a={entity:"ms.brands",query:{filters:[{field:"publish",value:"1",operator:"equal"},{field:"alias",value:a=a,operator:"equal"}]},version:"1",httpcache:!0,cache:!0}).query.filters=JSON.stringify(a.query.filters),s.loading=!0,e.list(a,function(e,t){s.loading=!1;var a=null;e||t&&t.data&&t.data.data&&t.data.data.length&&(a=t.data.data[0]),r(a)})):s.error("Brand not specified in settings or in url. Not proceeding")}],allCategories:["$scope","$stateParams","$rootScope","app",function(a,e,s,t){s.ms.categories?a.categories=s.ms.categories:t.list({entity:"ms.categories",query:{q:{publish:"1"}},version:"1",httpcache:!0,cache:!0},function(e,t){e?a.error("Could not get the categories"):t.data&&t.data.data&&(a.categories=t.data.data,s.ms.categories||(s.ms.categories=a.categories))})}],allBrands:["$scope","$stateParams","$rootScope",function(e,t,a){e.settings.entity="ms.brands",e.settings.filters=[{field:"publish",type:"manual",value:"1"}],mystore.entityController(e,"brands")}],allCollections:["$scope","$stateParams","$rootScope",function(e,t,a){e.settings.entity="ms.collections",mystore.entityController(e,"collections")}],navigation:["$scope","$rootScope","app",function(e,t,n){(ms._navigationsPromise||(ms._navigationsPromise=new Promise(function(t){if(ms.navigations)return t(ms.navigations);new Promise(function(a){n.list({entity:"ms.navigations",cache:!0,version:"1",httpcache:!0},function(e,t){e?(console.log("error occured in listing ms.navigation"),a([])):a(t&&t.data&&t.data.data)})}).then(function(e){new Promise(function(a){var s=[];n.list({entity:"ms.categories",query:{q:{publish:"1"}},version:"1",httpcache:!0,cache:!0},function(e,t){e?console.log("Could not get the categories"):t&&t.data&&t.data.data&&(s=t.data.data),a(s)})}).then(function(i){function r(e,t,a,s){var n,o;e.length?(n=e.shift(),o={title:n.name,url:"/browse/"+n.alias,images:n.images},n.children&&n.children.length?(o.children=[],r(n.children,o,a+1,function(){(1==a?t.links:t.children).push(o),r(e,t,a,s)})):((1==a?t.links:t.children).push(o),r(e,t,a,s))):s()}var s={},d=function(e,t,a,s){var n,o;{if(e.length)return(n=e.shift())?void("link"==n.type||"all_categories"!=n.type?((o={}).title=n.title,o.url=n.value,n.children&&n.children.length?(o.children=[],d(n.children.slice(0),o,a+1,function(){(1==a?t.links:t.children).push(o),d(e,t,a,s)})):((1==a?t.links:t.children).push(o),d(e,t,a,s))):"all_categories"==n.type?r(JSON.parse(JSON.stringify(i)),t,a,function(){d(e,t,a,s)}):s()):s();s()}},n=function(e,t){var a;e.length?(a=e.shift(),s[a.alias]={links:[]},a&&a.links&&a.links.length?d(a.links.slice(0),s[a.alias],1,function(){n(e,t)}):n(e,t)):t()};n(e,function(){ms.navigations=s,t(s)})})})}),ms._navigationsPromise)).then(function(){e.settings.alias?e.navigation=ms.navigations[e.settings.alias]:e.navigation=ms.navigations})}],entity:["$scope",function(e){mystore.entityController(e)}],productinfo:["$scope","app","$stateParams",function(a,e,t){t=t.product;if(!t)return null;e.list({entity:"ms.products",query:{q:{alias:t}},version:"1",httpcache:!0,cache:!0},function(e,t){e?a.error("Could not get the product"):((e=t.data.data)[0].description&&(t=e[0].description.split("\n"),e[0].description=t),e[0].specification&&(e[0].specification=e[0].specification.split("\n")),a.product=e[0])})}],orderHistory:["$scope","$rootScope","app","$stateParams",function(a,e,t,s){e.ms.user&&e.ms.user.isLoggedIn&&(e=e.ms.user._id,t.list({entity:"ms.orders",query:{q:{user_id:e}},version:"1"},function(e,t){e?a.error("Something went wrong"):a.orderHistory=t.data.data}))}],saveAddress:["$scope","$rootScope","app",function(n,o,e){n.loading=!0,n.selected_billing_address="",n.selected_shipping_address="",n.saved_address=[],n.string_saved_address=[];var t,i={entity:"ms.users",field:"addresses"};n.remove_address=function(s){s._id;e.del(i,function(e,t){var a;e?n.error("Something went wrong"):(a="",angular.forEach(n.saved_address,function(e,t){s._id==e._id&&(a=t)}),n.saved_address.splice(a,1),o.ms.forms.shippingform,angular.forEach(n.string_saved_address,function(e,t){s._id==e.data._id&&n.string_saved_address.splice(t,1)}))})},n.change_shipping_aadress=function(e){o.ms.cart.shipping_address=e,o.ms.forms.shippingform.fields=e,o.ms.cart.show_billing&&(o.ms.cart.billing_address=e,o.ms.forms.billingform.fields=e),o.ms.cart.update_local_storage()},n.save_address=function(a){delete a.showform;a._id;e.update(i,function(e,t){e||angular.forEach(n.saved_address,function(e,t){a._id,e._id})})},n.change_billing_aadress=function(e){o.ms.cart.billing_address=e,o.ms.forms.billingform.fields=e,o.ms.cart.update_local_storage()};o.ms.user&&o.ms.user.isLoggedIn&&!n.string_saved_address.length&&((t={entity:"ms.user_addresses",query:{filters:[{field:"user_id",value:o.ms.user._id}]},version:"1"}).query.filters=JSON.stringify(t.query.filters),e.list(i,function(e,t){var s;e?n.error("Something went wrong"):(n.loading=!1,n.saved_address=t.data.data,n.string_saved_address=(s=[],angular.forEach(n.saved_address,function(e){var t,a=[];for(t in e)"_id"!=t&&a.push(e[t]);s.push({string:a.join(" "),data:e})}),s))}))}],wishlist:["$scope","app","$rootScope","$http",function(o,i,s,e){o.loading=!0,o.products=[];var t;s.ms.user.isLoggedIn?(o.settings.user&&((t={entity:"ms.user_wishlists",query:{filters:[{field:"user_id",value:o.settings.user}]},version:"1"}).query.filters=JSON.stringify(t.query.filters),i.list(t,function(e,t){var n;!e&&(e=t&&t.data&&t.data.data&&t.data.data.length?t.data.data:[])&&e.length?(o.products=[],(n=function(a,s){var e;0!=a.length&&(e=a.shift()).product_id&&(e={entity:"ms.products",query:{filters:[{field:"_id",value:e.product_id}]},version:"1"},i.list(e,function(e,t){o.loading=!1,e||(o.products.push(t.data.data[0]),n(a,s))}))})(JSON.parse(JSON.stringify(e)))):o.loading=!1})),o.settings.list?((t={entity:"ms.user_wishlists",query:{filters:[{field:"user_id",value:s.ms.user._id},{field:"list_id",value:o.settings.list}]},version:"1"}).query.filters=JSON.stringify(t.query.filters),i.list(t,function(e,t){var n;!e&&(e=t&&t.data&&t.data.data&&t.data.data.length?t.data.data:[])&&e.length?(o.products=[],(n=function(a,s){var e;0!=a.length&&(e=a.shift()).product_id&&(e={entity:"ms.products",query:{filters:[{field:"_id",value:e.product_id}]},version:"1"},i.list(e,function(e,t){o.loading=!1,e||(o.products.push(t.data.data[0]),n(a,s))}))})(JSON.parse(JSON.stringify(e)))):o.loading=!1})):((t={entity:"ms.user_wishlists",query:{filters:[{field:"user_id",value:s.ms.user._id}]},version:"1"}).query.filters=JSON.stringify(t.query.filters),i.list(t,function(e,t){var n;e?o.loading=!1:(s.ms.user.wishlist=t&&t.data&&t.data.data&&t.data.data.length?t.data.data:[],s.ms.user.wishlist&&0<s.ms.user.wishlist.length?(o.products=[],(n=function(a,s){var e;0!=a.length&&(e=a.shift()).product_id&&(e={entity:"ms.products",query:{filters:[{field:"_id",value:e.product_id}]},version:"1"},i.list(e,function(e,t){o.loading=!1,e||(o.products.push(t.data.data[0]),n(a,s))}))})(JSON.parse(JSON.stringify(s.ms.user.wishlist)))):o.loading=!1)}),o.remove_from_wishlist=function(a,e){function t(){s.ms.user.remove_from_wishlist(a,function(){var t=[];o.products.forEach(function(e){e._id!=a&&t.push(e)}),o.products=t})}if(e)t();else{if(!confirm("Are you sure you want to delete?"))return!1;t()}},o.move_wishlist_to_cart=function(a){a.purchased_quantity=1,i.call("checkProductAvailability",{entity:"ms.carts",type:"put",data:a,version:"1"},function(e,t){e?(e.message&&alert("Cannot move the product to Cart, please recheck the availability"),s.ms.cart.remove_mask()):(s.ms.cart.add_product(a),o.remove_from_wishlist(a._id,!0))})})):o.loading=!1}],login:["$scope","$http","$rootScope","app","$compile","$element","$attrs","$timeout",function(a,e,s,t,n,o,i,r){a.widgetName="ms.form.login",a.requiredfields=["email","password"],a.message="","1"!=s.ms.settings.user_verification_required||o.find("#message").length||r(function(){var e=n('<div id="message">{{message}}</div>')(a);o.prepend(e)}),mystore.formController(a,o),a.submit=function(){var e;a.message="",a.submitValid()&&(a.submitting=!0,e={entity:"ms.users",customCommandName:"login",type:"put",version:"1",data:a.fields},t.call("login",e,function(e,t){e?(a.submitting=!1,a.$parent.$parent.$eval(i.msError),a.errors.email="Wrong Email Id or password",s.ms.showMessage("Wrong Email Id or password")):(a.submitting=!1,s.ms.user=new user(t.data.data),a.fields.remember_me&&t.data.data.token&&localStorage.setItem("token",t.data.data.token),a.fields={},a.$parent.$parent.$eval(i.msSuccess),1!=a.settings.disableclose&&"true"!=a.settings.disableclose&&$(".modal").modal("hide"),t.data.data&&t.data.data.use_temporary_password&&1==t.data.data.use_temporary_password&&$location.path("/account/changePassword"))}))}}],forgotPassword:["$scope","$http","$rootScope","app","$element","$attrs",function(s,e,n,t,a,o){s.widgetName="ms.form.forgotPassword",s.requiredfields=["email"],"1"!==ms.user.phone_verified&&"phone"===ms.settings.verification_method&&(s.requiredfields=["phone"]),mystore.formController(s,a),s.submit=function(){var e;s.requiredfields=["email"],s.submitValid()&&(s.submitting=!0,e={entity:"ms.users",type:"put",version:"1",data:s.fields},t.call("forgotPassword",e,function(e,t){s.submitting=!1,e?(s.$parent.$parent.$eval(o.msError),n.ms.showMessage("Email id does not exist")):(n.ms.showMessage("The mail has been sent to you"),s.fields={},s.$parent.$parent.$eval(o.msSuccess)),1!=s.settings.disableclose&&"true"!=s.settings.disableclose&&$(".modal").modal("hide")}))},s.sendOtp=function(){var a;s.requiredfields=["phone"],s.submitValid()&&(s.submitting=!0,a={entity:"ms.users",type:"put",version:"1",data:s.fields},t.call("forgotPasswordPhone",a,function(e,t){s.submitting=!1,e?(s.$parent.$parent.$eval(o.msError),n.ms.showMessage("Phone number does not exist")):(n.ms.showMessage("OTP has send to your phone number"),s.fields={},ms.location.search().verify=t.data.data._id,ms.location.search().phone=a.data.phone,s.$parent.$parent.$eval(ms.location.path("/user/reset_password"))),1!=s.settings.disableclose&&"true"!=s.settings.disableclose&&$(".modal").modal("hide")}))}}],resetPassword:["$scope","app","$rootScope","$location","$element","$attrs",function(s,t,n,a,e,o){s.widgetName="ms.form.resetPassword",s.requiredfields=["password","confirm_password"],mystore.formController(s,e);function i(){return""==s.fields.password||s.fields.password==s.fields.confirm_password||!(s.errors.confirm_password="Confirm password do not match")}s.submitOtp=function(){var e;s.submitValid()&&i()&&(s.submitting=!0,e={},angular.extend(e,s.fields),delete e.confirm_password,e={entity:"ms.users",type:"put",version:"1",data:e},ms.location.search().user&&(e.recordId=ms.location.search().user),t.call("resetPasswordPhone",e,function(e,t){s.submitting=!1,e?(s.$parent.$parent.$eval(o.msError),$(".modal").modal("hide"),"408"==e.status||"406"==e.status?n.ms.showMessage("Reset password request timeout"):n.ms.showMessage("Error occured in reseting the password, Please send the forgot password request again")):($(".modal").modal("hide"),n.ms.showMessage("Password reset successfully"),s.fields={},s.$parent.$parent.$eval(o.msSuccess))}))},s.verifyOtp=function(){if(!s.fields.otp)return s.errors||(s.errors={}),void(s.errors.otp="OTP Required");s.submitting=!0;var a={entity:"ms.users",type:"put",version:"1",data:{otp:s.fields.otp}};ms.location.search().verify&&(a.recordId=ms.location.search().verify),ms.location.search().phone&&(a.data.phone=ms.location.search().phone),t.call("verifyOtp",a,function(e,t){s.errors={},s.submitting=!1,e?(s.$parent.$parent.$eval(o.msError),$(".modal").modal("hide"),"408"==e.status||"406"==e.status?n.ms.showMessage("Reset password request timeout"):n.ms.showMessage("Error occured in reseting the password, Please send the forgot password request again")):(ms.location.search(""),$(".modal").modal("hide"),n.ms.showMessage("User verified successfully"),s.fields={},ms.location.search().user=a.recordId,s.$parent.$parent.$eval(ms.location.path("/user/reset_password")),s.$parent.$parent.$eval(o.msSuccess))})},s.submit=function(){if("1"!=ms.user.phone_verified&&"1"==ms.settings.user_verification_required&&"phone"==ms.settings.login_field&&"phone"===ms.settings.verification_method)return s.submitOtp();var e;s.submitValid()&&i()&&(e=a.search().key)&&(e=e.split("$"),s.fields.verified_text=e[0],s.fields.verified_time=e[1],s.fields.verified_text&&s.fields.verified_time?(s.submitting=!0,e={},angular.extend(e,s.fields),delete e.confirm_password,t.call("resetPassword",{entity:"ms.users",type:"put",version:"1",data:e},function(e,t){s.submitting=!1,e?(s.$parent.$parent.$eval(o.msError),$(".modal").modal("hide"),"408"==e.status?n.ms.showMessage("Reset password request timeout"):n.ms.showMessage("Error occured in reseting the password, Please send the forgot password request again")):($(".modal").modal("hide"),n.ms.showMessage("Password reset successfully"),s.fields={},s.$parent.$parent.$eval(o.msSuccess))})):alert("Invaild reset password url"))}}],changePassword:["$scope","app","$rootScope","$location","$element","$attrs",function(a,t,s,n,e,o){a.widgetName="ms.form.changePassword",a.requiredfields=["current_password","new_password","confirm_password"],mystore.formController(a,e);a.submit=function(){var e;a.submitValid()&&!(""!=a.fields.new_password&&a.fields.new_password!=a.fields.confirm_password?a.errors.confirm_password="Confirm password do not match":a.fields.new_password==a.fields.current_password&&(a.errors.confirm_password="Password should not be same as old password"))&&(a.submitting=!0,a.loading=!0,e={},angular.extend(e,a.fields),delete e.confirm_password,t.call("changePassword",{entity:"ms.users",type:"put",version:"1",data:e},function(e,t){a.submitting=!1,a.loading=!1,e?(e=(e.data&&e.data.data?e.data:e).data,a.errors.current_password=e,s.ms.showMessage(e),a.submitting=!1,a.$parent.$parent.$eval(o.msError)):($(".modal").modal("hide"),s.ms.showMessage("Password has been changed successfully"),a.fields={},a.$parent.$parent.$eval(o.msSuccess),s._blockFlag=!1,a.ms.user.use_temporary_password=!1,n.path("/account/profile"))}))}}],register:["$scope","$http","$rootScope","$compile","$element","$attrs","$timeout","app",function(s,e,n,t,a,o,i,r){s.widgetName="ms.form.register",s.requiredfields=["email","password","confirm_password"],mystore.formController(s,a),"1"!=n.ms.settings.user_verification_required||a.find("#message").length||i(function(){var e=t('<div id="message">{{message}}</div>')(s);a.prepend(e)});s.submit=function(){var e;s.message="",s.submitValid()&&(""!=s.fields.password&&s.fields.password!=s.fields.confirm_password?s.errors.confirm_password="Confirm password do not match":(e={},angular.extend(e,s.fields),delete e.confirm_password,s.submitting=!0,r.call("register",{entity:"ms.users",data:e,version:"1"},function(e,t){var a;s.submitting=!1,t&&t.data&&t.data.data?(a=t.data.data,"1"==n.ms.settings.user_verification_required?(s.message="User account is created successfully. An activation link has been sent to your email.",n.ms.showMessage("User account is created successfully. An activation link has been sent to your email.")):(n.ms.broadcast("ms.entity.users.login",{entity:"ms.users",level:"success",data:a}),n.ms.showMessage("Register successfully"),n.ms.user=new user(a)),1!=s.settings.disableclose&&"true"!=s.settings.disableclose&&$(".modal").modal("hide"),s.reset(),s.$parent.$parent.$eval(o.msSuccess)):(t=e.status,a=e.data,s.err=a,s.$parent.$parent.$eval(o.msError),"409"==t?(s.errors.email="Email id already exist",n.ms.showMessage("Email id already exist")):"412"==t?(s.errors.email="EmailId Does Not Match  Corporate Domains",n.ms.showMessage("EmailId Does Not Match  Corporate Domains")):"1"==n.ms.settings.user_verification_required&&"401"==t?(s.message="User already registered but has not activated the account.An activation link has been sent to your email.",n.ms.showMessage("User already registered but has not activated the account.An activation link has been sent to your email.")):n.ms.showMessage("Error ocurred in Registration"))})))}}],verifyUserAccount:["$scope","app","$rootScope","$stateParams","$location",function(e,t,a,s,n){s={entity:"ms.users",customCommandName:"",version:"1",type:"put",data:{_id:s.id}};t.call("verification",s,function(e,t){})}],billingForm:["$scope","$rootScope","$location","$element","$attrs",function(e,t,a,s,n){e.widgetName="ms.form.billingAddress",e.requiredfields=["full_name","address","country","state","city","zip","phone"],mystore.formController(e,s),t.ms.cart.billing_address&&(e.fields=t.ms.cart.billing_address),(t.ms.forms.billingform=e).submit=function(){if(e.submitValid())return function(){e.$parent.$parent.$eval(n.msSuccess)}}}],shippingForm:["$scope","$rootScope","$location","$element","$attrs",function(e,t,a,s,n){e.widgetName="ms.form.shippingAddress",e.requiredfields=["full_name","address","city","state","country","zip","phone"],mystore.formController(e,s),t.ms.cart.shipping_address&&(e.fields=angular.copy(t.ms.cart.shipping_address)),(t.ms.forms.shippingform=e).submit=function(){if(e.submitValid())return function(){e.$parent.$parent.$eval(n.msSuccess)}}}],guestUser:["$scope","$rootScope","$location","$element","$attrs",function(e,t,a,s,n){e.widgetName="ms.form.guestUser",e.requiredfields=["email"],mystore.formController(e,s),t.ms.cart&&t.ms.cart.email_id&&(e.fields.email=t.ms.cart.email_id),e.submit=function(){e.submitValid()?(t.ms.cart.email_id=e.fields.email,t.ms.cart.guestUser=!0,e.$parent.$parent.$eval(n.msSuccess)):e.$parent.$parent.$eval(n.msError)}}],paymentGatewayForm:["$scope",function(t){t.logo_url=ms.location.protocol()+":"+ms_store.baseUrl+"/"+ms.settings.logo;var e=ms.cart.payment_method&&ms.cart.payment_method.settings&&ms.cart.payment_method.settings.form_name;ms.getForm(e).then(function(e){t.form=new ms.formBuilder({name:"params.formName",scope:t,submitBtnLabel:ms.filters.translate("Confirm Order"),data:{},fields:e.fields,submit:function(t){return new Promise(function(a){t.data._id=ms.cart._id;var e={entity:"ms.carts",command:"saveUserInput",query:t.data};ms.app.call(e,function(e,t){e?console.log("Cannot retrieve data!"):(ms.cart.userInput=t.data.userInput,ms.cart.updateCart(ms.cart),ms.cart.placeOrder()),a()})})}})})}],banner:["$scope",function(i){(msi._bannerPromise||(msi._bannerPromise=new Promise(function(a){if(msi._banners)return a(msi._banners);var e={entity:"ms.banners",version:"1",httpcache:!0,cache:!0};window._designtheme&&(delete e.httpcache,delete e.cache),ms.app.list(e,function(e,t){e?console.log("error occurred in list command in banners"):(msi._banners=t.data.data,a(msi._banners))})}),msi._bannerPromise)).then(function(e){e&&e.length&&e.forEach(function(t){var e,a,s,n=!0;if((n=(n=(n=t.name!=i.settings.name?!1:n)&&"1"!=t.publish?!1:n)&&t.languages&&t.languages.length&&-1==t.languages.indexOf(ms.user.language)?!1:n)&&t.devices&&t.devices.length&&(ms.device.isMobile&&-1==t.devices.indexOf("phone")&&(n=!1),ms.device.isMobile||-1!=t.devices.indexOf("desktop")||(n=!1)),n&&t.start_time&&t.end_time&&(e=new Date(t.start_time).getTime(),a=new Date(t.end_time).getTime(),((s=parseInt(window.serverTimestamp))<e||a<s)&&(n=!1)),n&&t.user_groups&&t.user_groups.length){if(!ms.user.customer_groups||!ms.user.customer_groups.length)return void(n=!1);var o=!1;ms.user.customer_groups.forEach(function(e){-1!=t.user_groups.indexOf(e)&&(o=!0)}),o||(n=!1)}n&&(i.banner=t,ms._applyScope())})})}],enquiryForm:["$scope","$rootScope","$location","$element","app","$attrs",function(a,s,e,t,n,o){a.widgetName="ms.form.enquiry",a.requiredfields=["name","email","message"],mystore.formController(a,t),a.submit=function(){var e;a.submitValid()&&(a.submitting=!0,e={entity:"ms.enquiries",customCommandName:"",version:"1",data:a.fields},n.call("sendEnquiry",e,function(e,t){a.submitting=!1,e||(s.ms.broadcast("ms.entity.enquiries.sendEnquiry",{entity:"ms.enquiries",level:"success",data:t.data}),a.fields={})}))}}],entityForm:["$scope","$rootScope","$location","$element","app","$attrs",function(a,e,t,s,n,o){a.widgetName="ms.form.entity",a.button="Submit",a.settings&&a.settings.entity?(a.settings&&a.settings.button&&(a.button=a.settings.button),n.struct({entity:a.settings.entity},function(e,t){e||(a.struct=t.data,a.allFields=[],a.requiredfields=[],angular.forEach(t.data.fields,function(e){a.allFields.push(e.name),e.settings&&"1"==e.settings.required&&a.requiredfields.push(e.name),e.settings&&e.settings.edit_type&&(e.settings.display_type=e.settings.edit_type)}),a.formFields=a.struct.fields)}),mystore.formController(a,s),a.submit=function(){if(a.submitValid()){var t;if(a.extraFields=[],angular.forEach(a.fields,function(e,t){-1==a.allFields.indexOf(t)&&a.extraFields.push(t)}),a.extraFields&&0<a.extraFields.length)return t="",angular.forEach(a.extraFields,function(e){t=t+e+", "}),void alert("Extra fields exist : "+t);a.submitting=!0;var e={entity:a.settings.entity,data:a.fields,version:"1"};n.add(e,function(e,t){e?(a.$parent.$parent.$eval(o.msError),a.submitting=!1):(a.submitting=!1,a.recordId=t.data,a.reset(),a.$parent.$parent.$eval(o.msSuccess))})}}):alert("Error : Entity name not specified for ms.form.entity widgets")}],slides3:["$scope","app","msCache",function(a,e,t){a.sliderId="slides"+Math.floor(9e4*Math.random())+1e4,a.slides=[],a.next=function(){$("#"+a.settings.id).carousel("next")},a.prev=function(){$("#"+a.settings.id).carousel("prev")},a.settings.interval=a.settings.interval||5e3;var s="",s={entity:"ms.slides",version:"1",query:{sort:s=a.settings.sortfields?a.settings.sortfields:s}};e.list(s,function(e,t){var i;e||(i=[],angular.forEach(t.data.data,function(t){var e,a,s,n=!0;if((n=(n=n&&"1"!=t.publish?!1:n)&&t.languages&&t.languages.length&&-1==t.languages.indexOf(ms.user.language)?!1:n)&&t.devices&&t.devices.length&&(ms.device.isMobile&&-1==t.devices.indexOf("phone")&&(n=!1),ms.device.isMobile||-1!=t.devices.indexOf("desktop")||(n=!1)),n&&t.start_time&&t.end_time&&(e=new Date(t.start_time).getTime(),a=new Date(t.end_time).getTime(),((s=parseInt(window.serverTimestamp))<e||a<s)&&(n=!1)),n&&t.user_groups&&t.user_groups.length){if(!ms.user.customer_groups||!ms.user.customer_groups.length)return void(n=!1);var o=!1;ms.user.customer_groups.forEach(function(e){-1!=t.user_groups.indexOf(e)&&(o=!0)}),o||(n=!1)}n&&i.push(t)}),e=i,a.settings&&a.settings.tag&&""!=a.settings.tag?angular.forEach(e,function(e){e.tags&&-1!=e.tags.indexOf(a.settings.tag)&&a.slides.push(e)}):a.slides=e,$.prototype.carousel&&$(".carousel").carousel({interval:a.settings.interval}))})}],static:function(){},editdetail:["$scope","$rootScope","app",function(a,n,o){o.struct({entity:"ms.users"},function(e,t){e||(a.entityStruct=t.data)}),o.get({entity:"ms.users",version:"1",recordId:n.ms.user._id},function(e,t){e||(a.record=t.data.data)}),a.update=function(e,s){var t={entity:"ms.users",recordId:s._id,version:"1",data:s};o.update(t,function(e,t){if(!e)for(var a in s)n.ms.user[a]=s[a]})}}],searchform:["$scope","$stateParams","$element","$location","$rootScope",function(s,e,t,a,n){s.fields={},s.widgetName="ms.form.search",s.requiredfields=["search"],mystore.formController(s,t),n.$on("$stateChangeStart",function(e,t,a){t.url&&0<=t.url.indexOf("search")?s.fields.search=a.query:s.fields.search=""}),s.submit=function(){var e;s.submitValid()&&(e={},s.fields.category&&(e.category=s.fields.category),s.fields.brand&&(e.brand=s.fields.brand),s.fields.collection&&(e.collection=s.fields.collection),a.path("/search/"+s.fields.search).search(e))}}],search:["$scope","app","$stateParams","$location","$rootScope",function(o,i,t,a,e){o.$on("$locationChangeSuccess",function(e,t){o.path==a.path()&&s()}),o.path=a.path();var s=function(){var e,s,n=t.query;o.loading=!1,o.searchText=n,o.products=[],o.start=0,o.pagesize=10,o.settings.pagesize&&""!=o.settings.pagesize&&(o.pagesize=parseInt(o.settings.pagesize)),o.settings.filters||(o.settings.filters=[]),a.search().category&&(e={field:"categories",type:"manual",value:a.search().category},o.settings.filters.push(e)),o.settings.filters.push({field:"publish",type:"manual",value:"1"}),o.settings.sortfields=ms.location.search().sortfield,n&&(o.settings.searchtext=n,!o.settings.facets&&ms.settings.faceted_search&&"1"==ms.settings.faceted_search&&(o.settings.facets="true",o.settings.facetgroup="default_category_facet"),o.settings.entity||(o.settings.entity="ms.products"),mystore.entityController(o,"products"),s=[],o.$watch("totalRecords",function(e,t){var a;-1<s.indexOf(n)||void 0===o.totalRecords||(s.push(n),a={entity:"ms.search_queries",data:{query:n,total_results:o.totalRecords}},i.add(a,function(e,t){}))}))};s()}],checkout:["$scope","app","$location","$stateParams","$rootScope","$q","$http",function(n,o,e,t,i,a,s){function r(){var e;i.ms.settings.payment_methods&&i.ms.settings.payment_methods.length?i.ms.settings.payment_methods&&1==i.ms.settings.payment_methods.length?"payment_gateways"==(e=i.ms.settings.payment_methods[0]).type?(e.settings.gateways&&1==e.settings.gateways.length?(n.show_payment_step=!1,$("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),n.step=5):e.settings.gateways&&1<e.settings.gateways.length?(n.show_payment_step=!0,n.step=4):i.ms.broadcast("ms.msg.no_payment_methods",{level:"error",message:"No payment method is enabled on store  can't proceed"}),n.change_payment_method(i.ms.settings.payment_methods[0])):"cash_on_delivery"==e.type?(n.show_payment_step=!0,n.step=4):(n.change_payment_method(i.ms.settings.payment_methods[0]),n.show_payment_step=!1,$("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),n.step=5):n.change_payment_method(i.ms.settings.payment_methods[0]):i.ms.broadcast("ms.msg.no_payment_methods",{level:"error",message:"No payment method is enabled on store  can't proceed"})}var d,l=i.ms.cart;n.step=1,n.show_payment_step=!0,n.not_allowed_to_pay=!0;n.goto_step=function(e){if(e<n.step||n.step+1==e||1==e){var t;if(1==e&&(l.isUserLoggedIn()?n.goto_step(2):n.step=1),2==e&&(l.add_mask(),t={entity:"ms.carts",recordId:l._id,version:"1",data:{email_id:l.email_id,user_id:l.user_id}},o.update(t,function(e,t){e||(l.isUserLoggedIn()&&(l.shipping_address={},i.ms.forms.shippingform&&(e=i.ms.forms.shippingform.fields.country||(i.ms.settings.served_countries&&i.ms.settings.served_countries.length?i.ms.settings.served_countries[0]:"IN"),i.ms.forms.shippingform.fields={country:e})),l.update_local_storage(),n.step=2),l.remove_mask()})),3==e&&(t=i.ms.forms.shippingform,i.ms.forms.billingform,d=t.submitValid(),s=d,"IN"!=(a=t).fields.country&&"INDIA"!=a.fields.country||((isNaN(a.fields.zip)||"string"==typeof a.fields.zip&&6!=a.fields.zip.length)&&(s=!(a.errors.zip="Please enter six digit valid zip code")),!isNaN(a.fields.phone)&&10==a.fields.phone.length||(s=!(a.errors.phone="Please enter 10 digit valid phone number"))),s&&n.update_shipping_address(t.fields)),4==e){if(!l.shipping_method)return void alert("Please Select shipping method ");r(),n.step=4}5==e&&(n.step=5,$("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),l.remove_mask())}var a,s},n.change_payment_gateway=function(){l.add_mask();var e={entity:"ms.carts",customCommandName:"",type:"put",version:"1",data:{method:l.payment_method,shipping_address:l.shipping_address},query:{q:{_id:l._id}}};o.call("updatePaymentMethod",e,function(e,t){e||l.update_cart(t.data.data.cart),l.remove_mask()})},self.applyWalletDiscount=function(e,t){e&&t&&self._id&&(self.addMask(),e={entity:"ms.carts",type:"put",version:"1",data:{wallet:e,amount:t},query:{q:{_id:self._id}}},o.call("applyWalletDiscount",e,function(e,t){self.removeMask(),e||self.updateCart(t.data.data.cart),self.locked=!1}))},self.removeWalletDiscount=function(e){e&&self._id&&(self.addMask(),e={entity:"ms.carts",type:"put",version:"1",data:{wallet:e},query:{q:{_id:self._id}}},o.call("removeWalletDiscount",e,function(e,t){self.removeMask(),e||self.updateCart(t.data.data.cart),self.locked=!1}))},n.update_shipping_address=function(e){function a(){l.find_shipping_methods(l.shipping_address).then(function(e){e=l.available_shipping_methods=e;{var t;e&&1==e.length?(t=e[0],l.set_shipping_charges({_id:t._id,name:t.name,price:t.price}).then(function(){r(),n.step=4},function(){})):e&&1<e.length&&(l.available_shipping_methods=e,l.remove_mask(),n.step=3)}},function(){})}l.add_mask(),l.shipping_address=e,l.billing_address=l.shipping_address,l.update_local_storage();e={entity:"ms.carts",recordId:l._id,version:"1",data:{billing_address:l.shipping_address,shipping_address:l.shipping_address}};o.update(e,function(e,t){e?l.remove_mask():!l.isUserLoggedIn()||l.user_id!=i.ms.user._id||l.shipping_address._id?a():((e=JSON.parse(JSON.stringify(l.shipping_address))).user_id=i.ms.user._id,o.add({entity:"ms.user_addresses",data:e,version:"1"},function(e,t){e||cb&&a()}))})},n.change_payment_method=function(e){var t;e&&l._id&&(l.add_mask(),t=function(){var e={entity:"ms.carts",customCommandName:"",type:"put",version:"1",data:{method:l.payment_method,shipping_address:l.shipping_address},query:{q:{_id:l._id}}};o.call("updatePaymentMethod",e,function(e,t){e?l.payment_method={}:l.update_cart(t.data.data.cart),l.remove_mask()})},l.payment_method={name:e.name,type:e.type,settings:e.settings},e.additional_charges&&(l.payment_method.additional_charges=e.additional_charges),"payment_gateways"==l.payment_method.type?(e.settings.gateways.length?l.payment_method.settings.gateway=e.settings.gateways[0].gateway:l.payment_method.settings.gateway="dummyPayu",t()):"offline"!=l.payment_method.type&&"cash_on_delivery"!=l.payment_method.type||(e.settings.validate||(l.payment_method.settings.validate=!1),t()))},n.change_shipping_method=function(e){l.set_shipping_charges(e)},n.create_order=function(){if(!l.payment_method.type||-1==["cash_on_delivery","offline","payment_gateways"].indexOf(l.payment_method.type))return i.ms.broadcast("ms.msg.empty_payment_details",{level:"warning"});l.add_mask();var e={entity:"ms.carts",customCommandName:"",type:"put",version:"1",data:{},query:{q:{_id:l._id}}};o.call("createOrder",e,function(e,t){e?l.remove_mask():"form"==(e=t.data.data.gatewayInfo).type&&(l.order_id=e.order_id,l.update_local_storage(),"GET"==e.action||"REDIRECT"==e.action?get_to_url(e.url,e.data,"GET"):"POST"==e.action&&post_to_url(e.url,e.data,"POST"))})},n.fast_order=function(e){e={entity:"ms.carts",recordId:l._id,version:"1",data:{email_id:e.email_id,user_id:e.user_id,shipping_address:e.shipping_address,billing_address:e.shipping_address,payment_method:e.payment_method}};o.update(e,function(e,t){e?l.remove_mask():n.confirm_order()})},n.$watch("ms.user",function(e,t){e!=t&&(i.ms.user&&i.ms.user.isLoggedIn?n.step=2:n.step=1)}),n.goto_step(1)}],socialLogin:["$scope","$location","$rootScope","$element",function(m,u,p,e){e.bind("click",function(){$(".modal").modal("hide");var e="",t="";if(m.settings&&m.settings.role&&(e=m.settings.role),t=m.settings&&m.settings.provider?m.settings.provider:t){m.show=!1;var a=u.$$absUrl,s=(window.ms.preurl&&"^"!=window.ms.preurl&&(a=ms.location.protocol()+"://"+ms.location.host()+window.ms.preurl),!1),n=[];if((n=p.ms.settings&&p.ms.settings.ms&&p.ms.settings.ms.login_providers?p.ms.settings.ms.login_providers:n)&&0<n.length)for(var o=0,i=n.length;o<i;o++)if(n[o].name==t){m.show=!0,"1"==n[o].global&&n[o].active&&"1"==n[o].active&&(s=!0);break}(-1<a.indexOf("storehippo")||-1<a.indexOf("devhippo")||-1<a.indexOf("betahippo"))&&(s=!1);var r,d,l,c=findUserAgent(p);"APP"==c?(d="",d=s?"http://"+ms_store.name+".storehippo.com/auth/"+t+"?oldUrl="+a:"http://"+ms_store.global_domain+"/auth/"+t+"?oldUrl="+a,d+="&mobileApp=true",e&&(d+="&role="+e),p.ms.cordova?p.ms.cordova.InAppBrowser.open(d,"_blank","location=no,toolbar=no",{handler:"function (parameters) {parameters.windowReference.executeScript({code: \"localStorage.getItem( 'user' )\"},        function (values) {                        var name = values[0];            if (name) {\t\t\t\tname = JSON.parse(name);\t\t\t\tparameters.mystore.updateSession(name.user);                parameters.windowReference.close();            }        }    );}"}):((r=cordova.InAppBrowser.open(d,"_blank")).addEventListener("loadstart",function(e){e.url}),r.addEventListener("loadstop",function(e){-1<e.url.indexOf("/auth/"+t+"/callback")&&(mystore.afterLogin(),r.close())}))):(l=s?(d="storehippo",-1!=(l=u.host()).indexOf("devhippo")?d="devhippo":-1!=l.indexOf("betahippo")&&(d="betahippo"),"http://"+ms_store.name+"."+d+".com/auth/"+t+"?oldUrl="+a):"/auth/"+t+"?oldUrl="+a,e&&(l+="&role="+e),"MOBILE"===c?window.location.href=l:((d=PopupCenter("","Login",500,500)).document.body.innerHTML="<h2 style='text-align: center;margin-top: 15%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:35%;right:35%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>",d.location.href=l))}})}],facebookLogin:["$scope","$location","$rootScope","$element",function(i,r,d,e){e.bind("click",function(){$(".modal").modal("hide");var e,t,a="",s=(i.settings&&i.settings.role&&(a=i.settings.role),i.show=!1,r.$$absUrl),n=(window.ms.preurl&&"^"!=window.ms.preurl&&(s=ms.location.protocol()+"://"+ms.location.host()+window.ms.preurl),!1),o=[],o=((o=d.ms.settings&&d.ms.settings.ms&&d.ms.settings.ms.login_providers?d.ms.settings.ms.login_providers:o)&&0<o.length&&o.forEach(function(e){"facebook"==e.name&&(i.show=!0,"1"==e.global&&e.active&&"1"==e.active&&(n=!0))}),(-1<s.indexOf("storehippo")||-1<s.indexOf("devhippo")||-1<s.indexOf("betahippo"))&&(n=!1),findUserAgent(d));"APP"==o?window.ms.cordova.socialLogin("facebook"):n?(e="storehippo",-1!=(t=r.host()).indexOf("devhippo")?e="devhippo":-1!=t.indexOf("betahippo")&&(e="betahippo"),t="http://"+ms_store.name+"."+e+".com/auth/facebook?oldUrl="+s,a&&(t+="&role="+a),ms.user.store&&(t+="&substore="+ms.user.store),ms.user.language&&(t+="&language="+ms.user.language),(e=PopupCenter("","facebook",500,500)).document.body.innerHTML="<h2 style='text-align: center;margin-top: 15%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:35%;right:35%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>",e.location.href=t):(t=((e=PopupCenter("","facebook",500,500)).document.body.innerHTML="MOBILE"===o?"<h2 style='text-align: center;margin-top: 20%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:30%;right:40%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>":"<h2 style='text-align: center;margin-top: 15%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:35%;right:35%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>","/auth/facebook?oldUrl="+s),a&&(t+="&role="+a),ms.user.store&&(t+="&substore="+ms.user.store),ms.user.language&&(t+="&language="+ms.user.language),e.location.href=t)})}],googleLogin:["$scope","$location","$rootScope","$element",function(o,i,r,e){e.bind("click",function(){$(".modal").modal("hide"),o.show=!1;var t,e="",a=(o.settings&&o.settings.role&&(e=o.settings.role),i.$$absUrl),s=(window.ms.preurl&&"^"!=window.ms.preurl&&(a=ms.location.protocol()+"://"+window.location.host+window.ms.preurl),!1),n=[];(n=r.ms.settings&&r.ms.settings.ms&&r.ms.settings.ms.login_providers?r.ms.settings.ms.login_providers:n)&&0<n.length&&n.forEach(function(e){"google"==e.name&&(o.show=!0,"1"==e.global&&(s=!0))}),(-1<a.indexOf("storehippo")||-1<a.indexOf("devhippo")||-1<a.indexOf("betahippo"))&&(s=!1),"APP"==findUserAgent(r)?(n="",n=s?"http://"+ms_store.name+".storehippo.com/auth/google?oldUrl="+a:"http://"+ms_store.global_domain+"/auth/google?oldUrl="+a,n+="&mobileApp=true",e&&(n+="&role="+e),ms.user.store&&(n+="&substore="+ms.user.store),ms.user.language&&(n+="&language="+ms.user.language),r.ms.cordova?r.ms.cordova.InAppBrowser.open(n,"_blank","location=no,toolbar=no",{handler:"function (parameters) {    parameters.windowReference.executeScript(        {            code: \"localStorage.getItem( 'user' )\"        },        function (values) {                        var name = values[0];            if (name) {\t\t\t\tname = JSON.parse(name);\t\t\t\tparameters.mystore.updateSession(name.user);                parameters.windowReference.close();            }        }    );}"}):((t=cordova.InAppBrowser.open(n,"_blank")).addEventListener("loadstart",function(e){e.url}),t.addEventListener("loadstop",function(e){-1<e.url.indexOf("?code=")&&(mystore.afterLogin(),t.close())}))):(n=s?"http://"+ms_store.name+".storehippo.com/auth/google?oldUrl="+a:"/auth/google?oldUrl="+a,e&&(n+="&role="+e),ms.user.store&&(n+="&substore="+ms.user.store),ms.user.language&&(n+="&language="+ms.user.language),(a=PopupCenter("","google",500,500)).document.body.innerHTML="<h2 style='text-align: center;margin-top: 15%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:35%;right:35%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>",a.location.href=n)})}],linkedinLogin:["$scope","$location","$rootScope","$element",function(o,i,r,e){e.bind("click",function(){$(".modal").modal("hide");var t,e="",a=(o.settings&&o.settings.role&&(e=o.settings.role),o.show=!1,i.$$absUrl),s=(window.ms.preurl&&"^"!=window.ms.preurl&&(a=ms.location.protocol()+"://"+ms.location.host()+window.ms.preurl),!1),n=[];(n=r.ms.settings&&r.ms.settings.ms&&r.ms.settings.ms.login_providers?r.ms.settings.ms.login_providers:n)&&0<n.length&&n.forEach(function(e){"linkedin"==e.name&&(o.show=!0,"1"==e.global&&(s=!0))}),(-1<a.indexOf("storehippo")||-1<a.indexOf("devhippo")||-1<a.indexOf("betahippo"))&&(s=!1),"APP"==findUserAgent(r)?(n="",n=s?"http://"+ms_store.name+".storehippo.com/auth/linkedin?oldUrl="+a:"http://"+ms_store.global_domain+"/auth/linkedin?oldUrl="+a,n+="&mobileApp=true",e&&(n+="&role="+e),ms.user.store&&(n+="&substore="+ms.user.store),ms.user.language&&(n+="&language="+ms.user.language),r.ms.cordova?r.ms.cordova.InAppBrowser.open(n,"_blank","location=no,toolbar=no",{handler:"function (parameters) {    parameters.windowReference.executeScript(        {            code: \"localStorage.getItem( 'user' )\"        },        function (values) {                        var name = values[0];            if (name) {\t\t\t\tname = JSON.parse(name);\t\t\t\tparameters.mystore.updateSession(name.user);                parameters.windowReference.close();            }        }    );}"}):((t=cordova.InAppBrowser.open(n,"_blank")).addEventListener("loadstart",function(e){e.url}),t.addEventListener("loadstop",function(e){-1<e.url.indexOf("/auth/linkedin/callback")&&(mystore.afterLogin(),t.close())}))):(n=s?"http://"+ms_store.name+".storehippo.com/auth/linkedin?oldUrl="+a:"/auth/linkedin?oldUrl="+a,e&&(n+="&role="+e),ms.user.store&&(n+="&substore="+ms.user.store),ms.user.language&&(n+="&language="+ms.user.language),(a=PopupCenter("","linkedin",500,500)).document.body.innerHTML="<h2 style='text-align: center;margin-top: 15%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:35%;right:35%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>",a.location.href=n)})}],openidconnectLogin:["$scope","$location","$rootScope","$element",function(o,i,r,e){e.bind("click",function(){$(".modal").modal("hide");var t,e="",a=(o.settings&&o.settings.role&&(e=o.settings.role),o.show=!1,i.$$absUrl),s=(window.ms.preurl&&"^"!=window.ms.preurl&&(a=ms.location.protocol()+"://"+ms.location.host()+window.ms.preurl),!1),n=[];(n=r.ms.settings&&r.ms.settings.ms&&r.ms.settings.ms.login_providers?r.ms.settings.ms.login_providers:n)&&0<n.length&&n.forEach(function(e){"openidconnect"==e.name&&(o.show=!0,"1"==e.global&&(s=!0))}),(-1<a.indexOf("storehippo")||-1<a.indexOf("devhippo")||-1<a.indexOf("betahippo"))&&(s=!1),"APP"==findUserAgent(r)?(n="",n=s?"http://"+ms_store.name+".storehippo.com/auth/openidconnect?oldUrl="+a:"http://"+ms_store.global_domain+"/auth/openidconnect?oldUrl="+a,n+="&mobileApp=true",e&&(n+="&role="+e),ms.user.store&&(n+="&substore="+ms.user.store),ms.user.language&&(n+="&language="+ms.user.language),r.ms.cordova?r.ms.cordova.InAppBrowser.open(n,"_blank","location=no,toolbar=no",{handler:"function (parameters) {    parameters.windowReference.executeScript(        {            code: \"localStorage.getItem( 'user' )\"        },        function (values) {                        var name = values[0];            if (name) {\t\t\t\tname = JSON.parse(name);\t\t\t\tparameters.mystore.updateSession(name.user);                parameters.windowReference.close();            }        }    );}"}):((t=cordova.InAppBrowser.open(n,"_blank")).addEventListener("loadstart",function(e){e.url}),t.addEventListener("loadstop",function(e){-1<e.url.indexOf("/auth/openidconnect/callback")&&(mystore.afterLogin(),t.close())}))):(n=s?"http://"+ms_store.name+".storehippo.com/auth/openidconnect?oldUrl="+a:"/auth/openidconnect?oldUrl="+a,e&&(n+="&role="+e),ms.user.store&&(n+="&substore="+ms.user.store),ms.user.language&&(n+="&language="+ms.user.language),(a=PopupCenter("","openidconnect",500,500)).document.body.innerHTML="<h2 style='text-align: center;margin-top: 15%'>Please Wait</h2><div class='loader'></div><style>.loader {position:absolute;top:35%;right:35%; border: 16px solid #f3f3f3; /* Light grey */border-top: 16px solid #3498db; /* Blue */border-radius: 50%;width: 120px;height: 120px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}</style>",a.location.href=n)})}],facebookSharing:["$scope","$location","$element",function(t,e,a){window.fbAsyncInit=function(){FB.init({appId:"584378301624989",channelUrl:"http://mystore.mystore.in/",status:!0,xfbml:!0})};require(["//connect.facebook.net/en_US/all.js"],function(){});var s=e.absUrl();t.settings.url&&(s=t.settings.url),t.share=function(){FB.ui({method:"feed",name:t.settings.name,caption:t.settings.caption,description:t.settings.description,link:s,picture:t.settings.image},function(e){e&&e.post_id})},a.bind("click",function(){FB.getLoginStatus(function(e){"connected"===e.status?t.share():"not_authorized"===e.status?alert("You are not authorized, please logout and share again"):FB.login(function(e){e.authResponse?t.share():alert("please login first")})})})}],twitterSharing:["$scope","$location","$element",function(t,a,e){e.bind("click",function(){var e="https://twitter.com/intent/tweet?text="+t.settings.content+"&url="+a.absUrl();window.open(e,"twitter","height=350,width=400")})}],userOrders:["$scope","$rootScope","app","$stateParams",function(e,t,a,s){t.ms.cart.isUserLoggedIn()?(e.settings.entity="ms.orders",e.settings.filters=[{field:"user_id",value:t.ms.user._id}],e.settings.pagesize||(e.settings.pagesize=50),mystore.entityController(e,"orders")):console.log("user is not logged, Please login first")}],postVerification:function(){var e=ms.trigger("ms.user_verified");ms.user.isLoggedIn&&ms.trigger("ms.user_login"),e&&e.defaultPrevented||(ms.user.isLoggedIn?ms.goTo("/"):ms.goTo("/user/login"))},processOrder:["$scope","$location","$rootScope","app","$stateParams",function(e,n,o,i,t){function r(){ms.broadcast("ms.msg.payment_failed",{level:"warning"}),ms.trigger("ms.order_failed"),n.path("/cart").replace()}var d,a,l=n.search(),c=o.ms.cart,s=window.mystore.storage();"true"==localStorage.getItem("isApp")?s.setItem("order",JSON.stringify(t)):"success"==t.status?(s={entity:"ms.orders",recordId:d=t.id,version:"1",query:{getOriginalOrder:!0}},a=function(e){"1"==l.partialpayment&&e.query&&e.query.getOriginalOrder&&delete e.query.getOriginalOrder,i.get(e,function(e,t){var a,s;!e&&t.data&&t.data.data?(o.ms.cart.emptyCart(),o.ms.user._id&&(e={entity:"ms.carts",type:"put",version:"1",data:{user_id:o.ms.user._id}},c.locked=!0,c.addMask(),i.call("getUserCart",e,function(e,t){c.locked=!1,c.removeMask(),t&&t.data&&t.data.data&&t.data.data.cart&&c.updateCart(t.data.data.cart),s&&s(e)})),o.ms.broadcast("ms.entity.orders.handlePaymentResponse",{level:"success",data:t.data.data}),(t=(e=t.data.data).orders)&&1==t.length?(a=Object.assign({},e.orders[0]),"1"==l.partialpayment?ms.trigger("ms.order_partial_payment",{orders:[a]}):ms.trigger("ms.order_placed",{orders:[a]})):(delete(a=Object.assign({},e)).orders,ms.trigger("ms.order_placed",{orders:t,originalOrder:a})),n.path("/orderstatus/"+d).replace()):r()})},"1"==l.partialpayment?(delete s.query.getOriginalOrder,"crb2b"==ms.store.name||"demo-vijay"==ms.store.name?a(s):(s.entity="ms.order_partial_payments",i.get(s,function(e,t){!e&&t.data&&t.data.data?(e={entity:"ms.orders",recordId:String(t.data.data.record),version:"1",query:{partial_payment:!0}},a(e)):r()}))):a(s)):r()}],cartOrder:["$scope","app","$stateParams","$rootScope","$location",function(e,t,a,s,n){var o=window.mystore.storage(),i=null,a=a.id;try{i=JSON.parse(o.cart_id)._id}catch(e){}t.call("mergeCart",{entity:"ms.carts",data:{cart_id:a},version:"1",query:{q:{_id:i}}},function(e,t){if(e||!t.data||!t.data.data||!t.data.data.cart)return n.path("/cart"),void n.url(n.path());e=t.data.data.cart;s.ms.cart.updateCart(e),n.path("/cart"),n.url(n.path())})}],userAddresses:["$scope","$rootScope","app",function(n,t,o){n.addresses=[],n.newAddress={},ms.user.isLoggedIn&&(n.listAddresses=function(){var e={entity:"ms.user_addresses",query:{filters:[{field:"user_id",value:t.ms.user._id}]},version:"1"};e.query.filters=JSON.stringify(e.query.filters),n.loading=!0,o.list(e,function(e,t){n.loading=!1,e?console.log("Something went wrong while getting data",e):n.addresses=t&&t.data&&t.data.data&&t.data.data.length?t.data.data:[]})},n.listAddresses(),n.remove_address=function(s){var e;!0===confirm("Are you sure you want to delete?")&&(e={entity:"ms.user_addresses",recordId:s._id,version:"1"},o.del(e,function(e,t){var a;e?console.log("Something   went wrong while deleting address",e):(a="",angular.forEach(n.addresses,function(e,t){s._id==e._id&&(a=t)}),n.addresses.splice(a,1),n.listAddresses())}))},n.save_address=function(a){delete a.showform;var e={entity:"ms.user_addresses",recordId:a._id,data:a,version:"1"};o.update(e,function(e,t){e||angular.forEach(n.addresses,function(e){a._id,e._id})})},n.add_address=function(a){o.add({entity:"ms.user_addresses",data:a,version:"1"},function(e,t){e||(a._id=t.data._id,n.addresses.push(a),n.newAddress&&(n.newAddress={}))})})}],countryPicker:["$scope",function(s){s.countries=[],ms.getLocations(function(e,t){var a;t&&0<t.length?ms.settings.served_countries&&ms.settings.served_countries.length?-1<ms.settings.served_countries.indexOf("all")?(a=t.map(function(e){return e.code}).indexOf("REST"),t.splice(a,1),a=t.map(function(e){return e.code}).indexOf("all"),t.splice(a,1),s.countries=t):angular.forEach(t,function(e){-1!=ms.settings.served_countries.indexOf(e.code)&&s.countries.push(e)}):s.countries=[{country:"India",code:"IN"}]:s.error("Something went wrong")})}],statePicker:["$scope",function(a){function s(e){ms.getLocation(e,function(e,t){e?a.error("getLocation : Something went wrong"):t&&t.states&&(a.stateFieldLabel=t.label,a.states=t.states,ms._applyScope())})}a.states=[],a.stateFieldLabel="State",a.country=ms.settings.served_countries&&ms.settings.served_countries.length?ms.settings.served_countries[0]:"IN",a.settings.country?s(a.settings.country):a.settings.countryfield?a.$watch(a.settings.countryfield,function(e,t){if(!e)return a.states=[],void s(a.country);s(e)},!0):s(a.country)}],image:["$scope","$element",function(t,e){var a,s,n,o=e.get(0);function i(){var e;"cover"!=a&&(o.style.background=s,(e=$(o).width())&&(e=e/n,t.settings.aspectratio?o.style.height=e+"px":o.style.height="auto"))}"IMG"!=o.tagName?console.error("ms.image widget can be used only on img element tags. Tag used: "+o.tagName):o.src?console.error("ms.image widget requires ms-data-src attribute instead of src attribute"):($(o).on("error",function(){this.style.display="none"}),o.src=defaultBgImage,t.settings.src&&"//:0"!=t.settings.src||!t.settings.placeholder||e.attr("ms-data-src",t.settings.placeholder),a=t.settings.fit||"contain",$(o).css("object-fit",a),$(o).attr("width")||o.style.width||$(o).width("100%"),$(o).addClass("lazyload"),t.settings.position&&$(o).css("object-position",t.settings.position),s=o.style.background,o.style.background="#fafafa","cover"!=a&&(e=t.settings.aspectratio||1,(n=Number(e))||((e=e.split(":"))[0]=parseInt(e[0]),e[1]=e[1]?parseInt(e[1]):1,n=e[0]/e[1]),window.addEventListener("resize",i),$(o).on("lazyloaded",i),i()))}],image1:["$scope","$rootScope","$element","$window",function(t,e,a,s){if(ms.settings.image_lazyload&&t.settings.src&&!ms.device.isBot)return t.settings.aspectRatio&&(t.settings.aspectratio=t.settings.aspectRatio),t.settings.src=t.settings.src.replace(/-\d+x\d+(\.\w+)$/,"$1").replace("/webp/","/"),window.mystore.controllers.image[2](t,a);function n(){var e=parseInt(u[1]/u[0]*100);if(1==t.settings.centercropping||"true"==t.settings.centercropping)$(a).css("top","0%"),$(a).css("position","absolute"),$(a).css("margin","auto"),$(a).css("height","auto"),$(a).css("width","100%");else{switch($(a).addClass("ms-img-content"),f){case"top":$(a).css("top","0");break;case"bottom":$(a).css("bottom","0");break;case"middle":$(a).css("top","0"),$(a).css("bottom","0"),$(a).css("margin-top","auto"),$(a).css("margin-bottom","auto")}switch(h){case"left":$(a).css("left","0");break;case"center":$(a).css("left","0"),$(a).css("right","0"),$(a).css("margin-left","auto"),$(a).css("margin-right","auto");break;case"right":$(a).css("right","0")}}$(a).wrap(p),$(g).css("padding-top",e+"%"),t.settings.loadingimg&&-1==t.settings.loadingimg.indexOf("InternetSlowdown_Day.gif")?(t.settings.loadingimg=t.settings.loadingimg.replace(/'/g,""),_='<img  style="max-height: 50px;max-width: 50px" src="'+t.settings.loadingimg+'"/>',t.settings.loadingimgblur&&(_='<img width="100%" height="100%" src="'+t.settings.loadingimg+'"/>')):_=t.settings.loadinghtml||"<div> Loading...</div>",_=$('<div id="loading_img" style="position: absolute;width: 100%;height: 100%;"><table style="width: 100%; height: 100%;"><tbody><tr>    <td style=" text-align: center">'+_+"</td></tr></tbody></table></div> "),$(_).insertBefore(a),$(g).insertAfter(a),$(a).hide()}function o(){function a(e,t){return 0==t?e:a(t,e%t)}m=parseInt(t.settings.width),c=parseInt(t.settings.height);var e=a(m,c);u[0]=m/e,u[1]=c/e}window.need_to_append&&(i=".ms-centered-outer:before{content:'';display:inline-block;height:100%;vertical-align:middle;margin-right:-.25em}.ms-centered-inner{vertical-align:middle;text-align:center}.ms-centered-inner img{margin-left:auto;margin-right:auto;display:block}.accordion-inner{width:220px;margin-left:-15px}#accordion2{width:220px}.accordian-inner .accordion-group{margin-left:-12px}.savefixedBtn{position:absolute;right:20px;top:65px;z-index:100}.mcmsMessage{position:absolute;top:0;left:30%;width:30%;text-align:center;height:45px;z-index:10}.mcmsMessage span{padding:0 10px;line-height:45px;font-size:14px}.ms-img-warpper{display:inline-block;position:relative;width:100%;overflow:hidden}.ms-img-content{position:absolute;max-width:100%;max-height:100%}.btn.admin-settings-btn{right:0;top:20px;display:inline-block;width:42px!important;text-align:center;-webkit-border-radius:6px 0 0 6px!important;-moz-border-radius:6px 0 0 6px!important;border-radius:6px 0 0 6px!important;filter:alpha(opacity=55);vertical-align:top;margin:0;position:fixed;z-index:10000;background-color:#ffa830}.admin-settings-box{display:none;width:100%;padding:0 14px;background-color:#000;height:50px;position:fixed;z-index:1000;top:0}.admin-settings-box.open{display:block}.white-text{color:#fff}",r=document.body||document.getElementsByTagName("body")[0],(d=document.createElement("style")).type="text/css",d.styleSheet?d.styleSheet.cssText=i:d.appendChild(document.createTextNode(i)),r.appendChild(d),window.need_to_append=!1);var i,r,d,l='<div class="img-place-holder"><table><tr><td> No Image </td></tr></table></div>',c=0,m=0,u=[],p=$("<div class='ms-img-warpper'></div>"),g=$("<div></div>"),l=t.settings.placeholderhtml||l,f=t.settings.valign||"bottom",h=t.settings.halign||"center",_="";t.settings.aspectratio?((u=t.settings.aspectratio.split(":"))[0]=parseInt(u[0]),u[1]=u[1]?parseInt(u[1]):1,t.settings.width&&t.settings.height?o():!t.settings.width&&t.settings.height?(m=parseInt(parseInt(t.settings.height*u[0])/u[1]),c=parseInt(t.settings.height),t.settings.width=m):t.settings.width&&!t.settings.height&&(c=parseInt(parseInt(t.settings.width*u[1])/u[0]),m=parseInt(t.settings.width),t.settings.height=c),n()):t.settings.width&&t.settings.height&&(o(),n()),ms.device.isBot?($(a).show(),$(a).prev()&&$(a).prev().remove(),$(g).insertAfter(a)):(a.on("load",function(){$(a).show(),$(a).prev()&&$(a).prev().remove(),$(g).insertAfter(a)}),$(a).on("error",function(){$(a).prev()&&$(a).prev().remove(),$(a).hide(),$(g).insertAfter(a),l&&$(l).insertBefore(a)}))}],productdetailMap:["$scope","$element",function(a,e){var t,s=new google.maps.Geocoder,n=20,o="roadmap",n=(a.settings.zoom&&0<parseInt(a.settings.zoom)&&(n=parseInt(a.settings.zoom)),a.settings.maptype&&(o=a.settings.maptype),{center:new google.maps.LatLng(28.413323,77.044115),zoom:n,scrollwheel:!1,disableDoubleClickZoom:!0,mapTypeId:o}),i=(0==e.height()&&e.height(200),new google.maps.Map(e.get(0),n));a.settings.latitude&&a.settings.longitude?(t=new google.maps.LatLng(parseFloat(a.settings.latitude),parseFloat(a.settings.longitude)),new google.maps.Marker({position:t,map:i,title:a.settings.title}),i.setCenter(t)):(o=JSON.parse(a.settings.location),a.settings.location=o,n="",n=(t=a.settings.location).address?t.address+",":"",(n=(n=(n=(n+=t.city?t.city+",":"")+(t.state?t.state+",":""))+(t.country?t.country+",":""))+(t.zip_code?t.zip_code+",":""))||(alert("Map Error : Please enter the store address or geo location in store setting"),e.addStyle("display:none")),s.geocode({address:n},function(e,t){t==google.maps.GeocoderStatus.OK?(i.setCenter(e[0].geometry.location),new google.maps.Marker({map:i,position:e[0].geometry.location,title:a.settings.title})):a.error("Geocode was not successful for the following reason: "+t+".Reload the page to see the map.")}))}],fileController:["$scope","$rootScope","$element",function(n,e,t){t.bind("change",function(e){var a,s=t.find("input[type=file]").controller("ngModel");s=s||t.controller("ngModel");if(s&&e.target.files&&e.target.files.length)return a=e.target.files[0],(e=new FileReader).onload=function(e){var t={uploadType:"base64",data:e.target.result,name:a.name,size:a.size,type:a.type};n.previewUrl=e.target.result,s.$setViewValue(t),n.$$phase||n.$apply()},e.readAsDataURL(a),!0}),t.bind("click",function(){}),n.preview=!1,n.settings.name?n.settings.data&&(n.preview=!0):alert("please give the name of field  having file type ")}],productImage:["$scope",function(a){a.featured_image={},a.$watch("product_images",function(e,t){e&&a.product_images.length&&(a.featured_image=a.product_images[0])}),a.load_featured_image=function(e){ms.settings.image_lazyload&&(a.featured_image=""),ms.timeout(function(){a.featured_image=e})}}],optionsHandler:["$scope","$http","app","$rootScope","msCache",function(u,e,t,a,s){u.options={},u.option_values={},u.product.selected_options={},u.product.selected_variant={},u.product.available=!0,u.product_images=u.product.images,u.featured_image=u.product.images[0],"0"==u.product.available||0==u.product.available?u.product.available=!1:u.product.available=!0,u.max_quantity=10;var n,d={},l=[],i=u.settings.showalloptions,o=(u.settings.showallvalues,{}),r=[],c=[],m={},p=[];for(n in u.options)p.push(n);u.filterImages=function(a){u.product.images&&u.product.images.length&&(u.product_images&&u.product_images.length&&(u.product_images=[]),a?angular.forEach(u.product.images,function(e,t){e.tags==a&&u.product_images.push(e),t+1==u.product.images.length&&(u.product_images.length?u.featured_image=u.product_images[0]:(u.product_images=u.product.images,u.featured_image=u.product.images[0]))}):(u.product_images=u.product.images,u.featured_image=u.product.images[0]))};function g(a){var n,o=[];return i?(o=[],angular.forEach(a,function(a,e){var s=[];angular.forEach(a.values,function(e,t){e.available=!0,s.push(e),++t==a.values.length&&(a.values=s,o.push(a))})})):(n={},angular.forEach(l,function(e,t){angular.forEach(e.options,function(e){n[e.name]||(n[e.name]=[]),-1==n[e.name].indexOf(e.value)&&n[e.name].push(e.value)}),++t==l.length&&angular.forEach(a,function(a,e){var s;n[a.name]&&(s=[],angular.forEach(a.values,function(e,t){-1!=n[a.name].indexOf(e.value)&&(e.available=!0,s.push(e)),++t==a.values.length&&(a.values=s,o.push(a))}))})})),o}function f(){var a=[];return i?a=o:angular.forEach(o,function(e,t){-1!=r.indexOf(e.name)&&a.push(e)}),a}function h(e){for(var t in angular.forEach(e,function(e){var t={display_name:e.display_name,name:e.name,type:e.type,default_value:e.default_value,available:!0,required:"0"};e.required&&"1"==e.required&&(t.required="1",t.required_message=e.required_message||"Please select "+e.display_name,t.show=!1),u.option_values[e.name]=e.values,u.options[e.name]=t}),p=[],u.options)p.push(t)}function _(e,t,a,s){if(!a&&0==e.length||!t)return s(null);if(!a&&1<=e.length)return s(e[0]);for(var n=e,o=a,e=function(e){_(e,t,a-1,s)},i=t.split("|"),r=[],d=0;d<n.length;d++){var l=n[d].variant_id?n[d].variant_id.split("|"):"",c=!0;if(i.length==l.length){for(var m=0;m<i.length;m++)i[m]==l[m]||m+o==Object.keys(u.options).length&&"#"==l[m]||(c=!1);c&&r.push(n[d])}}e(r)}function v(e){var a;e&&(o=e.options,u.product.variants&&u.product.variants.length&&angular.forEach(u.product.variants,function(e,t){e&&l.push(e)}),angular.forEach(l,function(e,t){c.push(e.variant_id),angular.forEach(e.options,function(e){-1==r.indexOf(e.name)&&"#"!=e.value&&r.push(e.name)})}),u.product.inventory_management&&"automatic"==u.product.inventory_management?u.product.product_has_multiple_variants&&"1"==u.product.product_has_multiple_variants&&u.product.inventory_management_level&&"variant"==u.product.inventory_management_level?(h(g(f())),angular.forEach(l,function(t){m[t.variant_id]||(m[t.variant_id]=[],angular.forEach(t.options,function(e){m[t.variant_id].push(e.value)}))}),u.product.available=!0):(h(g(f())),u.product.inventory_quantity&&0<u.product.inventory_quantity?(u.product.available=!0,u.max_quantity=u.product.inventory_quantity):u.product.inventory_allow_out_of_stock&&"0"==u.product.inventory_allow_out_of_stock?u.product.available=!1:u.product.available=!0):(h(g(f())),u.product.available=!0),u.product.default_variant&&Object.keys(u.product.default_variant).length?(a=u.product.default_variant,u.product.selected_variant=u.product.default_variant,angular.forEach(u.product.selected_variant,function(e,t){ms.settings.new_product_variant_flow||("inventory_quantity"!=t&&"inventory_low_stock_quantity"!=t&&"inventory_management"!=t&&"inventory_management_level"!=t&&"inventory_allow_out_of_stock"!=t&&"price"!=t&&"options"!=t&&"id"!=t&&"variant_id"!=t&&"original_price"!=t&&(d[t]=u.product[t],u.product[t]=a[t]),"price"==t&&(u.product.original_price,u.product.original_price=u.product.price,d.price=u.product.price,d.original_price=u.product.original_price,a.price||(a.price=u.product.price),u.product.price=parseFloat(a.price)*(parseFloat(d.price)/parseFloat(d.original_price)),u.product.original_price=parseFloat(a.price)))}),angular.forEach(a.options,function(e){u.product.selected_options[e.name]=e.value})):(angular.forEach(o,function(e,t){e.default_value&&(u.product.selected_options[e.name]=e.default_value),t+1==o.length&&u.findRules(e.name,e.default_value)}),u.filterImages()))}u.findRules=function(e,t){if(u.product.selected_options[e]=t,ms.settings&&ms.settings.enable_option_price){if("object"==typeof t){var a,s=[];for(a in t)t[a]&&s.push(a);u.product.selected_options[e]=s}u.option_set_total=0,u.optionSet&&u.optionSet.options&&Object.keys(u.product.selected_options).forEach(function(a){u.optionSet.options.forEach(function(e){e.name==a&&e.values&&e.values.forEach(function(t){Array.isArray(u.product.selected_options[a])&&u.product.selected_options[a].forEach(function(e){t.price&&t.value==e&&(u.option_set_total+=parseFloat(t.price))})})})}),u.option_set_total?u.product.price_with_option_set=parseFloat(u.product.price)+parseFloat(u.option_set_total):u.product.price_with_option_set=0}if(u.product.product_has_multiple_variants&&"1"==u.product.product_has_multiple_variants){for(var n=(n=p).sort(),o=[],i=0;i<n.length;i++)u.product.selected_options[n[i]]?o[i]=u.product.selected_options[n[i]]:o[i]="#";var e=o.join("|"),r={};_(l.slice(0),e,Object.keys(u.options).length,function(e){r=e}),r?(angular.forEach(u.product.selected_variant,function(e,t){"inventory_quantity"!=t&&"inventory_low_stock_quantity"!=t&&"inventory_management"!=t&&"inventory_management_level"!=t&&"inventory_allow_out_of_stock"!=t&&"price"!=t&&"options"!=t&&"id"!=t&&"variant_id"!=t&&"original_price"!=t&&(d[t]=u.product[t],u.product[t]=r[t]),"price"==t&&(u.product.original_price,u.product.original_price=u.product.price,d.price=u.product.price,d.original_price=u.product.original_price,r.price||(r.price=u.product.price),u.product.price=parseFloat(r.price)*(parseFloat(d.price)/parseFloat(d.original_price)),u.product.original_price=parseFloat(r.price))}),(u.product.selected_variant=r).tag&&u.filterImages(r.tag),u.product.inventory_management&&"automatic"==u.product.inventory_management&&u.product.inventory_management_level&&"variant"==u.product.inventory_management_level&&r.inventory_management&&"automatic"==r.inventory_management&&(r.inventory_quantity&&0<r.inventory_quantity||"1"==r.inventory_allow_out_of_stock?u.product.available=!0:u.product.available=!1)):(angular.forEach(d,function(e,t){"inventory_quantity"!=t&&"inventory_low_stock_quantity"!=t&&"inventory_management"!=t&&"inventory_management_level"!=t&&"inventory_allow_out_of_stock"!=t&&(u.product[t]=d[t])}),u.filterImages(null))}},u.selectOption=u.findRules,u.check_required_options=function(e,t){if(t||!isNaN(t))if(e.inventory_management&&"automatic"==e.inventory_management)if(e.product_has_multiple_variants&&"1"==e.product_has_multiple_variants)if(e.inventory_management_level&&"variant"==e.inventory_management_level){if(!u.product.selected_variant||!Object.keys(u.product.selected_variant).length||b())return u.variant_error="Variant not exist",window.ms.broadcast("ms.msg.variant_not_selected",{level:"warning"});a.ms.cart.add_product(u.product,t)}else y()||a.ms.cart.add_product(e,t);else y()||a.ms.cart.add_product(e,t);else e.inventory_management&&"none"!=e.inventory_management||y()||a.ms.cart.add_product(e,t);else alert("Enter valid quantity")},u.addToCart=u.check_required_options;var y=function(){var a=!1;return angular.forEach(u.options,function(e,t){u.options[t].required&&"1"==u.options[t].required&&(u.options[t].show=!1),u.product.selected_options[t]&&""!=u.product.selected_options[t]||(u.options[t].show=!0,a=!0)}),angular.forEach(u.show_always_options,function(e,t){!u.show_always_options[t].required||"1"!=u.show_always_options[t].required||u.product.selected_options[t]&&""!=u.product.selected_options[t]?u.show_always_options[t].show=!1:(u.show_always_options[t].show=!0,u.show_always_options[t].required_message="Please select "+u.show_always_options[t].display_name,a=!0)}),a},b=function(){var a=!1;return angular.forEach(u.options,function(e,t){-1==r.indexOf(u.options[t].name)&&u.options[t].required&&"1"==u.options[t].required&&(u.options[t].show=!1,u.product.selected_options[t]&&""!=u.product.selected_options[t]||(u.options[t].show=!0,a=!0))}),a};u.product.option_set?(s=s.get_from_cache("ms.option_set",u.product.option_set))?v(s):(s={entity:"ms.option_set",query:{resolveOptionSet:!0,filters:[{field:"_id",value:u.product.option_set}]},version:"1",httpcache:!0,cache:!0},t.list(s,function(e,t){e||t.data&&t.data.data&&t.data.data.length&&(u.optionSet=t.data.data[0],v(t.data.data[0]))})):u.product.inventory_management&&"automatic"==u.product.inventory_management?u.product.inventory_quantity&&0<u.product.inventory_quantity?(u.product.available=!0,u.max_quantity=u.product.inventory_quantity):"1"==u.product.inventory_allow_out_of_stock?u.product.available=!0:u.product.available=!1:u.product.available=!0}],uploadTmpFile:["$scope","$element","$http",function(c,m,u){m.bind("change",function(o){var e,i,t,r=m.find("input[type=file]").controller("ngModel");r=r||m.controller("ngModel");if(r&&o.target.files&&o.target.files.length){if(e=o.target.files[0],c.uploading=!0,i={name:e.name,type:e.type,size:e.size,uploadType:"tmp",versioning:a},t=e.name.substring(e.name.lastIndexOf(".")),c.settings&&c.settings.entity&&"ms.imports"==c.settings.entity&&".csv"!=t&&".json"!=t)return m.val="",void alert("Upload csv file!!!");0;var d=e,l=new XMLHttpRequest;l.open("GET","/sign-s3?file-name="+d.name+"&file-type="+d.type),l.onreadystatechange=function(){var e,t,a,s,n;4===l.readyState&&(200===l.status?(e=JSON.parse(l.responseText),c.uploading=!1,c.processing=!0,$("#uploadModal").modal({backdrop:"static",show:!0}),d._id=e.imageId,t=d,a=e.signedRequest,s=e.url,n=new XMLHttpRequest,u.pendingRequests.push(n),n.open("PUT",a),n.setRequestHeader("content-type",t.type),n.setRequestHeader("expires",new Date((new Date).getTime()+3156192e5).toGMTString()),n.setRequestHeader("cache-control","max-age=315619200000,public"),n.upload.onprogress=function(e){e.lengthComputable&&c.$apply(function(){c.percent=parseInt(100*e.loaded/e.total),c.percentage=parseInt(100*e.loaded/e.total),c.uploading=!1,c.processing=!0})},n.onreadystatechange=function(){u.pendingRequests.splice(0),4===n.readyState&&(200===n.status?(i.path=s.replace("https://mystore.in.s3.amazonaws.com/",""),i._id=t._id,i.uploadType="tmp",c.previewUrl=o.target.result,c.processing=!1,r.$setViewValue(i),c.uploading=!1,c.$$phase||c.$apply()):(m.val="",c.uploading=!1,c.processing=!1,c.uploading=!1,alert("Error occured in file uploading")))},n.send(t)):(alert("Error occured in file uploading"),m.val="",c.uploading=!1))},l.send()}}),c.preview=!1,c.settings&&c.settings.data&&(c.preview=!0);var a=!(c.uploading=!1);c.settings&&"1"==c.settings.disable_versioning&&(a=!1),("ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints)&&m.bind("touchend",function(e){e.preventDefault(),e.target.click()})}],testCommand:["$scope","app","$rootScope",function(a,e,s){a.submit=function(){e.get({entity:"test",version:"1"},function(e,t){e&&(a.data=t.data.data,s.$broadcast("ms.add.test",{data:"one",type:"info"}))})}}],message:["$rootScope","$scope","$element","$timeout","$location","$interpolate",function(s,n,o,i,r,d){var e,t,l,c,m;s.ms.message_enabled=!0,o.addClass("ms_message_widget_internal"),o.css("display","none"),n.settings.name&&(e=n.settings.name,n.settings.level&&(e=e+"_"+n.settings.level),o.data("eventname",e),t=e+"_"+r.$$path,s.ms.registeredEvents.push(t),l="",c=!1,m=function(e,t){if(e)switch(e){case"show":"start"==t?$(o).show(parseInt(n.settings.starttime)):$(o).hide(parseInt(n.settings.endtime));break;case"fade":"start"==t?$(o).fadeIn(parseInt(n.settings.starttime)):$(o).fadeOut(parseInt(n.settings.endtime));break;case"slide":"start"==t?$(o).slideDown(parseInt(n.settings.starttime)):$(o).slideUp(parseInt(n.settings.endtime));break;case"animate":break;default:"start"==t?o.css("display","block"):o.css("display","none")}},s.$on(e,function(e,t){var a=5e3;if(n.settings.duration&&parseInt(n.settings.duration)&&(a=parseInt(n.settings.duration)),t.duration=a,n.message=t,n.output={},t.data&&(n.output=t.data,n.message.message&&-1<n.message.message.indexOf("{{")&&(n.message.message=d(n.message.message)(n))),"redirect"==n.settings.action)r.path(n.settings.url);else{if("expression"==n.settings.action)return o.css("display","block"),void s.$eval(n.settings.expression);n.settings.action,"display"==n.settings.action&&o.css("display","block"),"show"==n.settings.action&&(c?i.cancel(l):($(o).stop(!1,!0),c=!0,m(n.settings.action,"start")),l=i(function(){c=!1,m(n.settings.action,"end")},a))}}))}],loading:["$scope","app","$rootScope",function(e,t,a){a.ms.loading_enabled=!0,a.ms.loadings||(a.ms.loadings={}),e.entity=a.ms.loadings}],entityAttributes:["$scope","$stateParams","$attrs","app","$rootScope","$location",function(i,e,a,t,n,o){var s,r={},d=[];for(s in e.collection&&(r.collections=e.collection),i.settings.collection&&(r.collections=i.settings.collection),e.category&&(r.categories=e.category),i.settings.category&&(r.categories=i.settings.category),e.brand&&(r.brand=e.brand),i.settings.brand&&(r.brand=i.settings.brand),i.settings.entity||(i.settings.entity="ms.products",r.publish="1"),r)d.push({field:s,value:r[s],operator:"equal"});i.data=null,i.copydata=null,i.fields={};function l(e){var o={entity:i.settings.entity,customCommandName:"",type:"get",version:"1",query:{},httpcache:!0,cache:!0};o.query.filters=d,e&&(o.query.filters=d.concat(e)),o.query.filters=JSON.stringify(o.query.filters),"search"===ms.page.name&&ms.page.params&&ms.page.params.query&&(o.query.search=ms.page.params.query),i.submitting=!0,t.call("getAttributes",o,function(e,t){var n;i.submitting=!1,e?i.$parent.$parent.$eval(a.msError):(n=t.data.data,i.$parent.$parent.$eval(a.msSuccess),i.data?angular.forEach(i.data,function(t,e){var a,s;i.fields[e]&&-1!=i.fields[e].indexOf(i.currentValue)&&e==i.currentattribute||("string"==typeof(a=o.query.q)&&(a=JSON.parse(a)),o.query.q&&a.$and&&(a=JSON.parse(o.query.q),JSON.parse(a.$and)[0]["attributes.name"],JSON.parse(a.$and).length),n[e]?(s={},n[e].forEach(function(e){s[e.value]=e}),angular.forEach(t,function(e){s[e.value]||(e.count=0,e.disable=!0,s[e.value]=e)}),t=[],Object.keys(s).forEach(function(e){t.push(s[e])}),i.data[e]=t):angular.forEach(t,function(e){e.count=0,e.disable=!0}))}):(i.data=n,i.copydata=JSON.parse(JSON.stringify(n)))),angular.forEach(i.data,function(e,t){i.fields[t]||(i.fields[t]=[])})})}var c;o.search().filters&&"null"!=o.search().filters&&(c="string"==typeof(c=o.search().filters)?JSON.parse(c):c).forEach(function(e){var t=e.field.split(".")[1];i.fields[t]||(i.fields[t]=[]),e.value.forEach(function(e){-1==i.fields[t].indexOf(e)&&i.fields[t].push(e)})}),l(c);i.toggle=function(e,t){var a,s;i.fields[e]||(i.fields[e]=[]),-1==i.fields[e].indexOf(t)?i.fields[e].push(t):i.fields[e].splice(i.fields[e].indexOf(t),1),i.settings.widget&&(a=[],s="",angular.forEach(i.fields,function(e,t){e&&e.length&&(a.push({field:"attributes."+t,value:e,operator:"in"}),s=e.length)}),n.ms.widgets[i.settings.widget].filter(a),s<1&&o.search("filters",null),l(angular.copy(a)))},i.toggleClear=function(e,t){i.fields={},n.ms.widgets[i.settings.widget].filter(""),o.search("filters",null),l()}}],modal:["$rootScope","$scope","$element","$compile","$timeout",function(e,t,a,s,n){var o,i,r,d,l=a.html().trim();function c(){1!=t.settings.enablestack&&"true"!=t.settings.enablestack&&$("#"+r).remove(),s(d)(t,function(t,a){n(function(){$(t).appendTo("body");var e={show:!0};a.settings.backdrop&&(e.backdrop=a.settings.backdrop),(0==a.settings.usedefault||"false"==a.settings.usedefault?$("#"+r).find(".modal"):$("#"+r)).modal(e),setTimeout(function(){$(t).find("form .col-sm-10").removeClass("col-sm-10").addClass("col-sm-9"),$(t).find("form .col-sm-2").removeClass("col-sm-2").addClass("col-sm-3")},100)})}),t.$$phase||t.$root.$$phase||t.$apply()}t.settings.widget||l?(o=t.settings.widget,t.settings.widget&&(l=' <div ms-widget="'+o+'"></div>'),i=t.settings.header,r="",r=t.settings.modalid||function(e,t){for(var a="",s=e;0<s;--s)a+=t[Math.round(Math.random()*(t.length-1))];return a}(4,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),d="",d=0==t.settings.usedefault||"false"==t.settings.usedefault?'<div id="'+r+'" ms-widget="'+o+'"></div>':'<div id="'+r+'" class="modal fade" ><div class="modal-dialog"> <div class="modal-content"> '+(i&&""!=i?'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"> '+i+"</h4></div>":"")+'<div class="modal-body">'+l+"</div></div></div></div>",t.settings.event&&"click"!=t.settings.event?"load"==t.settings.event?t.settings.delay&&0<t.settings.delay?n(c,t.settings.delay):c():console.log("Event: ["+t.settings.event+"] not supported"):a.bind("click",function(){c()}),t.remove=function(){$(".modal").remove(),$(".modal-backdrop").remove()},t.show=function(){a.trigger("click")}):alert("widget name or content is not specified in ms.modal widget")}],mobilePlaceOrder:["$scope","app","$rootScope","$stateParams","$location",function(e,t,a,s,n){var o=a.ms.cart,a=(o.payment_method.type&&-1!=["cash_on_delivery","offline","payment_gateways"].indexOf(o.payment_method.type)||a.ms.broadcast("ms.msg.empty_payment_details",{level:"warning"}),o.add_mask(),{entity:"ms.carts",customCommandName:"",type:"put",version:"1",data:{client_details:{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,languages:navigator.languages,device:findUserAgent()}},query:{q:{_id:n.search().cart_id}}});t.call("placeOrder",a,function(e,t){e?o.removeMask():"form"==(e=t.data.data.gatewayInfo).type&&(o.order_id=e.order_id,o.updateLocalStorage(),"GET"==e.action||"REDIRECT"==e.action?get_to_url(e.url,e.data,"GET"):"POST"==e.action&&post_to_url(e.url,e.data,"POST"))})}],checkout1:["$scope","app","$location","$stateParams","$rootScope",function(o,s,e,t,i){function n(e){if(!r.available_shipping_methods.length)return i.ms.broadcast("ms.msg.no_shipping_methods",{level:"error",message:"No shipping method is enabled on store  can't proceed"});r.updateShippingMethod({shipping_method:r.available_shipping_methods[0]._id},function(e,t){return!e&&(1<r.available_shipping_methods.length?o.step=3:r.available_payment_methods.length?void r.updatePaymentMethod(r.available_payment_methods[0],function(e){if(e)return!1;1==r.available_payment_methods.length?"payment_gateways"==(e=r.available_payment_methods[0]).type?e.settings.gateways&&1==e.settings.gateways.length?($("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),o.step=5):e.settings.gateways&&1<e.settings.gateways.length?o.step=4:i.ms.broadcast("ms.msg.no_payment_methods",{level:"error",message:"No payment method is enabled on store  can't proceed"}):"cash_on_delivery"==e.type?o.step=4:($("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),o.step=5):o.step=4}):(i.ms.broadcast("ms.msg.no_payment_methods",{level:"error",message:"No payment method is enabled on store  can't proceed"}),!1))})}var r=i.ms.cart,d=i.ms.user,a=(o.step=1,o.show_payment_step=!0,o.not_allowed_to_pay=!0,window.mystore.orderOptions(o,i,s),o.goto_step=function(e){if(e<o.step||o.step+1==e||1==e){var t,a;if(1==e&&(d.isLoggedIn?o.goto_step(2):o.step=1),2==e&&(r._id?r.updateUser({email_id:r.email_id},function(){var e;d.isLoggedIn&&(r.shipping_address={},i.ms.forms.shippingform&&(e=i.ms.forms.shippingform.fields.country||(i.ms.settings.served_countries&&i.ms.settings.served_countries.length?i.ms.settings.served_countries[0]:"IN"),i.ms.forms.shippingform.fields={country:e})),o.step=2}):o.step=1),3==e&&(t=i.ms.forms.shippingform,i.ms.forms.billingform,a=t.submitValid(),n=a,"IN"!=(s=t).fields.country&&"INDIA"!=s.fields.country||((isNaN(s.fields.zip)||"string"==typeof s.fields.zip&&6!=s.fields.zip.length)&&(n=!(s.errors.zip="Please enter six digit valid zip code")),!isNaN(s.fields.phone)&&10==s.fields.phone.length||(n=!(s.errors.phone="Please enter 10 digit valid phone number"))),(a=n)&&o.update_shipping_address(t.fields)),4==e){if(!r.shipping_method)return void alert("Please Select shipping method ");if(!r.available_payment_methods.length)return!1;r.updatePaymentMethod(r.available_payment_methods[0],function(){5==e&&$("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),o.step=e})}5==e&&(o.step=5,$("#step4")&&$("#step4").length&&$("#step4").addClass("complete"),r.remove_mask())}var s,n},o.update_shipping_address=function(t){r.add_mask(),r.updateAddresses({shipping_address:t,billing_address:t},function(){var e,a;d.isLoggedIn&&!r.shipping_address._id?(a=function(){n()},(e=t).user_id=i.ms.user._id,s.add({entity:"ms.user_addresses",data:e,version:"1"},function(e,t){e||a&&a()})):n()})},o.change_shipping_method=function(e){r.updateShippingMethod({shipping_method:e})},o.create_order=function(){r.addMask(),o.saveOption(function(e){if(r.removeMask(),e)return!1;r.placeOrder()})},o._applePayAvailable=function(){return"undefined"!=typeof ApplePaySession&&(console.log("Applepay can make payment ",ApplePaySession.canMakePayments()),window.ApplePaySession&&ApplePaySession.canMakePayments())},o._startApplePaySession=function(){var n,e,t={countryCode:r.shipping_address.country,currencyCode:r.currency.name,merchantCapabilities:["supports3DS","supportsDebit","supportsCredit"],supportedNetworks:["visa","masterCard","amex","discover","mada"],total:{label:ms.store.name,type:"final",amount:parseFloat(r.total).toFixed(r.currency.decimal_points)}},t=(console.log("Starting apple pay session",t),new ApplePaySession(1,t));(n=t).onvalidatemerchant=function(e){console.log("In onvalidatemerchant function: ",JSON.stringify(e)),console.log("appleSession: ",r.payment_method.apple_session);e=n.completeMerchantValidation(JSON.parse(r.payment_method.apple_session));console.log("Ret value",e)},n.onpaymentauthorized=function(s){console.log("Inside payment authorized: ",s),console.log("Inside payment1 : ",JSON.stringify(s.payment)),console.log("Inside payment2 : ",JSON.stringify(s.payment.token)),console.log("Inside payment2 : ",r.txn_id);var e={entity:"ms.orders",command:"handlePaymentResponseNew",data:{response:s.payment.token},query:{txn_id:r.txn_id}};ms.app.call(e,function(e,t){var a;console.log("Handle payment resposne",t,e),e?(n.completePayment({status:ApplePaySession.STATUS_FAILURE}),a="https://"+ms.location.host()+"/ms/pages/handleResponse/success/"+r.txn_id+"?response="+JSON.stringify(s.payment.token),console.log("Return url resp1: ",a)):(n.completePayment({status:ApplePaySession.STATUS_SUCCESS}),a="https://"+ms.location.host()+"/ms/pages/handleResponse/success/"+r.txn_id+"?response="+JSON.stringify(s.payment.token),console.log("Return url resp2: ",a)),window.location.href=a})},e=t,r.addMask(),o.saveOption(function(){r.removeMask(),r.placeOrderApplepay(),console.log("Cart stored ",r),e.begin()})},o.$watch("ms.user",function(e,t){e!=t&&(i.ms.user&&i.ms.user.isLoggedIn?o.step=2:o.step=1)}),1),a=r.valid_email_id?r.valid_shipping_address&&r.valid_billing_address?r.valid_shipping_method?4:3:2:1;o.goto_step(a)}],forms:["$scope","$rootScope","app","$attrs",function(o,a,s,n){if(!o.settings||!o.settings.formname)return!1;var i=[],r=(o.fields=[],o.formName=o.settings.formname,o.errors={},o.allErrors={},o.formData={},o.button=o.settings.buttonname||"Submit",{});if(ms.forms&&ms.forms[o.settings.formname]){var d,i=(d=angular.copy(a.ms.forms[o.settings.formname])).fields,r=d,l={};if(ms.trigger("ms.form.loading",{form:{name:o.settings.formname,fields:i,data:o.formData}}),angular.forEach(d.fields,function(e){var t,a;-1<e.name.indexOf(".")?(a={name:(t=e.name.split("."))[0],data_type:"object",label:t[0],fields:[],settings:{},type:"object"},l[t[0]]||(l[t[0]]=a),e.name=t[1],l[t[0]].fields.push(e)):(e.data_type||(e.data_type="file"==e.type?"file":"string",e.settings.display_type=e.type),e&&e.settings&&"1"==e.settings.hidden||o.fields.push(e))}),Object.keys(l).length)for(var e in l){e=l[e];e.data_type||(e.data_type="file"==e.type?"file":"string",e.settings.display_type=e.type),e&&e.settings&&"1"==e.settings.hidden||o.fields.push(e),o.formData[e.name]={}}}else s.list({entity:"ms.forms",version:"1",query:{q:{name:o.settings.formname}},executeHooks:!0},function(e,t){if(e||!t.data||!t.data.data||!t.data.data.length)return!1;i=t.data.data[0].fields,r=t.data.data[0],ms.trigger("ms.form.loading",{form:{name:o.settings.formname,fields:i,data:o.formData}}),angular.forEach(i,function(t){if(!t.settings&&"1"==t.settings.hidden||o.fields.push(t),t.settings&&t.settings.default&&""!=t.settings.default){var e=t.settings.default;if(0<t.settings.default.indexOf("{{"))try{e=a.$eval(t.settings.default)}catch(e){console.log("Error while evaluating expression for default value ["+t.settings.default+"] for field: "+t.name)}o.formData[t.name]=e}})});o.submit=function(){o.errors={},o.allErrors={},ms.trigger("ms.form.validating",{form:{name:o.settings.formname,fields:o.fields,data:o.formData,errors:o.errors}});var e=validation.formValidation(o.fields,o.formData);if(o.allErrors=e,Object.keys(e).length||Object.keys(o.errors).length){for(var t in e){var a=Object.keys(e[t]);o.errors[t]||(o.errors[t]=e[t][a[0]])}if(ms.trigger("ms.form.invalid",{form:{name:o.settings.formname,fields:o.fields,data:o.formData,errors:o.errors}}),!n.msError)return!1;o.$parent.$parent.$eval(n.msError)}else ms.trigger("ms.form.valid",{form:{name:o.settings.formname,fields:o.fields,data:o.formData,errors:{}}}),d.settings.actions&&d.settings.actions.length?s.call("performActions",{entity:"ms.forms",version:"1",type:"put",query:{q:{_id:d._id}},data:o.formData},function(e,t){e&&(o.errDuplicate="Duplicate Record"),o.savedData=t.data,n.msSuccess&&o.$parent.$parent.$eval(n.msSuccess),o.formData={},angular.forEach(i,function(e){ms._resolveDefault(e,{data:o.formData})})}):n.msSuccess?(o.$parent.$parent.$eval(n.msSuccess),angular.forEach(i,function(e){ms._resolveDefault(e,{data:o.formData})})):(o.formData={},angular.forEach(i,function(e){ms._resolveDefault(e,{data:o.formData})}));$(".modal").modal&&$(".modal").modal("hide")},o.$watch("formData",function(s){var n;window&&window.admin_theme||(n=[],angular.forEach(r.fields,function(e,t){var a=!0;e&&e.settings&&e.settings.show_on&&e.settings.show_on.length&&e.settings.show_on.forEach(function(e){if(e&&e.field&&e.value)switch(e.operator){case"equal":e.value!=s[e.field]&&(a=!1);break;case"not_equal":e.value==s[e.field]&&(a=!1);break;default:e.value!=s[e.field]&&(a=!1)}}),!a||e&&e.settings&&"1"==e.settings.hidden||n.push(e)}),o.fields=n)},!0)}],messageNew:["$rootScope","$scope","$element","$timeout","$location","$interpolate",function(e,n,o,t,a,i){var s;e.ms.message_enabled=!0,o.css("display","none"),o.addClass("messageWidget"),n.settings.name&&(n.messages=[],s=n.settings.name,n.settings.level&&(s=s+"_"+n.settings.level),e.ms.registeredEvents.push(s),n.hideMessage=function(a,e){t(function(){var t=[];n.messages.forEach(function(e){e.id!=a&&t.push(e)}),n.messages=t,n.messages.length||o.css("display","none")},e)},e.$on(s,function(e,t){if(t)try{t=JSON.parse(JSON.stringify(t))}catch(e){}t=t||{};var a=Math.floor(1e7*Math.random()+1),s=5e3;switch(n.settings.duration&&parseInt(n.settings.duration)&&(s=parseInt(n.settings.duration)),t.duration=s,t.id=a,n.message=t,n.output={},t.data&&(n.output=t.data,n.message.message&&-1<n.message.message.indexOf("{{")&&(n.message.message=i(n.message.message)(n))),n.messages.push(n.message),n.$$phase||n.$root.$$phase||n.$apply(),n.settings.action){case"display":o.css("display","block"),n.hideMessage(n.message.id,n.message.duration);break;case"show":$(o).show(parseInt(n.settings.starttime)),n.hideMessage(n.message.id,n.message.duration);break;case"fade":$(o).fadeIn(parseInt(n.settings.starttime)),n.hideMessage(n.message.id,n.message.duration);break;case"slide":$(o).slideDown(parseInt(n.settings.starttime)),n.hideMessage(n.message.id,n.message.duration)}}))}],form:function(t){var a=t.settings.name||t.settings.formname,e=t.settings.options;function s(e){t.form=new ms.formBuilder({name:a,scope:t,submitBtnLabel:e.submitbtnlabel||"submit",fields:e.fields,data:e.data||{},submit:e.submit})}"string"==typeof e&&-1==e.indexOf("{")&&(e=t[e]),a||e?(a&&e&&console.warn("Both form name and options are specified. Using options and ignorning form name"),a?ms.getForm(a).then(function(t){t.submit=function(e){if(t.settings.actions&&t.settings.actions.length)return new Promise(function(a,s){ms.app.call({entity:"ms.forms",command:"performActions",recordId:t._id,data:e.data},function(e,t){e?s(e):a(t)})})},s(t)}):s(e)):console.error("Form name or options must be specified")},substores:function(a,t,s,e,n){a.data={};t.list({entity:"ms.substores",query:{limit:250}},function(e,t){a.records=t.data.records,s.ms.user.store&&s.ms.settings&&s.ms.settings.enable_multistore&&"1"==s.ms.settings.enable_multistore&&a.records.forEach(function(e){e.alias==s.ms.user.store&&(a.getstorename=s.ms.user.store,s.substorename=a.getstorename,console.log("===substorename",s.ms.user,a.getstorename))})}),a.setstore=function(e){var a={entity:"ms.settings",customCommandName:"",data:{store:e.alias}};e.metafields&&e.metafields.language&&(a.data.language=e.metafields.language),t.call("setPreferences",a,function(e,t){console.log("=====setPreferences",a.data,t),location.reload()})}},thread:["$scope","$rootScope",function(a,e){var s,t,n;a.message="",a.thread={},a.messages=[],a.loadMessages=function(){var e;a.thread?(e=a.thread._id,console.log("loading messages for thread_id",e),ms.app.call({entity:"ms.thread_messages",command:"list",version:1,query:{filters:[{field:"thread_id",value:e}],resolve:[{field:"sender_id",child_fields:["first_name","title"]}]}},function(e,t){t=t.data&&t.data.data&&t.data.data.records&&t.data.data.records.reverse();a.messages=t,ms._applyScope()})):console.error("Thread not loaded yet")},a.sendMessage=function(e){if(!(e=!e&&a.message?a.message:e))return alert("Enter some text");ms.app.call({entity:"ms.thread_messages",command:"add",data:{thread_id:a.thread._id,sender_id:ms.user._id,message:e,role:ms.user.role}},function(){a.message=""})},s=function(e){a.thread=e,ms.io().on("thread_message_"+a.thread._id,function(e){console.log("Thread message added",e),a.loadMessages()}),a.loadMessages()},n=[],a.settings.id?n.push({field:"_id",value:a.settings.id}):a.settings.users?(t=a.settings.users.sort().join("-"),n.push({field:"thread_id",value:t})):ms.searchParams.thread_id&&n.push({field:"_id",value:ms.searchParams.thread_id}),ms.app.call({entity:"ms.threads",command:"list",version:1,query:{filters:n}},function(e,t){return e?(console.error("Failed to load thread details"),s(null)):(e=t.data&&t.data.data&&t.data.data.records&&t.data.data.records[0])?s(e):void(a.settings.users&&ms.app.call({entity:"ms.threads",command:"add",data:{users:a.settings.users}},function(e,t){t=t.data&&t.data.data&&t.data.data;s(t)}))})}],otp:["$scope",function(a){ms.otp_verified=!1,a.otp_verified=!1,a.otp_sent=!1,a.sendOtp=function(e){a.error="",a.success="",ms.app.call({entity:"ms.users",command:"sendOtp",data:{phone:e||a.data[a.field.name]}},function(e,t){e?a.error=e.error.name:(a.otp_sent=!0,a.success=t.messages&&t.messages[0]&&t.messages[0].name)})},a.verifyOtp=function(e){a.error="",a.success="",ms.app.call({entity:"ms.users",command:"verifyOtp",data:{phone:e||a.data[a.field.name],otp:a.otp}},function(e,t){e?a.error=e.error.name:(a.otp_verified=!0,ms.trigger("phone_otp_verifed"),a.success=t.messages&&t.messages[0]&&t.messages[0].name,ms.otp_verified=!0,ms._applyScope())})},a.verifyNewOtp=function(e){a.error="",a.success="",ms.app.call({entity:"ms.users",command:"verifyOtpNew",data:{phone:e||a.data[a.field.name],otp:a.otp}},function(e,t){e?a.error=e.error.name:(a.success=t.messages&&t.messages[0]&&t.messages[0].name,ms.otp_verified=!0)})}}],threads:["$scope","$rootScope","$location",function(d,e,t){d.selectedThread,d.tableView=1,d.selectThread=function(e){ms.location.search("thread_id",e),ms.location.search("view",d.tableView),d.selectedThread="",ms.timeout(function(){d.selectedThread=e})},ms.searchParams.view&&(d.tableView=parseInt(ms.searchParams.view)),ms.searchParams.thread_id&&(d.selectedThread=ms.searchParams.thread_id);var l={};d.gotoThread=function(){ms.goTo("entity/ms.threads")},d.updateTicket=function(e,t){e={entity:"ms.threads",command:"edit",recordId:e._id,data:{status:t}};ms.app.call(e,function(e,t){ms.reload()})},d.toggleView=function(e){"list"==e&&(d.tableView=0,ms.goTo("entity/ms.threads?view=0")),"table"==e&&(d.tableView=1,ms.goTo("entity/ms.threads?view=1"))},d.addThread=function(a,s){ms.app.call({entity:"ms.threads",command:"add",data:{subject:a.subject,message:a.message,users:a.users||[]}},function(e,t){ms.app.call({entity:"ms.thread_messages",command:"add",data:{thread_id:t.data._id,sender_id:ms.user._id,message:a.message,role:ms.user.role}},function(){n(s)})})};var n=function(r){var e={entity:"ms.threads",command:"list",version:1,query:{sort:"-last_updated_on"}};"admin"==ms.user.role||ms.user.role.includes("ondc")||(e.query.filters=[{field:"users",value:[ms.user._id],operator:"in"}]),ms.app.call(e,function(e,t){var a=(t.data&&t.data.data||t.data).records;if(a.sort((e,t)=>{e=e.updated_on?new Date(e.updated_on):new Date(e.created_on);return(t.updated_on?new Date(t.updated_on):new Date(t.created_on))-e}),ms.adminTheme){var s,n,o=function(){for(var e of a)e.userDetails=e.users.map(function(e){return l[e]});d.threads=a,d.threads&&d.threads.length&&0==d.tableView&&d.selectThread(d.threads[0]._id),ms._applyScope()},i=[];for(s of a)for(n of s.users||[])l[n]||i.push(n);ms.app.call({entity:"ms.users",command:"list",query:{filters:[{field:"_id",value:i,operator:"in"}],fields:{email:1,first_name:1,role:1,roles:1,entities:1}},version:1},function(e,t){var a;for(a of(t.data&&t.data.data||t.data).records)l[a._id]=a;o()})}else d.threads=a,ms._applyScope();r&&ms.goTo(r)})};ms.io().on("thread_added_"+ms.user._id,function(e){console.log("Thread added",e),n()}),"admin"==ms.user.role&&ms.io().on("thread_added_admin",function(e){console.log("Thread added to admin",e),n()}),n()}],blog:["$scope",function(a){var s=!1,e=50;a.settings.pagesize&&(e=a.settings.pagesize),a.loading=!0,ms.app.list({entity:"ms.blog_posts",version:"1",query:{limit:e,q:{publish:"1"}}},function(e,t){a.records=t&&t.data&&t.data.data&&t.data.data.records,a.records&&a.records.length&&(a.loading=!1,ms.routeParams.blog&&(a.records.forEach(function(e){ms.routeParams.blog==e.alias&&(a.detail=e,e={title:a.detail.title,description:$("<div>"+a.detail.content+"</div>").text()},a.detail.image&&(e.image=ms.filters.image(a.detail.image)),ms.resolveSEO(a,ms.page,a.detail.SEO),ms.resolveOgTags(ms.page,e),s=!0)}),s||ms.notFound()))})}],blog_posts:["$scope",function(a){a.loading=!0;var e={entity:"ms.blog_posts",query:{q:{publish:"1"}}};a.settings.fields&&(e.query.fields=a.settings.fields),a.settings.pagesize&&(e.query.limit=a.settings.pagesize),ms.app.list(e,function(e,t){e?console.log("No blog posts found"):(t&&t.data&&t.data.records||ms.notFound(),t&&t.data&&t.data.records&&(a.blog_by_title=[],t.data.records.forEach(function(e){ms.routeParams.blog&&ms.routeParams.blog==e.alias&&(a.detail=e),ms.routeParams.tag&&e.tags&&-1<e.tags.indexOf(ms.routeParams.tag)&&a.blog_by_title.push(e)}),"blog_detail"!==ms.page.name||a.detail||ms.notFound(),"blog_tag"!==ms.page.name||a.blog_by_title.length||ms.notFound(),a.blogPosts=t.data.records),a.loading=!1,ms.app.list({entity:"ms.blogs"},function(e,t){e?console.log("No blog found"):(t&&t.data&&t.data.records||ms.notFound(),t&&t.data&&t.data.records&&(t.data.records.forEach(function(e){ms.routeParams.blog&&ms.routeParams.blog==e.alias&&(a.found=!0)}),"blogs"!==ms.page.name||a.found||ms.notFound(),a.blogs=t.data.records))}),e={title:a.detail.title,description:$("<div>"+a.detail.content+"</div>").text()},a.detail.image&&(e.image=ms.filters.image(a.detail.image)),a.detail.SEO.title&&""!=a.detail.SEO.title||(a.detail.SEO.title=a.detail.title),ms.resolveSEO(a,ms.page,a.detail.SEO),ms.resolveOgTags(ms.page,e))})}],blog_post:["$scope",function(n){n.loading=!0;var e={entity:"ms.blog_posts",query:{q:{alias:ms.routeParams.blog}}};ms.app.list(e,function(t,a){if(n.loading=!1,t)alert("This blog is not available. Please check another one ");else{t=a.data.records[0];n.detail=t,n.detail.blogContent=[];let e=$("<div>"+n.detail.content+"</div>");e.find("h2 ,h3 ,h4").each(function(e){var t=$(this),a=(t.attr("id","contentId"+e+1),"H1"==t[0].tagName?"outerparent":"H2"==t[0].tagName?"parent":"H3"==t[0].tagName?"child":"inner-child");t[0].innerText&&n.detail.blogContent.push({name:t[0].innerText,id:"sidebarcontentId"+e+1,align:a})}),n.detail.content=e[0].innerHTML,t&&t.blog&&(a={entity:"ms.blogs",query:{q:{_id:t.blog}}},ms.app.list(a,function(e,t){e?console.log("====no blog founD for this blog post"):n.blogType=t.data.records[0].title}));var t={title:n.detail.title,description:$("<div>"+n.detail.content+"</div>").text()},a=(n.detail.image&&(t.image=ms.filters.image(n.detail.image)),n.detail.SEO.title&&""!=n.detail.SEO.title||(n.detail.SEO.title=n.detail.title),n.detail.content),a=$("<div />").html(a),s=document.createElement("div"),s=(s.id="toc",a.find("h2").before(s),n.detail.content=a.html(),n.detail.SEO||{});s.title=s.title||n.detail.title,s.description=s.description||t.description,ms.updateSEO({title:s.title,description:s.description,image:t.image,keywords:s.keywords,canonical_url:s.canonical_url}),ms.resolveSEO(n,ms.page,n.detail.SEO),ms.resolveOgTags(ms.page,t)}})}],order:["$scope",function(a){var e=a.settings.id,e=(a.error=!1,{entity:"ms.orders",recordId:e=e||ms.routeParams.id,query:{relations:[{name:"fulfillments_new"}]}});e.query.relations=JSON.stringify(e.query.relations),ms.app.get(e,function(e,t){e?a.error("Something went wrong"):a.order=t.data})}],dialog:["$scope","$element",function(e,t){e.settings.widget&&("click"==(e.settings.trigger||"load")?t.on("click",function(){ms.dialog({widget:e.settings.widget,widgetScope:e}).showModal()}):ms.dialog({widget:e.settings.widget,widgetScope:e}).showModal())}],returnOrder:["$scope","$element","$rootScope","app",function(i,e,t,a){window.mystore.formValidator(i,a),i.submit=function(){var e,t,a;if(i.submitting)console.log("request are under progress pls wait");else if(i.submitValid())if(ms.settings.enable_product_return&&"full"==i.fields.return_type)if(i.returnData.order.items.filter(e=>!e.product.enable_return||"1"!=e.product.enable_return).length==i.returnData.order.items.length)o();else for(var s=0;s<i.returnData.order.items.length;s++){if(e)return;if(i.returnData.order.items[s].product&&i.returnData.order.items[s].product.enable_return&&i.returnData.order.items[s].product.return_days){var n=new Date;if(t=i.returnData.order.delivered_on,a=i.returnData.order.items[s].product.return_days,(t=new Date(t)).setDate(t.getDate()+a),t<n)return e=!0,void alert("Not Eligible for Return");s+1!=i.returnData.length||e||o()}else e=!0,alert("Not Eligible for Return")}else o()};var o=function(){i.submitting=!0;var s,n,e={entity:"ms.orders",data:i.fields},t=(e.data.order_id=i.order._id,i.returnData&&i.returnData.order&&i.returnData.order._id&&(e.data.order_id=i.returnData.order._id),i.fields),o={};angular.forEach(t,function(e,t){var a;-1<t.indexOf(".")&&(a=t.split("."),s=a[0],n=a[1],i.fields[s]||(i.fields[s]={}),i.fields[s][n]=e,o[t]=i.fields[t],delete i.fields[t])}),a.call("returnOrder",e,function(e,t){if(i.submitting=!1,e||!t||!t.data)return alert("Error while placing the return request. Please try again later.");alert("Return Request submitted successfully!"),i.fields={},ms.reload()})}}],return_order_items:["$scope",function(i){i.applicable_return_items=[],i.returnData.order.returned_items&&i.returnData.order.returned_items.length?i.returnData.order.items.forEach(function(e){for(var t of i.returnData.order.returned_items)if(t._id==e._id){var a=JSON.parse(JSON.stringify(e)),s=parseFloat(e.quantity)-parseFloat(t.quantity),n=!1;if(0<s&&i.applicable_return_items.length)for(var o of i.applicable_return_items)o._id==t._id&&(a.quantity+=s,n=!0);!n&&0<s&&(a.quantity=s,i.applicable_return_items.push(a))}}):i.applicable_return_items=i.returnData.order.items,i.returnData.selected_items=[],i.checkValidate=function(e,t){return e.quantity>t?(alert("Return Quantity can't be more than actual quantity"),e.quantity=t):e.quantity<=0?(alert("Return Quantity can't 0 or negative"),e.quantity=t):void 0},i.toggleSelectionRefund=function(e,t,a){var s=i.applicable_return_items.filter(function(e){return e.checked});i.returnData.selected_items=s,i.fields[i.field.name]=s},i.checkforReturn=function(e){var t,a;return!!ms.settings.enable_product_return&&(!e.product.enable_return||(t=new Date,a=i.returnData.order.delivered_on,e=e.product.return_days,(a=new Date(a)).setDate(a.getDate()+e),!(t<a)))}}],addtoany:function(){ms.loadScripts("https://static.addtoany.com/menu/page.js").then(function(){a2a&&a2a.init_all()})},newsletter:["$rootScope","$scope","app",function(e,n,t){e.$on("$stateChangeStart",function(e,t,a,s){n.submit_form_flag=!1,n.form_data={}}),n.submit_form_flag=!1,n.submit_form=function(e){n.submit_form_flag=!0;e={entity:"ms.user_list_members",data:{type_id:"5ad748eec73c2f2408872c23",type:"email",email:e.email}};t.add(e,function(e,t){if(e)throw e})}}],productEnquiry:["$scope","$rootScope","$location","$element","app","$attrs",function(o,t,a,e,s,i){"seller"==o.settings.type&&e.bind("click",function(){var e=t.ms.user,e={sellerEnquiry:1,seller_id:o.product.seller,product_name:o.product.name,first_name:e.first_name,email:e.email,phone:e.phone};ms.app.call("sendQuery",{entity:"ms.product_enquiries",data:e},function(e,t){!e&&t&&a.path("/sellers/"+o.product.seller)})}),window.mystore.formValidator(o,s),o.submit=function(){var e,s,n,t;console.log("submitting Enquiry Form "),o.submitting||o.submitValid()&&(o.submitting=!0,o.product&&o.product._id&&(o.fields.product_id=o.product._id),o.product&&o.product.seller&&(o.fields.seller_id=o.product.seller),o.product&&o.product.sku&&(o.fields.sku=o.product.sku),e={entity:"ms.product_enquiries",data:o.fields},n=s="",t=o.fields,angular.forEach(t,function(e,t){var a;-1<t.indexOf(".")&&(a=t.split("."),s=a[0],n=a[1],o.fields[s]||(o.fields[s]={}),o.fields[s][n]=e,console.log("Splitting Fields",o.fields,s,n),delete o.fields[t])}),ms.app.call("sendQuery",e,function(e,t){o.submitting=!1,$(".modal").modal&&$(".modal").modal("hide"),e?console.log("error occured",e):($(".product_enquiry")&&($(".product_enquiry").remove(),$(".enquiry_message.hidden")&&$(".enquiry_message.hidden").removeClass("hidden")),o.fields={},o.$parent.$parent.$eval(i.msSuccess))}))}}],quoteRequest:["$rootScope","$scope",function(e,t){var s={};ms.bind("ms.page_loaded",function(){if(s.email=ms.user&&ms.user.email,s.items=[],ms.cart&&ms.cart.items)for(let e=0;e<ms.cart.items.length;e++){var t=ms.cart.items[e],a={};a.description=t.name,a.product=t.product_id,a.quantity=t.quantity,a.sku=t.product_sku,s.items.push(a)}}),ms.user&&ms.user._id&&(s.user=ms.user._id),ms.entityToForm("ms.quote_requests").then(function(e){e=e.filter(e=>"user"!=e.name&&"request_id"!=e.name);t.form=new ms.formBuilder({name:"quote_request",scope:t,submitBtnLabel:"submit",fields:e,data:s,submit:function(e){return new Promise(function(a,s){ms.app.call({entity:"ms.quote_requests",command:"add",data:e.data},function(e,t){e?s(e):a(t)})})}}),console.log("FORM",t.form)})}]},{linkedProducts:["$scope","app","$stateParams","$rootScope","$filter","$location","$compile","$timeout","$http",function(p,g,f,h,_,e,t,a,s){var v,y,b,w,k,S,O,n=null;p.settings.product&&(n=p.settings.product),f.product&&(n=f.product),(n=p.settings&&p.settings.product?p.settings.product:n)?(p.settings.showalloptions||(p.settings.showalloptions=!1),p.settings.showallvalues||(p.settings.showallvalues=!1),p.product={},p.product_images=[],p.options={},p.option_values={},p.featured_image={},p.related_products=[],p.loading=!0,v={},y=[],b=[],p.settings.showalloptions,w=p.settings.showallvalues,k={},S=[],O=[],h.$on("ReviewAdded",function(){var e={entity:"ms.products",query:{q:{alias:f.product}},httpcache:!0,cache:!0};g.list(e,function(e,t){e||(p.product=t.data.records[0])})}),n={entity:"ms.products",query:{q:{alias:n}},httpcache:!0,cache:!0},g.list(n,function(e,t){var o,n,a,s,i,r,d,l,c,m,u;p.loading=!1,e||!t.data.records||0==t.data.records.length?f.product&&h.ms.page&&"product"==h.ms.page.name&&h.ms.notFound():(g.struct({entity:"ms.products",httpcache:!0,cache:!0},function(e,t){e||(angular.forEach(t.data.fields,function(e){e.settings&&e.settings.configurable&&"1"==e.settings.configurable&&1==e.settings.configurable&&b.push(e.name)}),angular.forEach(b,function(e){v[e]=p.product[e]}),v.original_price=p.product.original_price)}),p.product=t.data.records[0],p.product.metafields&&p.product.metafields.size_chart&&h.$broadcast("ProductSizeChart",{file:p.product.metafields.size_chart}),p.product_images=p.product.images,p.featured_image=p.product.images&&p.product.images.length?p.product.images[0]:{},p.product.selected_options={},p.product.selected_variant={},h.ms.page.title=p.product.name,h.ms.resolveSEO(p,h.ms.page,p.product.SEO),e={title:p.product.name,description:$("<div>"+p.product.description+"</div>").text()},p.featured_image&&p.featured_image.image&&(e.image=_("image")(p.featured_image.image)),h.ms.resolveOgTags(h.ms.page,e),"0"==p.product.available||0==p.product.available?p.product.available=!1:p.product.available=!0,p.$watch("related_products",function(e,t){e&&e.length&&angular.forEach(p.related_products,function(e,t){e.alias==p.product.alias&&p.related_products.splice(t,1)})}),h.$watch("ms.categories",function(e,t){var o;e&&(o=!0,angular.forEach(e,function(t){var a,s,n;o&&(-1!=p.product.categories.indexOf(t.alias)?(delete(a=angular.copy(t)).children,t.children.length?(s=0,n={},angular.forEach(t.children,function(e){s++,-1!=p.product.categories.indexOf(e.alias)&&delete(n=angular.copy(e)).children,s==t.children.length&&(Object.keys(n).length?(p.product.category=n,p.product.category.parent=a):p.product.category=a,p.settings.page_size=12,p.settings.paginationLimit=4,p.settings.filters=[{field:"categories",type:"manual",value:p.product.category.alias},{field:"publish",type:"manual",value:"1"}],p.settings.entity="ms.products",mystore.entityController(p,"related_products"))})):(p.product.category=a,p.settings.page_size=12,p.settings.filters=[{field:"categories",type:"manual",value:p.product.category.alias},{field:"publish",type:"manual",value:"1"}],p.settings.entity="ms.products",mystore.entityController(p,"related_products")),o=!1):t.children&&t.children.length&&angular.forEach(t.children,function(e){var t,a,s;o&&-1!=p.product.categories.indexOf(e.alias)&&(delete(t=angular.copy(e)).children,e.children.length?(a=0,s={},angular.forEach(e.children,function(e){a++,-1!=p.product.categories.indexOf(e.alias)&&delete(s=angular.copy(e)).children,a==e.children.length&&(Object.keys(s).length?(p.product.category=s,p.product.category.parent=t):p.product.category=t,p.settings.page_size=12,p.settings.filters=[{field:"categories",type:"manual",value:p.product.category.alias},{field:"publish",type:"manual",value:"1"}],p.settings.entity="ms.products",mystore.entityController(p,"related_products"))})):(p.product.category=t,p.settings.page_size=12,p.settings.filters=[{field:"categories",type:"manual",value:p.product.category.alias},{field:"publish",type:"manual",value:"1"}],p.settings.entity="ms.products",mystore.entityController(p,"related_products")),o=!1)}))}))}),p.load_featured_image=function(e){p.featured_image=e},o=function(){p.quantity={managing:!1,available:0},"automatic"!=p.product.inventory_management&&(p.product.available=!0),"automatic"==p.product.inventory_management&&"product"==p.product.inventory_management_level&&(0<p.product.inventory_quantity||"1"==p.product.inventory_allow_out_of_stock?p.product.available=!0:p.product.available=!1,0<=p.product.inventory_quantity&&(p.quantity={managing:!0,available:p.product.inventory_quantity})),"automatic"==p.product.inventory_management&&"variant"==p.product.inventory_management_level&&("automatic"!=p.product.selected_variant.inventory_management||0<p.product.selected_variant.inventory_quantity||"1"==p.product.selected_variant.inventory_allow_out_of_stock?p.product.available=!0:p.product.available=!1,0<=p.product.selected_variant.inventory_quantity&&(p.quantity={managing:!0,available:p.product.selected_variant.inventory_quantity}))},n=function(){var a=!1;return angular.forEach(p.options,function(e,t){p.options[t].required&&"1"==p.options[t].required&&(p.options[t].show=!1),p.product.selected_options[t]&&""!=p.product.selected_options[t]||(p.options[t].show=!0,a=!0)}),a},p.check_required_options=function(e,t){var a,s;return"automatic"!=e.inventory_management||"product"==e.inventory_management_level?(n()||h.ms.cart.add_product(e,t),!0):void("variant"==e.inventory_management_level&&(p.product.selected_variant&&Object.keys(p.product.selected_variant).length&&(s=!1,angular.forEach(p.options,function(e,t){-1==S.indexOf(p.options[t].name)&&p.options[t].required&&"1"==p.options[t].required&&(p.options[t].show=!1,p.product.selected_options[t]&&""!=p.product.selected_options[t]||(p.options[t].show=!0,s=!0))}),!s)?h.ms.cart.add_product(p.product,t):(e=" Please select ",a=[],angular.forEach(y[0].options,function(e,t){a.push(e.name)}),e=" Please select "+a.join(","),alert(e+" for product"))))},a=function(){var s,a,e;p.product.options&&p.product.options.length?(p.product.inventory_management_level="variant",p.product.product_has_multiple_variants="1",k=[],s={},a=function(){angular.forEach(p.product.options,function(e){e.name=e.name.toLowerCase();var t,a={_id:e._id,name:e.name,display_name:e.name,type:"dropdown",values:[]};s[e.name]&&((t=s[e.name]).display_name&&(a.display_name=t.display_name),t.type&&(a.type=t.type),t.required&&(a.required=t.required),t.default_value&&(a.default_value=t.default_value)),angular.forEach(e.values,function(e){a.values.push({label:e,value:e})}),k.push(a)});t=k,n=[],w?angular.forEach(t,function(a,e){var s=[];angular.forEach(a.values,function(e,t){e.available=!0,s.push(e),++t==a.values.length&&(a.values=s,n.push(a))})}):angular.forEach(t,function(e,t){var a,s=e.name.toLowerCase();p.linkedProductsOptions[s]&&(a=[],angular.forEach(p.linkedProductsOptions[s],function(e){a.push({label:e,value:e,available:!0})}),e.values=a,n.push(e))});var e,n,t=n;for(e in p.options={},angular.forEach(t,function(e){var t={display_name:e.display_name,name:e.name,type:e.type,default_value:e.default_value,available:!0,required:"0"};e.required&&"1"==e.required&&(t.required="1",t.required_message=e.required_message||"Please select "+e.display_name,t.show=!1),p.option_values[e.name]=e.values,p.options[e.name]=t,k[e.name]=t}),O=[],p.options)O.push(e);o()},p.product.option_set?(e={entity:"ms.option_set",query:{_id:p.product.option_set},httpcache:!0,cache:!0},g.list(e,function(e,t){e||(e=t.data.records[0],angular.forEach(e.options,function(e){e.name=e.name.toLowerCase(),s[e.name]=e})),a()})):a()):o()},s=function(e,a){var t,s,n=null;return e.options&&e.options.length&&(t=[],e.options.forEach(function(e){e.name&&t.push(e.name.toLowerCase())}),t.sort(),s=[],t.forEach(function(e){var t="#";a&&e&&a[e]&&(t=a[e]),s.push(t)}),n=s.join("|")),n},r=i=0,u=d="",p.showPrevious=!10,p.showNext=!1,p.settings.sortfield&&(d=p.settings.sortfield),l=function(e,t,a){t={entity:"ms.linked_products",query:{loadOptions:t,start:i,limit:10,sort:d,resolve:[{field:"vendor",child_fields:["first_name","last_name","email"]}],q:{product_id:p.product._id,publish:"1"}},httpcache:!0,cache:!0};e&&(t.query.q.variant_id=e),p.linkedProductsLoading=!0,p.loading=!0,g.list(t,function(e,t){p.linkedProductsLoading=!1,p.loading=!1,a(e,t)})},c=function(){p.showPrevious=0!=i,p.showNext=10+i<r},p.next=function(){i+=10,l(null,0,function(e,t){e||t.data&&t.data.records&&(p.linkedProducts=[],t.data.records.forEach(function(e){p.linkedProducts.push(m(e)),c()}))})},p.previous=function(){i-=10,l(null,0,function(e,t){e||t.data&&t.data.records&&(p.linkedProducts=[],t.data.records.forEach(function(e){p.linkedProducts.push(m(e)),c()}))})},p.loadMore=function(){p.showNext&&(i+=10,l(null,0,function(e,t){e||t.data&&t.data.records&&t.data.records.forEach(function(e){p.linkedProducts.push(m(e))})}))},m=function(e){var t=JSON.parse(JSON.stringify(p.product));return t.price=e.price,t.compare_price=e.compare_price,t.variant_id=e.variant_id,t.tax_rule=e.tax_rule,t.sku=e.sku,t.inventory_quantity=e.inventory_quantity,t.barcode=e.barcode,t.estimated_delivery_time=e.estimated_delivery_time,t.estimated_dispatch_time=e.estimated_dispatch_time,t._resolvedData=e._resolvedData,t.metafields||(t.metafields={}),t.selected_variant={},t.selected_options={},t.metafields.vendor=e.vendor,t.original_price=e.price,e.variant_id&&(t.selected_variant={},t.selected_variant.variant_id=e.variant_id),t},p.linkedProducts=[],u=null,p.product.options&&p.product.options.length&&(p.product.selected_options={},p.product.options.forEach(function(e){var t=e.name.toLowerCase();e.name=t,p.product.selected_options[t]="",e.values&&(p.product.selected_options[t]=e.values[0])}),u=s(p.product,p.product.selected_options)),l(u,1,function(e,t){e||t.data&&t.data.records&&(r=t.data.total,t.data&&t.data.options&&(p.linkedProductsOptions=t.data.options,a()),t.data.records.forEach(function(e){p.linkedProducts.push(m(e))}))}),p.loadLinkedProductWithVariant=function(){(u=s(p.product,p.product.selected_options))&&l(u,0,function(e,t){e||(p.linkedProducts=[],t.data&&t.data.records&&(r=t.data.total,t.data.records.forEach(function(e){p.linkedProducts.push(m(e))})))})})})):p.error("Could not find :product in the URL params")}],productNew:["$scope","app","$stateParams","$rootScope","$filter","$location","$compile","$timeout","$http",function(a,e,s,n,t,o,i,r,d){var l=null;a.settings.product&&(l=a.settings.product),s.product&&(l=s.product),(l=a.settings&&a.settings.product?a.settings.product:l)?(a.settings.showalloptions||(a.settings.showalloptions=!1),a.settings.showallvalues||(a.settings.showallvalues=!1),a.product={},a.product_images=[],a.options={},a.option_values={},a.featured_image={},a.related_products=[],a.loading=!0,a.settings.showalloptions,a.settings.showallvalues,(void 0)(),e.list({entity:"ms.products",query:{q:{alias:l}},httpcache:!0,cache:!0},function(e,t){a.loading=!1,e||!t.data.records||0==t.data.records.length?s.product&&n.ms.page&&"product"==n.ms.page.name&&n.ms.notFound():((void 0)(),(void 0)(),(void 0)(),(void 0)(),(void 0)(),(void 0)(),(void 0)())})):a.error("Could not find :product in the URL params")}],tag:["$scope","app","$stateParams",function(a,e,t){var s=a.settings.tag;if(s=s||t.tag){a.products=[];var n=s,o=function(e){a.tag=e,a.settings.filters=[{field:"publish",type:"manual",value:"1"}],"manual"==a.tag.type?a.settings.filters.push({field:"publish",type:"manual",value:"1"}):"dynamic"==a.tag.type&&a.tag.filters&&a.tag.filters.length&&a.tag.filters.forEach(function(e){a.settings.filters.push(e)}),a.settings.entity="ms.products",mystore.entityController(a,"products")};if(window.cacheEntities["ms.collections"])for(var i=JSON.parse(JSON.stringify(window.cacheEntities["ms.collections"])),r=0;r<i.length;r++){var d=i[r];if(d.alias==n)return void o(d)}else e.list({entity:"ms.collections",query:{q:{alias:n}},httpcache:!0,cache:!0},function(e,t){e||(t.data.records&&0!=t.data.records.length?o(t.data.records[0]):a.error("Tag ["+n+"] not found"))})}else a.error("MS: ERROR: Tag not specified in settings or in url. Not proceeding")}],addRecord:["$scope","$rootScope","$location","$element","app","$attrs",function(a,s,e,t,n,o){a.loading=!1,a.view=!0,a.form={fields:[],data:{}},a.settings&&a.settings.entity?(a.loading=!0,a.submitting=!1,n.struct({entity:a.settings.entity},function(e,t){e||(a.loading=!1,a.form.fields=t.data.fields)}),a.submit=function(){var e;a.loading||a.submitting||(a.invalid=!1,a.submitting=!0,a.errors=validation.formValidation(a.form.fields,a.form.data,a.partial_updatable),0!==Object.keys(a.errors).length?a.invalid=!0:(e={entity:a.settings.entity,data:a.form.data},n.add(e,function(e,t){a.submitting=!1,e||(a.form.data._id=t.data._id,s.ms.showMessage("Data Added successfully"),a.$parent.$parent.$eval(o.msSuccess),a.data=a.form.data)})))}):a.error("Error : Entity name not specified")}],consultation:["$scope","$http","$rootScope","$location","$element","app","$attrs",function(i,e,s,t,a,r,n){i.widgetName="consultation",i.action="add",i.loading=!1,i.view=!0,i.form={},i.messageForm={},i.condition={step:1},i.caseClose=!1,i.multipledoctors=[],i.attach_Report=[],i.$on("update_parent_controller",function(e,t){i.multipledoctors=t}),i.$on("update_controller",function(e,t){i.attach_Report=t});var o,d,l,c=[];i.settings&&i.settings.entity?(i.settings.value,o=function(e,t,a){var s;e&&t&&(i.loading=!0,(s={q:{}}).q[e]=t,i.settings.resolve&&(s.resolve=i.settings.resolve),e={entity:i.settings.entity,query:s,httpcache:!0,cache:!0},r.list(e,function(e,t){i.loading=!1,e?alert("Error occured in geting the record data "+i.settings.entity):(t.data&&t.data.records&&t.data.records.length&&(i.data=t.data.records[0],i.form.data=angular.copy(i.data),i.action="edit",i.data.prescription&&i.data.prescription.rx&&(new Date(i.data.updated_on).getTime()+864e6<(new Date).getTime()&&(i.caseClose=!0))),a&&a())}))},i.loading=!0,r.struct({entity:i.settings.entity},function(e,t){e||(i.loading=!1,e=t.data,i.partial_updatable=!("1"==e.settings.not_partial_updatable),i.form.fields=e.fields,angular.forEach(e.fields,function(e){"messages"==e.name&&(i.messageForm.fields=e.fields,i.messageForm.data={})}),i.form.data={},i.settings.field&&i.settings.value&&o(i.settings.field,i.settings.value,l))}),i.slidetoframe=function(e){$(".carousel").carousel(e)},i.validate=function(e){return i.invalid=!1,i.errors=validation.formValidation(i.form.fields,i.form.data,i.partial_updatable),0!==Object.keys(i.errors).length&&(i.invalid=!0),!i.invalid&&e&&(i.condition.step=e),!i.invalid&&e&&$(".carousel").carousel("next"),!i.invalid},i.submitting=!1,d=function(){var e,t,a;s.ms.user&&s.ms.user.isLoggedIn&&s.ms.user.metafields&&(s.ms.user.metafields.corporate_group||s.ms.user.metafields.insurance_company)?"aegis"==s.ms.user.metafields.corporate_group||"usgi"==s.ms.user.metafields.insurance_company?(t=(e=new Date).getMonth(),a=e.getFullYear(),a=new Date(a,t,1),t=new Date(e).setTime(e.getTime()+3e5),e=new Date(t),(t={entity:"consultations",query:{filters:[{field:"user_id",operator:"equal",value:s.ms.user._id},{field:"status",operator:"equal",value:"paid"},{field:"created_on",operator:"greater_than_or_equal",value:a},{field:"created_on",operator:"less_than",value:e}]},httpcache:!0,cache:!0}).query.filters=JSON.stringify(t.query.filters),r.list(t,function(e,t){t&&0==t.data.records.length?angular.forEach(i.data,function(e,t){t<=1?(e._resolvedData.doctor.original_fee=e._resolvedData.doctor.fee,e._resolvedData.doctor.fee=0):(t=parseFloat(e._resolvedData.doctor.fee),t-=10*t/100,e._resolvedData.doctor.original_fee=e._resolvedData.doctor.fee,e._resolvedData.doctor.fee=t)}):t&&1==t.data.records.length?angular.forEach(i.data,function(e,t){0==t?(e._resolvedData.doctor.original_fee=e._resolvedData.doctor.fee,e._resolvedData.doctor.fee=0):(t=parseFloat(e._resolvedData.doctor.fee),t-=10*t/100,e._resolvedData.doctor.original_fee=e._resolvedData.doctor.fee,e._resolvedData.doctor.fee=t)}):i.data.forEach(function(e){var t=parseFloat(e._resolvedData.doctor.fee);t-=10*t/100,e._resolvedData.doctor.original_fee=e._resolvedData.doctor.fee,e._resolvedData.doctor.fee=t}),i.processing=!1})):(a={entity:"corporate_groups",query:{q:{corporate_Name:s.ms.user.metafields.corporate_group}},httpcache:i.loading=!0,cache:!0},r.list(a,function(e,t){var a;e||(i.loading=!1,t.data.records&&t.data.records.length&&((e=t.data.records[0]).services&&(a=null,angular.forEach(e.services,function(e){a||i.data.service==e.service&&(a=e)}),a&&(t=parseFloat(i.data._resolvedData.doctor.fee),a.discount&&(t-=t*parseFloat(a.discount)/100),a.employer_paid&&(t-=t*parseFloat(a.employer_paid)/100),i.data._resolvedData.doctor.original_fee=i.data._resolvedData.doctor.fee,i.data._resolvedData.doctor.fee=t)),i.processing=!1))})):i.processing=!1},l=function(){var e,t,a;s.ms.user&&s.ms.user.isLoggedIn&&s.ms.user.metafields&&(s.ms.user.metafields.corporate_group||s.ms.user.metafields.insurance_company)?"aegis"==s.ms.user.metafields.corporate_group||"usgi"==s.ms.user.metafields.insurance_company?(t=(e=new Date).getMonth(),a=e.getFullYear(),a=new Date(a,t,1),t=new Date(e).setTime(e.getTime()+3e5),e=new Date(t),(t={entity:"consultations",query:{filters:[{field:"user_id",operator:"equal",value:s.ms.user._id},{field:"status",operator:"equal",value:"paid"},{field:"created_on",operator:"greater_than_or_equal",value:a},{field:"created_on",operator:"less_than",value:e}]},httpcache:!0,cache:!0}).query.filters=JSON.stringify(t.query.filters),r.list(t,function(e,t){t&&t.data.records.length<2?(i.data._resolvedData.doctor.original_fee=i.data._resolvedData.doctor.fee,i.data._resolvedData.doctor.fee=0):(t=parseFloat(i.data._resolvedData.doctor.fee),t-=10*t/100,i.data._resolvedData.doctor.original_fee=i.data._resolvedData.doctor.fee,i.data._resolvedData.doctor.fee=t),i.processing=!1})):(a={entity:"corporate_groups",query:{q:{corporate_Name:s.ms.user.metafields.corporate_group}},httpcache:i.loading=!0,cache:!0},r.list(a,function(e,t){var a;e||(i.loading=!1,t.data.records&&t.data.records.length&&((e=t.data.records[0]).services&&(a=null,angular.forEach(e.services,function(e){a||i.data.service==e.service&&(a=e)}),a&&(t=parseFloat(i.data._resolvedData.doctor.fee),a.discount&&(t-=t*parseFloat(a.discount)/100),a.employer_paid&&(t-=t*parseFloat(a.employer_paid)/100),i.data._resolvedData.doctor.original_fee=i.data._resolvedData.doctor.fee,i.data._resolvedData.doctor.fee=t),i.processing=!1)))})):i.processing=!1},i.send=function(a){var e;i.loading||i.submitting||i.validate()&&(i.submitting=!0,i.settings.field&&i.settings.value&&(i.form.data[i.settings.field]=i.settings.value),e={entity:i.settings.entity,data:i.form.data},"add"==i.action?r.add(e,function(e,t){i.submitting=!1,e||(i.form.data._id=t.data._id,i.action="edit",i.condition.step=a,i.processing=!0,o("_id",i.form.data._id,l))}):(e.recordId=i.form.data._id,r.update(e,function(e,t){i.submitting=!1,e||(i.condition.step=a,i.processing=!0,o("_id",i.form.data._id,l))})))},i.senddata=function(n){var o;i.loading||i.submitting||i.validate()&&(i.submitting=!0,i.settings.field&&i.settings.value&&(i.form.data[i.settings.field]=i.settings.value),o=function(a,s){if(!a.length)return s();var e=a.shift(),t=JSON.parse(JSON.stringify(i.form.data)),e=(t.speciality=e.speciality,t.doctor=e.doctor,t.incident.attach_Report=i.attach_Report,{entity:i.settings.entity,data:t});"add"==i.action&&r.add(e,function(e,t){i.submitting=!1,e||(i.condition.step=n,c.push(t.data._id)),o(a,s)})},i.multipledoctors&&(i.processing=!0,o(i.multipledoctors.slice(0),function(){var e,t,a,s;t=c,a=d,(e="_id")&&t&&(i.loading=!0,(s={}).filters=[{field:e,operator:"in",value:t}],i.settings.resolve&&(s.resolve=i.settings.resolve),(e={entity:i.settings.entity,query:s,httpcache:!0,cache:!0}).query.filters=JSON.stringify(e.query.filters),r.list(e,function(e,t){i.loading=!1,e?alert("Error occured in getting the record data "+i.settings.entity):(t.data&&t.data.records&&t.data.records.length&&(i.data=t.data.records),a&&a())}))})))},i.submit=function(e){var t;i.loading||i.submitting||i.validate()&&(i.submitting=!0,i.settings.field&&i.settings.value&&(i.form.data[i.settings.field]=i.settings.value),t={entity:i.settings.entity,data:i.form.data},"add"==i.action?r.add(t,function(e,t){i.submitting=!1,e||(i.form.data._id=t.data._id,i.action="edit",i.$parent.$parent.$eval(n.msSuccess),o("_id",i.form.data._id))}):(t.recordId=i.form.data._id,r.update(t,function(e,t){i.submitting=!1,e||(i.$parent.$parent.$eval(n.msSuccess),o("_id",i.form.data._id))})))},i.addMessage=function(){var e;i.loading||i.submitting||(i.MessageErrors=validation.formValidation(i.messageForm.fields,i.messageForm.data,i.partial_updatable),0===Object.keys(i.MessageErrors).length&&(i.settings.entity,i.data._id,i.submitting=!0,i.loading=!0,e={entity:i.settings.entity,recordId:i.data._id,field:"messages",data:i.messageForm.data},r.add(e,function(e,t){e?alert("error occured in posting the data in subRecord"):(i.view=!0,i.submitting=!1,i.messageForm.data="",o("_id",i.data._id))})))},i.showForm=function(){i.view=!1}):alert("Error : Entity name not specified for ms.form.entityconsultation widgets")}],recordAddEdit:["$scope","$rootScope","$location","$element","app","$attrs",function(n,e,t,a,o,i){var r;n.widgetName="ms.form.entityAddEdit",n.action="add",n.loading=!1,n.view=!0,n.form={},n.form.data={},n.settings&&n.settings.entity?(n.settings.value,r=function(e,t){var a;e&&t&&(n.loading=!0,(a={q:{}}).q[e]=t,n.settings.resolve&&(a.resolve=n.settings.resolve),e={entity:n.settings.entity,query:a},o.list(e,function(e,t){n.loading=!1,e?alert("Error occured in getting the record data "+n.settings.entity,e):t.data&&t.data.records&&t.data.records.length&&(n.data=t.data.records[0],n.action="edit")}))},n.loading=!0,o.struct({entity:n.settings.entity},function(e,t){e||(n.loading=!1,e=t.data,n.partial_updatable=!("1"==e.settings.not_partial_updatable),n.form.fields=[],angular.forEach(e.fields,function(e){(!e.settings||"collection"!=e.settings.edit_type||"true"==n.settings.collectioninline)&&n.form.fields.push(e)}),n.settings.field&&n.settings.value&&r(n.settings.field,n.settings.value))}),n.showForm=function(e){n.view=!1,n.form.data=e?angular.copy(e):{}},n.cancel=function(){n.view=!0,n.errors=null},n.submitting=!1,n.submitbygroup=function(t){n.invalid=!1;var e,a=[],s={};n.form.fields.forEach(function(e){e.settings.field_groups&&-1<e.settings.field_groups.indexOf(t)&&(a.push(e),s[e.name]=n.form.data[e.name])}),n.errors=validation.formValidation(a,s,!1),0!==Object.keys(n.errors).length?n.invalid=!0:(n.submitting=!0,n.settings.field&&n.settings.value&&(n.form.data[n.settings.field]=n.settings.value),e={entity:n.settings.entity,data:n.form.data},"add"==n.action?o.add(e,function(e,t){n.view=!0,n.submitting=!1,e||(n.form.data._id=t.data._id,n.$parent.$parent.$eval(i.msSuccess),n.action="edit",r("_id",n.form.data._id))}):(e.recordId=n.form.data._id,o.update(e,function(e,t){n.view=!0,n.submitting=!1,e||(n.$parent.$parent.$eval(i.msSuccess),r("_id",n.form.data._id))})))},n.submitbyfield=function(e,t){n.invalid=!1,e&&(n.form.fields1=e,n.form.data1=n.form.data[e.name]),n.errors=validation.formValidation(n.form.fields1.fields,n.form.data1,n.partial_updatable),0!==Object.keys(n.errors).length?n.invalid=!0:(n.submitting=!0,n.settings.field&&n.settings.value&&(n.form.data[n.settings.field]=n.settings.value),e={entity:n.settings.entity,data:n.form.data},"add"==n.action?o.add(e,function(e,t){n.view=!0,n.submitting=!1,e||(n.form.data._id=t.data._id,n.action="edit",i.msSuccess?n.$parent.$parent.$eval(i.msSuccess):r("_id",n.form.data._id))}):(t&&(n.form.data._id=t),e.recordId=n.form.data._id,o.update(e,function(e,t){n.view=!0,n.submitting=!1,e||r("_id",n.form.data._id)})))},n.submitting=!1,n.submit=function(){var e;n.invalid=!1,n.loading||n.submitting||(n.errors=validation.formValidation(n.form.fields,n.form.data,n.partial_updatable),0!==Object.keys(n.errors).length?n.invalid=!0:(n.submitting=!0,n.settings.field&&n.settings.value&&(n.form.data[n.settings.field]=n.settings.value),e={entity:n.settings.entity,data:n.form.data},"add"==n.action?o.add(e,function(e,t){n.view=!0,n.submitting=!1,e||(n.form.data._id=t.data._id,n.action="edit",i.msSuccess?n.$parent.$parent.$eval(i.msSuccess):r("_id",n.form.data._id))}):(e.recordId=n.form.data._id,o.update(e,function(e,t){n.view=!0,n.submitting=!1,e||(i.msSuccess?n.$parent.$parent.$eval(i.msSuccess):r("_id",n.form.data._id))}))))}):alert("Error : Entity name not specified for ms.form.entityAddEdit widgets")}],subRecordAddOrEdit:["$scope","$rootScope","$location","$element","app","$attrs",function(n,e,t,a,o,s){var i,r;n.widgetName="ms.form.entityAddEdit",n.loading=!1,n.action="add",n.view=!0,n.form={},n.settings&&n.settings.entity?n.settings.value&&n.settings.subfield?(n.settings.field?n.recordField=n.settings.field:n.recordField="_id",n.loading=!0,i=function(){n.loading=!0;var e={q:{}},e=(e.q[n.recordField]=n.settings.value,n.settings.resolve&&(e.resolve=n.settings.resolve),{entity:n.settings.entity,query:e});o.list(e,function(e,t){n.loading=!1,e?alert("Error occured in geting the record data"+n.settings.entity):t.data&&t.data.records&&t.data.records.length&&(n.data=t.data.records[0])})},r=function(e,a){e={entity:n.settings.entity,recordId:n.data._id,field:n.settings.subfield,data:e};o.add(e,function(e,t){e?alert("error occured in posting the data in subRecord"):a()})},o.struct({entity:n.settings.entity},function(e,t){e||(n.form.fields=[],e=t.data,angular.forEach(e.fields,function(e){e.name==n.settings.subfield&&e.settings&&"collection"==e.settings.edit_type&&(n.form.fields=e.fields)}),n.form.fields.length||alert("There is not fields in the field "+n.settings.subfield),i())}),n.showForm=function(e){n.action="add",n.view=!1,e?(n.action="edit",n.form.data=angular.copy(e)):n.form.data={}},n.cancel=function(){n.view=!0,n.errors=null},n.remove=function(e){1==confirm("Are you sure you want to delete?")&&(e={entity:n.settings.entity,recordId:n.data._id,field:n.settings.subfield,fieldId:e},o.del(e,function(e,t){e||i()}))},n.submitting=!1,n.submit=function(){var a,s,e;n.invalid=!1,n.loading||n.submitting||(n.errors=validation.formValidation(n.form.fields,n.form.data),0!==Object.keys(n.errors).length?n.invalid=!0:(n.submitting=!0,"add"==n.action?n.data&&n.data._id?r(n.form.data,function(){n.submitting=!1,n.view=!0,i()}):(s=function(){r(n.form.data,function(){n.submitting=!1,n.view=!0,i()})},n.data={},n.data[n.recordField]=n.settings.value,e={entity:n.settings.entity,data:n.data},o.add(e,function(e,t){e?alert("error occured while creating the record"):(n.data._id=t.data._id,s())})):(e=n.form.data,a=function(){n.submitting=!1,n.view=!0,i()},e={entity:n.settings.entity,recordId:n.data._id,field:n.settings.subfield,fieldId:e._id,data:e},o.update(e,function(e,t){e?alert("error occured in updating the data in subRecord"):a()}))))}):alert(n.settings.entity+" The record value that to be updated not specified"):alert("Error : Entity name not specified for ms.form.entityAddEdit widgets")}],slides:["$scope","app","$routeParams",function(a,e,t){if(a.sliderId="slides"+Math.floor(9e4*Math.random())+1e4,window.cacheEntities["ms.slides"])return a.links=JSON.parse(JSON.stringify(window.cacheEntities["ms.slides"])),void($.prototype.carousel&&$(".carousel").carousel());e.list({entity:"ms.slides",httpcache:!0,cache:!0},function(e,t){e||(a.links=t.data.records,$.prototype.carousel&&$(".carousel").carousel())})}],slides2:["$scope","app","$routeParams",function(a,e,t){if(a.slides=[],a.sliderId="slides"+Math.floor(9e4*Math.random())+1e4,window.cacheEntities["ms.slides"])return a.slides=JSON.parse(JSON.stringify(window.cacheEntities["ms.slides"])),void($.prototype.carousel&&$(".carousel").carousel());e.list({entity:"ms.slides",httpcache:!0,cache:!0},function(e,t){e||(a.slides=t.data.records,$.prototype.carousel&&$(".carousel").carousel())})}],map:["$scope",function(n){setTimeout(function(){var e,t,a,s;t=new google.maps.Geocoder,a={center:new google.maps.LatLng(28.413323,77.044115),zoom:14,scrollwheel:!1,disableDoubleClickZoom:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("googleMap"),a),ms_store.store_settings.geo_location&&ms_store.store_settings.geo_location.latitude&&ms_store.store_settings.geo_location.longitude?(e=new google.maps.LatLng(parseFloat(ms_store.store_settings.geo_location.latitude),ms_store.store_settings.geo_location.longitude),new google.maps.Marker({position:e,map:s,title:ms_store.store_settings.store_title}),s.setCenter(e)):(a="",a=(e=ms_store.store_settings.physical_location).address?e.address+",":"",(a=(a=(a=(a+=e.city?e.city+",":"")+(e.state?e.state+",":""))+(e.country?e.country+",":""))+(e.zip_code?e.zip_code+",":""))||alert("Map Error : Please enter the store address or geo location in store setting"),t.geocode({address:a},function(e,t){t==google.maps.GeocoderStatus.OK?(s.setCenter(e[0].geometry.location),new google.maps.Marker({map:s,position:e[0].geometry.location,title:ms_store.store_settings.store_title})):n.error("Geocode was not successful for the following reason: "+t+".Reload the page to see the map.")}))},5e3)}],entitymap:["$scope","app","$compile",function(n,e,o){n.records=null,n.item=null;var i,a,r,d,t=n.settings.entity;t?(n.loading=!0,i=new google.maps.Geocoder,a={center:new google.maps.LatLng(28.413323,77.044115),zoom:16,scrollwheel:!1,disableDoubleClickZoom:!1,panControl:!0,zoomControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.LatLngBounds,d=null,e.list({entity:t,httpcache:!0,cache:!0},function(e,t){e?n.loading=!1:n.records=t.data.records}),n.$watch("records",function(e,t){var s;e&&(s=new google.maps.Map(document.getElementById("entityMap"),a),n.settings.height&&""!=n.settings.height?$("#entityMap").height(n.settings.height):$("#entityMap").height(200),angular.forEach(n.records,function(e){var a=new google.maps.Marker({map:s,title:e.name||""}),t=(n.item=e,o("<div>"+n.settings.marker_html+"</div>")(n));a.content=t.html(),n.settings.marker_icon_url&&""!=n.settings.marker_icon_url&&a.setIcon(n.settings.marker_icon_url),google.maps.event.addListener(a,"mouseover",function(){d&&d.close(),(d=new google.maps.InfoWindow).setContent(a.content),d.open(s,this)}),e.latitude&&e.longitude?(t=new google.maps.LatLng(e.latitude,e.longitude),a.setPosition(t),r.extend(t),n.settings.zoom||s.fitBounds(r)):(t=e.address,i.geocode({address:t},function(e,t){t==google.maps.GeocoderStatus.OK?(a.setPosition(e[0].geometry.location),r.extend(e[0].geometry.location),n.settings.zoom||s.fitBounds(r)):n.error("Geocode was not successful for the following reason: "+t+".Reload the page to see the map.")})),google.maps.event.trigger(s,"resize"),n.settings.zoom&&s.setZoom(parseInt(n.settings.zoom))}))})):n.error("Entity not defined")}],twitterLogin:["$scope","$element",function(e,t){t.bind("click",function(){$(".modal").modal("hide"),window.open("/auth/twitter","twitter","height=350,width=400")})}],contactMap:["$scope","$element",function(a,e){var t,s=new google.maps.Geocoder,n={center:new google.maps.LatLng(28.413323,77.044115),zoom:14,scrollwheel:!1,disableDoubleClickZoom:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},o=(0==e.height()&&e.height(200),new google.maps.Map(e.get(0),n));a.settings.latitude&&a.settings.longitude?(t=new google.maps.LatLng(parseFloat(a.settings.latitude),a.settings.longitude),new google.maps.Marker({position:t,map:o,title:ms_store.store_settings.store_title}),o.setCenter(t)):ms_store.store_settings.geo_location&&ms_store.store_settings.geo_location.latitude&&ms_store.store_settings.geo_location.longitude?(t=new google.maps.LatLng(parseFloat(ms_store.store_settings.geo_location.latitude),ms_store.store_settings.geo_location.longitude),new google.maps.Marker({position:t,map:o,title:ms_store.store_settings.store_title}),o.setCenter(t)):(e="",e=(t=ms_store.store_settings.physical_location).address?t.address+",":"",(e=(e=(e=(e+=t.city?t.city+",":"")+(t.state?t.state+",":""))+(t.country?t.country+",":""))+(t.zip_code?t.zip_code+",":""))||alert("Map Error : Please enter the store address or geo location in store setting"),s.geocode({address:e},function(e,t){t==google.maps.GeocoderStatus.OK?(o.setCenter(e[0].geometry.location),new google.maps.Marker({map:o,position:e[0].geometry.location,title:ms_store.store_settings.store_title})):a.error("Geocode was not successful for the following reason: "+t+".Reload the page to see the map.")}))}],magicZoom:["$scope","$rootScope","$element","$filter","$timeout",function(e,t,a,s,n){require([s("global_asset")("jquery.elevatezoom.js")]);var o=a[0].id;$(document).ready(n(function(){$("#"+o).elevateZoom({gallery:"gal1",cursor:"pointer",galleryActiveClass:"active",imageCrossfade:!0,scrollZoom:!0})},1e3))}],bxSlider:["$scope","$rootScope","$element","$filter","$timeout",function(e,t,a,s,n){var o={slideWidth:150,minSlides:1,maxSlides:3,moveSlides:1,slideMargin:10,responsive:!0,auto:!0,autoHover:!0};e.startSlider=function(){n(function(){$(a).show(),$(a).bxSlider(o)},200)},$(a).bxSlider?e.startSlider():(window.mystore.utils.loadCss("http://cdn2.storehippo.com/global/assets/bxSlider-4.1.2.css"),n(function(){require(["http://cdn2.storehippo.com/global/assets/bxSlider-4.1.2.js"],function(){e.startSlider()})},100))}],htmleditor:["$scope","$element",function(a,e){var s=e.find("textarea"),n={};require(["http://cdn2.storehippo.com/vendor/ckeditor/ckeditor.js"],function(){CKEDITOR.config.forcePasteAsPlainText=!0;function e(){n=s.controller("ngModel"),a.$apply(function(){n.$setViewValue(t.getData())})}var t=CKEDITOR.replace(s[0],{enterMode:Number(2),filebrowserImageUploadUrl:"/uploads?dir=uploads",toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Strike","-","RemoveFormat"]},{name:"paragraph",groups:["list","indent","blocks","align"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"insert",items:["Link","Image","Table","HorizontalRule"]},{name:"document",groups:["mode","document","doctools"],items:["Source"]}]});t.on("instanceReady",function(){t.setData(n.$viewValue)}),t.on("pasteState",function(){a.$$phase||a.$apply(function(){n.$setViewValue(t.getData())})});t.on("change",e),t.on("key",e),t.on("dataReady",e),n.$render=function(e){t.setData(n.$viewValue)}})}],fieldDistinctValues:["$rootScope","$scope","$element","$stateParams","app",function(e,a,t,s,n){var o,i;a.settings.entity?a.settings.field?(o={},a.settings.filters&&("string"==typeof a.settings.filters&&(a.settings.filters=JSON.parse(a.settings.filters)),angular.forEach(a.settings.filters,function(e){var t;"route_param"==e.type?s.hasOwnProperty(e.value)&&(o[e.field]=s[e.value]):"scope_param"==e.type?a.$eval(e.value)&&(o[e.field]=a.$eval(e.value)):"$gt"==e.operator?(e.value=JSON.parse(e.value),t={$gt:e.value},o[e.field]=JSON.stringify(t)):"$lt"==e.operator?(e.value=JSON.parse(e.value),t={$lt:e.value},o[e.field]=JSON.stringify(t)):("eq"==e.operator&&(e.value=parseInt(e.value)),o[e.field]=e.value)})),i={entity:a.settings.entity,customCommandName:"",type:"get",query:{field:a.settings.field,q:o}},n.call("distinct",i,function(e,t){e||(a.data=t.data)})):alert("field name not specified in ms.fieldDistictValues widget"):alert("Entity name not specified in ms.fieldDistictValues widget")}],dashboard:["$rootScope","$scope","$element","$filter","$templateCache","app","$compile","$injector",function(n,r,e,t,o,d,a,s){var i;window.admin_theme&&"mobitual"==window.admin_theme.name&&(i=s.get("$mdToast")),r.loading=!0,r.widgets=[],r.widgetsObj={},r.unpublish_widgets=[],r.exports_result=[],r.oldvalue=n.global_val,n.global_val||(n.global_val="month"),window.admin_theme&&"mobitual"==window.admin_theme.name&&(n.$watch("global_val",function(e,t){r.oldvalue=t,document.getElementById(r.oldvalue).removeAttribute("selected"),document.getElementById(n.global_val).setAttribute("selected","selected")}),setTimeout(function(){document.getElementById("mdDatePicker").getElementsByTagName("button")[0].setAttribute("md-prevent-menu-close","md-prevent-menu-close"),document.getElementById("mdDatePicker").getElementsByTagName("button")[1].setAttribute("md-prevent-menu-close","md-prevent-menu-close"),document.getElementById("mdDatePicker1").getElementsByTagName("button")[0].setAttribute("md-prevent-menu-close","md-prevent-menu-close"),document.getElementById("mdDatePicker1").getElementsByTagName("button")[1].setAttribute("md-prevent-menu-close","md-prevent-menu-close")},1e3)),r.$watch("exports_result",function(t,e){var a=0,s=0;r.exports_result.forEach(function(e){e.widget_name==t.widget_name&&(e.result=t.result,s=1),++a==r.exports_result.length&&0==s&&(r.exports_result=t)})}),r.changeFilter=function(e){n.global_val=e,localStorage.setItem("filter",e)},r.changeFiltercustom=function(e,t,a){return null==t?(i.show(i.simple().textContent("Start date can not be null!!").position("right").hideDelay(3e3)),document.getElementById("customDate").removeAttribute("selected"),void document.getElementById(n.global_val).setAttribute("selected","selected")):null==a?(i.show(i.simple().textContent("End date can not be null!!").position("right").hideDelay(3e3)),document.getElementById("customDate").removeAttribute("selected"),void document.getElementById(n.global_val).setAttribute("selected","selected")):a<t?(i.show(i.simple().textContent("Start date must be smaller than end date!!").position("right").hideDelay(3e3)),document.getElementById("customDate").removeAttribute("selected"),void document.getElementById(n.global_val).setAttribute("selected","selected")):(n.global_val=e,localStorage.removeItem("filter"),n.start_date=t,void(n.end_date=a))},r.customDate=function(e){var a=s.get("$mdDialog");a.show({controller:["$scope","$rootScope",function(e,t){e.cancel=function(){document.getElementById("customDate").removeAttribute("selected"),document.getElementById(t.global_val).setAttribute("selected","selected"),a.cancel()},e.cancel1=function(){a.cancel()}}],scope:r,preserveScope:!0,template:' <md-toolbar> <div class="md-toolbar-tools"> <h2>Custom Date</h2> <span flex></span><md-button class="md-icon-button" ng-click="cancel()">   <i class="material-icons">&#xE14C;</i> </md-button> </div> </md-toolbar><div layout="column" class="md-padding"> <md-dialog-content><div layout="row"> <md-datepicker class="ms-mr-0" id="mdDatePicker" ng-model="start_date" required md-placeholder="Enter start date"md-prevent-menu-close="md-prevent-menu-close"></md-datepicker><md-datepicker class="ms-mr-0" id="mdDatePicker1" ng-model="end_date" required md-placeholder="Enter end date"md-prevent-menu-close="md-prevent-menu-close"></md-datepicker> </md-dialog-content></div></div><div layout="row" class="md-padding">  <span flex></span><md-button class="white md-raised md-primary" ng-click="cancel();"style="border-radius: 2px; text-align: center; height: 36px;  width: 0px;">CANCEL</md-button>\n<md-button class="white md-raised md-primary selectedoption" ng-click="changeFiltercustom(\'customDate\',start_date,end_date);cancel1()" style="border-radius: 2px; text-align: center; height: 36px;   width: 0px;">SUBMIT</md-button></div>',parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:r.customFullscreen})};d.list({entity:"ms.dashboard_widgets",httpcache:!0,cache:!0},function(e,t){var a,s;!e&&t.data&&t.data.records?(s=setInterval(function(){n.http.pendingRequests.length||clearInterval(s);var o=angular.copy(n.http.pendingRequests);r.widgets.forEach(function(e,t){for(var a=!1,s=0,n=o.length;s<n;s++)if(r.widgets[t].loading&&o[s].data&&o[s].data.data.widget_name==e.global_widget){a=!0;break}r.widgets[t].loading=a})},1e3),a=[],angular.forEach(t.data.records,function(e,t){e.global_widget&&(e.new_admin_theme&&1==e.new_admin_theme?"1"==e.publish_new_admin?(e.loading=!0,r.widgets.push(e),a.push(e.global_widget)):"0"==e.publish_new_admin&&r.unpublish_widgets.push(e):(n.ms.user&&n.ms.user.role&&"reseller"!=n.ms.user.role&&("1"!=e.publish||e.reseller&&"1"==e.reseller?"0"!=e.publish||e.reseller&&"1"==e.reseller||r.unpublish_widgets.push(e):(r.widgets.push(e),a.push(e.global_widget))),n.ms.user&&n.ms.user.role&&"reseller"==n.ms.user.role&&e.reseller&&"1"==e.reseller&&(r.widgets.push(e),a.push(e.global_widget))),e.index=t,r.widgetsObj[e.global_widget]=e)}),a.length?((e={version:1,entity:"ms.local_themes",type:"get",query:{filters:[{field:"name",operator:"in",value:a}]}}).query.filters=JSON.stringify(e.query.filters),d.call("getGlobalWidgets",e,function(e,t){e||t.data&&t.data.data&&t.data.data.length&&angular.forEach(t.data.data,function(e){var t;ms_theme.widgets[e.name]||(t="/templates/widgets/"+e.name+".html",o.put(t,e.template),ms_theme.widgets[e.name]=e)}),r.loading=!1})):r.loading=!1):r.loading=!1}),r.drag_drop=function(a){$(".widget-container-col").sortable({connectWith:".widget-container-col",items:"> .widget-box",handle:!!ace.vars.touch&&".widget-header",cancel:".fullscreen",opacity:.8,revert:!0,forceHelperSize:!0,placeholder:"widget-placeholder",forcePlaceholderSize:!0,tolerance:"pointer",start:function(e,t){t.item.parent().css({"min-height":t.item.height()})},update:function(e,t){t.item.parent({"min-height":""});t={entity:"ms.dashboard_widgets",recordId:a,data:{sort_column:t.offset.top+t.offset.left}};d.update(t,function(e,t){if(e)throw e})}})},r.drag_drop_new=function(){var i="";$(".widget-container-col").sortable({connectWith:".widget-container-col",items:"> .widget-box",cancel:".panel-fullscreen",opacity:.8,revert:!0,forceHelperSize:!0,placeholder:"widget-placeholder",forcePlaceholderSize:!0,tolerance:"pointer",start:function(e,t){i=$(t.item).attr("id")},update:function(e,t){var a=$(e.target).index();if(i==a)for(var s=i;s<=a;s++)(o={entity:"ms.dashboard_widgets",recordId:r.widgets[s]._id,data:{}}).data.sort_column=s==i?parseInt(a):s-1,$(t.item).attr("title")==r.widgets[s].Name&&(o.data.column=$(t.item).parent().attr("id")),d.update(o,function(e,t){if(e)throw e});if(i<a)for(s=i;s<=a;s++)(o={entity:"ms.dashboard_widgets",recordId:r.widgets[s]._id,data:{}}).data.sort_column=s==i?parseInt(a):s-1,$(t.item).attr("title")==r.widgets[s].Name&&(o.data.column=$(t.item).parent().attr("id")),d.update(o,function(e,t){if(e)throw e});if(a<i)for(var n=a;n<=i;n++){var o={entity:"ms.dashboard_widgets",recordId:r.widgets[n]._id,data:{}};$(t.item).attr("title")==r.widgets[n].Name&&(o.data.column=$(t.item).parent().attr("id")),o.data.sort_column=n==a?parseInt(a):n-1,d.update(o,function(e,t){if(e)throw e})}}})},r.drag_drop_new1=function(i,e){var r="";$("#sortable").sortable({start:function(e,t){r=$(t.item).index()},update:function(e,t){var a=$(t.item).index();if(r!=a){if(r<a)for(var s=r;s<=a;s++)(n={entity:"ms.dashboard_widgets",recordId:i[s]._id,data:{}}).data.sort_column=s==r?a:s-1,d.update(n,function(e,t){if(e)throw e});if(a<r)for(var n,o=a;o<=r;o++)(n={entity:"ms.dashboard_widgets",recordId:i[o]._id,data:{}}).data.sort_column=o==a?r:o-1,d.update(n,function(e,t){if(e)throw e})}}}),$("#sortable").disableSelection()},r.drag_drop_new2=function(i,e){var r="";$("#sortable").sortable({start:function(e,t){r=$(t.item).index()},update:function(e,t){var a=$(t.item).index();if(r!=a){if(r<a)for(var s=r;s<=a;s++)(n={entity:"ms.dashboard_widgets",recordId:i[s]._id,data:{}}).data.sort_column=s==r?a:s-1,d.update(n,function(e,t){if(e)throw e});if(a<r)for(var n,o=a;o<=r;o++)(n={entity:"ms.dashboard_widgets",recordId:i[o]._id,data:{}}).data.sort_column=o==a?r:o-1,d.update(n,function(e,t){if(e)throw e})}}}),$("#sortable").disableSelection()},r.widget_fullscreen=function(e){var t=document.getElementById(e);n.graphwidth="100%",t.className==e?($(".dashboard").scrollTop(0),document.getElementById("add-absolute").style.height="100vh",document.getElementById("add-absolute").style.overflow="hidden",document.getElementById("storehippo-video")&&(document.getElementById("storehippo-video").style.height="551px"),t.className="panel-fullscreen",r.fullscreentest=!0):"panel-fullscreen"==t.className&&(t.className=e,document.getElementById("add-absolute").style.height="auto",document.getElementById("storehippo-video")&&(document.getElementById("storehippo-video").style.height="320px"),document.getElementById("add-absolute").style.overflow="auto",r.fullscreentest=!1)},r.delete_new=function(a){var e={entity:"ms.dashboard_widgets",recordId:a._id,data:{publish_new_admin:"0"}};d.update(e,function(e,t){if(e)throw e;r.unpublish_widgets.push(a),r.widgets=r.widgets.filter(function(e){return e._id!=a._id})})},r.delete=function(a){var e={entity:"ms.dashboard_widgets",recordId:a._id,data:{publish:"0"}};d.update(e,function(e,t){if(e)throw e;r.unpublish_widgets.push(a),r.widgets=r.widgets.filter(function(e){return e._id!=a._id})})},r.toggle=function(a,s){d.update({entity:"ms.dashboard_widgets",recordId:a,data:{toggle:s}},function(e,t){if(e)throw e;r.widgets.forEach(function(e){e._id==a&&(e.toggle=s)})})},r.publish_new=function(e){d.update({entity:"ms.dashboard_widgets",recordId:e,data:{publish_new_admin:"1"}},function(e,t){if(e)throw e;location.reload()})},r.publish=function(e){d.update({entity:"ms.dashboard_widgets",recordId:e,data:{publish:"1"}},function(e,t){if(e)throw e;location.reload()})},r.info=function(a,s){d.update({entity:"ms.dashboard_widgets",recordId:a,data:{info:s}},function(e,t){if(e)throw e;r.widgets.forEach(function(e){e._id==a&&(e.info=s)})})},r.setting=function(a,s){d.update({entity:"ms.dashboard_widgets",recordId:a,data:{setting:s}},function(e,t){if(e)throw e;r.widgets.forEach(function(e){e._id==a&&(e.info=s)})})},r.export=function(t){r.exports_result.forEach(function(e){e.widget_name==t&&(e={entity:"ms.dashboard_widgets",data:e.result},d.call("reports",e,function(e,t){if(e)throw e;e=document.createElement("a");e.href="data:application/csv,"+encodeURIComponent(t.data),e.setAttribute("download","export.csv"),e.click()})),r.exports_result.length})},r.custom_settings=function(e,t,a){e={entity:"ms.dashboard_widgets",recordId:r.widgets[e]._id,data:t};d.update(e,function(e,t){e||a(null,t)})},r.custom_command=function(e,t,a){"function"==typeof t&&(a=t);e={entity:"ms.dashboard_widgets",data:{widget_name:e,data:t}};"function"==typeof t&&(a=t,delete e.data.data),d.call("commandhandler",e,function(e,t){e||a(null,t)})}}],reports:["$scope","app","$templateCache","$location","$http","$compile",function(r,d,s,n,t,i){r.loading=!0,r.format={};var o=0;r.exports_result=[],r.$watch("exports_result",function(e,t){r.exports_result=e});d.list({entity:"ms.reports",httpcache:!0,cache:!0},function(e,t){r.widgets_name=t.data.records;for(var a=0;a<t.data.records.length;a++){if(t.data.records[a]._id==n.search().id){r.show_widget(t.data.records[a],a),r.$$phase||r.$root.$$phase||r.$apply(),r.index=a;break}a==t.data.records.length-1&&(r.show_widget(t.data.records[0],a),r.index=0)}}),r.$on("$locationChangeStart",function(e){if(0==o)for(var t=0;t<r.widgets_name.length;t++)r.widgets_name[t]._id==n.search().id&&(r.index=t,r.show_widget(r.widgets_name[t],t));o=0}),r.show_widget=function(a,e){o=1,r.index=e||0,r.loading=!0;e={version:1,entity:"ms.local_themes",type:"get",query:{filters:[{field:"name",operator:"equal",value:a.widget_name}]}};e.query.filters=JSON.stringify(e.query.filters),d.call("getGlobalWidgets",e,function(e,t){e||t.data&&t.data.data&&t.data.data.length&&(ms_theme.widgets[t.data.data[0].name]||(e="/templates/widgets/"+t.data.data[0].name+".html",s.put(e,t.data.data[0].template),ms_theme.widgets[t.data.data[0].name]=t.data.data[0]),e="?id="+a._id,n.url(e),r.widgets=t.data.data[0],r.widget_report=a),r.loading=!1})},r.toggle=function(a,s){d.update({entity:"ms.reports",recordId:a,data:{toggle:s}},function(e,t){if(e)throw e;r.widget_report._id==a&&(r.widget_report.toggle=s)})},r.widget_report_fullscreen=function(e){var t=document.getElementById(e);t.className==e?(t.className="panel-fullscreen",r.fullscreentest=!0):"panel-fullscreen"==t.className&&(t.className=e,r.fullscreentest=!1)},r.export_new=function(e){},r.download_report_new=function(o){var i=0;t.get("/templates/widgets/exportReportModal.html",{cache:s}).success(function(e){var t=r.format.data,a=function(){};if("csv"==t)for(var s=r.exports_result.length-1;0<=s;s--)r.exports_result[s].widget_name==o&&(n={entity:"ms.reports",data:r.exports_result[s].result},1==++i&&d.call("reports",n,function(e,t){if(e)throw e;e=document.createElement("a");e.href="data:application/csv,"+encodeURIComponent(t.data),e.setAttribute("download","export.csv"),e.click()}));else if("pdf"==t)for(var n,s=r.exports_result.length-1;0<=s;s--)r.exports_result[s].widget_name==o&&(n={entity:"ms.reports",data:r.exports_result[s].result},1==++i&&d.call("reports_pdf",n,function(e,t){var t=t.data,a=t[0].key,s=t[0].value,t=document.createElement("script");t.src="//cdnjs.cloudflare.com/ajax/libs/jspdf/0.9.0rc1/jspdf.min.js";document.getElementsByTagName("head")[0].appendChild(t);var n=document.createElement("script");if(n.src="//cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.0.16/jspdf.plugin.autotable.js",document.getElementsByTagName("head")[0].appendChild(n),e)throw e;t.onload=function(){n.onload=function(){var t=new jsPDF("p","pt","letter");t.autoTable(a,s,{tableWidth:"wrap",styles:{cellPadding:2},headerStyles:{rowHeight:15,fontSize:12},bodyStyles:{rowHeight:12,fontSize:12,valign:"middle"},beforePageContent:function(e){t.text("Report",40,30)}}),t.save("export.pdf")}}}));else alert("Please choose a suitable format!!!");r.exports_result.length,a()})},r.export=function(e){t.get("/templates/widgets/exportReportModal.html",{cache:s}).success(function(e){$(document.body).append(i(e)(r)),$("#exportReportModal").modal("show")})},r.download_report=function(n){var o=0;t.get("/templates/widgets/exportReportModal.html",{cache:s}).success(function(e){$(document.body).append(i(e)(r));var e=$("#format").val(),t=function(){$("#exportReportModal").modal("hide")};if("csv"==e)for(var a=r.exports_result.length-1;0<=a;a--)r.exports_result[a].widget_name==n&&(s={entity:"ms.reports",data:r.exports_result[a].result},1==++o&&d.call("reports",s,function(e,t){if(e)throw e;e=document.createElement("a");e.href="data:application/csv,"+encodeURIComponent(t.data),e.setAttribute("download","export.csv"),e.click(),alert("Successfully Downloaded!!")}));else if("pdf"==e)for(var s,a=r.exports_result.length-1;0<=a;a--)r.exports_result[a].widget_name==n&&(s={entity:"ms.reports",data:r.exports_result[a].result},1==++o&&d.call("reports_pdf",s,function(e,t){var t=t.data,a=t[0].key,s=t[0].value,t=document.createElement("script");t.src="http://cdnjs.cloudflare.com/ajax/libs/jspdf/0.9.0rc1/jspdf.min.js";document.getElementsByTagName("head")[0].appendChild(t);var n=document.createElement("script");if(n.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.0.16/jspdf.plugin.autotable.js",document.getElementsByTagName("head")[0].appendChild(n),e)throw e;t.onload=function(){n.onload=function(){var t=new jsPDF("p","pt","letter");t.autoTable(a,s,{tableWidth:"wrap",styles:{cellPadding:2},headerStyles:{rowHeight:15,fontSize:12},bodyStyles:{rowHeight:12,fontSize:12,valign:"middle"},beforePageContent:function(e){t.text("Report",40,30)}}),t.save("export.pdf"),alert("Successfully Downloaded!!")}}}));else alert("Please choose a suitable format!!!");r.exports_result.length,t()})},r.custom_command=function(e,t,a){"function"==typeof t&&(a=t);e={entity:"ms.reports",data:{widget_name:e,data:t}};"function"==typeof t&&(a=t,delete e.data.data),d.call("commandhandler",e,function(e,t){e?console.log("======error found======"):a(null,t)})}}],ebay:["$scope","app","$timeout",function(o,a,s){o.loading=!0,o.loading_start=!0,o.ebay_count="",o.ebay_paginations=[];var n=[],i="ms.marketplace_products",r={},d={};a.call("getMarketPlaceQueueData",{entity:"ms.ebay"},function(e,t){o.ebay_summary=t.data.marketplace_queue_data,o.ebay_products_count=t.data.marketplace_products_data,o.results=t.data.marketplace_products_data.ebay_data,o.data={settings:t.data.marketplace_queue_data},o.loading=!1,o.loading_start=!1;var a=[],s=0;o.count=t.data.marketplace_products_data.total;for(var n=0;n<t.data.marketplace_products_data.total/20;n++)a.push(++s);o.pages=1,o.pagination=a}),o.selectPage=function(e){o.loading=!0,e&&e<0||o.pagination&&e/20>o.pagination.length||e>o.count||o.pages==e/20+1?o.loading=!1:(o.pages=e/20+1,(e={entity:i,query:{start:e,filters:n,q:r,limit:20}}).query.filters=JSON.stringify(e.query.filters),a.list(e,function(e,t){if(e)console.log("=====error found-----");else{o.results=t.data.records;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.loading=!1,o.pagination=a}}))},o.getResult=function(){switch(o.loading=!0,o.tab.name){case"All":n=[{field:"market_place",value:"ebay",operator:"equal"}];break;case"Pending Sync":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"pending_sync",operator:"equal"}];break;case"Sync":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"sync",operator:"equal"}];break;case"Failure":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"failure",operator:"equal"}];break;case"Update":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"update",operator:"equal"}];break;default:return}var e={entity:i="ms.marketplace_products",query:{filters:n,limit:20}};e.query.filters=JSON.stringify(e.query.filters),o.results=[],a.list(e,function(e,t){if(e)console.log("=====error found-----");else{o.results=t.data.records,o.count=t.data.total;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.pages=1,o.loading=!1,o.pagination=a}})},o.getHistory=function(e){e={entity:"ms.marketplace_history",query:{filters:[{field:"product.product_id",value:e,operator:"equal"},{field:"product.market_place",value:"ebay",operator:"equal"}]}};e.query.filters=JSON.stringify(e.query.filters),a.list(e,function(e,t){e?console.log("=====error found-----"):o.history=t.data.records})},o.getSearchResult=function(e,t){if(13==t.charCode){switch(o.loading=!0,o.tab.name){case"All":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:["pending_sync","sync","failure","update"],operator:"in"}];break;case"Pending Sync":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"pending_sync",operator:"equal"}];break;case"Sync":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"sync",operator:"equal"}];break;case"Failure":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"failure",operator:"equal"}];break;case"Update":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"update",operator:"equal"}];break;default:return}t={entity:i="ms.marketplace_products",query:{filters:n,q:r={product_name:{$regex:".*"+e+".*",$options:"i"}},limit:20}};t.query.filters=JSON.stringify(t.query.filters),a.list(t,function(e,t){if(e)console.log("=====error found-----");else{o.results=t.data.records,o.count=t.data.total;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.loading=!1,o.pagination=a}})}},o.getOrders=function(){o.loading=!0;var e={entity:i="ms.orders",query:{filters:n=[{field:"channel",value:"ebay",operator:"equal"}],limit:20}};e.query.filters=JSON.stringify(e.query.filters),a.list(e,function(e,t){if(e)console.log("=======nothing to do====");else{o.results=t.data.records,o.count=t.data.total;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.pages=1,o.loading=!1,o.pagination=a}})},o.updateData=function(){var e={entity:"ms.ebay",data:o.data.settings};a.call("updateGlobalEntity",e,function(e,t){o.message="Update Successfully",s(function(){o.message=""},6e3)})},o.getCategory=function(n,e,t){if(t&&13==t.charCode)d={name:{$regex:".*"+e+".*",$options:"i"}};else if(t&&13!=t.charCode)return;o.loading=!0,i="ms.ebay",n&&n<0||o.ebay_pagination&&(!t||13!=t.charCode)&&n/20+1>o.ebay_paginations.length?o.loading=!1:(0!=n&&n/20+1!=o.ebay_paginations.length&&0<n/20+1&&(2<o.ebay_pagination.indexOf(n/20+1)&&n/20+1<o.ebay_paginations.length-2?o.ebay_pagination=[o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)+1],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)+2],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)+3],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)+4]]:o.ebay_pagination.indexOf(n/20+1)<=1&&2<n/20+1&&(o.ebay_pagination=[o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)-4],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)-3],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)-2],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)-1],o.ebay_paginations[o.ebay_paginations.indexOf(n/20+1)]])),(e={entity:i,data:{start:n||0,q:d}}).data.q=JSON.stringify(e.data.q),a.call("getCategory",e,function(e,t){if(e)console.log("=======Nothing to do=======");else{var a=0;o.ebay_paginations=[];for(var s=0;s<Math.floor(t.data.total/20);s++)o.ebay_paginations.push(++a);o.loading=!1,o.results=t.data.records,o.count=t.data.total,o.ebay_count=t.data.total,0==n?(o.ebay_pages=1,o.ebay_page=1,o.ebay_pagination=[o.ebay_paginations[0],o.ebay_paginations[1],o.ebay_paginations[2],o.ebay_paginations[3],o.ebay_paginations[4]]):n/20+1==o.ebay_paginations.length?(o.ebay_pagination=[o.ebay_paginations.length-4,o.ebay_paginations.length-3,o.ebay_paginations.length-2,o.ebay_paginations.length-1,o.ebay_paginations.length],o.ebay_pages=5,o.ebay_page=o.ebay_paginations.length):(o.ebay_pages=o.ebay_pagination.indexOf(n/20+1)+1,o.ebay_page=o.ebay_paginations.indexOf(n/20+1)+1),o.loading=!1}}))}}],amazon:["$scope","app","$timeout",function(o,a,s){o.loading=!0,o.loading_start=!0,o.amazon_count="",o.amazon_paginations=[];var n=[],i="ms.marketplace_products",r={};a.call("getMarketPlaceQueueData",{entity:"ms.amazon"},function(e,t){o.amazon_summary=t.data.marketplace_queue_data,o.amazon_products_count=t.data.marketplace_products_data,o.results=t.data.marketplace_products_data.amazon_data,o.data={settings:t.data.marketplace_queue_data},o.loading=!1,o.loading_start=!1;var a=[],s=0;o.count=t.data.marketplace_products_data.total;for(var n=0;n<t.data.marketplace_products_data.total/20;n++)a.push(++s);o.pages=1,o.pagination=a}),o.selectPage=function(e){o.loading=!0,e&&e<0||o.pagination&&e/20>o.pagination.length||e>o.count||o.pages==e/20+1?o.loading=!1:(o.pages=e/20+1,(e={entity:i,query:{start:e,filters:n,q:r,limit:20}}).query.filters=JSON.stringify(e.query.filters),a.list(e,function(e,t){if(e)console.log("=====error found-----");else{o.results=t.data.records;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.loading=!1,o.pagination=a}}))},o.getResult=function(){switch(o.loading=!0,o.tab.name){case"All":n=[{field:"market_place",value:"amazon",operator:"equal"}];break;case"Pending Sync":n=[{field:"market_place",value:"amazon",operator:"equal"},{field:"status",value:"pending_sync",operator:"equal"}];break;case"Sync":n=[{field:"market_place",value:"amazon",operator:"equal"},{field:"status",value:"sync",operator:"equal"}];break;case"Failure":n=[{field:"market_place",value:"amazon",operator:"equal"},{field:"status",value:"failure",operator:"equal"}];break;case"Update":n=[{field:"market_place",value:"amazon",operator:"equal"},{field:"status",value:"update",operator:"equal"}];break;default:return}var e={entity:i="ms.marketplace_products",query:{filters:n,limit:20}};e.query.filters=JSON.stringify(e.query.filters),o.results=[],a.list(e,function(e,t){if(e)console.log("=====error found-----");else{o.results=t.data.records,o.count=t.data.total;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.pages=1,o.loading=!1,o.pagination=a}})},o.getHistory=function(e){e={entity:"ms.marketplace_history",query:{filters:[{field:"product.product_id",value:e,operator:"equal"},{field:"product.market_place",value:"amazon",operator:"equal"}]}};e.query.filters=JSON.stringify(e.query.filters),a.list(e,function(e,t){e?console.log("=====error found-----"):o.history=t.data.records})},o.getSearchResult=function(e,t){if(13==t.charCode){switch(o.loading=!0,o.tab.name){case"All":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:["pending_sync","sync","failure","update"],operator:"in"}];break;case"Pending Sync":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"pending_sync",operator:"equal"}];break;case"Sync":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"sync",operator:"equal"}];break;case"Failure":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"failure",operator:"equal"}];break;case"Update":n=[{field:"market_place",value:"ebay",operator:"equal"},{field:"status",value:"update",operator:"equal"}];break;default:return}t={entity:i="ms.marketplace_products",query:{filters:n,q:r={product_name:{$regex:".*"+e+".*",$options:"i"}},limit:20}};t.query.filters=JSON.stringify(t.query.filters),a.list(t,function(e,t){if(e)console.log("=====error found-----");else{o.results=t.data.records,o.count=t.data.total;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.loading=!1,o.pagination=a}})}},o.getOrders=function(){o.loading=!0;var e={entity:i="ms.orders",query:{filters:n=[{field:"channel",value:"amazon",operator:"equal"}],limit:20}};e.query.filters=JSON.stringify(e.query.filters),a.list(e,function(e,t){if(e)console.log("=======nothing to do====");else{o.results=t.data.records,o.count=t.data.total;for(var a=[],s=0,n=0;n<t.data.total/20;n++)a.push(++s);o.pages=1,o.loading=!1,o.pagination=a}})},o.updateData=function(){var e={entity:"ms.amazon",data:o.data.settings};a.call("updateGlobalEntity",e,function(e,t){o.message="Update Successfully",s(function(){o.message=""},6e3)})}}]});if(window&&window.mystore&&window.mystore.controllers)for(var key in controllers)window.mystore.controllers[key]||(window.mystore.controllers[key]=controllers[key]);angular.module("mystore").factory("shopifySvc",["$http","$rootScope","$q","msCache",function(l,e,c,t){function n(e,t,a,n){var r=this,s="/api/1/shopify",d=s;r.entity=e,r.entityname=e,r.list=function(e){e=e||{};var s="",s=c.defer();return a&&n&&(o[a]&&o[a].resolve(),o[a]=s),e.q&&(e.q=JSON.stringify(e.q)),l.get(d+"/entity/"+r.entity,{params:e,headers:{app_request:1},timeout:s.promise}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},r.get=function(e,t){t=t||{};var s=c.defer();return l.get(d+"/entity/"+r.entity+"/"+e,{params:t,headers:{app_request:1}}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},r.listSubRecords=function(e,t,a){a=a||{};var s=c.defer();return l.get(d+"/entity/"+r.entity+"/"+e+"/"+t,{params:a,headers:{app_request:1}}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},r.getCustomCommand=function(e,t,a){t=t||{};var s=c.defer(),n={};if(a)for(var o in a)n[o]=a[o];return l.get(d+"/entity/"+r.entity+"/_/"+e,{params:t,headers:n}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},r.postCustomCommand=function(e,t,a){var s=c.defer(),n={};if(a)for(var o in a)n[o]=a[o];return l.post(d+"/entity/"+r.entity+"/_/"+e,t,{headers:n}).success(function(e,t,a){s.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){s.reject({status:t,data:e,headers:a})}),s.promise},r.putCustomCommand=function(e,t,a,s){a=a||{};var n=c.defer(),o={};if(s)for(var i in s)o[i]=s[i];return l.put(d+"/entity/"+r.entity+"/_/"+e,t,{params:a,headers:o}).success(function(e,t,a){n.resolve({status:t,data:e,headers:a})}).error(function(e,t,a){n.reject({status:t,data:e,headers:a})}),n.promise}}var o={};return{getEntity:function(e,t,a,s){return!!e&&new n(e,0,a,s)}}}]).factory("shopifyApp",["$http","$rootScope","$q","shopifySvc",function(e,l,t,c){return new function(){var d=this;d.call=function(t,a,s){if(a.command=t,!a.entity)return console.log("please specify the entity name in app service call method"),void s({status:400,data:"please specify the entity name in app service call method"});l.ms.deferredCache||(l.ms.deferredCache={}),l.ms.loadings||(l.ms.loadings={}),d.addLoading=function(e,t){l.ms.loadings[e]||(l.ms.loadings[e]={}),l.ms.loadings[e][t]?++l.ms.loadings[e][t]:l.ms.loadings[e][t]=1},d.removeLoading=function(e,t){if(l.ms.loadings[e]){l.ms.loadings[e][t]&&--l.ms.loadings[e][t];var a,s=!0;for(a in l.ms.loadings[e])0!=l.ms.loadings[e][a]&&(s=!1);s&&delete l.ms.loadings[e]}};var e=c.getEntity(a.entity,a.version,a.id,a.cancel);if(a.field&&!a.recordId)s({status:400,data:"Please specify recordId in app field command"});else{var n=function(t,a){var e;a&&a.headers&&a.headers("ms-messages")&&(e=JSON.parse(a.headers("ms-messages")),angular.forEach(e,function(e){l.ms.broadcast(e.name,{entity:t,level:e.level,duration:e.duration,message:e.message,data:a.data})}))};switch(t){case"list":a.query||(a.query={});var o=function(){return a.field?e.listSubRecords(a.recordId,a.field,a.query):e.list(a.query)},i="";d.addLoading(a.entity,t),a.cache?i||(i=o(),l.ms.deferredCache[a.entity+"_"+JSON.stringify(a.query)]=i):i=o(),i.then(function(e){d.removeLoading(a.entity,t),s(null,e)},function(e){d.removeLoading(a.entity,t),s(e,null)});break;case"get":if(!a.recordId)return void s({status:400,data:"Please specify recordId in app field command"});if(a.field&&!a.fieldId)return void s({status:400,data:"Please specify the fieldId in app field get command"});a.query||(a.query={});o=function(){return a.field?e.getSubRecord(a.recordId,a.field,a.fieldId):e.get(a.recordId,a.query)},i="";d.addLoading(a.entity,t),a.cache?(i=l.ms.deferredCache[a.entity+"/"+a.recordId])||(i=o(),l.ms.deferredCache[a.entity+"/"+a.recordId]=i):i=o(),i.then(function(e){d.removeLoading(a.entity,t),s(null,e)},function(e){d.removeLoading(a.entity,t),s(e,null)});break;default:switch(a.type||(a.type="put"),a.type){case"get":a.query||(a.query={});var r={};a.headers&&(r=a.headers),d.addLoading(a.entity,a.command),e.getCustomCommand(a.command,a.query,r).then(function(e){n(a.entity,e),d.removeLoading(a.entity,a.command),s(null,e)},function(e){n(a.entity,e),d.removeLoading(a.entity,a.command),s(e,null)});break;case"post":d.addLoading(a.entity,a.command);r={};a.headers&&(r=a.headers),e.postCustomCommand(a.command,{data:a.data},r).then(function(e){console.log("app add command called"),n(a.entity,e),d.removeLoading(a.entity,a.command),s(null,e)},function(e){n(a.entity,e),d.removeLoading(a.entity,a.command),s(e,null)});break;case"put":d.addLoading(a.entity,a.command);r={};a.headers&&(r=a.headers),e.putCustomCommand(a.command,{data:a.data},a.query,r).then(function(e){n(a.entity,e),d.removeLoading(a.entity,a.command),s(null,e)},function(e){n(a.entity,e),d.removeLoading(a.entity,a.command),s(e,null)});break;default:console.log("Wrong custom type"),s({statue:401,data:"Wrong custom type"},null)}}}},d.list=function(e,t){d.call("list",e,t)},d.get=function(e,t){d.call("get",e,t)}}}]).directive("checkLogin",["$rootScope","app","$compile","$timeout",function(o,a,i,r){return{priority:-1,link:function(t,s,e){s.on("$destroy",function(){$("#loginWidgetModal").remove(),$("#loginWidget").remove(),$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()});function n(e){o.ms.user.isLoggedIn||(window._lastElement=s,a.addPosthook({entity:"ms.users",command:"login"},function(e,t,a){o.ms.user=new user(t.data),o.ms.user.isLoggedIn&&window._lastElement&&($(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),s.off("click",n),r(function(){angular.element(window._lastElement).click(),delete window._lastElement}))}),i("<div id='loginWidget' ms-data-modalid='loginWidgetModal' ms-widget='ms.modal' ms-data-widget='login'></div>")(t,function(e,t){r(function(){$(e).appendTo("body")}),r(function(){$("#loginWidget").trigger("click")},100)}),e.stopImmediatePropagation())}s.on("click",n)}}}]).directive("msAssign",function(){return{scope:!0,compile:function(e,t){return{pre:function(e,t,a){a=a.msAssign.split("=");e[a[0]]=e.$eval(a[1])}}}}}).directive("msActive",["$compile",function(e){return{link:function(e,a,t){e.$watch("element",function(e,t){a.hasClass("active")&&(a.parent().parent().parent().parent()&&(a.parent().parent().parent().parent().addClass("open"),a.parent().parent().parent().parent().addClass("active")),a.parent().parent().addClass("active"),a.parent().parent().addClass("open"))},!0),a.on("click",function(){a.siblings().hasClass("active")&&a.siblings().removeClass("active"),a.siblings().hasClass("open")&&(a.siblings().removeClass("open"),a.siblings().children("ul").css("display","none")),a.parent().parent().siblings().removeClass("open"),a.parent().parent().siblings().children("ul").css("display","none"),a.parent().parent().siblings().removeClass("active"),a.parent().parent().addClass("active"),a.parent().parent().addClass("open")})}}}]).directive("msThemeactive",["$compile",function(e){return{link:function(e,a,t){e.$watch("element",function(e,t){a.hasClass("active")&&(a.parent().parent().parent().parent()&&(a.parent().parent().parent().parent().addClass("open"),a.parent().parent().parent().parent().addClass("active")),a.parent().parent().addClass("active"),a.parent().parent().addClass("open"))},!0),a.on("click",function(){a.hasClass("child")&&($(".child").removeClass("active"),a.addClass("active")),a.siblings()&&a.siblings().hasClass("active")&&0==a.children.length&&a.siblings().removeClass("active"),a.siblings().hasClass("open")&&(a.siblings().removeClass("open"),a.siblings().children("ul").css("display","none")),a.parent().parent().siblings().removeClass("open"),a.parent().parent().siblings().children("ul").css("display","none"),a.parent().parent().siblings().removeClass("active"),a.parent().parent().addClass("active"),a.parent().parent().addClass("open")})}}}]).directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(n){n.initCarousel=function(e){var t,a={},s=n.$eval($(e).attr("data-options"));for(t in s)a[t]=s[t];$(e).owlCarousel(a)}}}}).directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(e,t){e.$last&&e.initCarousel(t.parent())}}}]).directive("prism",[function(){return{restrict:"EAC",template:"<pre><code ng-transclude></code></pre>",replace:!0,transclude:!0}}]).filter("shopifyImage",["$filter","$rootScope",function(e,s){return function(e,t,a){if(s.ms.user&&s.ms.user.device&&s.ms.user.device.type&&"mobile"==s.ms.user.device.type&&!a&&(t&&"master"!=t&&"2048x2048"!=t&&"1024x1024"!=t||(t="medium")),!e)return"//:0";return 0==(e=t?e.substring(0,e.lastIndexOf("."))+"_"+t+e.substring(e.lastIndexOf(".")):e).indexOf("data:")||0==e.indexOf("http")?e:ms_store.baseUrl+"/"+e}}]),angular.module("mystore").value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(f,h,_,v,e,y,b){return(y=y||{}).baseUrl&&(tinymce.baseURL=y.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(m,u,p,g){function a(){var t,a,s,n,o,i,r,e,d;function l(e){e?(c(),o&&o.getBody().setAttribute("contenteditable",!1)):(c(),o&&!o.settings.readonly&&o.getDoc()&&o.getBody().setAttribute("contenteditable",!0))}function c(){o=o||tinymce.get(p.id)}v.tinymce&&(t=g[0],a=g[1]||null,n={debounce:!1},i=function(e){e=e.getContent({format:n.format}).trim();t.$setViewValue(e),f.$$phase||m.$digest()},d=b.getUniqueId(),p.$set("id",d),s={},angular.extend(s,m.$eval(p.uiTinymce)),r=function(t){_.cancel(e),e=_(function(){var e;(e=t).isDirty()&&(e.save(),i(e))},400)},d={setup:function(e){e.on("init",function(){t.$render(),t.$setPristine(),t.$setUntouched(),a&&a.$setPristine()}),e.on("ExecCommand change NodeChange ObjectResized",function(){if(!n.debounce)return e.save(),void i(e);r(e)}),e.on("blur",function(){u[0].blur(),t.$setTouched(),f.$$phase||m.$digest()}),e.on("remove",function(){u.remove()}),y.setup&&y.setup(e,{updateView:i}),s.setup&&s.setup(e,{updateView:i})},format:s.format||"html",selector:"#"+p.id},angular.extend(n,y,s,d),_(function(){n.baseURL&&(tinymce.baseURL=n.baseURL);var e=tinymce.init(n);e&&"function"==typeof e.then?e.then(function(){l(m.$eval(p.ngDisabled))}):l(m.$eval(p.ngDisabled))}),t.$formatters.unshift(function(e){return e||""}),t.$parsers.unshift(function(e){return e||""}),t.$render=function(){c();var e=t.$viewValue||"";o&&o.getDoc()&&(o.setContent(e),o.fire("change"))},p.$observe("disabled",l),m.$on("$tinymce:refresh",function(e,t){var a,s=p.id;!angular.isUndefined(t)&&t!==s||(t=u.parent(),(a=u.clone()).removeAttr("id"),a.removeAttr("style"),a.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,s),t.append(h(a)(m)))}),m.$on("$destroy",function(){c(),o&&(o.remove(),o=null)}))}if(window.ms.tinymceLoaded)return a();$.cachedScript(["//cdn.storehippo.com/frontend/plugins/tinymce/tinymce.min.js"]).done(function(e,t){window.ms.tinymceLoaded=!0,a()}).fail(function(e,t,a){console.log("Triggered ajaxError handler.")})}}}]).service("uiTinymceService",[function(){return new function(){var e=0;return{getUniqueId:function(){return"ui-tinymce-"+ ++e}}}}]),d.directive("msCategories",["$templateCache","$compile","$stateParams","entitySvc",function(e,t,a,s){return{scope:!0,link:function(e,t,a){var s=a.msCategories;e.settings={},e.settings.page_size=a.count,s?(e.settings.page_size||(e.settings.page_size="1"),e.settings.filters=[{field:"alias",type:"manual",value:s}]):e.settings.page_size||(e.settings.page_size="10"),e.settings.entity="ms.categories",mystore.entityController(e,"categories")}}}]).directive("msTags",["$templateCache","$compile","$stateParams","entitySvc","$http","$rootScope","$timeout",function(e,t,a,s,n,o,i){return{scope:!0,link:function(e,t,a){var s=a.msTags;e.settings={},e.settings.page_size=a.msPagesize,s?(e.settings.page_size||(e.settings.page_size="1"),e.settings.filters=[{field:"alias",type:"manual",value:s}]):e.settings.page_size||(e.settings.page_size="10"),e.settings.entity="ms.tags",mystore.entityController(e,"tags")}}}]).directive("msCategoryProducts",["$templateCache","$compile","$stateParams","entitySvc",function(e,t,o,i){return{scope:!0,link:function(a,e,t){var s,n=t.msCategoryProducts;console.log("enter in category products",n),a.settings={},a.settings.page_size=t.msPagesize,n=n||o.category,a.settings.page_size||(a.settings.page_size="10"),n?(s=i.getEntity("ms.categories")).list({q:{alias:n}}).then(function(e){var t;e.records&&0!=e.records.length?(a.category=e.records[0],t=a.category.alias,o.subcategory?s.list({alias:o.subcategory}).then(function(e){e.records&&0!=e.records.length?(a.subcategory=e.records[0],t=$scope.subcategory.alias,a.settings.filters=[{field:"categories",type:"manual",value:t}],a.settings.entity="ms.products",mystore.entityController(a,"categoryProducts")):a.error("Sub Category ["+o.subcategory+"] not found")}):(a.settings.filters=[{field:"categories",type:"manual",value:t}],a.settings.entity="ms.products",mystore.entityController(a,"categoryProducts"))):a.error("Category ["+category+"] not found")}):a.error("Category not specified in settings or in url. Not proceeding")}}}]).directive("msTagProducts",["$templateCache","$compile","$stateParams","entitySvc","$http","$rootScope","$timeout",function(e,t,n,o,a,s,i){return{scope:!0,link:function(t,e,a){var s=a.msTagProducts,a=a.msPagesize;(s=s||n.tag)?(t.settings={},a||(t.settings.page_size="10"),o.getEntity("ms.tags").list({q:{alias:s}}).then(function(e){e.records&&0!=e.records.length?(t.tag=e.records[0],t.settings.filters=[{field:"tags",type:"manual",value:s}],t.tag.filters.forEach(function(e){t.filters.push(e)}),t.settings.entity="ms.products",mystore.entityController(t,"tagProducts")):t.error("Tag ["+s+"] not found")})):t.error("MS: ERROR: Tag not specified in settings or in url. Not proceeding")}}}]).directive("msProducts",["$templateCache","$compile","$http","$rootScope","$timeout",function(e,t,a,s,n){return{link:function(e,t,a){console.log("msProduct directive called"),e.settings={},e.settings.page_size="10",a.msPagesize&&""!=a.msPagesize&&(e.settings.page_size=parseInt(a.msPagesize)),e.settings.entity="ms.products",mystore.entityController(e,"products")}}}]).directive("msProduct",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,a,i,r,s){return{link:function(o,e,t){if(o.alias=t.msProduct,r.product&&""!=r.product&&(o.alias=r.product),!o.alias||""==o.alias)return console.log("product alias not found"),void o.error("Could not find :product in the URL params");t=s.getEntity("ms.products");o.loading=!0,t.list({q:{alias:o.alias}}).then(function(e){if(!e.records||0==e.records.length)return o.error("Product ["+r.product+"] not found"),void $location.path("/page/404html");o.product=e.records[0],i.ms.page&&o.product.name&&(i.ms.page.title=o.product.name),o.loading=!1,o.variant_options={},angular.forEach(o.product.product_variants[0],function(e,t){"price"!=t&&(o.variant_options[t]=[e])}),angular.forEach(o.product.product_variants,function(a){angular.forEach(o.variant_options,function(e,t){-1==e.indexOf(a[t])&&e.push(a[t])})});var t={},a="",s=[],n=(angular.forEach(o.product.product_variants,function(e){angular.forEach(e,function(e,t){"price"!=t&&(a+="/"+e)}),(t=e).title=a,s.push(t),a=""}),o.variant_values={},o.product.price);o.$watch("variant_values",function(e){var t;e&&(t="",angular.forEach(e,function(e){t+="/"+e}),angular.forEach(s,function(e){t==e.title&&(console.log("====detail====",e),(o.variant_selected=e).price?o.product.price=e.price:o.product.price=n)}))},!0)},function(){o.error("Error getting product details"),o.loading=!1})}}}]).directive("msNavigation",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,a,s,n,o){return{link:function(e,t,a){var s=a.msNavigation;e.settings={},e.settings.page_size=a.count,s?(e.settings.page_size||(e.settings.page_size="1"),e.settings.filters=[{field:"name",type:"manual",value:s}]):e.settings.page_size||(e.settings.page_size="10"),e.settings.entity="ms.navigation",mystore.entityController(e,"links")}}}]).directive("navigation",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,n,a,s,o){return{link:function(t,e,a){var s=a.navigation,a=(t.settings={},t.settings.page_size=a.count,"/entity/ms.themes/"+Store.theme._id+"/navigation");n.get(a).success(function(e){angular.forEach(e.records,function(e){e.name==s&&(t.links=e.links)})})}}}]).directive("slides",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,s,a,n,o){return{link:function(t,e,a){t.settings={},t.settings.page_size=a.count;a="/entity/ms.themes/"+Store.theme._id+"/slides";s.get(a).success(function(e){t.records=e.records})}}}]).directive("banners",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,s,a,n,o){return{link:function(t,e,a){t.settings={},t.settings.page_size=a.count;a="/entity/ms.themes/"+Store.theme._id+"/banners";s.get(a).success(function(e){t.records=e.records})}}}]).directive("msSlides",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,a,s,n,o){return{link:function(t,e,a){t.sliderId="slides"+Math.floor(9e4*Math.random())+1e4,o.getEntity("ms.slides").list().then(function(e){t.links=e.records,$(".carousel").carousel()})}}}]).directive("msEntityMap",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,l,t,a,s,c){return{link:function(n,e,o){console.log("entityMap directive called",e,o),n.records=null,n.item=null,o.id&&""!=o.id||console.log("please add id attribute to ms-entity-map element");var i,a,r,d,e=o.msEntityMap;e?(e=c.getEntity(e),n.loading=!0,i=new google.maps.Geocoder,a={center:new google.maps.LatLng(28.413323,77.044115),zoom:16,scrollwheel:!1,disableDoubleClickZoom:!1,panControl:!0,zoomControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.LatLngBounds,d=null,e.list({}).then(function(e){console.log("all Records>>>>>>>>>>>>>>>>>>>>>",e.records),n.records=e.records},function(){n.loading=!1}),n.$watch("records",function(e,t){var s;e&&(s=new google.maps.Map(document.getElementById(o.id),a),o.msHeight&&""!=o.msHeight?$("#"+o.id).height(o.msHeight):$("#"+o.id).height(200),angular.forEach(n.records,function(e){var a=new google.maps.Marker({map:s,title:e.name||""}),t=(n.item=e,l("<div>"+o.msMarkerHtml+"</div>")(n));console.log("ele>>>>>>>>>>>>>>>>>>>>>",t,e.name),a.content=t.html(),console.log(">>>>>>>>>>>marker.content>>>>>>>>>>>>>>>>",a.content),o.msMarkerIconUrl&&""!=o.msMarkerIconUrl&&a.setIcon(o.msMarkerIconUrl),google.maps.event.addListener(a,"mouseover",function(){d&&d.close(),(d=new google.maps.InfoWindow).setContent(a.content),d.open(s,this)}),google.maps.event.addListener(a,"click",function(){$location.path(a.url),n.$apply()}),e.latitude&&e.longitude?(t=new google.maps.LatLng(e.latitude,e.longitude),a.setPosition(t),r.extend(t),o.msZoom||s.fitBounds(r)):((t=e.address)||console.log("Please give the latitude and longitude or address for the record"),i.geocode({address:t},function(e,t){t==google.maps.GeocoderStatus.OK?(a.setPosition(e[0].geometry.location),r.extend(e[0].geometry.location),o.msZoom||s.fitBounds(r)):n.error("Geocode was not successful for the following reason: "+t+".Reload the page to see the map.")})),google.maps.event.trigger(s,"resize"),o.msZoom&&s.setZoom(parseInt(o.msZoom))}))})):n.error("Entity not defined")}}}]).directive("msSearch",["$templateCache","$compile","$http","$rootScope","$stateParams","entitySvc",function(e,t,a,s,i,r){return{link:function(t,e,a){function s(){t.loading=!0,""==n?t.loading=!1:o.search({q:n,start:t.start,limit:t.page_size}).then(function(e){t.products=e.records,t.loading=!1})}var n=i.query,o=(t.loading=!0,t.searchText=n,t.products=[],r.getEntity("ms.products"));t.start=0,t.page_size=10,a.msPagesize&&""!=a.msPagesize&&(t.page_size=parseInt(a.msPagesize));t.next=function(){t.start=t.start+t.page_size,s()},t.previous=function(){t.start=t.start-t.page_size,s()},s()}}}]).directive("msOrderStatus",["$stateParams","entitySvc","$http","$rootScope",function(n,o,e,i){return{scope:!0,link:function(t,e,a){var s=n.orderId;s?o.getEntity("ms.orders").list({q:{_id:s}}).then(function(e){t.data={order_id:s,status:e.records[0].received_info.status,txnid:e.records[0].received_info.txnid,bank_ref_num:e.records[0].received_info.bank_ref_num,items:e.records[0].item_details,total:e.records[0].total,total_items:e.records[0].item_count},i.ms.cart.items=[],i.ms.cart.total=0,i.ms.cart.item_count=0,i.ms.cart.billing_address={},i.ms.cart.shipping_address={},i.ms.cart.shipping_method={},i.ms.cart.payment_method={},i.ms.cart.id="",i.ms.cart.discounts={},i.ms.cart.selected_shipping_method={},i.ms.cart.available_shipping_methods={},localStorage.setItem("cart",JSON.stringify(i.ms.cart))},function(){t.error("Something went wrong")}):t.error("Something went wrong")}}}]).directive("msOrderHistory",["$rootScope",function(n){return{scope:!0,link:function(e,t,a){var s=n.ms.user._id;s?(e.settings={},e.settings.page_size="10",e.settings.filters=[{field:"user_id",type:"manual",value:s}],e.settings.entity="ms.orders",mystore.entityController(e,"orderHistory")):e.error("User is not logged in. Not proceeding")}}}]),!function(){function p(i,e,t,a,s,n,o,r,d){var l,c,m,u=i.field,p=e.find("select"),g=(i.bindEvents&&i.bindEvents(p),!u.settings.multiple||i.formData[i.field.name]||(i.formData[i.field.name]=[]),u.settings.display_type||(u.settings.display_type="chosen"),"select2"==u.settings.display_type&&(i.tags=[],i.$watch("field.settings.options",function(e,t){a(function(){i.tags=e},300)},!0),mystore.utils.loadCss("//cdn.storehippo.com/frontend/plugins/select2/select2.css"),require(["//cdn.storehippo.com/frontend/plugins/select2/select2.js"],function(){a(function(){$(p).hide();var e=$("<input type='hidden' />").insertAfter(p);e.select2({tags:i.tags,tokenSeparators:[","]}).bind("change",function(){i.formData[i.field.name]=e.select2("val")}),i.formData[i.field.name]&&e.select2("val",i.formData[i.field.name])},300)})),"chosen"==u.settings.display_type&&(p.addClass("chzn-select"),i.$watch("field.settings.options",function(e,t){a(function(){$(p).trigger("chosen:updated")},10)},!0),mystore.utils.loadCss("//cdn.storehippo.com/frontend/plugins/chosen_v1.5.1/chosen.css"),require.config({waitSeconds:0}),i.$watch("formData[field.name]",function(e,t){$(p).trigger("chosen:updated")}),require(["//cdn.storehippo.com/frontend/plugins/chosen_v1.5.1/chosen.jquery.min.js"],function(){a(function(){$(p).chosen({width:"100%"})},10)})),""),e=s.getEntity("ms.extend_field");if("options"==u.settings.source?e.list().then(function(e){angular.forEach(e.records,function(e){g=e.field_name&&e.field_name==u.name&&0<e.data.length?e.data:u.settings.options?u.settings.options.slice(0):[],u.settings.defaultLabel&&g.unshift({name:u.settings.defaultLabel,value:u.settings.default}),u.settings.options=g})}):(g=u.settings.options?u.settings.options.slice(0):[],u.settings.defaultLabel&&g.unshift({name:u.settings.defaultLabel,value:u.settings.default}),u.settings.options=g),"entity"==u.settings.source&&(g=[],(m=u.settings.source_entity).entity&&(s={entity:m.entity,query:{fields:{},limit:5e3}},m.filters&&m.filters.length&&(s.query.filters=JSON.stringify(m.filters)),l=m.key_column||"_id",c=m.value_column||"name",s.query.fields[l]=1,s.query.fields[c]=1,n.list(s,function(e,t){if(e)console.log("Error occured in list command ",e);else{if(t&&t.data&&t.data.records){var a,s=t.data.records;for(a in s){var n=s[a];if(l in n){var o="";if(m.value_formatter&&"string"==typeof m.value_formatter&&m.value_formatter.trim())o=mystore.utils.parseFunction(m.value_formatter).call(null,n);else{if(!(c in n))continue;o=n[c]}i.formData[l]!=n[l]&&g.push({name:o,value:n[l]})}}}u.settings.options=g,"1"==u.settings.add_new_option&&u.settings.options.push({name:"Add New",value:"add_new"})}}))),"sub_entity"==u.settings.source&&(g=[],m=u.settings.source_entity,e="/entity/"+r.entity+"/"+r.entityid+"/"+m.entity,o.get(e).success(function(e){var t,a=e.records;for(t in a){var s,n=a[t],o=m.key_column||"_id";o in n&&((s=m.value_column||"name")in n&&g.push({name:n[s],value:n[o]}))}u.settings.options=g},function(e){console.log("ERROR: Could not get data for source entity ["+m.entity+"]")})),"function"==u.settings.source){n=u.settings.source_function,s=mystore.utils.parseFunction(n);if(!s)return console.log(n),void console.log("ERROR: sourceFunction not defined");r=s.call(null);"object"==typeof r&&r.then?r.then(function(e){u.settings.options=e},function(e){console.log("ERROR: Source function failed while retrieving data"),u.settings.options=[]}):"array"==typeof r?u.settings.options=r:(console.log("ERROR: Source function did not return valid data"),u.settings.options=[])}}var e=angular.module("mystore");e.directive("msForm",["$templateCache","$timeout","$http","$compile","$rootScope","$location","$anchorScroll","$stateParams",function(f,h,_,v,y,b,w,$){return{restrict:"A",scope:{formOptions:"=msForm",formName:"@name"},controller:["$scope",function(a){a.initCheckboxes=function(e,t){e[t]||(e[t]=[]),Array.isArray(e[t])||(e[t]=[])},a.isChecked=function(e,t){return-1<e.indexOf(t)},a.initSelect=function(e,t){e[t]||(e[t]=["first","second"])},a.toggleCheckbox=function(e,t){-1===e.indexOf(t)?e.push(t):e.splice(e.indexOf(t),1)},this.getElement=function(e){for(var t in a.formOptions.fields)if(a.formOptions.fields[t].name==e)return element;return null},this.getError=function(e){return a.errors[e]},this.setElementData=function(e,t){a.formData[e]=t}}],link:function(l,c,e){if("FORM"!=c.prop("tagName")&&"NG-FORM"!=c.prop("tagName"))console.log("MS-FORM: ERROR: The directive can only be applied on a form tag");else{l.fieldsObj={},l.tabObj={},l.uploadingImage=!1,l.setUploadingImage=function(e){l.uploadingImage=e},l.$on("$locationChangeStart",function(e,t,a,s,n){l.editRecord&&l.editRecord.$dirty&&l.addRecord&&l.addRecord.$dirty&&(l.submitting||l.submitted||confirm("You have unsaved changes.Are you sure you want to leave this page?")||e.preventDefault())}),l.formName&&(y.ms||(y.ms={}),y.ms.forms||(y.ms.forms={}),y.ms.forms[l.formName]=l),l.formOptions||(l.formOptions={}),l.isTemplateProcessed=!1;var t=window.mystore.storage(),m="",u="",p=t.getItem("mform_active_tabs");if(p)try{p=JSON.parse(p)}catch(e){console.log("Error in parsing storedata"),t.removeItem("mform_active_tabs"),p={}}else p={};"string"==typeof p&&(p={}),l[l.formName]=l.$parent[l.formName],l.$watch("formOptions",function(e,t){if(l.formOptions){if(p&&l.formName&&l.formOptions.entity&&l.formOptions.recordId&&(m=l.formName+"_"+l.formOptions.entity,p[m]&&p[m].recordId==l.formOptions.recordId&&(u=p[m].activetab)),l.getTypeOf=function(e){return typeof e},l.scrollToElement=function(e,t){l.formOptions.selectedIndex==e.tab||(l.formOptions.selectedIndex=e.tab),b.hash(e.id),h(function(){w(),b.hash("")},500)},l.formOptions.groups_settings&&l.formOptions.groups_settings.groups&&0<l.formOptions.groups_settings.groups.length){if("tab"==l.formOptions.groups_settings.display_type){l.tab=l.formOptions.groups_settings.groups[0],l.formOptions.groups_settings.position&&(l.formOptions.groups_settings.class="tabs-"+l.formOptions.groups_settings.position);for(var a=0;a<l.formOptions.fields.length;a++)(n=l.formOptions.fields[a]).settings||(n.settings={}),n.settings.field_groups&&n.settings.field_groups.length||(n.settings.field_groups=l.formOptions.groups_settings.default),!n.settings.add_hidden||"1"!=n.settings.add_hidden||"add"!=$.action&&"_add"!=$.action||(n.settings.hidden=!0),!n.settings.edit_hidden||"1"!=n.settings.edit_hidden||"edit"!=$.action&&"_edit"!=$.action||l.formOptions.enableAdd||(n.settings.hidden=!0),!n.settings.add_disabled||"1"!=n.settings.add_disabled||"add"!=$.action&&"_add"!=$.action||(n.settings.disabled=!0),!n.settings.edit_disabled||"1"!=n.settings.edit_disabled||"edit"!=$.action&&"_edit"!=$.action||l.formOptions.enableAdd||(n.settings.disabled=!0),n.layout_style||(n.layout_style=l.formOptions.layout_style),n.label_width||(n.label_width=l.formOptions.label_width),l.fieldsObj[n.name]={id:n.id},n.settings&&n.settings.label&&(l.fieldsObj[n.name].label=n.settings.label);var s=[];l.formOptions.groups_settings.groups.forEach(function(e){for(var t=0;t<l.formOptions.fields.length;t++){var a=l.formOptions.fields[t];e.fields||(e.fields=[]),a.settings.field_groups==e.name&&(e.fields.push(a),l.fieldsObj[a.name].tab=s.length)}e.fields.length&&s.push(e),u&&e&&e.name==u&&(l.tab=e)}),l.formOptions.groups_settings.groups=s}if("accordion"==l.formOptions.groups_settings.display_type){l.accordion=l.formOptions.groups_settings.groups[0],l.formOptions.groups_settings.position&&(l.formOptions.groups_settings.class="tabs-"+l.formOptions.groups_settings.position);for(var n,a=0;a<l.formOptions.fields.length;a++)(n=l.formOptions.fields[a]).settings.field_groups||(n.settings.field_groups=l.formOptions.groups_settings.default)}}else if(l.formOptions.fields&&l.formOptions.fields.length)for(var o=0,i=l.formOptions.fields.length;o<i;o++){var r=l.formOptions.fields[o];!r.settings.edit_type&&r.type&&(r.settings.edit_type=r.type),!r.settings.label&&r.label&&(r.settings.label=r.label),!r.settings.add_hidden||"1"!=r.settings.add_hidden||"add"!=$.action&&"_add"!=$.action||(r.settings.hidden=!0),!r.settings.edit_hidden||"1"!=r.settings.edit_hidden||"edit"!=$.action&&"_edit"!=$.action||l.formOptions.enableAdd||(r.settings.hidden=!0),!r.settings.add_disabled||"1"!=r.settings.add_disabled||"add"!=$.action&&"_add"!=$.action||(r.settings.disabled=!0),!r.settings.edit_disabled||"1"!=r.settings.edit_disabled||"edit"!=$.action&&"_edit"!=$.action||l.formOptions.enableAdd||(r.settings.disabled=!0),l.fieldsObj[r.name]={id:r.id},r.settings&&r.settings.label&&(l.fieldsObj[r.name].label=r.settings.label),r.layout_style||(r.layout_style=l.formOptions.layout_style),r.label_width||(r.label_width=l.formOptions.label_width)}var d;l.formOptions&&0===Object.keys(l.formOptions).length||(l.isTemplateProcessed?g(c):(0==c.children().length?((d=l.formOptions.template)||(l.formOptions.enableMaterial?d="/templates/widgets/msFormsTemplate.html":l.formOptions.enableBootstrap3?d="/templates/widgets/mform.default.bootstrap3.html":(d="/templates/widgets/mform.default.html",c.addClass("form-horizontal"))),c.addClass("form-horizontal"),_.get(d,{cache:f}).success(function(e){e=v(e)(l);c.html("").append(e.contents()),g(c)})):(d=v(c.html())(l),c.html("").append(d),g(c)),l.isTemplateProcessed=!0))}}),l.refresh=function(){console.log("msform refresh function called"),angular.forEach(l.formOptions.fields,function(e){var t;e.settings&&e.settings.show_on&&e.settings.show_on.length?(t=!0,e.settings.show_on.forEach(function(e){e&&l.formData[e.field]==e.value&&(t=!1)}),e.settings.hidden=t):e.settings&&e.settings.hide_on&&e.settings.hide_on.length&&(e.settings.hide_on.forEach(function(e){if(t=!1,e)switch(e.operator||"equal"){case"equal":l.formData[e.field]==e.value&&(t=!0);break;case"not_equal":l.formData[e.field]!=e.value&&(t=!0)}}),e.settings.hidden=t)}),l.$$phase||l.$root.$$phase||l.$apply()},l.tabChange=function(e){(l.tab=e)&&e.name&&m&&p&&(e={recordId:l.formOptions.recordId,activetab:e.name},p[m]=e,t.setItem("mform_active_tabs",JSON.stringify(p)))},l.toggleAccordion=function(e){l.accordion.name==e.name?l.accordion={}:l.accordion=e},l.formData={},l.$watch("formOptions.data",function(e,t){l.formOptions&&l.formOptions.data&&(l.formData=l.formOptions.data,angular.forEach(l.formOptions.fields,function(t){if(t.settings&&t.settings.show_on&&t.settings.show_on.length){var a=!1,s=!0,e=(t.settings.show_on.forEach(function(e){var t;e&&("equal"===(t=e.operator||"equal")&&l.formData[e.field]==e.value||"not_equal"===t&&l.formData[e.field]!=e.value?a=!0:s=!1)}),!0);(!s||"and"!==t.settings.show_on_operator)&&(!a||"or"!==t.settings.show_on_operator&&t.settings.show_on_operator)||(e=!1),t.settings.hidden=e}else if(t.settings&&t.settings.hide_on&&t.settings.hide_on.length){e=!1;for(var n=0,o=t.settings.hide_on.length;n<o;n++){var i=t.settings.hide_on[n],r=i.operator||"equal";if("equal"===r&&l.formData[i.field]==i.value)console.log("equal",l.formData[i.field],i.value,l.formData[i.field]===i.value),e=e||!0;else if("not_equal"===r&&l.formData[i.field]!=i.value)console.log("not_equal",l.formData[i.field],i.value,l.formData[i.field]!==i.value),e=e||!0;else if("and"===t.settings.hide_on_operator){e=!1;break}}t.settings.hidden=e}if(t.settings&&t.settings.default&&"object"!=t.settings.edit_type&&"collection"!=t.settings.edit_type)if("multiselect"==t.settings.edit_type){var d=l.formData[t.name];d&&d.length||(d=t.settings.default,"array"!=typeof(l.formData[t.name]=d)&&(l.formData[t.name]=[d]))}else if(void 0===l.formData[t.name])try{y.$eval(t.settings.default)?l.formData[t.name]=y.$eval(t.settings.default):l.formData[t.name]=t.settings.default}catch(e){l.formData[t.name]=t.settings.default}}))},!0),l.submitted=!1,l.errors={},l.errorslength,l.invalid=!1,l.error={},l.$watch("errors",function(e,t){e&&angular.forEach(l.errors,function(e,a){angular.forEach(e,function(e,t){l.error[a]=e})})}),l.validate=function(){return l.invalid=!1,l.errors=validation.formValidation(l.formOptions.fields,l.formData),l.$$phase||l.$root.$$phase||l.$apply(),0!==Object.keys(l.errors).length?(l.errorslength=Object.keys(l.errors).length,!(l.invalid=!0)):!(l.invalid=!1)},l.submit=function(){c.trigger("submit")},l.reset=function(){c.trigger("reset"),l.formData={},l.errors={}}}function g(e){l.formOptions.class&&c.addClass(l.formOptions.class),l.formOptions.id&&e.attr("id",l.formOptions.id),l._submitBinded||(l._submitBinded=!0,e.bind("submit",function(){if(l.submitting)return console.log("MS-FORM: INFO: Form submit is already in progress. Waiting for that to finish"),!1;if(l.uploadingImage)return alert("Image processing is in progress .... "),!1;if(l.success=!1,l.validate()||(l.$$phase||l.$root.$$phase||l.$apply(),l.invalid=!0),l[l.formName]&&l[l.formName].$invalid&&(l[l.formName].$error.ngIntlTelInput?l.errors.phone={invalid_phone:"Enter a valid phone number"}:l.errors.Error={Error:"Form is not valid. Please check the input and try again."},l.errorslength=Object.keys(l.errors).length,l.invalid=!0),l.invalid)return!1;if(l.formOptions.submit){l.submitting=!0;var e=l.formOptions.submit(l.formOptions.data);if(!e||!e.then)return console.log("MS-FORM: ERROR: The submit handler should be a promise object"),l.submitting=!1;e.then(function(e){l.submitting=!1,l.submitted=!0,l.success=!0,l.formOptions.clearOnSuccess&&(l.formOptions.data={}),l.$$phase||l.$root.$$phase||l.$apply()},function(e){l.invalid=!0,"string"==typeof e?l.errors={Error:{form:e}}:e.error?"string"==typeof e.error?l.errors={Error:{form:e.error}}:e.error.message&&(l.errors={Error:{form:e.error.message}}):"string"==typeof e.data?l.errors={Error:{form:e.data}}:e.data&&e.data.data?l.errors=e.data.data:l.errors=e.data,-1<String(e.status).indexOf(50)&&(l.errors={Server:{server:"Server Error"}}),401==e.status&&(l.errors={Server:{server:"Unauthorized"}}),l.errorslength=Object.keys(l.errors).length,l.submitting=!1,l.submitted=!0,l.success=!1,l.$$phase||l.$root.$$phase||l.$apply()}),l.$$phase||l.$root.$$phase||l.$apply()}return!1}))}}}}]),e.directive("msField",["$compile","$timeout",function(i,r){return{scope:!0,link:function(o,a,s){s.$observe("msField",function(){var e,n=null;if(o.formOptions){for(var t in o.formOptions.fields){t=o.formOptions.fields[t];if(t.name==s.msField){n=t;break}}n?((o.field=n).settings||(n.settings={}),n.settings.edit_type||(n.settings.edit_type="text"),o.eventsBinded=!1,o.bindEvents&&(o.bindEvents=function(s){!o.eventBinded&&n.settings.events&&(angular.forEach(n.settings.events,function(t){var a;t&&t.handler&&(a=mystore.utils.parseFunction(t.handler))?("init"==t.event&&r(function(){var e={scope:o,msEvent:t.event,domElement:s,selectedValue:o.formData[n.name]};a.call(null,e)}),"load"==t.event&&n.settings.default&&(o.formData[n.name]||(o.formData[n.name]=n.settings.default),o.$on("load",function(e){e={scope:o,event:e,msEvent:t.event,domElement:s,selectedValue:o.formData[n.name]};a.call(null,e)}),o.$emit("load")),angular.element(s).bind(t.event,function(e){e={scope:o,event:e,msEvent:t.event,domElement:s,selectedValue:o.formData[n.name]};a.call(null,e)})):console.log("ERROR: event handler not defined")}),o.eventBinded=!0)}),n.template||(e=i("<div class='mf-"+n.name+"' ms-form-"+n.settings.edit_type+'="" ></div>')(o),a.html("").append(e)),n.settings.readonly&&($(".mf-"+n.name).find("input").attr("disabled","true"),$(".mf-"+n.name).find("textarea").attr("disabled","true")),n.settings&&n.settings.default&&"object"!=n.settings.edit_type&&"collection"!=n.settings.edit_type&&("multiselect"==n.settings.edit_type?(e=o.formData[n.name])&&e.length||(e=n.settings.default,"array"!=typeof(o.formData[n.name]=e)&&(o.formData[n.name]=[e])):o.formData[n.name]||("integer"==String(n.data_type)||"number"==String(n.data_type))&&"0"==String(o.formData[n.name])||(o.formData[n.name]=n.settings.default))):console.log("MS-FORM: ERROR: field ["+s.name+"] not found")}})}}}]),e.directive("msLabel",["$filter",function(r){return{scope:!0,link:function(n,o,i){i.$observe("msLabel",function(){if(n.formOptions){var e,t,a=null;for(e in n.formOptions.fields){var s=n.formOptions.fields[e];if(s.name==i.msLabel){a=s;break}}a?(t=(t=a.name.replace(/_/g," ")).replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),a.settings&&a.settings.label?t=a.settings.label:a.settings&&a.settings.no_label&&(t=""),t=r("msT")(t),o.html(t)):console.log("MS-FORM: ERROR: field ["+i.name+"] not found")}})}}}]),e.directive("msError",["$filter",function(r){return{restrict:"A",link:function(e,n,o){var i="";e.$watch("errors",function(e,t){if(e){var a=o.msError,s=(o.parent,"");if(!e[a])return $("."+a).removeClass("md-input-invalid"),void n.html(s);angular.forEach(e[a],function(e,t){var a;(s=s?s:'<div class="md-input-message-animation">'+(a=function(e){var t;return"object"==typeof e&&(t=Object.keys(e)[0],e=a(e[t])),r("msT")(e)})(e)+"</div>")&&(i="md-input-invalid")}),n.html(s),$("."+a).addClass(i)}},!0)}}}]),e.directive("ckEditor",function(){return{require:"?ngModel",link:function(e,t,a,s){var n=CKEDITOR.replace(t[0]);s&&(n.on("pasteState",function(){e.$$phase||e.$apply(function(){s.$setViewValue(n.getData())})}),s.$render=function(e){n.setData(s.$viewValue)})}}}),e.directive("msFormHybrideditor",["$timeout","$rootScope","$compile",function(e,t,i){return{link:function(s,e,t){s.selecteditor={},s.selecteditor.value=0;s.selecteditor.value;s.$watch("selecteditor.value",function(e,t){var a=0==s.selecteditor.value?o:n;i(a)(s,function(e){s.html=e})});var n="<div ms-form-htmleditor></div>",o="<div ms-form-codemirror></div>"},template:'<ul class="nav nav-pills" style="margin-left: 0px"><li class="active"><a data-toggle="pill" href="#check" data-ng-click="selecteditor.value = 0">CODE MIRROR</a></li><li><a data-toggle="pill" href="#check" data-ng-click="selecteditor.value = 1">HTML EDITOR</a></li></ul><br/><div id="check" ng-bind-html-unsafe="html"></div>'}}]),e.directive("msFormHtmleditor",["$timeout","$rootScope",function(r,d){return{link:function(s,n,e){mystore.utils.logError("UNUSED: msFormHtmleditor  called");function t(){var e=n.find("textarea"),t=e.data("$ngModelController"),a=CKEDITOR.replace(e[0],{enterMode:Number(2),filebrowserImageUploadUrl:i,toolbar:[{name:"basicstyles",items:["Bold","Italic","Strike","-","RemoveFormat"]},{name:"styles",items:["Font","FontSize","TextColor","BGColor","Styles","Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"insert",items:["Link","Image","Table","HorizontalRule","SpecialChar"]},{name:"document",items:["Source"]},{name:"other",items:["Maximize"]}]});CKEDITOR.config.allowedContent=!0,CKEDITOR.config.allowedContent=!0,CKEDITOR.config.fillEmptyBlocks=!1,CKEDITOR.config.tabSpaces=0,t&&(a.on("instanceReady",function(){a.setData(t.$viewValue)}),a.on("pasteState",function(){s.$$phase||s.$apply(function(){t.$setViewValue(a.getData())})}),a.on("change",e=function(){s.$apply(function(){t.$setViewValue(a.getData())})}),a.on("key",e),a.on("dataReady",e),a.on("afterUndoImage",e),t.$render=function(e){a.setData(t.$viewValue)})}var a=s.field,o="uploads",i="/entity/ms.files/_/upload?dir="+(o=a.settings&&a.settings.file_directory?a.settings.file_directory:o),a=(d.ms&&d.ms.adminTheme&&(i+="&backend=1"),[]);a.push("//cdn.storehippo.com/frontend/plugins/ckeditor_v4.5.11_imageCustom/ckeditor.js"),require(a,function(){r(t)})},template:'<textarea ng-model="formData[field.name]"></textarea>'}}]),e.directive("msFormText",function(){return{link:function(e,t,a){},template:'<input type="text" class="form-control" ng-model="formData[field.name]" ng-disabled="field.settings && field.settings.disabled == \'1\'" placeholder="{{field.settings.placeholder}}"/>'}}),e.directive("msFormNumber",function(){return{link:function(e,t,a){},template:'<input type="number" class="form-control" ng-model="formData[field.name]" ng-disabled="field.settings && field.settings.disabled == \'1\'" placeholder="{{field.settings.placeholder}}"/>'}}),e.directive("msFormPrice",function(){return{link:function(e,t,a){},template:'<div class="input-group"><span class="input-group-addon"><span ms-widget="currency"></span></span><input class="form-control"  ng-model="formData[field.name]" ng-disabled="field.settings && field.settings.disabled == \'1\'" placeholder="{{field.name|ucfirst}}" type="text" ></div>'}}),e.directive("msFormWidgettemplate",["$http",function(e){return{link:function(t,e,a){var s=[];t.setTemplate=function(){for(var e in t.options)s[e].value==t.widgetTemplate&&(t.formData[t.field.name]=s[e].template)}},template:'<div ms-form-codemirror="formData[field.name]"></div><select ng-options="option.value as option.name for option in options" ng-model="widgetTemplate" ng-change="setTemplate()"></select>'}}]),e.directive("msFormTextarea",function(){return{link:function(e,t,a){},template:'<textarea  style="width:100%;" class="form-control" ng-model="formData[field.name]" ng-disabled="field.settings && field.settings.disabled == \'1\'" cols="{{field.settings.cols}}" rows="{{field.settings.rows || 6}}" ></textarea>'}}),e.directive("msFormAlias",function(){return{link:function(e,t,a){},template:'<input type="text" malias class="form-control" ng-model="formData[field.name]"placeholder="{{field.name}}"/>'}}),e.directive("msFormButton",function(){return{link:function(e,t,a){e.bindEvents&&e.bindEvents(t.find("input"));t="",t=e.field.settings.text||(t=e.field.name.replace("_"," ")).substring(0,1).toUpperCase()+t.substring(1);e.label=t},template:'<input type="button" value="{{label}}"> </input>'}}),e.directive("msFormRadio",function(){return{link:function(e,t,a){},template:'<div class="inline" ng-repeat ="option in field.settings.options"><label><input type = "radio" ng-model="formData[field.name]" value="{{option.value}}"/><span class ="lbl">{{option.name}}</span></label></div>'}}),e.directive("msFormCategory",["entitySvc","$http",function(e,a){return{link:function(n,e,t){n.field;n.categories=[],window.mystore.categories?(console.log(window.mystore.categories),angular.forEach(window.mystore.categories,function(e){n.categories.push(e)})):a.get("/api/1/entity/ms.categories").success(function(e){function a(e){angular.forEach(e,function(e,t){e.hidden=!1,e.padding="0px",1!=e.level&&(e.hidden=!0,e.padding=20*parseInt(e.level)-20+"px"),window.mystore.categories[e.alias]=e,n.categories.push(e),e.children&&0<e.children.length&&a(e.children)})}var t=[];e&&e.data&&e.data.length&&(t=e.data),window.mystore.categories={};a(t)});var o=mystore.utils.parseFunction("mystore.event_handlers.change_product_category");o?(n.formData.categories&&(n.options=n.formData.categories.slice(0),n.$watch("options",function(e,t){var a;n.options&&(a={scope:n,msEvent:"load",selectedValue:n.formData[n.field.name]},o.call(null,a))})),n.setPadding=function(e){return{"padding-left":e}},n.toggleChildren=function(e,t){for(var a in n.categories)n.categories[a].parent==t._id&&(n.formData[e.name].indexOf(t.alias),n.categories[a].hidden=!1);var s={scope:n,msEvent:"change",selectedValue:n.formData[e.name]};o.call(null,s)}):console.log("ERROR: event handler not defined")},template:'<div style="padding-top: 5px;" ng-init="initCheckboxes(formData, field.name)"  ng-repeat = "option in categories"><label ng-style="setPadding(option.padding)" ><input type = "checkbox"  ng-checked="formData[field.name].indexOf(option.alias) != -1" ng-click="toggleCheckbox(formData[field.name], option.alias);toggleChildren(field, option);" value="{{option.alias}}"/><span class="lbl"> {{option.name}}</span></label></div>'}}]),e.directive("msFormMultiselect",["$timeout","entitySvc","app",function(s,n,o){return{link:function(e,t,a){return p(e,t,0,s,n,o)},template:'<select multiple ng-multiple="true" class="form-control" ng-model= "formData[field.name]"  ng-options="option.value as option.name for option in field.settings.options" ></select>'}}]),e.directive("msFormSelect",["$timeout","entitySvc","$http","$stateParams","$compile","$templateCache","app",function(s,d,l,n,c,m,u){return{link:function(o,e,t){function i(e){o.field.settings.options=[],angular.forEach(e.data,function(e){o.field.settings.options.push(e)})}var r=d.getEntity("ms.extend_field"),a=Math.floor(1e5*Math.random());return o.submitForm=function(e){var t=document.getElementById(a+"_form");angular.element(t).triggerHandler("submit")},o.field.settings&&o.field.settings.readonly&&(o.field.settings.disabled=!0,e.find("select").attr("disabled",!0)),r.struct().then(function(e){var a,t,s,n={fields:(o.entityStruct=e).fields,submit:function(t){o.id?r.update(o.id,{data:t}).then(function(e){$("#fieldModal").modal("hide"),i(t)}):r.create({data:t}).then(function(e){$("#fieldModal").modal("hide"),i(t)})},adminForm:"true",id:void 0+"_form",enableBootstrap3:!0,data:{}};o.style={},-1==Object.keys(o.field.settings).indexOf("disabled")&&(o.field.settings.disabled=!0),o.type1="options"==o.field.settings.source&&o.field.settings.edit_options&&"1"==o.field.settings.edit_options,o.type1&&(o.style["margin-right"]="50px"),o.extendField=function(){l.get("/extend").success(function(e){function a(){n.data.field_name=o.field.name,n.data.data=[],angular.forEach(o.field.settings.options,function(e){n.data.data.push(e)}),$("#fieldModal").remove(),l.get("/templates/widgets/fieldModal.html",{cache:m}).success(function(e){$(document.body).append(c(e)(o)),$("#fieldModal").modal("show"),o.formOptions=n})}0==e.records.length&&a(),angular.forEach(e.records,function(t){o.field.name==t.field_name?(n.data=t,o.id=n.data._id,n.data.field_name=o.field.name,$("#fieldModal").remove(),l.get("/templates/widgets/fieldModal.html",{cache:m}).success(function(e){$(document.body).append(c(e)(o)),$("#fieldModal").modal("show"),o.result=t,o.formOptions=n})):o.field.name!=t.field_name&&a()})})},"1"==o.field.settings.add_new_option&&(t=d.getEntity(o.field.settings.source_entity.entity),s=Math.floor(1e5*Math.random()),t.struct().then(function(e){o.entityStruct=e,a={fields:e.fields,submit:function(n){console.log("******Submit called*****",n);t.create({data:n}).then(function(e){console.log("After Create ",e,typeof e,n),$("#addRecordModal").modal("hide"),n._id=e._id;var e=n,t=o.field.settings.source_entity,a=t.key_column||"_id";if(a in e){var s="";if(t.value_formatter&&"string"==typeof t.value_formatter&&t.value_formatter.trim())s=mystore.utils.parseFunction(t.value_formatter).call(null,e);else{t=t.value_column||"name";if(!(t in e))return;s=e[t]}o.field.settings.options.pop(),o.field.settings.options.push({name:s,value:e[a]}),o.field.settings.options.push({name:"Add New",value:"add_new"})}})},adminForm:"true",id:s+"_form",enableBootstrap3:!0,data:{}}}),o.$watch("formData[field.name]",function(e,t){console.log(e),console.log(t),e&&"add_new"==e&&l.get("/templates/widgets/addRecordModal.html",{cache:m}).success(function(e){o.formOptions=a,$(document.body).append(c(e)(o)),$("#addRecordModal").modal("show")})}))}),p(o,e,0,s,d,u,l,n)},template:'<div ng-style=style><select ng-model= "formData[field.name]" class="form-control" ng-options="option.value as option.name for option in field.settings.options" ><option selected="selected" value="" >Select</option></select></div><a ng-if="type1" class="btn btn-default btn-sm pull-right" style="margin-top: -33px;" ng-click="extendField()"><i class="fa fa-edit bigger-130"></i></a>'}}]),e.directive("msFormIframe",["$timeout","app","$http","$stateParams","$compile","$templateCache","$q","$location",function(e,r,a,d,t,s,n,o){return{link:function(n,e,t){var o=n.field.name,i=(n.formData[o],"");n.common_mailer=function(){r.call("commonMailer",{entity:"ms.mail_notifications"},function(e,t){if(e)throw e;window.open("/admin/entity/ms.mail_notifications/"+t.data._id+"/_edit","_blank")})},"global_notifications"==d.entity||"ms.notifications"==d.entity?a.get("/entity/"+d.entity+"/"+d.entityid).success(function(e,t,a){var s="";(i=e.email[o])&&(s=new RegExp("{{>").test(i)),n.commonMailerExists=!1,s&&(n.commonMailerExists=!0),n.formData[o]=i,r.call("generateMailerPreview",{entity:d.entity,data:{template:n.formData[o],name:e.name,sample_data:n.formData.sample_data}},function(e,t){e?alert("Error occurred in generating review"):document.getElementById("iframe").srcdoc=t.data});n.getPreview=function(){r.call("generateMailerPreview",{entity:d.entity,data:{template:n.formData[o],name:e.name}},function(e,t){e?alert("Error occurred in generating preview"):document.getElementById("iframe").srcdoc=t.data})}}):a.get("/entity/"+d.entity+"/"+n.formData._id).success(function(e,t,a){var s="";(i=e[o])&&(s=new RegExp("{{>").test(i)),n.commonMailerExists=!1,s&&(n.commonMailerExists=!0),n.formData[o]=i,r.call("generateMailerPreview",{entity:d.entity,data:{template:n.formData[o],name:e.name,sample_data:n.formData.sample_data}},function(e,t){e?alert("Error occurred in generating review"):document.getElementById("iframe").srcdoc=t.data});n.getPreview=function(){r.call("generateMailerPreview",{entity:d.entity,data:{template:n.formData[o],name:e.name}},function(e,t){e?alert("Error occurred in generating preview"):document.getElementById("iframe").srcdoc=t.data})}})},template:'<div id="content"><ul id="tabs" class="nav nav-tabs" data-tabs="tabs"><li class="active" ng-click="getPreview()" ><a href="#preview" data-toggle="tab">Preview</a></li><li ><a href="#edit" data-toggle="tab">Edit</a></li><li class="pull-right btn btn-xs btn-info" ng-if="commonMailerExists" ng-click="common_mailer()">Common Mailer&nbsp;&nbsp; <i class="icon icon-info" title="contains html for common mailer"></i></li></ul><div id="my-tab-content" class="tab-content"><div class="tab-pane " id="edit"><textarea ng-model="formData[field.name]" codemirror ui-codemirror="field.settings"></textarea></div><div class="tab-pane active" id="preview"><iframe srcdoc="" id="iframe" scrolling="yes" height="670" width ="670"></iframe></div></div></div></div>'}}]),e.directive("msFormIframe2",["$timeout","app","$http","$stateParams","$compile","$templateCache","$q",function(e,o,t,a,s,n,i){return{link:function(e,t,a){var s=$scope.settings.template,n=$scope.settings.data;o.call("resolveHandleBarData",{entity:"ms.mail_notifications",data:{template:s,data:n}},function(e,t){document.getElementById("iframe").srcdoc=t})},template:'<iframe srcdoc="" id="iframe" scrolling="yes" height="700" width ="700"></iframe>'}}]),e.directive("msFormAutocomplete",["$timeout","app","$http","$stateParams","$compile","$templateCache","$q",function(e,d,t,a,s,n,o){return{link:function(a,e,t){if(!a.field||!a.field.settings)return console.log("Field Settings not properly set, so returning");var s,n;if(a.field.settings.source_entity?a.field.settings.entity&&(n=a.field.settings.entity,o=a.field.settings.value_field,s=a.field.settings.label_field):(i=a.field.settings.source_entity,n=i.entity,o=i.value_column,s=i.key_column),!n||!s)return console.log("Field Settings not properly set, so returning");var o=o||"_id",i=e.find("input"),r=(a.bindEvents&&a.bindEvents(i),a.data={searchText:"",label:"",records:[]},Math.floor(1e5*Math.random()));!a.formData[a.field.name]&&a.field.settings.default&&(a.formData[a.field.name]=a.field.settings.default),a.formData[a.field.name]&&((e={entity:n,id:r,cancel:!0,query:{filters:[{field:o,value:a.formData[a.field.name]}],limit:10}}).query.filters=JSON.stringify(e.query.filters),d.list(e,function(e,t){e?console.log("Error occured"):t&&t.data&&t.data.records&&t.data.records.length&&(e=t.data.records[0],(t={}).label=e[s],t.value=e[o],a.data.label=t.label)})),a.close=function(){a.formData[a.field.name]="",a.data.label=""},a.selectValue=function(e){a.formData[a.field.name]=e.value,a.data.label=e.label},a.search=function(e){var t;console.log("searchText press called 2",a.data.searchText),a.data.searchText&&((t={entity:n,id:r,cancel:!0,query:{filters:[{field:s,value:{$regex:".*"+a.data.searchText+".*",$options:"i"}}],limit:10}}).query.filters=JSON.stringify(t.query.filters),a.data.records=[],d.list(t,function(e,t){e?console.log("Error occured"):t&&t.data&&t.data.records&&t.data.records.forEach(function(e){var t={};e[s]&&(t.label=e[s],t.value=e[o]),a.data.records.push(t)})}))}},template:'<div class="row"><div class="col-lg-12" ng-show="!formData[field.name]"><div style="position: relative;"><input type="text"  class="form-control" placeholder="Type text" ng-model="data.searchText" ng-keyup ="search($event)"/> <ul ng-if="data.records.length" class="well" style="margin-left:0px !important;list-style: none;" ><li ng-repeat="record in data.records"><a href="" ng-click="selectValue(record)">{{record.label}}</a></li></ul></div></div><div class="col-lg-12" ng-show="formData[field.name]"><input type="text"  class="form-control" placeholder="Type text" ng-model="data.label" readonly/> <i style="opacity: .5;position: absolute;right: 12px;top: 0px;font-size: 15px;padding: 8px 12px;" class="close fa fa-close" ng-click="close()"></i> <br/></div></div> </div>'}}]),e.directive("msFormCaptcha",function(){return{link:function(e,t,a){console.log("Captcha type called")},template:'<img src="/store/captcha.jpg" /> <br/> <br/> <input type="text" class="form-control" ng-model="formData[field.name]"  placeholder="{{field.settings.placeholder}}"/>'}}),e.directive("msFormChilduser",["app","$timeout",function(o,e){return{link:function(a,e,t){console.log("radia button two called 66");var s=a.field,n=(a.formData[s.name]||(a.formData[s.name]={}),a.formData[s.name]);a.subformOptions={fields:s.fields,data:a.formData[s.name],enableBootstrap3:!0},a.change=function(){console.log("change called 13"),"two"==a.data.user_type||"existing_user"==a.data.user_type?($("#link_user").find("input").attr("disabled","true"),$("#link_user").find("select").attr("disabled","true"),$("#link_user").find(".user_type").attr("disabled",!1)):($("#link_user").find("input").attr("disabled",!1),$("#link_user").find("select").attr("disabled",!1),$("#link_user").find(".user_type").attr("disabled",!1),a.close())},a.data={user_type:"new_user",key:"",username:"",users:[]},a.userChange=function(){for(var e in a.formData.user)delete a.formData.user[e]},a.close=function(){for(var e in delete a.formData._id,a.data.username="",n)delete n[e]},a.selectUser=function(e){for(var t in a.formData._id=e._id,e)n[t]=e[t];a.data.username=e.username},a.search=function(e){a.data.key&&(13!=(e.keyCode||e.which)&&e.type,console.log("Search called",a.key),e={entity:"ms.users",id:"seller_user_list",cancel:!0,query:{search:a.data.key}},a.data.users=[],o.list(e,function(e,t){e?console.log("Error occured"):t&&t.data&&t.data.records&&t.data.records.forEach(function(e){e.username=e.email,e.first_name&&(e.username=e.first_name,e.last_name&&(e.username=e.username+" "+e.last_name)),e&&e.entities&&e.entities.sellers||a.data.users.push(e)})}))}},template:'<div class="row"><div class="col-lg-12"><div class="col-sm-12" id="link_user"><div class="mform-object-box"><div class="row"><div > <label class="control-label col-sm-2" > User Type</label></div> <div class="col-sm-10"><div class="inline"><label><input type="radio" class="user_type" ng-model="data.user_type" value="new_user" ng-change="change()"/><span class="lbl">New User</span></label></div><div class="inline"><label><input type="radio" class="user_type" ng-model="data.user_type" value="existing_user" ng-change="change()"/><span class="lbl">Existing User</span></label></div><div ng-if="data.user_type == \'existing_user\' "><div ng-show="data.username"><input type="text" class="form-control" placeholder="User Name" ng-model="data.username" readonly/><i style="opacity: .5;position: absolute;right: 12px;top: 27px;font-size: 15px;padding: 8px 12px;" class = "close fa fa-close" ng-click="close()" ></i><br/></div><div ng-show="!data.username"><input type="text" class="form-control" placeholder="user Name" ng-model="data.key" ng-keyup = "search($event)" /><ul ng-if="data.users.length" class="well" style="margin-left:0px !important;list-style: none;"><li ng-repeat="user in data.users"><a href="" ng-click="selectUser(user)">{{user.username}}</a></li></ul></div></div></div> </div> <br/><form ms-form="subformOptions"></form><div class="clearfix"></div></div></div></div>'}}]),e.directive("msFormLinkuser",["app",function(s){return{link:function(a,e,t){a.data={key:"",username:"",users:[]},a.userChange=function(){for(var e in a.formData.user)delete a.formData.user[e]},a.close=function(){a.formData._id="",a.data.username=""},a.selectUser=function(e){for(var t in a.formData._id=e._id,a.data.username=e.username,e)a.formData.user[t]=e[t]},a.search=function(e){!a.data.key||13!=(e.keyCode||e.which)&&"click"!=e.type||(console.log("Search called",a.key),e={entity:"ms.users",query:{search:a.data.key}},a.data.users=[],s.list(e,function(e,t){e?console.log("Error occured"):t&&t.data&&t.data.records&&t.data.records.forEach(function(e){e.username=e.email,e.first_name&&(e.username=e.first_name,e.last_name&&(e.username=e.username+" "+e.last_name)),a.data.users.push(e)})}))}},template:'<div class="row"> <div class="col-lg-12"><label><input type = "checkbox" ng-model="formData[field.name]" ng-change="userChange()" ng-true-value="1" ng-false-value="0"/><span class="lbl"> </span></label></div></div><div class="row" ng-if="formData[field.name] == \'1\' "><div class="col-lg-12" ng-show="!formData._id"><input type="text"  class="form-control"   placeholder="user Name" ng-model="data.key"  ng-keypress="search($event)"/> <ul ng-if="data.users.length" class="well" style="margin-left:0px !important;list-style: none;" ><li ng-repeat="user in data.users"><a href="" ng-click="selectUser(user)">{{user.username}}</a></li></ul></div><div class="col-lg-12" ng-show="formData._id"><input type="text"  class="form-control"   placeholder="Product Name" ng-model="data.username" readonly/> <i style="opacity: .5;position: absolute;right: 12px;top: 0px;font-size: 15px;padding: 8px 12px;" class="close fa fa-close" ng-click="close()"></i> <br/></div></div> </div>'}}]),e.directive("msFormLinkproducts",["$timeout","entitySvc","$http","$stateParams","$compile","$templateCache","$q",function(o,e,i,t,a,s,r){return{link:function(n,e,t){n.field;var a=!0,s=(n.blur=!1,"");n.selected_options={},n.$watch("product_id1",function(e,t){a?(console.log("i am here",n.formData.product_id),n.formData.product_id&&i.get("/entity/ms.products/"+n.formData.product_id).success(function(e,t,a){n.product=e,n.formData.productName=e.name,n.product&&n.product.images&&n.product.images.length&&n.product.images[0]&&(n.ProductImage=n.product.images[0]),n.formData.variant_id&&n.product.variants&&n.product.variants.length&&n.product.variants.forEach(function(e){e.variant_id==n.formData.variant_id&&e.options&&e.options.length&&e.options.forEach(function(e){n.selected_options[e.name]=e.value})})}),o(function(){a=!1})):(s&&s.resolve(),s=r.defer(),i.get("/entity/ms.products",{params:{limit:100,q:{publish:"1",name:n.product_id1}},timeout:s.promise,headers:{"linked-product-request":1}}).success(function(e,t,a){e&&e.records?n.products=e.records:n.products=[]}).error(function(e,t,a){console.log("Linked request error >>>>>>>>>>>",e,t,a)}))}),n.setVariantId=function(){console.log("setVariantId called");var t,a,e=null,s=n.product;s.options&&s.options.length&&(t=[],s.options.forEach(function(e){e.name&&t.push(e.name)}),t.sort(),a=[],t.forEach(function(e){var t="#";n.selected_options&&e&&n.selected_options[e]&&(t=n.selected_options[e]),a.push(t)}),e=a.join("|")),n.formData.variant_id=e,console.log("setVariantId called",e,s,n.formData)};n.close=function(){n.product=null,n.formData.product_id=null,n.formData.productName=null},n.selectProduct=function(e,t){n.product=e,n.blur=!1,n.formData.productName=e.name,n.formData.product_id=e._id,n.formData.variant_id=null,n.selected_options={},n.product.options&&n.product.options.length&&n.product.options.forEach(function(e){e.name&&e.values&&e.values.length&&(e.default?n.selected_options[e.name]=e.default:n.selected_options[e.name]=e.values[0])}),n.setVariantId(),n.product&&n.product.images&&n.product.images.length&&n.product.images[0]&&(n.ProductImage=n.product.images[0])}},template:'<div class="row"><div class="col-lg-12"><div ng-show="formData.productName"> <input type="text"  class="form-control"   placeholder="Product Name" ng-model="formData.productName" readonly/> <i style="opacity: .5;position: absolute;right: 12px;top: 0px;font-size: 15px;padding: 8px 12px;" class="close fa fa-close" ng-click="close()"></i> <br/><div ng-if="ProductImage"> <img src="{{ProductImage.image | image :\'100x100\'}}"/></div></div><div ng-show="!formData.productName"><input type="text" class="form-control" ng-model="product_id1" placeholder="Search Product" ><ul ng-if="products.length" class="well" style="margin-left:0px !important;list-style: none;" ><li ng-repeat="data in products"><a href="" ng-click="selectProduct(data)">{{data.name}} ({{data.sku}})</a></li></ul></div>  </div> </div><br/><br/><div class="row" ng-show="product.options && product.options.length"><div class="col-lg-12"><label> <strong>Specify Options </strong></label></div><br/><div class="col-lg-12"><form class="form-horizontal"><div  class=""  ng-repeat="option in product.options"><div ><label class="control-label col-sm-2"> {{option.name}} </label></div>  <div class="col-sm-10" style="margin-bottom: 20px;">  <select ng-model="selected_options[option.name]" class="form-control" ng-change="setVariantId()" ng-options="value as value for value in option.values" data-placeholder="Product variant">  </select>   </div></div> </form></div></div>'}}]),e.directive("msFormFeature",["$timeout",function(s){return{link:function(o,e,t){var a=o.field;o.formData[a.name]||(o.formData[a.name]=[]),o.data=o.formData[a.name],o.featureName="",o.addFeature=function(e){-1<o.data.indexOf(o.featureName)?console.log("Already exist : ",o.featureName):o.featureName&&o.data.push(o.featureName),o.featureName=""},o.remove=function(e){o.data.splice(e,1)},s(function(){var s=null,n=-1;o.$watch("$scope.data",function(e,t){o.data&&(s=o.data)},!0),$(".features").sortable({items:".tag",start:function(e,t){n=$(t.item).index()},stop:function(e,t){var t=$(t.item).index(),a=s[n];s.splice(n,1),s.splice(t,0,a),o.data=s,o.$apply()},axis:"y"})},1e3)},template:'<div class=""><div class="tags" style="width:100%"><div class="features"><div class="tag" style="white-space: normal;display: block;background-color:#eee;color: #555" ng-repeat="(index, feature) in data"> {{feature}}<button style="color:#666;" type="button" class="close" ng-click="remove(index)">×</button></div></div><form ng-submit="addFeature()"><input type="text" style="height: 24px;"placeholder="Enter feature, Please press Enter ... " ng-model="featureName" ></form></div></div>'}}]);e.directive("msFormReference",["$timeout","entitySvc",function(e,o){return{link:function(e,t,a){var s,i,r,n,d,l;s=o,i=e.field,r=i.settings.options?i.settings.options.slice(0):[],n=i.settings.reference_entity,d=i.settings.reference_key_column,l=i.settings.reference_value_column,s.getEntity(n).list().then(function(e){console.log(e);var t,a=e.records;for(t in a){var s,n=a[t],o=d||"_id";o in n&&((s=l||"name")in n&&r.push({name:n[s],value:n[o]}))}i.settings.options=r},function(e){console.log("ERROR: Could not get data for source entity ["+n.entity+"]")})},template:'<select ng-model= "formData[field.name]" class="form-control" ng-options="option.value as option.name for option in field.settings.options" ><option value="" disabled></option></select>'}}]),e.directive("msFormPassword",function(){return{link:function(e,t,a){},template:'<input type = "password" class="form-control" placeholder="Password"ng-model = "formData[field.name]"/>'}}),e.directive("msFormDatetime",function(){return{link:function(e,t,a){},template:'<div class="input-append dipti date" id="datetimepicker" ><input ui-date size="16" ui-date-format type="text" ng-model = "formData[field.name]">\x3c!--<span class="add-on"><i class="icon-th"></i></span>--\x3e</div>'}}),e.directive("msFormEmail",function(){return{link:function(e,t,a){},template:'<input type = "email" class="form-control"  ng-model = "formData[field.name]"/> '}}),e.directive("msFormMulticheckbox",function(){return{link:function(e,t,a){},template:'<div ng-init="initCheckboxes(formData, field.name)" ng-repeat = "option in field.settings.options"><label><input type = "checkbox" ng-checked="formData[field.name].indexOf(option.value) != -1" ng-click="toggleCheckbox(formData[field.name], option.value)" value="{{option.value}}"/><span class="lbl"> {{option.name}}</span></label></div>'}}),e.directive("msFormCheckbox",function(){return{link:function(a,e,t){a.bindEvents&&a.bindEvents(e.find("input"));a.$watch("formData[field.name]",function(e,t){e&&a.formData&&(1==a.formData[a.field.name]||"1"==a.formData[a.field.name]?a.formData[a.field.name]="1":a.formData[a.field.name]="0")})},template:'<label style="padding-top: 5px;"><input type = "checkbox" ng-model="formData[field.name]" ng-true-value="1" ng-false-value="0"/><span class="lbl"> </span></label>'}}),e.directive("msFormRelation",["entitySvc",function(a){return{link:function(n,e,t){var o=n.field,i=o.settings||{};a.getEntity(i.entity).struct().then(function(e){n.gridOptions=function(e){var t=[],a=(angular.forEach(e.fields,function(e){t.push(e)}),{formField:o});a.cols=t,a.reorder=!0,a.showPaging=!0,a.enableSearch=!1,a.ajax=!0,a.limit=5,a.ajaxUrl="/entity/"+i.entity,a.list_columns=e.settings.list_columns,a.selection=!0,a.template='<ng-include src="\'datatable.data.html\'"></ng-include><div ng-show="editable " ng-click="addEmptyrow()" class="btn"> Add Record</div>',n.formData[o.name]||(n.formData[o.name]=[]);{var s;i.joins&&(s=[],angular.forEach(i.joins,function(e){e.local_field&&e.foreign_field?s.push({name:e.foreign_field,value:n.formData[e.local_field]}):console.log("MS-FORM-EXTERNAL: "+n.field.name+": local_field or foreign_field is not specified in the join")}),a.filters=s)}a.data=n.formData[o.name],(n.gridOptions=a).commands=i.commands,a.row_commands=i.row_commands,a.batch_commands=i.batch_commands,a.row_commands&&0!=a.row_commands.length||(a.row_commands=[{name:"delete",title:"delete",icon:"trash"}]);a.batch_commands&&0!=a.batch_commands.length||(a.batch_commands=[{name:"delete",value:"delete"}]);return a}(e)})},template:'<div datatable="gridOptions" class="grid-container"></div>'}}]),e.directive("msFormAsset",["$filter","$http",function(e,o){return{compile:function(e,t){return{pre:function(e,t,a){var s=e.field,n=e.formData,e=n[s.name],e=ms_store.assetUrl+"/"+e;s.settings.lineNumbers=!0,s.settings.height=500,o.get(e,{params:{_:Math.random()}}).success(function(e){n._metadata[s.name].data=e})}}},template:' <textarea style="border:1px solid #f7f7f7;" ms-widget="ms.addon.codemirror" ms-data-config="field.settings" ng-model="formData[\'_metadata\'][field.name][\'data\']"></textarea>'}}]),e.directive("msFormStates",["$filter","$http","$rootScope",function(e,t,d){return{link:function(a,e,t){var s=a.field,n=a.formData,o={},i=s.settings.base_column;function r(e){d.ms.getLocation(e,function(e,t){e?console.log("Something went wrong"):(e=[],t&&t.states&&(e=t.states),angular.forEach(e,function(e){o[e.name]=e.value,e.value=e.name}),s.settings.options=e)})}n[s.name]?(n[i]&&r(n[i]),a.$watch("formData."+i,function(e,t){e!=t&&r(e)},!0)):((n=angular.element(".mf-"+i).scope()).formData[i]&&r(n.formData[i]),n.$watch("formData."+i,function(e,t){e!=t&&r(e)},!0)),s.settings&&s.settings.code_column&&a.$watch("formData."+s.name,function(e,t){e!=t&&(console.log("$scope.formData",a.formData),a.formData[s.settings.code_column]=o[e])},!0)},template:'<select ng-model= "formData[field.name]" class="form-control" ng-options="option.value as option.name for option in field.settings.options" ><option selected="selected" value="" disabled>Select</option></select>'}}]),e.directive("msFormState",["$filter","$http","$rootScope",function(e,t,d){return{link:function(a,e,t){var s=a.field,n=a.formData,o={},i=s.settings.base_column;function r(e){d.ms.getLocation(e,function(e,t){e?console.log("Something went wrong"):(e=[],t&&t.states&&(e=t.states),angular.forEach(e,function(e){o[e.name]=e.value,e.value=e.name}),s.settings.options=e)})}n[s.name]?(n[i]&&r(n[i]),a.$watch("formData."+i,function(e,t){e!=t&&r(e)},!0)):((n=angular.element(".mf-"+i).scope()).formData[i]&&r(n.formData[i]),n.$watch("formData."+i,function(e,t){e!=t&&r(e)},!0)),s.settings&&s.settings.code_column&&a.$watch("formData."+s.name,function(e,t){e!=t&&(console.log("$scope.formData",a.formData),a.formData[s.settings.code_column]=o[e])},!0)},template:'<select ng-model= "formData[field.name]" class="form-control" ng-options="option.value as option.name for option in field.settings.options" ><option selected="selected" value="" disabled>Select</option></select>'}}]),e.directive("msFormCountry",["$filter","$http","$rootScope",function(e,t,i){return{link:function(a,e,t){var s=a.field,n=a.formData,o={},n=(console.log("==========formField============",s),console.log("==========formData============",n),s.name);s.settings&&(s.settings.code_column||s.settings.state_column)&&a.$watch("formData."+n,function(e,t){e!=t&&(console.log("$scope.formData",a.formData),s.settings.code_column&&(a.formData[s.settings.code_column]=o[e]),s.settings.state_column&&delete a.formData[s.settings.state_column])},!0),i.ms.getLocations(function(e,t){var a;e?console.log("Something went wrong"):(a=[],t.forEach(function(e){e&&e.states&&e.states.length&&a.push(e)}),angular.forEach(a,function(e){e.value=e.country,e.name=e.country,o[e.country]=e.code}),s.settings.options=a)})},template:'<select ng-model= "formData[field.name]" class="form-control" ng-options="option.value as option.name for option in field.settings.options" ><option selected="selected" value="" disabled>Select</option></select>'}}]),e.directive("msFormFileOld",function(){return{link:function(n,o,e){var i=n.field,r=n.formOptions.data;function d(){var e,t,a,s;r[i.name]&&(e=r._metadata[i.name],n.preview=!0,n.$$phase||n.$root.$$phase||n.$apply(),o.find("span").attr("data-title",e.name),$(o.find("a")).show(),e.type&&0==e.type.indexOf("image")&&((s=e.data)||(t=(a=r[i.name]).substring(0,a.lastIndexOf(".")),a=a.substring(a.lastIndexOf(".")),s=e.type&&-1<e.type.indexOf("ico")?ms_store.baseUrl+"/"+t+"-o"+a:ms_store.baseUrl+"/"+t+"-240x240"+a),o.find(".ms-form-file-preview").attr("src",s),$(o.find("img")).show()))}o.find("input").bind("change",function(e){var t=i.name;if(this.files&&this.files.length){var a,s=this.files[0];if(i.settings.file_types&&-1==i.settings.file_types.indexOf(s.type))alert("Invalid File type !");else return r[t]=s.name,r._metadata||(r._metadata={}),n.preview=!1,a=new FileReader,a.onload=function(e){r._metadata[t]={data:e.target.result,name:s.name,size:s.size,type:s.type},d()},a.readAsDataURL(s),!0}}),o.find("a").bind("click",function(){var e=n.formOptions.data,t=i.name;e._metadata[t]={},e[t]="",n.preview=!1,n.$$phase||n.$apply();return angular.element(document.getElementById(t+"_preview")).removeAttr("src"),o.find("input").val(""),o.find("span").attr("data-title",""),$(o.find("a")).hide(),!1}),n.uniqueId=Math.random(),o.bind("click",function(e){e.stopPropagation()}),d()},template:'<div class="ace-file-input"><input type="file" id="{{uniqueId}}" data-name="{{field.name}}"> <label class="file-label" data-title="Choose" for="{{uniqueId}}">  <span class="file-name" data-title="No File ..."><i class="ace-icon fa fa-upload-alt"></i></span></label><a class="remove"  ng-show="preview" ><i class="fa fa-trash"></i></a></div><div><img ng-show="preview" src="" width="200" class="ms-form-file-preview"/></div></div>'}}),e.directive("msFormFile",["$rootScope","$upload","$http",function(g,e,f){return{link:function(l,n,e){var o=l.field,c=l.formOptions.data,m=!0;function u(){var e,t,a,s;c&&c[o.name]&&(l.src="","string"==typeof c[o.name]&&c[o.name]&&c._metadata?c._metadata&&c._metadata[o.name]&&(s=c._metadata[o.name],l.filename=s.name,s.type&&0==s.type.indexOf("image")&&(t=(e=c[o.name]).substring(0,e.lastIndexOf(".")),a=e.substring(e.lastIndexOf(".")),l.src=ms_store.baseUrl+"/"+t+"-240x240"+a,l.src1=ms_store.baseUrl+"/"+t+"-o"+a,m||(l.src=ms_store.baseUrl+"/"+t+a),s.type&&-1<s.type.indexOf("ico")&&(l.src=ms_store.baseUrl+"/"+t+"-o"+a))):"object"==typeof c[o.name]&&c[o.name].path&&c[o.name].type&&0==c[o.name].type.indexOf("image")&&(t=(e=c[o.name].path).substring(0,e.lastIndexOf(".")),a=e.substring(e.lastIndexOf(".")),s=ms_store.baseUrl.split("/"),l.src="//"+s[2]+"/"+t+"-240x240"+a,l.src1="//"+s[2]+"/"+t+"-o"+a,m||(l.src="//"+s[2]+"/"+t+a),l.filename=c[o.name].name),l.src&&(l.preview=!0,$(n.find("a")).show(),l.$$phase||l.$root.$$phase||l.$apply()))}function p(){c._metadata&&c._metadata[o.name]&&(c._metadata[o.name]={}),c[o.name]="",l.filename="No File ...",l.preview=!1,l.src="",n.find("input").val(""),l.$$phase||l.$root.$$phase||l.$apply()}l.readonly=!1,o.settings&&"1"==o.settings.disable_versioning&&(m=!1),o.settings&&o.settings.readonly&&(l.readonly=!0),n.find("input").bind("change",function(i){var r=o.name;if(this.files&&this.files.length){var e=this.files[0];if(o.settings.file_types)if(!new RegExp("([a-zA-Z0-9s_\\.-:])+("+o.settings.file_types.join("|")+")$").test(e.name.toLowerCase()))return alert("Please upload files having extensions: "+o.settings.file_types.join(", ")+" only."),!1;l.filename=e.name,l.uploading=!0,l.processing=!1,g.spinnerHide=!0,l.preview=!1,l.setUploadingImage(!0);var d={name:e.name,type:e.type,size:e.size,uploadType:"tmp",versioning:m};return function(n){var o=new XMLHttpRequest;o.open("GET","/sign-s3?file-name="+n.name+"&file-type="+n.type),o.onreadystatechange=function(){var e,t,a,s;4===o.readyState&&(200===o.status?(e=JSON.parse(o.responseText),l.uploading=!1,l.processing=!0,$("#uploadModal").modal({backdrop:"static",show:!0}),n._id=e.imageId,t=n,a=e.signedRequest,s=e.url,g.$apply(function(){var e=new XMLHttpRequest;f.pendingRequests.push(e),e.open("PUT",a),e.setRequestHeader("content-type",t.type),e.setRequestHeader("expires",new Date((new Date).getTime()+3156192e5).toGMTString()),e.setRequestHeader("cache-control","max-age=315619200000,public"),e.upload.onprogress=function(e){e.lengthComputable&&l.$apply(function(){l.percent=parseInt(100*e.loaded/e.total),l.percentage=parseInt(100*e.loaded/e.total),console.log("----4-----",l.percentage,l.percent),l.uploading=!1,l.processing=!0,$("#uploadModal").modal({backdrop:"static",show:!0})})},e.onreadystatechange=function(){f.pendingRequests.splice(0),4===e.readyState&&200===e.status&&(200===e.status?(d.path=s.replace("https://mystore.in.s3.amazonaws.com/",""),l.previewUrl=i.target.result,l.processing=!1,g.spinnerHide=!1,l.setUploadingImage(!1),c[r]=d,c[r]._id=t._id,c[r].uploadType="tmp",$("#uploadModal").modal({backdrop:"static",show:!1}),u(),l.uploading=!1,l.$$phase||l.$apply()):(console.log("Error occured in file uploading",d),l.processing=!1,l.uploading=!1,$element.val="",g.spinnerHide=!1,$("#uploadModal").modal({backdrop:"static",show:!1}),l.setUploadingImage(!1),p()))},e.send(t)})):(console.log("Error occured in file uploading2",d),l.processing=!1,l.uploading=!1,g.spinnerHide=!1,$("#uploadModal").modal({backdrop:"static",show:!1}),l.setUploadingImage(!1),p()))},o.send()}(e),l.abort=function(){l.upload.abort()},!0}}),n.find("a").bind("click",p),l.uniqueId=Math.random(),n.bind("click",function(e){e.stopPropagation()}),l.filename="No File ...",u()},template:'<div class="ace-file-input"><input type="file" id="{{uniqueId}}" data-name="{{field.name}}"  multiple /><label class="ace-file-container" data-title="Choose" for="{{uniqueId}}"><span class="ace-file-name" data-title="{{filename}}"><i class="ace-icon fa fa-upload"></i></span> </label><div ng-if="uploading || processing"><div id="uploadModal" class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog"><div class="modal-content" style="border:none!important"><div class="modal-body loading"></div></div></div></div></div></div><a ng-show="preview && !readonly" class="remove" href="javascript:void(0)"><i class="fa fa-remove"></i></a> </div><div ng-if="uploading"><progress min="0" max="100" value="{{percentage}}"></progress> Uploading ...</div><br/><div ng-show="processing" class="col-sm-6"><div class="progress"><div class="progress-bar progress-bar-striped active pull-left" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="50" style="width: 100%"></div><a href="javascript:void(0)" class="badge badge-danger pull-right" ng-click="abort()"><i class="fa fa-remove bigger-120"></i></a></div></div><div> <img ng-if="preview" src="{{src}}" width="200" class="ms-form-file-preview"/></div> '}}]),e.directive("msFormCustomfile",["$filter","$http","$stateParams",function(e,t,n){return{compile:function(e,t){return{pre:function(a,e,t){console.log(a.field);a.field;var s=a.formOptions.data;a.file_data="",s.file||(s.file={}),s._metadata||(s._metadata={file:{}}),s.file="custom.css",s._metadata.file.name="custom.css",s._metadata.file.type="","less_variant"==n.field&&(s.file="variant.less",s._metadata.file.name="variant.less"),a.$watch("file_data",function(e,t){e!=t&&(s._metadata.file.data=a.file_data,s._metadata.file.size=a.file_data.length)})}}},template:'<div class="control-group"><div class="controls"><textarea style="border:1px solid #000000;" codemirror ui-codemirror="field.settings" ng-model="file_data" id="content"></textarea></div> </div>'}}]),e.directive("msFormCreatefile",["$filter","$http",function(e,t){return{compile:function(e,t){return{pre:function(a,e,t){$("label[for='create_file']").text("");a.field;var s=a.formOptions.data;a.content="",s.file||(s.file={}),s._metadata||(s._metadata={file:{}}),a.$watch("filename",function(e,t){s.file=e,s._metadata.file.name=e,s._metadata.file.type=""}),a.$watch("content",function(e,t){s._metadata.file.data=a.content,s._metadata.file.size=a.content.length})}}},template:'<div ><div class="control-group"> <label class="control-label" for="filename">File Name</label><div class="controls"> <input type="text" ng-model="filename" placeholder="file name" id="filename" class="form-control" style="margin-bottom:10px;"/></div></div>  <div class="control-group"><label class="control-label" for="content">content</label><div class="controls"><textarea style="border:1px solid #000000;" codemirror ui-codemirror="field.settings" ng-model="content" id="content"></textarea></div> </div><div>'}}]),e.directive("msFormCollection",["$http","$compile","$timeout","$templateCache","$filter",function(c,m,u,p,g){return{link:function(a,e,t){var s,n,o,i,r=a.field,d=[];for(s in r.fields){var l=r.fields[s];d.push(l)}a.formData[r.name]||(a.formData[r.name]=[]),a.data=a.formData[r.name],a.edit_template="inline","pop_up"==r.settings.edit_template?($("#collectionRecordModal").remove(),a.edit_template="pop_up",a.btnText="add",angular.forEach(d,function(e){var t;e.settings.label||(t=(t=(t=e.name).replace("_"," ")).substring(0,1).toUpperCase()+t.substring(1),e.settings.label=t)}),a.cols=d,a.template=null,n=function(){$("#collectionRecordModal").remove(),c.get("/templates/widgets/addEditCollectionModal.html",{cache:p}).success(function(e){a.template=e,$(document.body).append(m(e)(a)),$("#collectionRecordModal").modal("show")})},a.submitForm=function(){$("#collection_form").trigger("submit")},a.addCollectionData=function(e){"add"==a.btnText?a.data.push(e):a.data.splice(a.index,1,e),$("#collectionRecordModal").modal("hide"),u(function(){$("#collectionRecordModal").remove()},300)},a.addRecord=function(){a.btnText="add";var e="collection_form"+Math.floor(1e5*Math.random());a.collectionFormOptions={fields:r.fields,submit:a.addCollectionData,id:e,template:"/templates/widgets/mform.default.bootstrap3.html",data:{}},n()},a.editRecord=function(e){a.btnText="edit",a.index=e;var t="collection_form"+Math.floor(1e5*Math.random());a.collectionFormOptions={fields:r.fields,submit:a.addCollectionData,id:t,template:"/templates/widgets/mform.default.bootstrap3.html",data:{}},angular.copy(a.data[e],a.collectionFormOptions.data),n()},a.deleteRecord=function(e){var t=g("msT")("Are you sure to delete ?");confirm(t)&&a.data.splice(e,1)},a.sortableOptions={disabled:!1,placeholder:"tr",helper:function(e,t){return t.children().each(function(){$(this).width($(this).width())}),t},connectWith:"tbody",handle:"td.dt-reorder-row",axis:"y"}):(o=r.settings||{},(i={formField:r}).struct=r,i.cols=d,i.reorder=!0,i.showPaging=!1,i.enableSearch=!1,i.list_columns=o.list_columns,i.selection=!0,i.template='<ng-include src="\'datatable.data.html\'"></ng-include><div ng-show="editable && !addFormShown"  ng-click="showAddForm()" class="btn"> Add Record</div><div ng-show="addFormShown"><div class="ms-add-form datatable_inline_edit"></div></div> ',i.data=a.formData[r.name],i.inline_editable=!0,i.always_editable=!!o.always_editable,(a.gridOptions=i).commands=o.commands,i.showAddForm=!0,i.commands=o.commands,i.commands&&0!=i.commands.length||(i.commands=[{name:"delete",title:"Delete",handler:function(e){var t=g("msT")("Are you sure to delete ?");return 1==confirm(t)&&(e.rows?e.scope.deleteRows(e.rows):e.scope.deleteRow(e.row_id)),!1},btn_logo:"fa-trash",icon:"trash",btn_class:"danger",level:["row","batch"]}]),i.commands=i.commands.concat([{name:"delete",title:"Delete",icon:"trash",level:["row","batch"],type:"handler",handler:function(e){var t=g("msT")("Are you sure to delete ?");return 1==confirm(t)&&(e.rows?e.scope.deleteRows(e.rows):e.scope.deleteRow(e.row_id)),!1}}]),i.commands=mystore.utils.removeDuplicateObjects(i.commands,i.commands,"name"))},template:'<div ng-if="edit_template == \'inline\' " datatable="gridOptions" class="grid-container"></div><div ng-if="edit_template == \'pop_up\' " ng-include="\'/templates/widgets/mformCollection.html\'"></div>'}}]),e.directive("msFormObject",function(){return{link:function(e,t,a){var s=e.field;e.formData[s.name]||(e.formData[s.name]={}),e.subformOptions={fields:s.fields,data:e.formData[s.name],enableBootstrap3:!0}},template:'<div class="mform-object-box"><form ms-form="subformOptions"></form></div>'}}),e.directive("msFormCodemirror",function(){return{link:function(e,t,a){e.codemirror_id=Math.floor(100*Math.random()+1)},template:'<style type="text/css">.activeline {background: #e8f2ff !important;}span.CodeMirror-matchhighlight { background: #e9e9e9 }.CodeMirror-focused span.CodeMirror-matchhighlight { background: #e7e4ff; !important }</style><div class="widget-box" style="border: 1px solid #eeeeee"><div class="widget-header widget-header-small" style="background-color: #f7f7f7;background-image: none"><div class="btn-group pull-left" style="margin-top: 7px;"><a id="{{codemirror_id}}_codemirror-autoFormat" href=""></i> Autoformat Selected</a><span> | </span><a id="{{codemirror_id}}_codemirror-comment" href=""> Comment Selected</a><span> | </span><a id="{{codemirror_id}}_codemirror-uncomment" href=""> Uncomment Selected</a><span> | </span><a id="{{codemirror_id}}_codemirror-find" href=""> Find</a><span> | </span><a id="{{codemirror_id}}_codemirror-replace" href=""> Replace</a></div><div class="pull-right" style="margin-top: 7px;margin-right: 5px;"><a id="{{codemirror_id}}_codemirror-undo" href=""><i class="fa fa-undo"></i></a><span> | </span><a id="{{codemirror_id}}_codemirror-redo" href=""><i class="fa fa-repeat"></i></a></div></div><div class="widget-body"><div class="widget-main no-padding"><textarea style="border: 0px;resize: none;" id="{{codemirror_id}}" codemirror ui-codemirror="field.settings" ng-model="formData[field.name]"></textarea></div></div></div>'}}),e.directive("msFormFunction",function(){return{link:function(e,t,a){},template:' <textarea style="border:1px solid #f7f7f7; width: 100%;min-height: 300px;" codemirror ui-codemirror="field.settings" ng-model="formData[field.name]"></textarea>'}}),e.directive("msFormHtml",["$compile",function(o){return{link:function(t,e,a){var s=t.field,n=s.settings.html;s.settings.compile?o(n)(t,function(e){t.html=e}):t.html=n},template:'<div ng-bind-html-unsafe="html"></div>'}}]),e.directive("mformlabel",["$stateParams",function(s){return{link:function(a,e,t){a.field;a.$watch("field.label",function(e,t){e!=t&&"edit"!=s.action&&"_edit"!=s.action&&(e=a.field.label||"",a.field.name=mystore.utils.slugify(e))},!0)}}}]),e.directive("malias",[function(){return{link:function(a,e,t){var s,n=a.field;n.settings.base_column&&(s="formData."+n.settings.base_column,a.$watch(s,function(e,t){a.formData[n.name]&&e==t||(e=a.formData[n.settings.base_column]||"",a.formData[n.name]=mystore.utils.slugify(e))},!0))}}}]),e.directive("msFormWidget",["$timeout","$compile",function(e,n){return{link:function(t,e,a){var s;console.log("msform widget called",t.field),t.field&&t.field.settings&&t.field.settings.widget_name?(s='<div ms-widget="'+t.field.settings.widget_name+'"></div>',n(s)(t,function(e){console.log("elem --------",e),t.html=e,console.log("elem 3",e.html(),"ff",$(e).html(),"dd",e[0].innerHTML,"oo",e.contents()),console.log("$scope.template >>>>11>>>>>>>>",t.template)})):t.template='<input type="text" placeholder="widget type" />'},template:'<div ng-bind-html-unsafe="html"></div>'}}]),e.constant("uiCodemirrorConfig",{}).directive("uiCodemirror",["uiCodemirrorConfig","$timeout","$location",function(a,h,_){var v=["cursorActivity","viewportChange","gutterClick","focus","blur","scroll","update"];return{restrict:"A",require:"ngModel",link:function(c,m,u,p){var e,g,f;if("textarea"!==m[0].type)throw new Error("uiCodemirror3 can only be applied to a textarea element");mystore.utils.loadCss("/plugins/codemirror-5.21.0/lib/codemirror.css");var t=[];t.push("codemirror"),t.push("codemirror/addon/comment/continuecomment"),t.push("codemirror/addon/comment/comment"),t.push("codemirror/addon/dialog/dialog"),t.push("codemirror/addon/display/fullscreen"),t.push("codemirror/addon/display/rulers"),t.push("codemirror/addon/display/panel"),t.push("codemirror/addon/display/placeholder"),t.push("codemirror/addon/display/autorefresh"),t.push("codemirror/addon/edit/matchbrackets"),t.push("codemirror/addon/edit/closebrackets"),t.push("codemirror/addon/edit/closetag"),t.push("codemirror/addon/edit/matchtags"),t.push("codemirror/addon/fold/foldcode"),t.push("codemirror/addon/fold/foldgutter"),t.push("codemirror/addon/fold/brace-fold"),t.push("codemirror/addon/fold/xml-fold"),t.push("codemirror/addon/fold/markdown-fold"),t.push("codemirror/addon/fold/indent-fold"),t.push("codemirror/addon/fold/comment-fold"),t.push("codemirror/addon/hint/show-hint"),t.push("codemirror/addon/hint/javascript-hint"),t.push("codemirror/addon/hint/xml-hint"),t.push("codemirror/addon/hint/html-hint"),t.push("codemirror/addon/hint/css-hint"),t.push("codemirror/addon/hint/anyword-hint"),t.push("codemirror/addon/hint/sql-hint"),t.push("codemirror/addon/selection/active-line"),t.push("codemirror/addon/mode/loadmode"),t.push("codemirror/mode/htmlmixed/htmlmixed"),t.push("codemirror/mode/javascript/javascript"),t.push("codemirror/mode/javascript/formatting"),t.push("codemirror/mode/xml/xml"),t.push("codemirror/mode/css/css"),t.push("codemirror/mode/meta"),t.push("codemirror/mode/xml/xml"),t.push("codemirror/mode/markdown/markdown"),t.push("codemirror/mode/markdown/markdown"),t.push("codemirror/addon/search/searchcursor"),t.push("codemirror/addon/search/search"),t.push("codemirror/addon/search/match-highlighter"),t.push("codemirror/addon/search/jump-to-line"),t.push("codemirror/addon/selection/mark-selection"),t.push("codemirror/addon/lint/lint"),require.config({packages:[{name:"codemirror",location:"/plugins/codemirror-5.21.0",main:"lib/codemirror"}]}),require(t,function(l){e=a.codemirror||{},g=angular.extend({},e,c.$eval(u.uiCodemirror)),h(function(){var e;function t(){var e=a.options[a.selectedIndex].textContent;f.setOption("theme",e),location.hash="#"+e,localStorage.setItem("codemirror_theme_select",e)}f=l.fromTextArea(m[0],{lineNumbers:!0,lineWrapping:!0,mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Q":function(e){e.foldCode(e.getCursor())},"Alt-C":"toggleComment","Ctrl-J":"toMatchingTag",F11:function(e){var t,a;-1<_.$$absUrl.indexOf("/admin")&&($(".CodeMirror-fullscreen")&&$(".CodeMirror-fullscreen").length&&$(window).width()&&1280<=$(window).width()&&$(".CodeMirror-fullscreen").removeAttr("style"),e.setOption("fullScreen",!e.getOption("fullScreen")),e.getOption("fullScreen")?($("."+u.id+"codemirror_options").addClass("codemirror_options_fullscreen"),$(window).width()&&1280<=$(window).width()&&(t=$(window).width()-385+11*$(window).width()/100+"px",a=$(window).width()-255+11*$(window).width()/100+"px",$(".CodeMirror-fullscreen").css("left","220px"),$(".CodeMirror-fullscreen").css("width",t),$("."+u.id+"codemirror_options").css("left","242px"),$("."+u.id+"codemirror_options").css("width",a))):e.getOption("fullScreen")||($("."+u.id+"codemirror_options").removeAttr("style"),$("."+u.id+"codemirror_options").removeClass("codemirror_options_fullscreen")))},Esc:function(e){-1<_.$$absUrl.indexOf("/admin")&&(e.getOption("fullScreen")&&e.setOption("fullScreen",!1),e.getOption("fullScreen")||($("."+u.id+"codemirror_options").removeAttr("style"),$("."+u.id+"codemirror_options").removeClass("codemirror_options_fullscreen")))}},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],styleSelectedText:!0,scanUp:!0,highlightSelectionMatches:{showToken:/\w/,annotateScrollbar:!0},autoCloseTags:!0,autoCloseBrackets:!0,continueComments:"Enter",matchTags:{bothTags:!0},matchBrackets:!0}),window._designtheme&&u.msDataDynamicheight&&(e=$(".designtheme_codemirror_height").height(),s=$(".designtheme_codemirror_height").width(),f.setSize(s,e)),u.msDataCodemirrorMode&&f.setOption("mode",u.msDataCodemirrorMode),f.markText({line:6,ch:26},{line:6,ch:42},{className:"styled-background"});var a=document.getElementById(u.id+"_codemirror-theme-select"),s=localStorage.getItem("codemirror_theme_select");function n(){return{from:f.getCursor(!0),to:f.getCursor(!1)}}function o(e){var t=n();f.commentRange(e,t.from,t.to)}s&&(a&&(a.value=s),f.setOption("theme",s)),l.on(window,"hashchange",function(){var e=localStorage.getItem("codemirror_theme_select");e&&(a.value=e,t())}),$(document).on("click","#"+u.id+"_codemirror-autoFormat",function(){var e;e=n(),f.autoFormatRange(e.from,e.to)}),$(document).on("click","#"+u.id+"_codemirror-comment",function(){o(!0)}),$(document).on("click","#"+u.id+"_codemirror-uncomment",function(){o(!1)}),$(document).on("click","#"+u.id+"_codemirror-find",function(){f.execCommand("find")}),$(document).on("click","#"+u.id+"_codemirror-replace",function(){f.execCommand("replace")}),$(document).on("change","#"+u.id+"_codemirror-theme-select",function(){t()}),$(document).on("click","#"+u.id+"_codemirror-undo",function(){f.execCommand("undo")}),$(document).on("click","#"+u.id+"_codemirror-redo",function(){f.execCommand("redo")}),(g.width||g.height)&&f.setSize(g.width,g.height),f.on("change",function(){f.save();var e=f.getValue();e!==p.$viewValue&&(p.$setViewValue(e),c.$$phase||c.$root.$$phase||c.$apply()),"function"==typeof i&&i(instance,changeObj)});for(var i,r=0,d=v.length;r<d;++r)void 0!==(i=g["on"+v[r].charAt(0).toUpperCase()+v[r].slice(1)])&&"function"==typeof i&&f.on(v[r],i);p.$formatters.push(function(e){if(angular.isUndefined(e)||null===e)return"";if(angular.isObject(e)||angular.isArray(e))throw new Error("ui-codemirror cannot use an object or an array as a model");return e}),p.$render=function(){f.setValue(p.$viewValue)},u.uiRefresh&&c.$watch(u.uiRefresh,function(e,t){e!==t&&h(function(){f.refresh()})})})})}}}])}();var mystoreModule=angular.module("mystore");function findUserAgent(){return ms.device.isMobileApp?"APP":ms.device.isMobile?"MOBILE":"WEB"}function buildUrl(e,t){var a,s="";for(a in t){var n=t[a];"object"==typeof t[a]&&(n=JSON.stringify(n)),s+=encodeURIComponent(a)+"="+encodeURIComponent(n)+"&"}return e=0<s.length?e+"?"+(s=s.substring(0,s.length-1)):e}function post_to_url(e,t,a){a=a||"post";var s,n,o,i=document.createElement("form");for(s in i.setAttribute("method",a),i.setAttribute("action",e),t)t.hasOwnProperty(s)&&(n=t[s],"object"==typeof t[s]&&(n=JSON.stringify(n)),(o=document.createElement("input")).setAttribute("type","hidden"),o.setAttribute("name",s),o.setAttribute("value",n),i.appendChild(o));document.body.appendChild(i),i.submit()}function get_to_url(e,t,a){window.location.href=buildUrl(e,t)}function executeFunction(e,t,a){window.mystore.utils.parseFunction(e).call(this,t,a)}mystore.utils.checkFieldVisibility=function(e,a){var s,n,t;if(e.settings&&e.settings.show_on&&e.settings.show_on.length)return n=!(s=!1),e.settings.show_on.forEach(function(e){var t;e&&("equal"===(t=e.operator||"equal")&&a[e.field]==e.value||"not_equal"===t&&a[e.field]!=e.value?s=!0:n=!1)}),t=!0,!(t=n&&"and"===e.settings.show_on_operator||s&&("or"===e.settings.show_on_operator||!e.settings.show_on_operator)?!1:t);if(e.settings&&e.settings.hide_on&&e.settings.hide_on.length){t=!1;for(var o=0,i=e.settings.hide_on.length;o<i;o++){var r=e.settings.hide_on[o],d=r.operator||"equal";if("equal"===d&&a[r.field]==r.value)console.log("equal",a[r.field],r.value,a[r.field]===r.value),t=t||!0;else if("not_equal"===d&&a[r.field]!=r.value)console.log("not_equal",a[r.field],r.value,a[r.field]!==r.value),t=t||!0;else if("and"===e.settings.hide_on_operator){t=!1;break}}return!t}return!0},window.admin_theme&&"mobitual"==window.admin_theme.name&&(mystoreModule.filter("resolveFilterOperator",function(){return function(e){var t="is";switch(e){case"eq":t="is";break;case"not_equal":t="is not";break;case"regex":t="contains";break;case"greater_than":t="is greater than";break;case"less_than":t="is less than";break;case"less_than_or_equal":t="is less than or equal to";break;case"greater_than_or_equal":t="is greater than or equal to";break;case"in":t="has";break;case"nin":t="not have"}return t}}),mystoreModule.directive("datatableNew",["$templateCache","$compile","$injector","$http","$rootScope","$q","$location","$filter","$timeout","app","$mdDialog","$mdToast","$stateParams",function(t,b,e,w,k,n,S,o,a,r,d,O,l){return t.put("datatable.collection.html",'<span><span ng-show="row[col.name].length>0">{{row[col.name].length}}</span><span ng-hide="row[col.name].length>0">{{"No"|msT}}</span>  {{"records"|msT}}</span>'),t.put("datatable.editablecell.html",'<span><input class="inline-editable-input" ng-model="row[col.name]"/></span>'),t.put("datatable.editablecellSelect.html",'<span><select ng-init ="" ng-model= "row[col.name][0]" ng-options="option for option in row[col.name]"></select></span>'),t.put("datatable.loadmore.html",'<div class="load-more pull-right" ng-show="showLoadMore"><a class="btn btn-sm btn-primary" ng-click="loadMoreItems()">{{"Load More"|msT}}</a></div>'),t.put("datatable.data.html",'<style>a.active-sort {color: #3d3333 !important;}.th-heading-columns {display: flex;align-items: center}</style><div class="loading" ng-if="loading "> <md-progress-circular md-mode="indeterminate"></md-progress-circular></div> <div ng-if="(!pageData || !pageData.length) && !loading && !addFormShown && !dtOptions.formField"><div class="no-record-found ms-mt-s"><b> {{"No Records  Found"|msT}}</b></div></div> <div class="ms-ml-0 ms-mr-0 table-responsive" ng-if="!loading && ((pageData && pageData.length) || dtOptions.formField)"><table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp"><thead ng-if="!onSelection"><tr><th class="mdl-data-table__select mdl-data-table__cell--non-numeric" ng-show="selection"><div class="th-heading-columns" style="position: relative; top: 3px;"><md-checkbox md-no-ink aria-label="Select All" md-indeterminate="isIndeterminate()" ng-checked="exists(\'selectAll\')" ng-click="changeSelection()"></md-checkbox></div></th><th class="mdl-data-table__cell--non-numeric" ng-if="($root.ms.device &amp;&amp; $root.ms.device.isMobile) || detail_view">{{"Summary"|msT}}</th><th class="mdl-data-table__cell--non-numeric" ng-hide="col.settings.hidden" ng-if="(!$root.ms.device || !$root.ms.device.isMobile) && !detail_view" ng-repeat="col in list_columns track by $index"><div class="th-heading-columns"><span style="display: flex;cursor: pointer; margin-right: 5px; flex-direction: column;cursor:pointer" class="btn-group-vertical" ng-if="col.settings.sortable"><a style="line-height: 1;height: 8px;color: #80808091;" ng-class="{\'active-sort\':iconClass == \'fa fa-chevron-up\' && currentSortedField == col.name}" ng-click="sortBy(col,-1)"><i class="fa fa-caret-up flex"></i></a><a style="line-height: 1;color: #80808091;" ng-class="{\'active-sort\':iconClass == \'fa fa-chevron-down\' && currentSortedField == col.name}" ng-click="sortBy(col,1)"><i class="fa fa-caret-down flex"></i></a></span><span>{{col.settings.label|ucfirst|remove_underscore|msT}}</span></div></th><th class="mdl-data-table__cell--non-numeric" ng-show="showRowCommands"><div class="th-heading-columns" style="float:right"><span class="pull-right">{{"Actions"|msT}}</span></div></th></tr></thead><thead ng-if="onSelection"><tr><th class="mdl-data-table__select mdl-data-table__cell--non-numeric" ng-show="selection"><md-checkbox md-no-ink aria-label="Select All" md-indeterminate="isIndeterminate()" ng-checked="exists(\'selectAll\')" ng-click="changeSelection()"></md-checkbox></th>\x3c!--<th class="mdl-data-table__cell--non-numeric ms-pb-s" colspan="1"><md-input-container class="ms-mt-0 ms-mb-0"><label>{{"Apply Option"|msT}}</label><md-select ng-model="selectedBatchCommand" ng-change="executeBatchCommand(selectedBatchCommand)"><md-option ng-repeat="option in batchCommands" value={{option.name}}>{{option.title}}</md-option></md-select></md-input-container>--\x3e</th><th class="mdl-data-table__cell--non-numeric ms-pb-s" colspan="{{colSpanLength}}"><span>{{selectedItems.length}} {{selectedItems.length > 1 ? "items" : "item" | msT}} {{"selected"|msT}}</span></th><th class=" ms-pb-0"><md-menu ng-if="batchCommands.length" md-offset="0 50" class="pull-right"><md-button md-no-ink aria-label="Open phone interactions menu_{{$index}}" class="md-icon-button" ng-click="openMenu($mdOpenMenu, $event)"><i class="material-icons md-dark ms-pt-xs"></i> </md-button> <md-menu-content width="2"><md-menu-item ng-if="command.widget || command.handler || command.link" ng-repeat="command in batchCommands"><md-button md-no-ink ng-if="command.widget && command.customWidget" ms-widget="ms.dialog" ms-data-widget="{{command.widget}}" ms-data-trigger="click">{{command.title|msT}}</md-button><md-button md-no-ink ng-if="command.widget && !command.customWidget" ms-dialog="{{command.widget}}">{{command.title|msT}}</md-button><md-button md-no-ink ng-if="!command.widget && command.handler" ng-click="executeBatchCommand(command.name)">{{command.title|msT}}</md-button><md-button md-no-ink ng-if="!command.widget && command.link" ng-href="{{command.link|resolveLink:this}}" ng-attr-target="{{command.pageChange ? \'_blank\' : undefined}}">{{command.title|msT}}</md-button></md-menu-item></md-menu-content></md-menu></th></tr></thead><tbody ng-model="pageData"><tr ng-class="{\'active\':$root.ms.routeParams.entityid && row._id && $root.ms.routeParams.entityid == row._id}" id="{{row_id}}" ng-hide="row.hidden" ng-repeat="(row_id, row) in pageData track by $index"><td class="mdl-data-table__cell--non-numeric" ng-if="selection"><md-checkbox md-no-ink aria-label="Select All" ng-checked="exists(row, selectedItems)" ng-click="selectRow(row)"></md-checkbox></td><td class="mdl-data-table__cell--non-numeric ms-pr-0" data-pk="{{row_id}}" ng-if="($root.ms.device && $root.ms.device.isMobile) || detail_view" ng-summary-cell="" style="word-break: break-all;"></td><td class="mdl-data-table__cell--non-numeric {{col.editable}}" data-pk="{{row_id}}" ng-cell-new="" ng-hide="col.settings.hidden" ng-if="(!$root.ms.device || !$root.ms.device.isMobile) && !detail_view" ng-repeat="(col_id, col) in list_columns track by $index"></td><td class="ms-pl-0" ng-show="showRowCommands" ng-init="rowCommands = getRowCommands(row_id, row)"><md-menu md-offset="0 50" class="pull-right ms-pt-xs" ng-if="rowCommands.length"><md-button md-no-ink aria-label="Open phone interactions menu_{{$index}}" class="md-icon-button menu_{{col_id}}" ng-click="openMenu($mdOpenMenu, $event)"><i class="material-icons"></i></md-button> <md-menu-content width="2"><md-menu-item ng-if="command.widget || command.handler || command.link" ng-repeat="command in rowCommands"><md-button md-no-ink class="{{command.title}}" ng-if="command.widget && command.customWidget" ms-widget="ms.dialog" ms-data-widget="{{command.widget}}" ms-data-trigger="click">{{command.title|msT}}</md-button><md-button md-no-ink class="{{command.title}}" ng-if="command.widget && !command.customWidget" ms-dialog="{{command.widget}}"  ms-data-dialogSettings="{{command.dialogSettings}}">{{command.title|msT}}</md-button><md-button md-no-ink class="{{command.title}}" ng-if="!command.widget && command.handler" ng-click="executeRowCommand(command.name, row_id, row, $event)">{{command.title|msT}}</md-button><md-button md-no-ink class="{{command.title}}" ng-if="!command.widget && command.link" ng-href="{{command.link|resolveLink:this}}" ng-attr-target="{{command.pageChange ? \'_blank\' : undefined}}">{{command.title|msT}}</md-button></md-menu-item></md-menu-content></md-menu></td></tr></tbody></table></div>'),t.put("datatable.data1.html",'<div class="table-responsive" ><table class=" table table-striped table-bordered table-hover" id=""><thead class="thin-border-bottom" ng-hide="onSelection"><tr><th ng-show="selection" ng-class="selectType" class="selection-header center hidden-480"><label ><input type="checkbox" ng-model="selectAll" class="select-all ace " ng-click="changeSelection()"><span class="lbl"></span></label></th><th ng-show="rowReorder" style="width:20px" class="hidden-480"><i class="fa fa-align-justify"></i></th><th ng-click="sort(col)"  ng-hide="col.settings && col.settings.hidden" ng-class="{\'hidden-480\':$index!=0}"  ng-repeat="col in list_columns">{{col.name|ucfirst |remove_underscore}} <i class="pull-right  {{iconClass}}" ng-show="sortedCol==col.name"></i></th><th ng-show="showRowCommands">{{"Actions"|msT}}</th></tr></thead><thead class="thin-border-bottom" ng-show="onSelection"><tr><th ng-show="selection" ng-class="selectType" class="selection-header" colspan="{{colSpanLength}}"><label><input type="checkbox" ng-model="selectAll" class="select-all ace" ng-click="changeSelection()"><span class="lbl"></span> <select ng-show="showBatchDropdown" ng-model="data.selectedBatchCommand" ng-change="executeBatchCommand(this.data.selectedBatchCommand)" ng-options="option.name as option.value for option in batchCommands"><option value="">{{"Apply on selected rows"|msT}}</option></select></label></th></thead><tbody dnd-list="pageData" ui-sortable="sortableOptions" ng-model="pageData"><tr style="cursor:pointer;" ng-repeat="(row_id, row) in pageData"  id="{{row_id}}" ng-hide="row.hidden" ng-click="dtOptions.getRecord(row)"><td ng-show="selection" class="center hidden-480" ><label><input type="checkbox" class="rowcheckbox ace" ng-click="selectRow(row)"><span class="lbl"></span></label></td><td ng-show="rowReorder"  class="dt-reorder-row hidden-480"><i class="fa fa-align-justify"></i></td><td  ng-repeat="(col_id, col) in list_columns" style="word-break: break-all;" ng-cell-new ng-class="{\'hidden-480\':$index!=0}"  ng-hide="col.settings.hidden" class="{{col.editable}}" data-pk="{{row_id}}"></td><td style="word-wrap: break-word;" ng-if="dtOptions.row_commands.length" ng-init="rowCommands = getRowCommands(row_id, row)"><div class="inline position-relative dropdown-hover"><button class="btn btn-minier bigger btn-primary"><i class="fa fa-cog icon-only bigger-110"></i></button><ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-caret dropdown-close dropdown-menu-right"><li ng-repeat="command in getRowCommands(row_id, row)"><a href="" ng-click="executeRowCommand(command.name, row_id, row, $event)" class="tooltip-success" data-rel="tooltip" data-original-title="{{command.title|ucfirst}}" title="{{command.title|ucfirst}}"><span class="red"><i  class="ace-icon fa fa-{{command.icon}} bigger-120"></i></span></a></li></ul></div></td></tr></tbody></table></div>'),t.put("datatable.commands.html",'<style>#search-input {color:#ffffff;background: none; outline:none;border:none;border-bottom:1px solid rgba(255,255,255,0.87);width:0px;float:right;-webkit-transition: width 0.4s ease-in-out;transition: width 0.4s ease-in-out;}#search-input:focus {width: 90%}</style><div style="margin: 8px" class="md-whiteframe-6dp"><md-toolbar class="md-table-toolbar alternate" ng-if="pageData.length && selectedItems && selectedItems.length"><div class="md-toolbar-tools"><span>{{selectedItems.length}} {{selectedItems.length >+ 1 ? "items" : "item"}} selected</span><div flex></div><md-menu md-offset="0 50"><md-button md-no-ink aria-label="Open phone interactions menu" class="md-icon-button"ng-click="openMenu($mdOpenMenu, $event)"><i class="material-icons md-dark">&#xE5D4;</i></md-button><md-menu-content width="2"><md-menu-item ng-repeat="option in batchCommands"><md-button md-no-ink ng-click="executeBatchCommand(option.name)"><i class="material-icons" ng-bind="option.icon"></i>{{option.value}}</md-button></md-menu-item></md-menu-content></md-menu></div></md-toolbar></div>'),t.put("datatable.pagination.html",'<div class="mdt-footer" layout="row" layout-align="center center" ng-if="(totalRecords > itemsPerPage) && !loading"><div class="mdt-pagination" layout="row" layout-align="center center" flex><div layout-margin><span ng-if="page==1">{{"Showing"|msT}} 1 {{"to"|msT}} {{itemsPerPage}} {{"of"|msT}} {{totalRecords1 || totalRecords}} {{!totalRecords1 && "Records"|msT}}</span><span ng-if="page!=1 && (page-1)*itemsPerPage+itemsPerPage <= totalRecords">{{"Showing"|msT}} {{((page-1)*itemsPerPage)+1}} {{"to"|msT}} {{(page-1)*itemsPerPage+itemsPerPage}} {{"of"|msT}} {{totalRecords1 || totalRecords}}</span><span ng-if="page!=1 && (page-1)*itemsPerPage+itemsPerPage > totalRecords">{{"Showing"|msT}} {{((page-1)*itemsPerPage)+1}} {{"to"|msT}} {{totalRecords}} {{"of"|msT}} {{totalRecords1 || totalRecords}}</span></div><md-button md-no-ink class="md-icon-button md-primary" aria-label="First page" ng-click="selectPage(1)"><i class="material-icons">&#xE5DC;</i></md-button><md-button md-no-ink class="md-icon-button md-primary" aria-label="Previous page" ng-click="selectPage(page - 1)"><i class="material-icons">&#xE5CB;</i></md-button><md-button md-no-ink class="md-icon-button md-primary" aria-label="Next page" ng-click="selectPage(page + 1)"><i class="material-icons">&#xE5CC;</i></md-button><md-button md-no-ink class="md-icon-button md-primary" aria-label="Last page" ng-click="selectPage(totalPages)"><i class="material-icons">&#xE5DD;</i></md-button></div></div>'),t.put("datatable.html",'<md-card><ng-include src="\'datatable.commands.html\'"></ng-include></div><div class="pull-right">here<div ms-widget="ms.datatable.search"></div></div><div class="pull-right"><span ng-switch on="triggerPopup"><a class="btn" ng-switch-when="true" ms-datatable-popup-new="add">{{"Add Record"|msT}}</a><a class="btn" ng-switch-default ng-click="executeBatchCommand(\'add\')">{{"Add Record"|msT}}</a></div></div><ng-include src="\'datatable.data.html\'" ></ng-include><div><ng-include src="\'datatable.pagination.html\'"></ng-include></div></md-card>'),{restrict:"A",scope:{dtOptions:"=datatableNew"},link:function(g,f,e){g.openMenu=function(e,t){e(t)},g.saveSearch=function(e){e=d.prompt().title("What would you name your Search?").textContent("Saved search name").placeholder("Name").ariaLabel("Name").targetEvent(e).ok("Save").cancel("Cancel");d.show(e).then(function(a){var e={entity:"ms.extend_entity",data:{entity_name:g.dtOptions.entity,tab:{name:a,filters:h.filters,filter_operator:"and",custom:!0}}};k.ms.user&&k.ms.user.isLoggedIn&&k.ms.user.role&&(e.data.tab.user=k.ms.user._id),r.call("createCustomFilters",e,function(e,t){if(e)throw e;S.search("saved_search",a),window.location.reload()})},function(){})},g.deleteTabFilter=function(e,t,a){e.filters&&1==e.filters.length?(a=d.confirm().title("Delete this filter?").textContent("Are you sure you want to delete this filter? It will delete the tab also.").ariaLabel("Delete Filter").targetEvent(a).ok("Delete").cancel("Cancel"),d.show(a).then(function(){var e=mystore.utils.getObjectIndexFromArray(g.dtOptions.tabs,"tempTab",!0);g.dtOptions.tabs.splice(e,1),g.tab=null,g.dtOptions.filters=[]},function(){})):(a=mystore.utils.getObjectIndexFromArray(e.filters,"$$hashKey",t.$$hashKey),e.filters.splice(a,1),k.ms.tables[g.dtOptions.name].filter(e.filters,e.filter_operator,e))},g.deleteSearch=function(t,e){e=d.confirm().title("Delete this search?").textContent("Are you sure you want to delete "+t.name+"? This action cannot be reversed.").ariaLabel("Delete Search").targetEvent(e).ok("Delete").cancel("Cancel");d.show(e).then(function(){var e={entity:"ms.extend_entity",data:{entity_name:g.dtOptions.entity,tab:t}};r.call("deleteCustomFilters",e,function(e,t){if(e)throw e;window.location.reload()})},function(){})},g.data={};var a={struct:{},detail_view:!(g.loading=!0),rowReorder:!1,selection:!1,showSearchBox:!0,showSaveSearch:!1,showPaging:!0,filters:[],fields:{},inline_editable:!0,always_editable:!1,list_columns:[],sort_columns:[],primary_columns:[],showEmptyRows:1,addEmptyRows:"bottom",showBatchDropdown:"false",cols:[],data:[],enableSorting:!0,enableSearch:!0,ajax:!1,ajaxUrl:"",template:t.get("datatable.html"),commands:[],clientSearch:!0,clientSort:!0,clientPaging:!0,limit:20,pageSizes:[10,20,50,100],pageSize:20,currentPage:1,enableTextSearch:!1},h=($(document).data("datatable-editing-flag")||($(document).on("click",function(){$(".datatable-editing").triggerHandler("blur")}),$(document).data("datatable-editing-flag",!0)),{});function i(){for(var e=[],t=[],a=0,s=h.commands.length;a<s;a++)h.commands[a].level&&-1<h.commands[a].level.indexOf("row")&&(h.commands[a].widget&&0==h.commands[a].widget.indexOf("custom")&&(h.commands[a].customWidget=1),e.push(h.commands[a])),h.commands[a].level&&-1<h.commands[a].level.indexOf("batch")&&t.push(h.commands[a]);g.page_query=null,g.sortedCol="",g.selectType="select-none",g.pageData=[],g.originalData=[],g.selectedItems=[],g.onSelection=!1,g.selection=h.selection,g.cols=[],g.rowReorder=h.reorder,g.rowCommands=e,g._batchCommands=t,g.batchCommands=t,g.showBatchDropdown=h.showBatchDropdown,"object"==typeof g.rowCommands&&(g.showRowCommands=0<Object.keys(g.rowCommands).length),g.data.searchTxt=h.searchTxt,g.page="",g.sortedCol="",g.showPaging=h.showPaging,g.currentPage=h.currentPage,g.pageSizes=h.pageSizes,g.pageSize=h.pageSize,g.enableSorting=h.enableSorting,g.enableSearch=h.enableSearch,g.editable=h.inline_editable,g.originalLimit=h.limit,g.initialLoading=!0,g.list_columns=[],h.list_columns&&h.list_columns.length?angular.forEach(h.list_columns,function(t){angular.forEach(h.cols,function(e){e.name==t&&g.list_columns.push(e)})}):g.list_columns=h.cols,h.sort_columns&&h.sort_columns.length&&angular.forEach(h.cols,function(e){h.sort_columns.includes(e.name)&&(e.settings.sortable=1)}),h.ajax&&S.search().search?g.data.searchTxt=S.search().search:h.ajax&&Object.keys(S.search()).length&&S.search()&&Object.keys(S.search()).length&&Object.keys(S.search()).forEach(function(e){h.advance_search_fields&&-1<h.advance_search_fields.indexOf(e)&&(g.data.searchKey=e,g.data.searchTxt=S.search()[e])}),h.ajax&&S.search().page&&0<parseInt(S.search().page)&&(g.page=parseInt(S.search().page)),g.page_query=angular.copy(S.search()),"ms.audit_logs"==ms.routeParams.entity&&g.page_query&&g.page_query.q&&g.page_query.q.includes("section")&&(g.page_query.q=g.page_query.q.split("?")[0]);var o,i,n=-1,r=(g.dtOptions.tabs&&g.dtOptions.tabs.length&&(n=mystore.utils.getObjectIndexFromArray(g.dtOptions.tabs,"name","Custom Search")),0);if(g.dtOptions.struct&&g.dtOptions.struct.settings&&g.dtOptions.struct.settings.store_only_in_big_query&&"1"==g.dtOptions.struct.settings.store_only_in_big_query&&(r=1),-1==n&&(r||Object.keys(g.page_query).length&&g.dtOptions.advance_search_fields&&g.dtOptions.advance_search_fields.length)){if(g.page_query.filters)if(g.page_query.filters=JSON.parse(g.page_query.filters),g.dtOptions.struct.settings.store_only_in_big_query&&"1"==g.dtOptions.struct.settings.store_only_in_big_query)g.dtOptions.tabs.push({name:"Custom Search",filters:g.page_query.filters,custom:!0,tempTab:!0}),S.search(""),S.replace(),g.dtOptions.selectedTabIndex=g.dtOptions.tabs.length-1;else{for(var d=1,a=0,s=g.page_query.filters.length;a<s;a++)if(!(-1<g.dtOptions.advance_search_fields.indexOf(g.page_query.filters[a].field))){d=0;break}d?(g.dtOptions.tabs.push({name:"Custom Search",filters:g.page_query.filters,custom:!0,tempTab:!0}),S.search(""),S.replace(),g.dtOptions.selectedTabIndex=g.dtOptions.tabs.length-1):O.show(O.simple().position("top right").hideDelay(5e3).textContent("Invalid Query!"))}else if(g.page_query.q){var l,c=[],d=1;for(l in g.page_query.q,g.page_query.q=JSON.parse(g.page_query.q),g.page_query.q)if(r)c.push({field:l,value:g.page_query.q[l]});else{if(!(-1<g.dtOptions.advance_search_fields.indexOf(l))){d=0;break}c.push({field:l,value:g.page_query.q[l]})}d?(g.dtOptions.tabs.push({name:"Custom Search",filters:c,custom:!0,tempTab:!0}),S.search(""),S.replace(),g.dtOptions.selectedTabIndex=g.dtOptions.tabs.length-1):O.show(O.simple().position("top right").hideDelay(5e3).textContent("Invalid Query!"))}}else-1!=n||S.search().page||S.search().saved_search||S.search().search||S.search().without_layout||!Object.keys(g.page_query).length||S.search().data||S.search().related_entity||S.search().section||(S.search()&&"string"==typeof S.search().search&&""==S.search().search?S.search("search",null):O.show(O.simple().position("top right").hideDelay(5e3).textContent("Invalid Query !")));for(u in h.cols){var m,u=h.cols[u];u.settings||(u.settings={}),u.settings.label||(m=u.name)&&(m=(m=m.replace("_"," ")).substring(0,1).toUpperCase()+m.substring(1),u.settings.label=m),u.settings.type||(u.settings.type="text"),!h.inline_editable||"editable"in u||(u.settings.editable=!0),!h.always_editable||"always_editable"in u||(u.settings.always_editable=!0),u.settings.formatter&&(m=mystore.utils.parseFunction(u.settings.formatter),u.settings.formatter=m),g.cols.push(u)}function p(e,t){for(var a=0;a<e.length;a++)if(e[a]._id==t)return a}g.page||(g.page=1),g.itemsPerPage=h.limit,g.$watch("totalRecords",function(e,t){e!=t&&(g.page||(g.page=1),g.pages=g.getPages(g.page),g.previousStart=h.start)},!0),g.selectPage=function(e){g.totalPages=Math.max(h.limit<1?1:Math.ceil(g.totalRecords/h.limit)||0,1),(g.page!==e&&0<e&&e<=g.totalPages||h.tokens)&&(g.pages=g.getPages(e),g.page=e,h.tokens||S.search("page",g.page),y())},g.getPages=function(e){for(var t=Math.max(h.limit<1?1:Math.ceil(g.totalRecords/h.limit)||0,1),a=[],s=1,n=t,o=s=angular.isDefined(5)&&5<t&&t<(n=(s=Math.max(e-Math.floor(2.5),1))+5-1)?(n=t)-5+1:s;o<=n;o++)a.push({number:o,text:o,active:o===e});return a},h.data?"string"==typeof h.data?(g.originalData=g.$parent.$eval(h.data),g.$parent.$watch(h.data,function(e,t){e&&e.length&&(g.originalData=g.$parent.$eval(h.data),h.showPaging||(g.pageData=g.originalData),v(g.originalData))},!0)):g.$watch("dtOptions.data",function(e,t){g.originalData=e,h.showPaging||(g.pageData=g.originalData),v(g.originalData)},!0):h.tabs&&h.tabs.length||y(),g.isChecked=function(){return g.selectedItems.length===g.pageData.length},g.isIndeterminate=function(){return 0!==g.selectedItems.length&&g.selectedItems.length!==g.pageData.length},g.exists=function(e,t){return!("selectAll"!=e||!g.selectedItems.length||g.selectedItems.length!=g.pageData.length)||("selectAll"!=e||g.selectedItems.length!=g.pageData.length)&&!!(t&&0<=t.indexOf(e))},g.changeSelection=function(){g.pageData&&g.pageData.length&&(g.selectedItems&&g.selectedItems.length?(g.selectedItems=[],g.selectType="select-none",g.selectAll=!1,g.showBatchDropdown=!1,g.onSelection=!1):(g.selectedItems=g.pageData.slice(0),g.selectType="select-visible",g.selectAll=!0,g.showBatchDropdown=!0,g.onSelection=!0,g.colSpanLength=0,g.list_columns.forEach(function(e){e.settings.hidden||++g.colSpanLength}),(g.dtOptions.detail_view||k.ms.device&&k.ms.device.isMobile)&&(g.colSpanLength=1),g.getBatchCommands()))},g.selectRow=function(e){g.selectedItems.indexOf(e)<0?g.selectedItems.push(e):g.selectedItems.splice(g.selectedItems.indexOf(e),1),g.selectedItems.length?(g.getBatchCommands(),g.showBatchDropdown=!0,g.onSelection=!0,g.colSpanLength=0,g.list_columns.forEach(function(e){e.settings.hidden||++g.colSpanLength}),(g.dtOptions.detail_view||k.ms.device&&k.ms.device.isMobile)&&(g.colSpanLength=1)):g.onSelection=!1},h.reorder&&(g.sortableOptions={disabled:!1,placeholder:"tr",connectWith:"tbody",helper:_,handle:"td.dt-reorder-row",axis:"y",start:function(e,t){o=angular.copy(g.pageData),i=$(t.item).index()},stop:function(e,t){var t=$(t.item).index(),s=o[i],n=o[t],a={limit:h.limit,startIndex:i,targetIndex:t,startId:s._id,targetId:n._id,currentRowOrder:s.sort_order,command:"reorder"};i!=t&&h.ajaxUrl&&(g.sortableOptions.disabled=!0,w.post(h.ajaxUrl+"/_reorder",{data:a}).success(function(e){var t,a;g.sortableOptions.disabled=!1,h.ajax||g.originalData==g.pageData||(t=p(g.originalData,s._id),a=p(g.originalData,n._id),g.originalData.splice(t,1),g.originalData.splice(a,0,s))}).error(function(e){console.log("reorder error occurred",e)}))}}),f.html(b(h.template)(g))}g.pageData=[],g.sortableOptions={disabled:!0},g.$watch("dtOptions",function(){var t;g.dtOptions&&(h=angular.extend({},a,g.dtOptions),g.dtOptions.deleteSearch=g.deleteSearch,h.struct&&(g.struct=h.struct),h.detail_view&&(g.detail_view=h.detail_view),g.dtOptions.name&&(k.ms||(k.ms={}),k.ms.tables||(k.ms.tables={}),k.ms.tables[g.dtOptions.name]=g),t={},h.commands=[],angular.forEach(a.commands,function(e){t[e.name]=e}),g.watch=!1,g.dtOptions.commands&&angular.forEach(g.dtOptions.commands,function(e){t[e.name]=e}),angular.forEach(t,function(e){h.commands.push(e)}),h.list_columns&&0<h.list_columns.length&&angular.forEach(h.cols,function(e){-1==h.list_columns.indexOf(e.name)&&(e.settings.hidden=!0)}),g.searchlabel="",g.hasSettings_label=!1,angular.forEach(h.cols,function(e){e.settings&&(e.settings.primary_columns=!1,h.primary_columns&&-1!=h.primary_columns.indexOf(e.name)&&(e.settings.primary_columns=!0,e.name==h.struct.settings.primary_columns[0]&&(e.settings&&e.settings.label?(g.searchlabel=e.settings.label,g.hasSettings_label=!0):(g.searchlabel=h.struct.settings.primary_columns[0],g.hasSettings_label=!1))),h.list_columns&&1<h.list_columns.length&&-1==h.list_columns.indexOf(e.name)&&(e.settings.hidden=!0))}),h.triggerPopup&&(g.triggerPopup=h.triggerPopup),h.showSaveSearch&&(g.showSaveSearch=h.showSaveSearch),0==h.addFormShown&&(g.addFormShown=!1),(g.dtOptions.entity&&g.dtOptions.entity==l.entity||!g.dtOptions.entity)&&i())}),g.getCommand=function(e){var t,a=null;for(t in h.commands){var s=h.commands[t];if(s.name==e){a=s;break}}return a},g.formatRowCommand=function(e){row_id,row;e=g.getCommand(e);e.formatter||(e.formatter=function(e){return""})},g._rowCommands={},g.getRowCommands=function(e,t){var a,s=g.rowCommands;return h.row_commands_processor&&(t={row_id:e,row:t,dtOptions:h,scope:g,commands:s},(a=mystore.utils.parseFunction(h.row_commands_processor))?s=a(t):(console.log("ERROR: row commands processor is not a function"),console.log(h.row_commands_processor))),g._rowCommands[e]=s,g.showRowCommands=0<s.length,s=s.filter(function(e){return"editOrder"!==e.name||"1"===ms.settings.enable_edit_order?e:void 0})},g.getBatchCommands=function(){var e,t,a,s=g._batchCommands;return(h.batch_commands_processor||g.struct.settings.batch_commands_processor)&&(e=h.batch_commands_processor||g.struct.settings.batch_commands_processor,(t={dtOptions:h,scope:g,commands:s}).rows=g.selectedItems,(a=mystore.utils.parseFunction(e))?s=a(t):(console.log("ERROR: batch commands processor is not a function"),console.log(e)),g.batchCommands=s),s},g.executeBatchCommand=function(e){"delete"==e&&(h.start=g.previousStart);var t={command:e,scope:g};if(!g.selectedItems.length)return alert("no rows selected"),void(g.data.selectedBatchCommand="");t.rows=g.selectedItems;e=g.getCommand(e),e=mystore.utils.parseFunction(e.handler);e&&(g.changeSelection(),e.call(null,t)),g.data.selectedBatchCommand=""},g.executeRowCommand=function(e,t,a,s){"delete"==(e=e||(h.struct.settings.view_enabled&&"1"==h.struct.settings.view_enabled?"view":"edit"))&&(h.start=g.previousStart,g.addFormShown=!1);var t={command:e,row_id:t,row:a,pkey:a._id,dtOptions:h,scope:g,event:s},n=g.getCommand(e);n.entity&&(t.entity=n.entity),n.params&&(t.params=n.params),(n=n||"view"!=e?n:{link:"entity/"+g.dtOptions.entity+"/"+a._id+"/_view"})&&n.handler?(e=mystore.utils.parseFunction(n.handler))&&e.call(null,t):n&&n.link&&((e=g.$new()).row=a,t=o("resolveLink")(n.link,e),S.path(t)),s.stopPropagation(),s.preventDefault()},g.deleteRow=function(e){g.originalData.splice(e,1),h.start=g.previousStart,i()},g.deleteRows=function(e){for(var t in e){t=e[t];g.originalData.splice(g.originalData.indexOf(t),1)}h.start=g.previousStart,i()},g.addEmptyrow=function(){var e,t={};for(e in h.cols)t[h.cols[e].name]="";"top"==h.addEmptyRows?g.pageData.splice(0,0,t):g.pageData.push(t)},g.addFormShown=!1,g.addForm=null,g.saveAddForm=function(){g.addForm.submit()},g.showAddForm=function(e,t,a){g.addFormShown=!0;var s=k.$new(),n=t&&t.row?t.row:{},o=(s.tempId=Math.floor(1e5*Math.random()),s.field_name=h.formField.settings&&h.formField.settings.singular_name?h.formField.settings.singular_name:h.formField.name,s.btnFunction=t&&t.row?"Update":"Insert",s.subformOptions={id:s.tempId+"_form",name:s.tempId+"_form",fields:h.cols,data:n,layout_style:"row",label_width:"15",enableMaterial:!0,submit:function(e){t?(g.pageData[t.row_id]=e,i()):g.pageData.push(e),ms._applyScope(),s.removeForm()}},s.submitForm=function(){g.pageData.push(n),g.addFormShown=!1,g.addForm=null,$("#"+s.tempId+"_form").remove()},s.removeForm=function(){g.addFormShown=!1,g.addForm=null,!s.subformOptions.disableDialogClose&&d&&d.cancel(),$("#"+s.tempId+"_form").remove()},'<div class="edit-collection"><form flex layout="column" name="subRecord" ms-form="subformOptions" ></form><md-button md-no-ink class="md-raised md-primary white" ms-submit="{{subformOptions.id}}">{{btnFunction|msT}} {{field_name|ucfirst|remove_underscore|msT}}</md-button><md-button md-no-ink class="md-raised md-primary white" ng-click="removeForm()">{{"Cancel"|msT}}</md-button></div>');k.ms.device&&k.ms.device.isMobile||t||a?(s.subformOptions.layout_style="column",s.subformOptions.label_width="",d.show({controller:["$scope","$mdDialog",function(e,t){}],autoWrap:!0,clickOutsideToClose:!0,template:'<md-dialog style="width: 50%">'+o+"</md-dialog>",parent:angular.element(document.body),targetEvent:e,scope:s,onRemoving:function(){s.removeForm()}})):(a=f.find(".ms-add-form").html(""),s.subformOptions.disableDialogClose=!0,g.addForm=b(angular.element(o))(s),g.addForm.appendTo(a),$(".modal").each(function(){var e=$(this).attr("id");setTimeout(function(){$("#"+e).data("bs.modal").handleUpdate()},500)}))},g.showModal=function(e){g.addModalShown=!0;var t=k.$new(),a={},s=(t.tempId=Math.floor(1e5*Math.random()),t.field_name=h.formField.name,t.subformOptions={id:t.tempId+"_form",fields:h.cols,data:a,enableMaterial:!0,submit:function(){g.pageData.push(a),g.addFormShown=!1,g.addForm=null}},h.formField.settings||{}),n={formField:h.formField};n.cols=h.cols,n.reorder=!0,n.enableSearch=!1,n.list_columns=s.list_columns,n.selection=!0,n.showPaging=!0,n.struct=h.formField,n.template='<ng-include src="\'datatable.data.html\'"></ng-include><md-button md-no-ink ng-show="editable && !addFormShown" ng-click="showAddForm()" class="md-raised md-primary white">{{"Add Record"|msT}}</md-button><div ng-show="addFormShown"><div class="ms-add-form datatable_inline_edit"></div></div>',n.data=h.data,(g.gridOptions=n).commands=h.commands,n.commands&&0!=n.commands.length||(n.commands=[{name:"delete",title:"Delete",icon:"trash",level:["row","batch"]}]);d.show({controller:["$scope","$mdDialog","gridOptions",function(e,t,a){e.gridOptions=a,e.cancel=function(){t.cancel()}}],template:'<div class="ms-mb-m" datatable-new="gridOptions" class="grid-container"></div>',parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{gridOptions:n}}),t.submitForm=function(){g.pageData.push(a),g.addFormShown=!1,g.addForm=null,$("#"+t.tempId+"_form").remove()},t.removeForm=function(){g.addFormShown=!1,g.addForm=null,$("#"+t.tempId+"_form").remove()},$(".modal").each(function(){var e=$(this).attr("id");setTimeout(function(){$("#"+e).data("bs.modal").handleUpdate()},500)})},g.search=function(e,t,a){var s;h.start=0,h.limit=h.limit||20,g._rowCommands={},13!=(s=t?t.keyCode||t.which:s)&&t&&"click"!=t.type&&"submit"!=t.type||(g.data.searchTxt=e,a?(h.advance_search_fields&&h.advance_search_fields.length&&S.search()&&Object.keys(S.search()).length&&Object.keys(S.search()).forEach(function(e){-1<h.advance_search_fields.indexOf(e)&&S.search(e,null)}),S.search(a,g.data.searchTxt)):S.search("search",g.data.searchTxt),h.ajax&&""!=g.data.searchTxt&&h.enableTextSearch?(g.loading=!0,s={total:"1",resolve:JSON.stringify(h.resolve),relations:JSON.stringify(h.relations),search:JSON.stringify(g.data.searchTxt),start:h.start,limit:h.limit},h.filters&&(s.filters=JSON.stringify(h.filters)),a&&(s.filters=[{field:a,value:e,operator:"regex"}],s.filters=JSON.stringify(s.filters),delete s.search),w.get(h.ajaxUrl,{params:s}).success(function(e){g.totalRecords=e.paging.total,v(e.data)}).error(function(e){g.totalRecords=0,v([])})):(S.search("page",null),g.page=1,y()),g.selectedItems=[],g.selectType="select-none",g.selectAll=!1,g.showBatchDropdown=!1,g.onSelection=!1,t&&t.preventDefault())},g.getRecords=function(a){var s=!1,n=0;h.cols.forEach(function(t){var e;t.name==a&&t.settings&&t.settings.source_entity&&t.settings.source_entity.entity&&t.settings.source_entity.entity.length&&(s=!0,g.multiSelect=!0,e={url:"/entity/"+t.settings.source_entity.entity,method:"GET",params:{limit:100}},w(e).success(function(e){g.data.records=e.records,g.data.key_column=t.settings.source_entity.key_column,g.data.value_column=t.settings.source_entity.value_column,0<e.count?g.watch=!0:g.watch=!1})),++n!=h.cols.length||s||(g.multiSelect=!1)})},g.reload=function(){g.selectedItems&&g.selectedItems.length&&g.changeSelection(),h.ajax=!0,g.dtOptions.filters&&(h.filters=g.dtOptions.filters),y()},g.filter=function(e,t,a){g.data.searchTxt="",a&&(g.dtOptions.showSaveSearch=a.custom,g.dtOptions.tempTab=a.tempTab,g.dtOptions.filters=a.filters,g.tab=a,g._rowCommands={},h.filters=a.filters,h.start=h.start||0,h.limit=h.limit||20,h.filter_operator=a.filter_operator),g.selectedItems=[],g.selectType="select-none",g.selectAll=!1,g.showBatchDropdown=!1,g.onSelection=!1,y()},g.sortBy=function(e,t){g.currentSortedField=e.name,h.enableSorting&&h.sort_columns&&h.sort_columns.length&&-1!=h.sort_columns.indexOf(e.name)&&(h.start=g.previousStart,g.sortedCol=e.name,1==t?(e.settings.sorting=0,g.iconClass="fa fa-chevron-down"):(e.settings.sorting=1,g.iconClass="fa fa-chevron-up"),y())},g.sort=function(e){h.enableSorting&&h.sort_columns&&h.sort_columns.length&&-1!=h.sort_columns.indexOf(e.name)&&(h.start=g.previousStart,g.sortedCol=e.name,g.sortedCol&&("fa fa-chevron-up"==g.iconClass?g.iconClass="fa fa-chevron-down":g.iconClass="fa fa-chevron-up"),y())};var _=function(e,t){return t.children().each(function(){$(this).width($(this).width())}),t};function v(e){var t;!h.ajax&&h.clientSearch&&(g.data.searchTxt||h.filters.length)&&(e=e.filter(function(e){if(0<h.filters.length)for(var t in h.filters){t=h.filters[t];if(""==t.field)return!0;if(e[t.field]instanceof Array){if(-1==e[t.field].indexOf(t.value))return!1}else if(e[t.field]!=t.value)return!1}if(!g.data.searchTxt)return!0;var a,s=g.data.searchTxt.toLowerCase();for(a in e)if("$$hashKey"!=a)if("string"==typeof e[a])if(-1!=e[a].toLowerCase().indexOf(s))return!0})),h.clientSort&&!h.ajax&&(t=function(a){var s=1;return"-"===a[0]&&(s=-1,a=a.substr(1,a.length-1)),function(e,t){return(e[a]<t[a]?-1:e[a]>t[a]?1:0)*s}},g.sortedCol&&("fa fa-chevron-down"==g.iconClass?e.sort(t("-"+g.sortedCol)):e.sort(t(g.sortedCol)))),e&&(g.totalServerItems=e.length);if(h.treeview&&parseInt(h.treeview))return g.toggleChildren=function(e){var t=g.pageData;if(0==e.open)for(var a in t)e._id==t[a]._id&&(t[a].open=!0),t[a].parent==e._id&&(t[a].hidden=!1);else for(var a in e.open=!1,t)t[a].parent==e._id&&(t[a].hidden=!0);g.pageData=t},g.pageData=function(e){for(var t in e)0==e[t].open&&(e[t].hidden=!0);return e}(e),void(g.loading=!1);w.pendingRequests.length=0,h.limit&&!h.start&&(h.start=0),g.pageData=e,g.originalData=e,g.loading=!1}var s="";function y(){var t,a;g.loading=!0,h.ajax?(g.page&&1<parseInt(g.page)&&(h.start=(g.page-1)*h.limit),1==parseInt(g.page)&&(h.start=0),t={total:1,q:{},filters:JSON.stringify(h.filters),fields:(a={},h.list_columns&&h.list_columns.length&&(h.list_columns.forEach(function(e){a[e]=1}),a._metadata=1,h.struct.settings.columns_to_fetch&&h.struct.settings.columns_to_fetch.length&&h.struct.settings.columns_to_fetch.forEach(function(e){a[e]=1})),a),filter_operator:h.filter_operator,sort:"fa fa-chevron-down"==g.iconClass?"-"+g.sortedCol:g.sortedCol,start:h.start,limit:h.limit,resolve:JSON.stringify(h.resolve),relations:JSON.stringify(h.relations)},h.tokens&&h.tokens[g.page]&&(t.nextToken=h.tokens[g.page]),g.data.searchTxt&&(h.enableTextSearch?t.search=g.data.searchTxt:"global_assets"==h.entity?t.q.file=g.data.searchTxt:"ms.users"==h.entity?t.q.first_name=g.data.searchTxt:h.primary_columns&&h.primary_columns.length?(t.filters&&t.filters.length||(t.filters=[]),t.filters=JSON.parse(t.filters),t.filters.push({field:h.primary_columns[0],value:g.data.searchTxt,operator:"regex"}),t.filters=JSON.stringify(t.filters)):t.search=JSON.stringify(g.data.searchTxt)),g.data&&g.data.searchKey&&g.data.searchKey&&g.data.searchTxt&&(t.filters||JSON.parse(t.filters.length)||(t.filters=[]),t.filters=JSON.parse(t.filters),t.filters.push({field:g.data.searchKey,value:g.data.searchTxt,operator:"regex"}),t.filters=JSON.stringify(t.filters),delete t.search),s&&s.resolve(),s=n.defer(),"string"==typeof h.ajaxUrl?w.get(h.ajaxUrl,{params:t,timeout:s.promise}).then(function(e){e.data.paging.nextToken?(g.nextToken=e.data.paging.nextToken,e.data.paging.total<g.itemsPerPage?g.totalRecords=(g.page-1)*g.itemsPerPage+g.itemsPerPage+1:(g.totalRecords=(g.page-1)*g.itemsPerPage+g.itemsPerPage+1,g.totalRecords1="Many"),h.tokens||(h.tokens={}),h.tokens[g.page+1]=e.data.paging.nextToken,"1"===k.ms.store.shipkaro&&r.call("count",{entity:h.entity,query:t},function(e,t){g.totalRecords=t.data.total})):(h.tokens&&delete h.tokens,g.totalRecords=e.data.paging.total),v(e.data.data)},function(e){-1!=e.status&&(g.loading=!1,w.pendingRequests.length=0)}):(t.timeout=s.promise,h.ajaxUrl(t,function(e){g.totalRecords=e.paging.total,v(e.data)}).error(function(e){g.loading=!1,w.pendingRequests.length=0}))):v(g.originalData)}}}}]),mystoreModule.directive("ngCellNew",["$templateCache","$compile","$timeout",function(e,o,i){return{scope:!1,link:function(a,t){var s=a.col;function e(){var e=a.row[s.name],t=s.settings.formatter;(e=(t=!t&&mystore.formatters&&mystore.formatters[s.settings.edit_type]?mystore.formatters[s.settings.edit_type]:t)?(t=mystore.utils.parseFunction(t))(e,{rowData:a.row,row:a.row,col:s,scope:a}):e)&&"object"==typeof e&&e.then?e.then(function(e){a.formattedValue=e}):a.formattedValue=e}a.errors&&a.errors[a.row_id]&&a.errors[a.row_id][a.col.name]&&(a.style="color: red;"),e(),s.settings.cellTemplate||(s.settings.primary_columns?s.settings.cellTemplate='<div class="dt-primary-column" style="cursor: pointer;font-size: 13px;font-weight: bold; display: inline;" ng-style="style" ng-click="executeRowCommand(edit, row_id, row, $event)">{{formattedValue}}</span>':s.settings.passHtml?s.settings.cellTemplate="<div ng-bind-html-unsafe=\"formattedValue\" ng-style='style'></div>":"optionsvalue"==s.settings.edit_type?s.settings.cellTemplate='<div ng-style=\'style\' ng-model="formattedValue" ng-repeat="option in formattedValue" ><span><b> Label: </b>{{option.label}} ,</span><span><b> Value: </b>{{option.value}}</span></div>':"object"==s.settings.edit_type?s.settings.cellTemplate='<div ng-style=\'style\' ng-model="formattedValue" ng-repeat="(key,value) in formattedValue" ><span><b> {{key}}: </b>{{value}} <br></span></div>':s.settings.cellTemplate="<div ng-style='style'>{{formattedValue}}</div>"),s.settings.passHtml&&(s.settings.cellTemplate="<div ng-bind-html-unsafe='formattedValue' ng-style='style'></div>");var n='<div ng-hide="editing" >'+s.settings.cellTemplate+"</div>";s.settings.editable&&"collection"!=s.settings.edit_type&&(a.formOptions={fields:[s],data:a.row,inline:!0,enableMaterial:!0},n+='<div ng-show="editing" ng-style="style"><form ms-form="formOptions"></form></div>',s.settings.always_editable?a.editing=!0:t.bind("click",function(e){if(a.editing)return!1;$(".datatable-editing").triggerHandler("blur"),$(".CodeMirror").each(function(e,t){i(function(){t.CodeMirror.refresh()})}),a.editing=!0,a.$apply(),t.addClass("datatable-editing"),t.find(":input").focus(),e.stopPropagation()}).bind("blur",function(){a.editing=!1,e(),a.$apply(),t.removeClass("datatable-editing")})),t.append(o(n)(a))}}}]),mystoreModule.directive("ngSummaryCell",["$templateCache","$compile","$timeout","$filter","$rootScope",function(e,a,t,m,s){return{scope:!1,link:function(d,e){var l="",t=d.list_columns.filter(function(e){return mystore.utils.checkFieldVisibility(e,d.row)}),c={row:d.row,cols:t,col:{settings:{}},scope:d};d.struct&&d.struct.settings&&!d.struct.settings.edit_type&&(l='<a ng-href="entity/{{struct.name}}/{{row._id}}',d.struct.settings.view_enabled&&"1"==d.struct.settings.view_enabled?l+='/view">':l+='/edit">'),l=function(){if(o=d.struct.settings.summary_view){var e=(o=mystore.utils.parseFunction(o))(c);"object"==typeof e&&e.then?(e.then(function(e){d.formattedValue=e}),l="<div ng-bind-html-unsafe='formattedValue' ></div>"):c.col.settings.passHtml?l=e:(l+=e,d.struct&&d.struct.settings&&!d.struct.settings.edit_type&&(l+="</a>"))}else{if(d.struct.settings.primary_columns&&d.struct.settings.primary_columns.length){d.cols=d.struct.settings.primary_columns,l+="<h5>{{row[cols[0]]}}</h5>";for(var a=1,t=d.cols.length;a<t;a++)l+="<p>{{row[cols["+a+"]]}}</p>"}else for(var s,n,o,i,r=0,a=0,t=d.struct.fields.length;a<t;a++)if("metafields"==d.struct.fields[a].name&&(s=d.row[d.struct.fields[a].name]||{},n=!1,d.struct.fields[a].fields.forEach(function(e,t){s[e.name]&&(n||(l+="<b>Metafields</b>: ",n=!0),"string"!=e.data_type&&"number"!=e.data_type||(l+="&emsp;<small><b>"+m("ms_ucfirst")(e.name)+"</b> - {{row[struct.fields["+a+'].name]["'+e.name+'"]}}</small>'))})),!(2<=r)){if("file"==d.struct.fields[a].data_type)return i=d.row[d.struct.fields[a].name],(o=!(o=d.struct.fields[a].settings.formatter)&&mystore.formatters&&mystore.formatters[d.struct.fields[a].settings.edit_type]?mystore.formatters[d.struct.fields[a].settings.edit_type]:o)?(o=mystore.utils.parseFunction(o))(i,{rowData:d.row,row:d.row,col:d.struct.fields[a],scope:d}):i;"string"!=d.struct.fields[a].data_type&&"number"!=d.struct.fields[a].data_type||(!r&&d.row[d.struct.fields[a].name]?(++r,l+="<h5>{{row[struct.fields["+a+"].name]}}</h5>"):r&&d.row[d.struct.fields[a].name]&&(++r,l+="<p>{{row[struct.fields["+a+"].name]}}</p>"))}d.struct&&d.struct.settings&&!d.struct.settings.edit_type&&(l+="</a>")}return l}(),c.col.settings.passHtml?e.append(l):e.append(a(l)(d))}}}]),mystoreModule.directive("msDatatablePopupNew",["$compile","entitySvc","$stateParams",function(i,r,d){return{link:function(t,e,a){t.entityId=Math.floor(1e5*Math.random());var s=r.getEntity(d.entity),n=(t.addEntityData=function(e){s.create({data:e}).then(function(e){location.reload()},function(e){t.formOptions.error=e})},t.formOptions={fields:t.dtOptions.cols,template:"/templates/widgets/mform.default.html",id:t.entityId,submit:t.addEntityData,data:{}},i('<div class="modal fade" style="width: 100%;left: -100%;margin-left: 0px;top: 0;height: 100%;padding:20px;"><button type="button" class="close" data-dismiss="modal" style="position: absolute;right: 4%;top: 10px;font-size: 40px;" aria-hidden="true"><i class="icon-remove"></i></button><form ms-form="formOptions"></form><a class="btn" ms-submit="#{{entityId}}">{{"Save"|msT}}</a></div>')(t)),o=$(n).appendTo("body");e.bind("click",function(){o.css("left",0),o.modal("show")}),o.on("hidden",function(){o.css("left","-100%")})}}}]),mystoreModule.directive("msMaterialDatatablePopup",["$compile","entitySvc","$stateParams","$mdDialog","$mdMedia","app","$filter","$q","$rootScope",function(h,e,t,_,v,y,b,w,$){return{link:function(t,e,a){for(var s=(v("sm")||v("xs"))&&t.customFullscreen,n=(Math.floor(1e5*Math.random()),t.dtOptions.advance_search_fields),o=t.dtOptions.cols,u={},d=[],i=0,r=o.length;i<r;i++)u[o[i].name]=o[i];for(i=0,r=n.length;i<r;i++){var l,c,m=n[i];if(-1<m.indexOf(".")&&(m=(l=m.split("."))[1],c=l[0]),c&&u[c])for(var p=0,g=u[c].fields.length;p<g;p++)u[u[c].fields[p].name]=u[c].fields[p];u[m]&&(u[m].settings&&u[m].settings.label&&(m=u[m].settings.label),d.push({name:m,value:n[i]}))}var f=["$scope","$mdDialog","dtOptions","$rootScope","$timeout",function(c,t,e,a,m){c.dtOptions=e,c.dtOptions.exists=!1,c.fieldsData=d;e=mystore.utils.getObjectIndexFromArray(c.dtOptions.tabs,"tempTab",!0);if(-1<e)for(var s=c.dtOptions.tabs[e].filters,n=0,o=c.fieldsData.length;n<o;n++){c.fieldsData[n].disable&&delete c.fieldsData[n].disable;for(var i=0,r=s.length;i<r;i++)c.fieldsData[n].name==s[i].field&&(c.fieldsData[n].disable=!0)}c.init=!0,c.filters=-1<e?angular.copy(c.dtOptions.tabs[e].filters):[{field:"",operator:"eq"}],c.removeFilter=function(e){c.filters.splice(e,1)},c.addFilter=function(){c.filters.push({field:"",operator:"eq"})},c.selectNgChange=function(e,o){o.valueData=[],c.init?c.init=!1:(o.filter.value=null,o.selectedItem=null,delete o.filter.label),o.operators=[{name:"Equals",value:"eq"},{name:"Not Equal",value:"not_equal"}],m(function(){if(c.filters&&c.filters.length)for(var e=c.filters,t=0,a=c.fieldsData.length;t<a;t++){c.fieldsData[t].disable&&delete c.fieldsData[t].disable;for(var s=0,n=e.length;s<n;s++)c.fieldsData[t].name==e[s].field&&(c.fieldsData[t].disable=!0)}});function i(t){return function(e){return 0===e.value.indexOf(t)}}var s,r="",n={},d=!0,t=(o.querySearch=function(e,t){var a=w.defer();return d||!e?(d=!1,a.resolve(o.valueData)):s(e,function(e){a.resolve(e)},!1,n),a.promise},o.searchTextChange=function(e){},o.selectedItemChange=function(e){e&&(o.filter.value=e[o.keyCol],o.filter.label=e[o.valueCol])},{}),l=o.filter.field;if(-1<l.indexOf(".")&&(l=(l=l.split("."))[1])[0],u[l])switch(u[l].data_type){case"string":switch(u[l].settings.edit_type){case"select":switch(o.template=h('<md-autocomplete required md-search-text-change="searchTextChange(searchText)"  ng-disabled="isDisabled" md-no-cache="noCache" md-selected-item="selectedItem" md-search-text="searchText" md-selected-item-change="selectedItemChange(item)" md-items="item in querySearch(searchText)" md-item-text="item[valueCol]" md-min-length="0"><md-item-template><span md-highlight-text="searchText" md-highlight-flags="^i">{{item[valueCol]}}</span></md-item-template><md-not-found><span ng-if="searchText">No records matching "{{searchText}}" were found.</span><span ng-if="!searchText">Enter to search</span></md-not-found><div data-ng-if="filter.error && filter.error.value"><div ng-message="required">This field is required</div></div></md-autocomplete>')(o),t=u[l].settings,o.simulateQuery=!1,o.isDisabled=!1,r=Math.floor(1e5*Math.random()),u[l].settings.source){case"entity":o.keyCol=t.source_entity.key_column||"_id",o.valueCol=t.source_entity.value_column||"name",n={entity:t.source_entity.entity,filters:t.source_entity.filters,keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,a,t,s){var n={version:1,entity:s.entity,id:r,cancel:!0,query:{filters:s.filters,fields:{},limit:20}};t||(n.query.filters=[{field:s.valueCol,value:e,operator:"regex"}],n.query.filters=JSON.stringify(n.query.filters)),n.query.fields[s.keyCol]=1,n.query.fields[s.valueCol]=1,y.list(n,function(e,t){e?console.log("Error occured ",e):t&&t.data&&t.data.data&&t.data.data.length?a(t.data.data):a([])})};break;case"options":o.keyCol="value",o.valueCol="name",n={keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,t,a,s){if(!a)return t(u[l].settings.options.filter(i(e)));t(u[l].settings.options)};break;case"function":o.keyCol=t.source_entity.key_column||"_id",o.valueCol=t.source_entity.value_column||"name",n={source_function:t.settings.source_function,keyCol:o.keyCol,valueCol:o.valueCol},s=function(t,a,s,e){var n=mystore.utils.parseFunction(sourceFunction);n?n.call(null,{scope:o}).then(function(e){if(!s)return a(e.filter(i(t)));a(e)},function(e){console.log("ERROR: Source function failed while retrieving data"),a([])}):console.log("ERROR: sourceFunction not defined")}}s(null,function(e){for(var t=0,a=e.length;t<a;t++){var s={};s[o.keyCol]=e[t][o.keyCol],s[o.valueCol]=e[t][o.valueCol],o.valueData.push(s),o.filter.value&&o.filter.value==s[o.keyCol]&&(o.selectedItem=s)}},!0,n);break;case"autocomplete":switch(o.template=h('<md-autocomplete required ng-disabled="isDisabled" md-no-cache="noCache" md-selected-item="selectedItem" md-search-text="searchText" md-selected-item-change="selectedItemChange(item)" md-items="item in querySearch(searchText)" md-item-text="item[valueCol]" md-min-length="0"><md-item-template><span md-highlight-text="searchText" md-highlight-flags="^i">{{item[valueCol]}}</span></md-item-template><md-not-found><span ng-if="searchText">No records matching "{{searchText}}" were found.</span><span ng-if="!searchText">Enter to search</span></md-not-found></md-autocomplete><div data-ng-if="filter.error && filter.error.value" style="color:rgb(221, 44, 0)"><div ng-message="required">This field is required</div></div>')(o),t=u[l].settings,o.keyCol=t.value_field||"_id",o.valueCol=t.label_field||"name",o.simulateQuery=!1,o.isDisabled=!1,r=Math.floor(1e5*Math.random()),u[l].settings.source){case"options":o.keyCol="value",o.valueCol="name",n={keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,t,a,s){if(!a)return t(u[l].settings.options.filter(i(e)));t(u[l].settings.options)};break;case"function":o.keyCol="value",o.valueCol="name",n={source_function:t.source_function,keyCol:o.keyCol,valueCol:o.valueCol},s=function(t,a,s,e){e=mystore.utils.parseFunction(e.source_function);e?e.call(null,{scope:o}).then(function(e){if(!s)return a(e.filter(i(t)));a(e)},function(e){console.log("ERROR: Source function failed while retrieving data"),a([])}):console.log("ERROR: sourceFunction not defined")};break;default:o.keyCol=t.value_field||(t.source_entity&&t.source_entity.key_column?t.source_entity.key_column:"_id"),o.valueCol=t.label_field||(t.source_entity&&t.source_entity.value_column?t.source_entity.value_column:"name"),n={entity:t.entity,filters:[],keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,a,t,s){var n={version:1,entity:s.entity,id:r,cancel:!0,query:{filters:s.filters,fields:{},limit:20}};t||(n.query.filters=[{field:s.valueCol,value:e,operator:"regex"}],n.query.filters=JSON.stringify(n.query.filters)),n.query.fields[s.keyCol]=1,n.query.fields[s.valueCol]=1,y.list(n,function(e,t){e?console.log("Error occured ",e):t&&t.data&&t.data.data&&t.data.data.length?a(t.data.data):a([])})}}s(null,function(e){for(var t=0,a=e.length;t<a;t++){var s={};s[o.keyCol]=e[t][o.keyCol],s[o.valueCol]=e[t][o.valueCol],o.valueData.push(s),o.filter.value&&o.filter.value==s[o.keyCol]&&(o.selectedItem=s)}},!0,n);break;default:c.dtOptions.disable_search||o.operators.push({name:"Contains",value:"regex"}),o.template=h('<md-input-container class="md-block ms-mb-0 ms-mt-0" flex-gt-sm>                                            <input required ng-model="filter.value">                                            <div data-ng-if="filter.error && filter.error.value">                                                <div ng-message="required">This is required.</div>                                            </div>                                            </md-input-container>')(o)}break;case"integer":case"number":if("select"===u[l].settings.edit_type){switch(o.template=h('<md-autocomplete required md-search-text-change="searchTextChange(searchText)"  ng-disabled="isDisabled" md-no-cache="noCache" md-selected-item="selectedItem" md-search-text="searchText" md-selected-item-change="selectedItemChange(item)" md-items="item in querySearch(searchText)" md-item-text="item[valueCol]" md-min-length="0"><md-item-template><span md-highlight-text="searchText" md-highlight-flags="^i">{{item[valueCol]}}</span></md-item-template><md-not-found><span ng-if="searchText">No records matching "{{searchText}}" were found.</span><span ng-if="!searchText">Enter to search</span></md-not-found><div data-ng-if="filter.error && filter.error.value"><div ng-message="required">This field is required</div></div></md-autocomplete>')(o),t=u[l].settings,o.simulateQuery=!1,o.isDisabled=!1,r=Math.floor(1e5*Math.random()),u[l].settings.source){case"options":o.keyCol="value",o.valueCol="name",n={keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,t,a,s){if(!a)return t(u[l].settings.options.filter(i(e)));t(u[l].settings.options)};break;case"function":o.keyCol="value",o.valueCol="name",n={source_function:t.source_function,keyCol:o.keyCol,valueCol:o.valueCol},s=function(t,a,s,e){e=mystore.utils.parseFunction(e.source_function);e?e.call(null,{scope:o}).then(function(e){if(!s)return a(e.filter(i(t)));a(e)},function(e){console.log("ERROR: Source function failed while retrieving data"),a([])}):console.log("ERROR: sourceFunction not defined")};break;default:o.keyCol=t.source_entity.key_column||"_id",o.valueCol=t.source_entity.value_column||"name",n={entity:t.source_entity.entity,filters:t.source_entity.filters,keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,a,t,s){var n={version:1,entity:s.entity,id:r,cancel:!0,query:{filters:s.filters,fields:{},limit:20}};t||(n.query.filters=[{field:s.valueCol,value:e,operator:"regex"}],n.query.filters=JSON.stringify(n.query.filters)),n.query.fields[s.keyCol]=1,n.query.fields[s.valueCol]=1,y.list(n,function(e,t){e?console.log("Error occured ",e):t&&t.data&&t.data.data&&t.data.data.length?a(t.data.data):a([])})}}s(null,function(e){for(var t=0,a=e.length;t<a;t++){var s={};s[o.keyCol]=e[t][o.keyCol],s[o.valueCol]=e[t][o.valueCol],o.valueData.push(s),o.filter.value&&o.filter.value==s[o.keyCol]&&(o.selectedItem=s)}},!0,n)}else o.operators.push({name:"Greater than",value:"greater_than"},{name:"Less than",value:"less_than"},{name:"Less than or Equal",value:"less_than_or_equal"},{name:"Greater than or Equal",value:"greater_than_or_equal"}),o.template=h('<md-input-container class="md-block ms-mb-0 ms-mt-0" flex-gt-sm>                                            <input required ng-model="filter.value">                                            <div data-ng-if="filter.error && filter.error.value">                                                <div ng-message="required">This is required.</div>                                            </div>                                            </md-input-container>')(o);break;case"array":switch(u[l].settings.edit_type){case"multiselect":case"multiautocomplete":case"category":o.filter.value||(o.filter._metadata=[],o.filter.value=[]),o.operators=[{name:"Has",value:"in"},{name:"Not Have",value:"nin"}],o.filter.operator="in",o.selectedItemChange=function(e){if(e)return e[o.keyCol]},o.transformChip=function(e){if(e)return e.label=e[o.valueCol],e.keyCol=o.keyCol,e};switch(o.template=h('<md-chips ng-model="filter._metadata" md-transform-chip="transformChip($chip)"                                            md-autocomplete-snap md-require-match="true">                                                            <md-autocomplete md-search-text-change="searchTextChange(searchText)"  ng-disabled="isDisabled" md-no-cache="noCache" md-selected-item="selectedItem"                                                             md-search-text="searchText" md-selected-item-change="selectedItemChange(item)"                                                             md-items="item in querySearch(searchText)" md-item-text="item[valueCol]" md-min-length="0">                                                            <md-item-template>                                                            <span md-highlight-text="searchText" md-highlight-flags="^i">{{item[valueCol]}}</span>                                                            </md-item-template>                                                            <md-not-found>                                                            <span ng-if="searchText">No records matching "{{searchText}}" were found.</span>                                                            <span ng-if="!searchText">Enter to search</span>                                                            </md-not-found>                                                            </md-autocomplete>                                                            <md-chip-template>                                                            <span>                                                            {{$chip.label}}                                                            </span>                                                            </md-chip-template>                                                            </md-chips>')(o),t=u[l].settings,u[l].settings.source){case"entity":o.keyCol=t.source_entity.key_column||"_id",o.valueCol=t.source_entity.value_column||"name",o.simulateQuery=!1,o.isDisabled=!1,r=Math.floor(1e5*Math.random()),n={entity:t.source_entity.entity,filters:t.source_entity.filters,keyCol:o.keyCol,valueCol:o.valueCol},s=function(e,a,t,s){var n={version:1,entity:s.entity,id:r,cancel:!0,query:{filters:s.filters,fields:{},limit:20}};t||(n.query.filters=[{field:s.valueCol,value:e,operator:"regex"}],n.query.filters=JSON.stringify(n.query.filters)),n.query.fields[s.keyCol]=1,n.query.fields[s.valueCol]=1,y.list(n,function(e,t){e?console.log("Error occured ",e):t&&t.data&&t.data.data&&t.data.data.length?a(t.data.data):a([])})};break;case"options":o.keyCol="value",o.valueCol="name",s=function(e,t,a,s){if(!a)return t(u[l].settings.options.filter(i(e)));t(u[l].settings.options)}}s(null,function(e){for(var t=0,a=e.length;t<a;t++){var s={};s[o.keyCol]=e[t][o.keyCol],s[o.valueCol]=e[t][o.valueCol],o.valueData.push(s)}},!0,n)}break;case"datetime":o.filter.operator="greater_than_or_equal",o.operators=[{name:"Greater than",value:"greater_than"},{name:"Less than",value:"less_than"},{name:"Less than or Equal",value:"less_than_or_equal"},{name:"Greater than or Equal",value:"greater_than_or_equal"}],o.template=h('<md-input-container class="md-block ms-mb-0 ms-mt-0" flex-gt-sm>                                            <input aria-label="Datetime" mdc-datetime-picker date="true" time="true" type="text" id="datetime"                                            show-todays-date="" ng-model="filter.value">                                        </md-input-container>')(o);break;default:c.dtOptions.disable_search||o.operators.push({name:"Contains",value:"regex"}),o.template=h('<md-input-container class="md-block ms-mb-0 ms-mt-0" flex-gt-sm required>                                            <input ng-model="filter.value">                                            <div data-ng-if="filter.error && filter.error.value">                                                <div ng-message="required">This is required.</div>                                            </div>                                            </md-input-container>')(o)}};c.submit=function(){if(!function(e){for(var t,a,s,n=1,o=0,i=e.length;o<i;o++){if(delete e[o].error,e[o].field||(n=0,e[o].error||(e[o].error={}),e[o].error.field=!0),e[o].value||null===e[o].value||0===e[o].value||(n=0,e[o].error||(e[o].error={}),e[o].error.value=!0),e[o].error||"[object Date]"!==Object.prototype.toString.call(e[o].value)||(e[o].label=b("date")(e[o].value,"medium")),!e[o].error&&Array.isArray(e[o].value)){for(var r=[],d=e[l=0]._metadata.length;l<d;l++)e[o]._metadata[l].keyCol&&r.push(e[o]._metadata[l][e[o]._metadata[l].keyCol]);e[o].value=r}if(-1<e[o].field.indexOf(".")&&(a=(t=e[o].field.split("."))[1],s=t[0]),s&&u[s]){for(var l=0,c=u[s].fields.length;l<c;l++)if(u[s].fields[l].name==a){u[s].fields[l].settings&&u[s].fields[l].settings.label&&(e[o].flabel=u[s].settings.label);break}}else u[e[o].field].settings&&u[e[o].field].settings.label&&(e[o].flabel=u[e[o].field].settings.label)}return n}(c.filters))return!1;var e=mystore.utils.getObjectIndexFromArray(c.dtOptions.tabs,"tempTab",!0);-1<e?(c.dtOptions.tabs[e].filters=c.filters,c.dtOptions.selectedTabIndex==c.dtOptions.tabs.length-1?a.ms.tables[c.dtOptions.name].filter(c.dtOptions.tabs[e].filters,c.dtOptions.tabs[e].filter_operator,c.dtOptions.tabs[e]):c.dtOptions.selectedTabIndex=c.dtOptions.tabs.length-1):(c.dtOptions.tabs.push({name:"Custom Search",filters:c.filters,custom:!0,tempTab:!0}),c.dtOptions.selectedTabIndex=c.dtOptions.tabs.length-1),t.cancel()},c.cancel=function(){t.cancel()}}];t.$watch(function(){return v("xs")||v("sm")},function(e){t.customFullscreen=!0===e}),e.bind("click",function(e){e=e,_.show({controller:f,templateUrl:"/templates/widgets/advanceFiltersModal.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:s,locals:{dtOptions:t.dtOptions,$rootScope:$}}).then(function(e){},function(){})})}}}])),ms.localStorage.cart&&ms.localStorage.removeItem("cart");var settings=ms.settings,parseQuantity=function(e){return"number"!=typeof e?parseFloat(parseFloat(e).toFixed(2)):e},CartItem=function(){var n=this;return n._id=null,n.name=null,n.product_id=null,n.thumbnail_url=null,n.image_url=null,n.quantity=0,n.selected_options={},n.variant_id=null,n.vendor=null,n.product={},n.price=0,n.discounts_total=0,n.discount_total=0,n.discounts_percentage=0,n.taxes=[],n.taxes_total=0,n.total=0,n.updateQuantity=function(e,a){var s=0;"inc"!=e&&"+"!=e||(s=parseQuantity(n.quantity)+1),"dec"!=e&&"-"!=e||(s=n.quantity-1),"equal"!=e&&"="!=e||(s=n.quantity),ms.cart.locked||(ms.cart.locked=!0,ms.cart.addMask(),(e=n.toDatabase()).quantity=s,e.linked_product_id=e.linked_product_id||null,e={entity:"ms.carts",type:"put",data:e,query:{q:{_id:ms.cart._id}}},ms.app.call("updateQuantity",e,function(e,t){ms.cart.locked=!1,ms.cart.removeMask(),e?a&&a(e):(e=t.data.cart&&t.data.cart.items&&t.data.cart.items.filter(function(e){return e._id==n._id})[0],ms.trigger("ms.cart_item_quantity_updated",{old_item:n.toDatabase(),new_item:e,input_quantity:s}),ms.cart.updateCart(t.data.cart),a&&a(null,t.data.cart))}))},n.updateQuantityBulk=function(e,a){var t;ms.cart.locked||(ms.cart.locked=!0,ms.cart.addMask(),(t=n.toDatabase()).quantity=e,t.linked_product_id=t.linked_product_id||null,e={entity:"ms.carts",type:"put",data:t,query:{q:{_id:ms.cart._id}}},ms.app.call("updateQuantity",e,function(e,t){ms.cart.locked=!1,ms.cart.removeMask(),e?a&&a(e):(ms.cart.updateCart(t.data.cart),a&&a(null,t.data.cart))}))},n.toDatabase=function(){var e={};return e._id=n._id,e.name=n.name,e.product_id=n.product_id,e.quantity=n.quantity,e.selected_options=n.selected_options,e.variant_id=n.variant_id,e.linked_product_id=n.linked_product_id,e.vendor=n.vendor,e.product=n.product,e.price=n.price,e.discounts_total=n.discounts_total,e.discounts_percentage=n.discounts_percentage,e.taxes=n.taxes,e.taxes_total=n.taxes_total,e.total=n.total,e.thumbnail_url=n.thumbnail_url,e.image_url=n.image_url,"1"==ms.settings.enable_product_bundling&&n.product&&n.product.bundle_items&&n.product.bundle_items.length&&(e.bundle_items=n.product.bundle_items,e.is_bundle=!0),n.is_bundle_item&&(e.is_bundle_item=n.is_bundle_item),n.parent_bundle_item&&(e.parent_bundle_item=n.parent_bundle_item),e},n.fromDatabase=function(e){for(var t in e)n[t]=e[t]},n.update_quantity=function(e,t){n.updateQuantity(e,t)},n.update_quantity_bulk=function(e,t){n.updateQuantityBulk(e,t)},n},Cart=function(){function e(t,n){return new Promise(function(a,s){var e={entity:"ms.carts",type:"put",data:{_id:t,user_id:ms.user._id}};!n&&ms.user.isLoggedIn&&ms.substore&&ms.substore._id&&ms.user.substore_carts&&ms.user.substore_carts[ms.substore._id]&&ms.settings&&ms.settings.substore_based_cart&&(t=ms.user.substore_carts[ms.substore._id],e.data._id=ms.user.substore_carts[ms.substore._id]),r.locked=!0,r.addMask(),ms.app.call("getUserCart",e,function(e,t){r.locked=!1,r.removeMask(),t&&t.data&&t.data.cart?(r.updateCart(t.data.cart),a(t.data.cart)):s(e)})})}function t(t,e){return new Promise(function(a,s){var e={entity:"ms.carts",type:"get",recordId:t};r.locked=!0,r.addMask(),ms.app.get(e,function(e,t){r.locked=!1,r.removeMask(),t&&t.data&&t.data.cart?(r.updateCart(t.data.cart),a(t.data.cart)):s(e)})})}var r=this;r._id=null,r.additional_charges=[],r.available_payment_methods=[],r.available_options=[],r.available_shipping_methods=[],r.billing_address={},r.client_details={},r.currency={},r.currency_code=null,r.currency_rate=null,r.discounts=[],r.discount_total=0,r.discounts_total=0,r.ecoupon={},r.coupon_code=null,r.email_id=null,r.gift_cards=[],r.gift_card_total=0,r.item_count=0,r.items=[],r.user_language=null,r.metafields={},r.options={},r.order_id=null,r.sub_total=0,r.total=0,r.payment_method={},r.prices_are="inclusive",r.shipping_address={},r.shipping_method={},r.shipping_method_name=null,r.status="pending",r.shipping_total=0,r.taxes_total=0,r.total_weight=0,r.user_id=null,r.version="ms.0.3.0",r.valid_email_id=!1,r.valid_user=!1,r.valid_shipping_address=!1,r.valid_billing_address=!1,r.valid_shipping_method=!1,r.valid_payment_method=!1,r.options_updated=!1,r.show_billing=!0,r.guestUser=!1,r.locked=!1;r.reload=function(){return new Promise(function(e){return r._id?t(r._id).then(e):reject("Cart id not present")})},r.addMask=function(){var e=document.createElement("div");e.id="_loading",document.body.appendChild(e),ms_theme.templates&&ms_theme.templates["/templates/widgets/loading.html"]?(e=ms_theme.templates["/templates/widgets/loading.html"],$("#_loading").append(e)):$("#_loading")&&$("#_loading").length&&$("#_loading").append(' <div style="position: fixed;top: 0;right: 0;bottom: 0;left: 0;z-index: 29; background: rgba(0, 0, 0, 0.1);"><h4 style="position: absolute; left: 50%;margin-top: 25%;display: inline-block;"><i class="icon icon-spinner icon-spin icon-5x "> </i></h4></div>')},r.removeMask=function(){var e;$("#_loading")&&$("#_loading").length&&(e=document.getElementById("_loading")).parentNode.removeChild(e)},r.isUserRegistered=function(e,a){"string"==typeof e&&e.includes("@")&&(e={email:e}),ms.app.call("isUserRegistered",{entity:"ms.users",data:e},function(e,t){e||!t.data?a(!1):a(!0)})},r.fromDatabase=function(e){if(e.version&&"ms.0.2.0"==e.version){Object.assign(r,e);for(var t=r.items.splice(0,r.items.length),a=0;a<t.length;a++){var s=t[a],n=new CartItem;n.fromDatabase(s),r.items.push(n)}}else r.empty_cart();return r},r.emptyCart=function(){r._id=null,r.additional_charges=[],r.available_payment_methods=[],r.available_options=[],r.available_shipping_methods=[],r.billing_address={},r.client_details={},r.currency={},r.currency_code=null,r.currency_rate=null,r.coupon_code=null,r.discounts=[],r.discount_total=0,r.ecoupon={},r.email=null,r.email_id=null,r.gift_cards=[],r.gift_card_total=0,r.item_count=0,r.items=[],r.user_language=null,r.metafields={},r.options={},r.order_id=null,r.sub_total=0,r.total=0,r.payment_method={},r.shipping_address={},r.shipping_method=null,r.shipping_method_name=null,r.status="pending",r.shipping_total=0,r.prices_are="inclusive",r.taxes_total=0,r.total_weight=0,r.user_id=null,ms.trigger("ms.cart_updated")},r.updateCart=function(e){for(var t in e)r[t]=e[t];for(var a=r.items.splice(0,r.items.length),s={},n=0;n<a.length;n++){var o=a[n],i=new CartItem;i.fromDatabase(o),r.items.push(i),s[i.sku]=i.quantity}r.count_by_sku=s,ms.trigger("ms.cart_updated"),ms.localStorage.setItem("cart_id",JSON.stringify({_id:e._id}))},r.saveOptions=function(e,a){r.locked||(e={entity:"ms.carts",command:"saveOptions",recordId:r._id,data:{fields:e}},ms.app.call(e,function(e,t){e?(r.locked=!1,a&&a(e)):(r.options_updated=!1,r.locked=!1,r.updateCart(t.data.cart),a&&a(null,t.data.cart))}))},r.addItem=function(n,e,a){if(!r.locked){var s=1;if(!(s=isNaN(e)?s:e))return a&&a({message:"Invalid Quantity"},null),ms.broadcast("ms.msg.invalid_quantity",{level:"warning"}),!1;s=parseQuantity(s),n.selected_options||(n.selected_options={});var t=!1,o={},e=(r.items.forEach(function(e){e.product_id==n._id&&e.variant_id==n.variant_id&&e.linked_product_id==n.linked_product_id&&(t=!0,o=e)}),!t||(e=Object.keys(n.selected_options)).length&&e.forEach(function(s){var e,t=n.selected_options[s];t&&"object"==typeof t&&!Array.isArray(t)?t.uploadType&&"tmp"==t.uploadType&&(e=Object.keys(o.selected_options)).length&&e.forEach(function(e){o.selected_options[e]&&"object"==typeof o.selected_options[e]&&!Array.isArray(o.selected_options[e])&&o.selected_options[e].path==t.path&&(n.selected_options[s]=o.selected_options[e])}):ms.settings&&ms.settings.enable_option_price&&t&&Array.isArray(t)&&(e=Object.keys(o.selected_options)).length&&e.forEach(function(e){var t,a;o.selected_options[e]&&Array.isArray(o.selected_options[e])&&(t=n.selected_options[s].sort(),a=o.selected_options[e].sort(),t.join()==a.join()&&(n.selected_options[s]=o.selected_options[e]))})}),r.locked=!0,{entity:"ms.carts",recordId:r._id,type:"put",data:{product_id:n._id,seller_id:n.seller,selected_options:n.selected_options,variant_id:n.selected_variant&&n.selected_variant.variant_id?n.selected_variant.variant_id:null,quantity:s,linked_product_id:n.linked_product_id||null,sku:n.sku},query:{q:{_id:r._id}}});ms.settings&&ms.settings.fix_multiple_abandoned_cart&&(e.recordId=ms.user&&ms.user.isLoggedIn&&ms.user.cart_id?ms.user.cart_id:r._id,e.query.q={_id:ms.user&&ms.user.isLoggedIn&&ms.user.cart_id?ms.user.cart_id:r._id}),ms.user&&ms.user.isLoggedIn&&ms.substore&&ms.substore._id&&ms.user.substore_carts&&ms.user.substore_carts[ms.substore._id]&&ms.settings&&ms.settings.substore_based_cart&&(e.recordId=ms.user.substore_carts[ms.substore._id],r._id=ms.user.substore_carts[ms.substore._id],e.query.q={_id:e.recordId}),n.metafields&&"1"==n.metafields.allow_custom_pricing&&(e.data.price=n.price),"1"==ms.settings.enable_product_bundling&&n.bundle_items&&n.bundle_items.length&&(e.data.bundle_items=n.bundle_items),ms.app.call("addItem",e,function(e,t){r.removeMask(),e?(r.locked=!1,a&&a(e)):(ms.trigger("ms.cart_item_added",{new_item:t.data.product,input_quantity:s}),r.updateCart(t.data.cart),r.locked=!1,a&&a(null,t.data.cart))})}},r.addMultiItems=function(e,a){ms.settings;r.locked||(r.locked=!0,e={entity:"ms.carts",type:"put",data:{items:e},query:{q:{_id:r._id}}},ms.app.call("addItems",e,function(e,t){r.removeMask(),e?(r.locked=!1,a&&a(e)):(r.updateCart(t.data.cart),r.locked=!1,a&&a(null,t.data.cart))}))},r.removeItem=function(e,t,a,s){var n,o;r.locked||(r.locked=!0,n={entity:"ms.carts",type:"put",data:{_id:e._id},query:{q:{_id:r._id}}},s&&s.length&&(n.data.items=s),"1"==ms.settings.enable_product_bundling&&e.product&&e.product.bundle_items&&e.product.bundle_items.length&&(n.data.bundle_items=e.product.bundle_items),r.addMask(),o=e.toDatabase(),ms.app.call("removeItem",n,function(e,t){r.removeMask(),e?(r.locked=!1,a&&a(e)):(ms.trigger("ms.cart_item_removed",{old_item:o}),r.updateCart(t.data.cart),r.locked=!1,a&&a(null,t.data.cart))}))},r.applyCoupon=function(e,a){return e?r.items.length?void(r.locked||(r.locked=!0,e={entity:"ms.carts",type:"put",data:{coupon_code:e},query:{q:{_id:r._id}}},r.addMask(),ms.app.call("applyCoupon",e,function(e,t){r.removeMask(),e?(r.locked=!1,ms.trigger("ms.coupon_rejected"),a&&a(e)):(r.updateCart(t.data.cart),ms.trigger("ms.coupon_applied"),r.locked=!1,a&&a(null,t.data.cart))}))):(ms.broadcast("ms.msg.empty_cart_operation",{level:"error"}),a&&a({message:"Invalid operation on empty cart"}),!1):(ms.broadcast("ms.msg.coupon_rejected",{level:"warning"}),a&&a({message:"Invalid code"}),!1)},r.removeCoupon=function(a){var e;r.ecoupon.code?r.locked||(r.locked=!0,e={entity:"ms.carts",type:"put",query:{q:{_id:r._id}}},r.addMask(),ms.app.call("removeCoupon",e,function(e,t){r.removeMask(),r.locked=!1,e?a&&a(e):(r.updateCart(t.data.cart),ms.trigger("ms.coupon_removed"),a&&a(null,t.data.cart))})):ms.broadcast("ms.msg.removeCoupon")},r.updateUser=function(e,a){e={entity:"ms.carts",type:"put",data:e,query:{q:{_id:r._id}}};r.addMask(),ms.app.call("updateUser",e,function(e,t){r.removeMask(),e?(r.locked=!1,a&&a(e)):(r.updateCart(t.data.cart),r.locked=!1,a&&a(null,t.data.cart))})},r.updateAddresses=function(a,s){var e={entity:"ms.carts",recordId:r._id,type:"put",data:a,query:{q:{_id:r._id}}};r.addMask(),ms.app.call("updateAddresses",e,function(e,t){r.removeMask(),e?(r.locked=!1,s&&s(e)):(r.updateCart(t.data.cart),r.locked=!1,ms.trigger("ms.cart.address_updated",a),s&&s(null,t.data.cart))})},r.updateShippingMethod=function(e,a){e={entity:"ms.carts",type:"put",data:e="string"==typeof e?{shipping_method:e}:e,query:{q:{_id:r._id}}};r.addMask(),ms.app.call("updateShippingMethod",e,function(e,t){r.removeMask(),e?(r.locked=!1,a&&a(e)):(r.updateCart(t.data.cart),r.locked=!1,a&&a(null,t.data.cart))})},r.updatePaymentMethod=function(e,a){if(!e&&!r._id)return!1;var t=null,s=("payment_gateways"==e.type&&(t=e.settings.gateway&&""!=e.settings.gateway?e.settings.gateway:e.settings.gateways.length?e.settings.gateways[0].gateway:"dummyPayu"),r.addMask(),{entity:"ms.carts",type:"put",data:{payment_method:{_id:e._id,settings:{gateway:t}}},query:{q:{_id:r._id}}});ms.app.call("updatePaymentMethod",s,function(e,t){r.removeMask(),e?(e.data&&e.data.cart&&r.updateCart(e.data.cart),r.locked=!1,a&&a(e)):(ms.trigger("ms.cart.payment_method_updated",s.data),r.updateCart(t.data.cart),r.locked=!1,a&&a(null,t.data.cart))})},r.applyWalletDiscount=function(e,t){e&&t&&r._id&&(r.addMask(),e={entity:"ms.carts",type:"put",data:{wallet:e,amount:t},query:{q:{_id:r._id}}},ms.app.call("applyWalletDiscount",e,function(e,t){r.removeMask(),e||r.updateCart(t.data.cart),r.locked=!1}))},r.removeWalletDiscount=function(e){e&&r._id&&(r.addMask(),e={entity:"ms.carts",type:"put",data:{wallet:e},query:{q:{_id:r._id}}},ms.app.call("removeWalletDiscount",e,function(e,t){r.removeMask(),e||r.updateCart(t.data.cart),r.locked=!1}))},r.updatePaymentGateway=function(e,t){r.updatePaymentMethod(r.payment_method,t)},r.checkOptions=function(){return new Promise(function(a,s){return r.available_options&&r.available_options.length&&r.options?(console.log("Saving options"),void r.saveOptions(r.options,function(e,t){if(e)return s("Failed to save options. Error:"+e.message);a()})):a()})},r.placeOrder1=function(t){r.checkOptions().then(function(){r.locked||(r.valid_payment_method||(ms.broadcast("ms.msg.empty_payment_details",{level:"warning"}),t&&t({message:"payment method not selected"})),r.add_mask(),r.locked=!0,ms.app.callAsync({entity:"ms.carts",command:"placeOrder",recordId:r.id,query:{q:{_id:r._id}},data:{client_details:{}}}).then(function(e){e=(e.data&&e.data.data||e.data).gatewayInfo;"form"==e.type&&(r.order_id=e.order_id,"GET"==e.action||"REDIRECT"==e.action?get_to_url(e.url,e.data,"GET"):"FUNCTION"==e.action?(r.locked=!1,r.removeMask(),executeFunction(e.execute_function,e.url,e.data)):"POST"==e.action&&post_to_url(e.url,e.data,"POST"))}).catch(function(e){r.removeMask(),r.locked=!1,e.data&&e.data.cart&&r.updateCart(e.data.cart),console.log("Error occurred in createOrder command",e),t&&t(e)}))})},r.placeOrder=function(n){if("vuejs"==ms.theme.js_framework)return this.placeOrder1(n);var e=JSON.parse(JSON.stringify(arguments));if(!r.locked){r.payment_method.type&&-1!=["cash_on_delivery","offline","payment_gateways"].indexOf(r.payment_method.type)||(ms.broadcast("ms.msg.empty_payment_details",{level:"warning"}),n&&n({message:"payment method not selected"})),r.add_mask();var o=!(r.locked=!0),t=findUserAgent();if(e[1]&&e[1].iFrame){o=!0;if("APP"!=t)return e="appCodeName="+navigator.appCodeName+"&appName="+navigator.appName+"&appVersion="+navigator.appVersion+"&platform="+navigator.platform+"&cookieEnabled="+navigator.cookieEnabled+"&languages="+navigator.languages+"&device="+findUserAgent(),void window.open("/iFramePayment/"+r._id+"?"+e,"mywindow","menubar=1,resizable=1,width=500,height=500")}t={entity:"ms.carts",customCommandName:"",recordId:r._id,type:"put",data:{client_details:{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,languages:navigator.languages,device:findUserAgent()}},query:{q:{_id:r._id}}};r.userInput&&(t.data.userInput=r.userInput),ms.app.call("placeOrder",t,function(e,t){var a,s;e?(r.removeMask(),r.locked=!1,e.data&&e.data.cart&&r.updateCart(e.data.cart),console.log("Error occurred in createOrder command",e),n&&n(e)):(e=t.data.gatewayInfo,t=t.data.handler,a=findUserAgent(),s=!1,(s=ms.store&&"tabdeal"==ms.store.name&&"APP"==a&&r.payment_method&&r.payment_method.settings&&"tap"==r.payment_method.settings.gateway?1:s)||ms._newMobileApp||"APP"!=a||"form"!=e.type||"FUNCTION"==e.action?"form"==e.type&&(r.order_id=e.order_id,"GET"==e.action||"REDIRECT"==e.action?get_to_url(e.url,e.data,"GET"):"FUNCTION"==e.action?(r.locked=!1,r.removeMask(),executeFunction(e.execute_function,e.url,e.data)):"POST"==e.action&&post_to_url(e.url,e.data,"POST")):(s=buildUrl(window.location.protocol+"//"+window.location.host+"/ms/pages/processPayment",{q:{_id:r._id,url:e.url,action:e.action}}),ms.cordova?(r.removeMask(),ms.cordova.InAppBrowser.open(s,"_blank","location=no,toolbar=no",{handler:t,iFrame:o})):mystore.utils.logError("CRITICAL: Very old flow of mobile app triggered in place Order (1)")))})}},r.placeOrderApplepay=function(a){var e=JSON.parse(JSON.stringify(arguments));if(!r.locked){r.payment_method.type&&-1!=["cash_on_delivery","offline","payment_gateways"].indexOf(r.payment_method.type)||(ms.broadcast("ms.msg.empty_payment_details",{level:"warning"}),a&&a({message:"payment method not selected"})),r.add_mask();r.locked=!0;var t=findUserAgent();if(e[1]&&e[1].iFrame)if("APP"!=t)return e="appCodeName="+navigator.appCodeName+"&appName="+navigator.appName+"&appVersion="+navigator.appVersion+"&platform="+navigator.platform+"&cookieEnabled="+navigator.cookieEnabled+"&languages="+navigator.languages+"&device="+findUserAgent(),void window.open("/iFramePayment/"+r._id+"?"+e,"mywindow","menubar=1,resizable=1,width=500,height=500");t={entity:"ms.carts",customCommandName:"",recordId:r._id,type:"put",data:{client_details:{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,languages:navigator.languages,device:findUserAgent()}},query:{q:{_id:r._id}}};ms.app.call("placeOrderApplepay",t,function(e,t){e?(r.removeMask(),r.locked=!1,e.data&&e.data.cart&&r.updateCart(e.data.cart),console.log("Error occurred in createOrder command",e),a&&a(e)):(r.locked=!1,r.removeMask(),t&&t.data&&r.updateCart(t.data),a&&a())})}},r.add_mask=function(){r.addMask()},r.remove_mask=function(){r.removeMask()},r.add_product=function(e,t){r.addItem(e,t)},r.add_bundle_product=function(e,t,a){var s=1;if(!(s=isNaN(t)?s:t))return a&&a({message:"Invalid Quantity"},null),ms.broadcast("ms.msg.invalid_quantity",{level:"warning"}),!1;var s=parseQuantity(s),n=[{product_id:e._id,quantity:s,variant_id:null,linked_product_id:null,selected_options:{}}];e.bundle_items.forEach(function(e){n.push({product_id:e,quantity:s,variant_id:null,linked_product_id:null,selected_options:{}})}),r.addMultiItems(n,a)},r.remove_product=function(e){r.removeItem(e)},r.apply_coupon=function(e){r.applyCoupon(e)},r.remove_coupon=function(){r.removeCoupon()},r.update_local_storage=function(){},r.from_local_storage=function(e){},r.update_cart=function(e){r.updateCart(e)},r.reorder_cart=function(e){var t;ms.user&&ms.user.isLoggedIn?(t=localStorage.getItem("cart_id"),t=JSON.parse(t)._id):alert("Please login in!"),ms.app.call("reorderCart",{entity:"ms.carts",data:{order:e,user_cart:t}},function(e,t){if(e)throw e;r.updateCart(t.data.cart),ms.goTo("/cart")})},r.isUserLoggedIn=function(){return!(!ms.user||!ms.user.isLoggedIn)},r.empty_cart=function(){r.emptyCart()},r.getShippingMethods=function(e,a){r.addMask();e={entity:"ms.carts",customCommandName:"getShippingMethods",type:"put",data:e,query:{q:{_id:r._id}}};ms.app.call("getShippingMethods",e,function(e,t){r.removeMask(),e?a&&a(e,null):(r.removeMask(),t.data&&t.data.methods&&t.data.methods.length&&(r.available_shipping_methods=t.data.methods,a&&a(null,t.data.methods)))})},r.getPaymentMethods=function(a){r.addMask();var e={entity:"ms.carts",customCommandName:"getPaymentMethods",type:"put",query:{q:{_id:r._id}}};ms.app.call("getPaymentMethods",e,function(e,t){r.removeMask(),e?a&&a(e):t.data&&t.data.methods&&t.data.methods.length?(r.available_payment_methods=t.data.methods,a&&a(null,t.data.methods)):a&&a({message:"No payment avialable"})})};var a={_id:null};ms.localStorage.cart&&ms.localStorage.removeItem("cart"),ms.localStorage.cart_id?a=JSON.parse(ms.localStorage.cart_id):ms.localStorage.setItem("cart_id",JSON.stringify(a)),ms.user&&ms.user._id?e(a._id).then(function(e){ms.trigger("ms.cart_loaded")},function(){}):a._id&&t(a._id).then(function(e){ms.trigger("ms.cart_loaded")},function(){}),ms.bind("ms.user_login",function(){e(r._id,!0),ms.trigger("ms.cart_loaded")}),ms.bind("ms.user_register",function(){ms.user.isLoggedIn&&e(r._id)}),ms.bind("ms.user_logout",function(){ms.localStorage.setItem("cart_id",JSON.stringify({_id:null})),ms.cart.emptyCart()}),ms.bind("ms.order_placed",function(){ms.localStorage.setItem("cart_id",JSON.stringify({_id:null})),ms.cart.emptyCart()}),ms.app.addPrehook({entity:"ms.settings",command:"setPreferences"},function(e,t,a){if(ms.user.isLoggedIn&&ms.settings&&ms.settings.substore_based_cart)return a();if(e.data&&e.data.store&&ms.user&&ms.user.store!=e.data.store)if(ms.cart&&ms.cart.items&&ms.cart.items.length){if(!confirm(ms.filters.translate("Changing the substore will clear the cart")))return t.send(406);a()}else a();else a()}),ms.app.addPosthook({entity:"ms.settings",command:"setPreferences"},function(e,t,a){return ms.user.isLoggedIn&&ms.settings&&ms.settings.substore_based_cart||ms.settings&&ms.settings.clear_cart_based_on_substore?a():void(e.data&&e.data.store&&ms.user&&ms.user.store!=e.data.store&&ms.cart&&ms.cart.items&&ms.cart.items.length?(s=[],ms.cart.items.forEach(function(e,t){0!=t&&s.push(e._id)}),r.removeItem(ms.cart.items[0],!0,function(){a()},s)):a());var s})};ms.bind("ms.initialized",function(){console.log("App initialized"),ms.cart||(ms.cart=new Cart,ms.user._id||ms.cart._id||ms.trigger("ms.cart_loaded"),ms.bind("ms.cart_loaded",function(){ms.settings.minimum_order_value&&"NaN"!=parseInt(ms.settings.minimum_order_value)&&ms.bind("ms.page_change_start",function(e){e&&e.data&&-1<e.data.to.indexOf("checkout")&&parseInt(ms.cart.sub_total)<parseInt(ms.settings.minimum_order_value)&&(e.preventDefault(),ms.broadcast("ms.msg.minimum_order_value_required",{level:"error",data:{minimum_value:window.ms.settings.minimum_order_value}}))})}))});